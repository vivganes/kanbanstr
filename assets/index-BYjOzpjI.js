var Oe=Object.defineProperty;var Fe=(t,e,n)=>e in t?Oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var $=(t,e,n)=>Fe(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const DEV=!1;var is_array=Array.isArray,array_from=Array.from,define_property=Object.defineProperty,get_descriptor=Object.getOwnPropertyDescriptor,get_descriptors=Object.getOwnPropertyDescriptors,object_prototype=Object.prototype,array_prototype=Array.prototype,get_prototype_of=Object.getPrototypeOf;function is_function(t){return typeof t=="function"}const noop=()=>{};function run$2(t){return t()}function run_all(t){for(var e=0;e<t.length;e++)t[e]()}const DERIVED=2,EFFECT=4,RENDER_EFFECT=8,BLOCK_EFFECT=16,BRANCH_EFFECT=32,ROOT_EFFECT=64,BOUNDARY_EFFECT=128,UNOWNED=256,DISCONNECTED=512,CLEAN=1024,DIRTY=2048,MAYBE_DIRTY=4096,INERT=8192,DESTROYED=16384,EFFECT_RAN=32768,EFFECT_TRANSPARENT=65536,LEGACY_DERIVED_PROP=1<<17,HEAD_EFFECT=1<<19,EFFECT_HAS_DERIVED=1<<20,STATE_SYMBOL=Symbol("$state"),LEGACY_PROPS=Symbol("legacy props");function equals(t){return t===this.v}function safe_not_equal(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function safe_equals(t){return!safe_not_equal(t,this.v)}function effect_in_teardown(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function effect_in_unowned_derived(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function effect_orphan(t){throw new Error("https://svelte.dev/e/effect_orphan")}function effect_update_depth_exceeded(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function lifecycle_legacy_only(t){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function props_invalid_value(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function state_descriptors_fixed(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function state_prototype_fixed(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function state_unsafe_local_read(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function state_unsafe_mutation(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let legacy_mode_flag=!1;function enable_legacy_mode_flag(){legacy_mode_flag=!0}const EACH_ITEM_REACTIVE=1,EACH_INDEX_REACTIVE=2,EACH_IS_CONTROLLED=4,EACH_IS_ANIMATED=8,EACH_ITEM_IMMUTABLE=16,PROPS_IS_IMMUTABLE=1,PROPS_IS_RUNES=2,PROPS_IS_UPDATED=4,PROPS_IS_BINDABLE=8,PROPS_IS_LAZY_INITIAL=16,TEMPLATE_FRAGMENT=1,TEMPLATE_USE_IMPORT_NODE=2,UNINITIALIZED=Symbol();function source(t,e){var n={f:0,v:t,reactions:null,equals,version:0};return n}function mutable_source(t,e=!1){var r;const n=source(t);return e||(n.equals=safe_equals),legacy_mode_flag&&component_context!==null&&component_context.l!==null&&((r=component_context.l).s??(r.s=[])).push(n),n}function mutable_state(t,e=!1){return push_derived_source(mutable_source(t,e))}function push_derived_source(t){return active_reaction!==null&&active_reaction.f&DERIVED&&(derived_sources===null?set_derived_sources([t]):derived_sources.push(t)),t}function mutate(t,e){return set(t,untrack(()=>get$1(t))),e}function set(t,e){return active_reaction!==null&&is_runes()&&active_reaction.f&(DERIVED|BLOCK_EFFECT)&&(derived_sources===null||!derived_sources.includes(t))&&state_unsafe_mutation(),internal_set(t,e)}function internal_set(t,e){return t.equals(e)||(t.v=e,t.version=increment_version(),mark_reactions(t,DIRTY),is_runes()&&active_effect!==null&&active_effect.f&CLEAN&&!(active_effect.f&BRANCH_EFFECT)&&(new_deps!==null&&new_deps.includes(t)?(set_signal_status(active_effect,DIRTY),schedule_effect(active_effect)):untracked_writes===null?set_untracked_writes([t]):untracked_writes.push(t))),e}function mark_reactions(t,e){var n=t.reactions;if(n!==null)for(var r=is_runes(),s=n.length,o=0;o<s;o++){var a=n[o],u=a.f;u&DIRTY||!r&&a===active_effect||(set_signal_status(a,e),u&(CLEAN|UNOWNED)&&(u&DERIVED?mark_reactions(a,MAYBE_DIRTY):schedule_effect(a)))}}let hydrating=!1;function proxy(t,e=null,n){if(typeof t!="object"||t===null||STATE_SYMBOL in t)return t;const r=get_prototype_of(t);if(r!==object_prototype&&r!==array_prototype)return t;var s=new Map,o=is_array(t),a=source(0);o&&s.set("length",source(t.length));var u;return new Proxy(t,{defineProperty(l,c,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&state_descriptors_fixed();var h=s.get(c);return h===void 0?(h=source(f.value),s.set(c,h)):set(h,proxy(f.value,u)),!0},deleteProperty(l,c){var f=s.get(c);if(f===void 0)c in l&&s.set(c,source(UNINITIALIZED));else{if(o&&typeof c=="string"){var h=s.get("length"),p=Number(c);Number.isInteger(p)&&p<h.v&&set(h,p)}set(f,UNINITIALIZED),update_version(a)}return!0},get(l,c,f){var g;if(c===STATE_SYMBOL)return t;var h=s.get(c),p=c in l;if(h===void 0&&(!p||(g=get_descriptor(l,c))!=null&&g.writable)&&(h=source(proxy(p?l[c]:UNINITIALIZED,u)),s.set(c,h)),h!==void 0){var m=get$1(h);return m===UNINITIALIZED?void 0:m}return Reflect.get(l,c,f)},getOwnPropertyDescriptor(l,c){var f=Reflect.getOwnPropertyDescriptor(l,c);if(f&&"value"in f){var h=s.get(c);h&&(f.value=get$1(h))}else if(f===void 0){var p=s.get(c),m=p==null?void 0:p.v;if(p!==void 0&&m!==UNINITIALIZED)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return f},has(l,c){var m;if(c===STATE_SYMBOL)return!0;var f=s.get(c),h=f!==void 0&&f.v!==UNINITIALIZED||Reflect.has(l,c);if(f!==void 0||active_effect!==null&&(!h||(m=get_descriptor(l,c))!=null&&m.writable)){f===void 0&&(f=source(h?proxy(l[c],u):UNINITIALIZED),s.set(c,f));var p=get$1(f);if(p===UNINITIALIZED)return!1}return h},set(l,c,f,h){var E;var p=s.get(c),m=c in l;if(o&&c==="length")for(var g=f;g<p.v;g+=1){var b=s.get(g+"");b!==void 0?set(b,UNINITIALIZED):g in l&&(b=source(UNINITIALIZED),s.set(g+"",b))}p===void 0?(!m||(E=get_descriptor(l,c))!=null&&E.writable)&&(p=source(void 0),set(p,proxy(f,u)),s.set(c,p)):(m=p.v!==UNINITIALIZED,set(p,proxy(f,u)));var y=Reflect.getOwnPropertyDescriptor(l,c);if(y!=null&&y.set&&y.set.call(h,f),!m){if(o&&typeof c=="string"){var _=s.get("length"),x=Number(c);Number.isInteger(x)&&x>=_.v&&set(_,x+1)}update_version(a)}return!0},ownKeys(l){get$1(a);var c=Reflect.ownKeys(l).filter(p=>{var m=s.get(p);return m===void 0||m.v!==UNINITIALIZED});for(var[f,h]of s)h.v!==UNINITIALIZED&&!(f in l)&&c.push(f);return c},setPrototypeOf(){state_prototype_fixed()}})}function update_version(t,e=1){set(t,t.v+e)}function get_proxied_value(t){return t!==null&&typeof t=="object"&&STATE_SYMBOL in t?t[STATE_SYMBOL]:t}function is(t,e){return Object.is(get_proxied_value(t),get_proxied_value(e))}var $window,first_child_getter,next_sibling_getter;function init_operations(){if($window===void 0){$window=window;var t=Element.prototype,e=Node.prototype;first_child_getter=get_descriptor(e,"firstChild").get,next_sibling_getter=get_descriptor(e,"nextSibling").get,t.__click=void 0,t.__className="",t.__attributes=null,t.__styles=null,t.__e=void 0,Text.prototype.__t=void 0}}function create_text(t=""){return document.createTextNode(t)}function get_first_child(t){return first_child_getter.call(t)}function get_next_sibling(t){return next_sibling_getter.call(t)}function child(t,e){return get_first_child(t)}function first_child(t,e){{var n=get_first_child(t);return n instanceof Comment&&n.data===""?get_next_sibling(n):n}}function sibling(t,e=1,n=!1){let r=t;for(;e--;)r=get_next_sibling(r);return r}function clear_text_content(t){t.textContent=""}function derived$1(t){var e=DERIVED|DIRTY;active_effect===null?e|=UNOWNED:active_effect.f|=EFFECT_HAS_DERIVED;var n=active_reaction!==null&&active_reaction.f&DERIVED?active_reaction:null;const r={children:null,ctx:component_context,deps:null,equals,f:e,fn:t,reactions:null,v:null,version:0,parent:n??active_effect};return n!==null&&(n.children??(n.children=[])).push(r),r}function derived_safe_equal(t){const e=derived$1(t);return e.equals=safe_equals,e}function destroy_derived_children(t){var e=t.children;if(e!==null){t.children=null;for(var n=0;n<e.length;n+=1){var r=e[n];r.f&DERIVED?destroy_derived(r):destroy_effect(r)}}}function get_derived_parent_effect(t){for(var e=t.parent;e!==null;){if(!(e.f&DERIVED))return e;e=e.parent}return null}function execute_derived(t){var e,n=active_effect;set_active_effect(get_derived_parent_effect(t));try{destroy_derived_children(t),e=update_reaction(t)}finally{set_active_effect(n)}return e}function update_derived(t){var e=execute_derived(t),n=(skip_reaction||t.f&UNOWNED)&&t.deps!==null?MAYBE_DIRTY:CLEAN;set_signal_status(t,n),t.equals(e)||(t.v=e,t.version=increment_version())}function destroy_derived(t){destroy_derived_children(t),remove_reactions(t,0),set_signal_status(t,DESTROYED),t.v=t.children=t.deps=t.ctx=t.reactions=null}function validate_effect(t){active_effect===null&&active_reaction===null&&effect_orphan(),active_reaction!==null&&active_reaction.f&UNOWNED&&effect_in_unowned_derived(),is_destroying_effect&&effect_in_teardown()}function push_effect(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function create_effect(t,e,n,r=!0){var s=(t&ROOT_EFFECT)!==0,o=active_effect,a={ctx:component_context,deps:null,deriveds:null,nodes_start:null,nodes_end:null,f:t|DIRTY,first:null,fn:e,last:null,next:null,parent:s?null:o,prev:null,teardown:null,transitions:null,version:0};if(n){var u=is_flushing_effect;try{set_is_flushing_effect(!0),update_effect(a),a.f|=EFFECT_RAN}catch(f){throw destroy_effect(a),f}finally{set_is_flushing_effect(u)}}else e!==null&&schedule_effect(a);var l=n&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&EFFECT_HAS_DERIVED)===0;if(!l&&!s&&r&&(o!==null&&push_effect(a,o),active_reaction!==null&&active_reaction.f&DERIVED)){var c=active_reaction;(c.children??(c.children=[])).push(a)}return a}function teardown(t){const e=create_effect(RENDER_EFFECT,null,!1);return set_signal_status(e,CLEAN),e.teardown=t,e}function user_effect(t){validate_effect();var e=active_effect!==null&&(active_effect.f&BRANCH_EFFECT)!==0&&component_context!==null&&!component_context.m;if(e){var n=component_context;(n.e??(n.e=[])).push({fn:t,effect:active_effect,reaction:active_reaction})}else{var r=effect(t);return r}}function user_pre_effect(t){return validate_effect(),render_effect(t)}function component_root(t){const e=create_effect(ROOT_EFFECT,t,!0);return(n={})=>new Promise(r=>{n.outro?pause_effect(e,()=>{destroy_effect(e),r(void 0)}):(destroy_effect(e),r(void 0))})}function effect(t){return create_effect(EFFECT,t,!1)}function legacy_pre_effect(t,e){var n=component_context,r={effect:null,ran:!1};n.l.r1.push(r),r.effect=render_effect(()=>{t(),!r.ran&&(r.ran=!0,set(n.l.r2,!0),untrack(e))})}function legacy_pre_effect_reset(){var t=component_context;render_effect(()=>{if(get$1(t.l.r2)){for(var e of t.l.r1){var n=e.effect;n.f&CLEAN&&set_signal_status(n,MAYBE_DIRTY),check_dirtiness(n)&&update_effect(n),e.ran=!1}t.l.r2.v=!1}})}function render_effect(t){return create_effect(RENDER_EFFECT,t,!0)}function template_effect(t){return block$1(t)}function block$1(t,e=0){return create_effect(RENDER_EFFECT|BLOCK_EFFECT|e,t,!0)}function branch(t,e=!0){return create_effect(RENDER_EFFECT|BRANCH_EFFECT,t,!0,e)}function execute_effect_teardown(t){var e=t.teardown;if(e!==null){const n=is_destroying_effect,r=active_reaction;set_is_destroying_effect(!0),set_active_reaction(null);try{e.call(null)}finally{set_is_destroying_effect(n),set_active_reaction(r)}}}function destroy_effect_deriveds(t){var e=t.deriveds;if(e!==null){t.deriveds=null;for(var n=0;n<e.length;n+=1)destroy_derived(e[n])}}function destroy_effect_children(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){var r=n.next;destroy_effect(n,e),n=r}}function destroy_block_effect_children(t){for(var e=t.first;e!==null;){var n=e.next;e.f&BRANCH_EFFECT||destroy_effect(e),e=n}}function destroy_effect(t,e=!0){var n=!1;if((e||t.f&HEAD_EFFECT)&&t.nodes_start!==null){for(var r=t.nodes_start,s=t.nodes_end;r!==null;){var o=r===s?null:get_next_sibling(r);r.remove(),r=o}n=!0}destroy_effect_children(t,e&&!n),destroy_effect_deriveds(t),remove_reactions(t,0),set_signal_status(t,DESTROYED);var a=t.transitions;if(a!==null)for(const l of a)l.stop();execute_effect_teardown(t);var u=t.parent;u!==null&&u.first!==null&&unlink_effect(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=null}function unlink_effect(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function pause_effect(t,e){var n=[];pause_children(t,n,!0),run_out_transitions(n,()=>{destroy_effect(t),e&&e()})}function run_out_transitions(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var s of t)s.out(r)}else e()}function pause_children(t,e,n){if(!(t.f&INERT)){if(t.f^=INERT,t.transitions!==null)for(const a of t.transitions)(a.is_global||n)&&e.push(a);for(var r=t.first;r!==null;){var s=r.next,o=(r.f&EFFECT_TRANSPARENT)!==0||(r.f&BRANCH_EFFECT)!==0;pause_children(r,e,o?n:!1),r=s}}}function resume_effect(t){resume_children(t,!0)}function resume_children(t,e){if(t.f&INERT){check_dirtiness(t)&&update_effect(t),t.f^=INERT;for(var n=t.first;n!==null;){var r=n.next,s=(n.f&EFFECT_TRANSPARENT)!==0||(n.f&BRANCH_EFFECT)!==0;resume_children(n,s?e:!1),n=r}if(t.transitions!==null)for(const o of t.transitions)(o.is_global||e)&&o.in()}}let is_micro_task_queued$1=!1,current_queued_micro_tasks=[];function process_micro_tasks(){is_micro_task_queued$1=!1;const t=current_queued_micro_tasks.slice();current_queued_micro_tasks=[],run_all(t)}function queue_micro_task(t){is_micro_task_queued$1||(is_micro_task_queued$1=!0,queueMicrotask(process_micro_tasks)),current_queued_micro_tasks.push(t)}function flush_tasks(){is_micro_task_queued$1&&process_micro_tasks()}function lifecycle_outside_component(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}const FLUSH_MICROTASK=0,FLUSH_SYNC=1;let is_throwing_error=!1,scheduler_mode=FLUSH_MICROTASK,is_micro_task_queued=!1,last_scheduled_effect=null,is_flushing_effect=!1,is_destroying_effect=!1;function set_is_flushing_effect(t){is_flushing_effect=t}function set_is_destroying_effect(t){is_destroying_effect=t}let queued_root_effects=[],flush_count=0,dev_effect_stack=[],active_reaction=null;function set_active_reaction(t){active_reaction=t}let active_effect=null;function set_active_effect(t){active_effect=t}let derived_sources=null;function set_derived_sources(t){derived_sources=t}let new_deps=null,skipped_deps=0,untracked_writes=null;function set_untracked_writes(t){untracked_writes=t}let current_version=1,skip_reaction=!1,component_context=null;function increment_version(){return++current_version}function is_runes(){return!legacy_mode_flag||component_context!==null&&component_context.l===null}function check_dirtiness(t){var a,u;var e=t.f;if(e&DIRTY)return!0;if(e&MAYBE_DIRTY){var n=t.deps,r=(e&UNOWNED)!==0;if(n!==null){var s;if(e&DISCONNECTED){for(s=0;s<n.length;s++)((a=n[s]).reactions??(a.reactions=[])).push(t);t.f^=DISCONNECTED}for(s=0;s<n.length;s++){var o=n[s];if(check_dirtiness(o)&&update_derived(o),r&&active_effect!==null&&!skip_reaction&&!((u=o==null?void 0:o.reactions)!=null&&u.includes(t))&&(o.reactions??(o.reactions=[])).push(t),o.version>t.version)return!0}}(!r||active_effect!==null&&!skip_reaction)&&set_signal_status(t,CLEAN)}return!1}function propagate_error(t,e){for(var n=e;n!==null;){if(n.f&BOUNDARY_EFFECT)try{n.fn(t);return}catch{n.f^=BOUNDARY_EFFECT}n=n.parent}throw is_throwing_error=!1,t}function should_rethrow_error(t){return(t.f&DESTROYED)===0&&(t.parent===null||(t.parent.f&BOUNDARY_EFFECT)===0)}function handle_error(t,e,n,r){if(is_throwing_error){if(n===null&&(is_throwing_error=!1),should_rethrow_error(e))throw t;return}n!==null&&(is_throwing_error=!0);{propagate_error(t,e);return}}function update_reaction(t){var p;var e=new_deps,n=skipped_deps,r=untracked_writes,s=active_reaction,o=skip_reaction,a=derived_sources,u=component_context,l=t.f;new_deps=null,skipped_deps=0,untracked_writes=null,active_reaction=l&(BRANCH_EFFECT|ROOT_EFFECT)?null:t,skip_reaction=!is_flushing_effect&&(l&UNOWNED)!==0,derived_sources=null,component_context=t.ctx;try{var c=(0,t.fn)(),f=t.deps;if(new_deps!==null){var h;if(remove_reactions(t,skipped_deps),f!==null&&skipped_deps>0)for(f.length=skipped_deps+new_deps.length,h=0;h<new_deps.length;h++)f[skipped_deps+h]=new_deps[h];else t.deps=f=new_deps;if(!skip_reaction)for(h=skipped_deps;h<f.length;h++)((p=f[h]).reactions??(p.reactions=[])).push(t)}else f!==null&&skipped_deps<f.length&&(remove_reactions(t,skipped_deps),f.length=skipped_deps);return c}finally{new_deps=e,skipped_deps=n,untracked_writes=r,active_reaction=s,skip_reaction=o,derived_sources=a,component_context=u}}function remove_reaction(t,e){let n=e.reactions;if(n!==null){var r=n.indexOf(t);if(r!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[r]=n[s],n.pop())}}n===null&&e.f&DERIVED&&(new_deps===null||!new_deps.includes(e))&&(set_signal_status(e,MAYBE_DIRTY),e.f&(UNOWNED|DISCONNECTED)||(e.f^=DISCONNECTED),remove_reactions(e,0))}function remove_reactions(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)remove_reaction(t,n[r])}function update_effect(t){var e=t.f;if(!(e&DESTROYED)){set_signal_status(t,CLEAN);var n=active_effect,r=component_context;active_effect=t;try{e&BLOCK_EFFECT?destroy_block_effect_children(t):destroy_effect_children(t),destroy_effect_deriveds(t),execute_effect_teardown(t);var s=update_reaction(t);t.teardown=typeof s=="function"?s:null,t.version=current_version}catch(o){handle_error(o,t,n,r||t.ctx)}finally{active_effect=n}}}function infinite_loop_guard(){if(flush_count>1e3){flush_count=0;try{effect_update_depth_exceeded()}catch(t){if(last_scheduled_effect!==null)handle_error(t,last_scheduled_effect,null);else throw t}}flush_count++}function flush_queued_root_effects(t){var e=t.length;if(e!==0){infinite_loop_guard();var n=is_flushing_effect;is_flushing_effect=!0;try{for(var r=0;r<e;r++){var s=t[r];s.f&CLEAN||(s.f^=CLEAN);var o=[];process_effects(s,o),flush_queued_effects(o)}}finally{is_flushing_effect=n}}}function flush_queued_effects(t){var e=t.length;if(e!==0)for(var n=0;n<e;n++){var r=t[n];if(!(r.f&(DESTROYED|INERT)))try{check_dirtiness(r)&&(update_effect(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?unlink_effect(r):r.fn=null))}catch(s){handle_error(s,r,null,r.ctx)}}}function process_deferred(){if(is_micro_task_queued=!1,flush_count>1001)return;const t=queued_root_effects;queued_root_effects=[],flush_queued_root_effects(t),is_micro_task_queued||(flush_count=0,last_scheduled_effect=null)}function schedule_effect(t){scheduler_mode===FLUSH_MICROTASK&&(is_micro_task_queued||(is_micro_task_queued=!0,queueMicrotask(process_deferred))),last_scheduled_effect=t;for(var e=t;e.parent!==null;){e=e.parent;var n=e.f;if(n&(ROOT_EFFECT|BRANCH_EFFECT)){if(!(n&CLEAN))return;e.f^=CLEAN}}queued_root_effects.push(e)}function process_effects(t,e){var n=t.first,r=[];e:for(;n!==null;){var s=n.f,o=(s&BRANCH_EFFECT)!==0,a=o&&(s&CLEAN)!==0,u=n.next;if(!a&&!(s&INERT))if(s&RENDER_EFFECT){if(o)n.f^=CLEAN;else try{check_dirtiness(n)&&update_effect(n)}catch(h){handle_error(h,n,null,n.ctx)}var l=n.first;if(l!==null){n=l;continue}}else s&EFFECT&&r.push(n);if(u===null){let h=n.parent;for(;h!==null;){if(t===h)break e;var c=h.next;if(c!==null){n=c;continue e}h=h.parent}}n=u}for(var f=0;f<r.length;f++)l=r[f],e.push(l),process_effects(l,e)}function flush_sync(t){var e=scheduler_mode,n=queued_root_effects;try{infinite_loop_guard();const s=[];scheduler_mode=FLUSH_SYNC,queued_root_effects=s,is_micro_task_queued=!1,flush_queued_root_effects(n);var r=t==null?void 0:t();return flush_tasks(),(queued_root_effects.length>0||s.length>0)&&flush_sync(),flush_count=0,last_scheduled_effect=null,r}finally{scheduler_mode=e,queued_root_effects=n}}async function tick(){await Promise.resolve(),flush_sync()}function get$1(t){var f;var e=t.f,n=(e&DERIVED)!==0;if(n&&e&DESTROYED){var r=execute_derived(t);return destroy_derived(t),r}if(active_reaction!==null){derived_sources!==null&&derived_sources.includes(t)&&state_unsafe_local_read();var s=active_reaction.deps;new_deps===null&&s!==null&&s[skipped_deps]===t?skipped_deps++:new_deps===null?new_deps=[t]:new_deps.push(t),untracked_writes!==null&&active_effect!==null&&active_effect.f&CLEAN&&!(active_effect.f&BRANCH_EFFECT)&&untracked_writes.includes(t)&&(set_signal_status(active_effect,DIRTY),schedule_effect(active_effect))}else if(n&&t.deps===null)for(var o=t,a=o.parent,u=o;a!==null;)if(a.f&DERIVED){var l=a;u=l,a=l.parent}else{var c=a;(f=c.deriveds)!=null&&f.includes(u)||(c.deriveds??(c.deriveds=[])).push(u);break}return n&&(o=t,check_dirtiness(o)&&update_derived(o)),t.v}function untrack(t){const e=active_reaction;try{return active_reaction=null,t()}finally{active_reaction=e}}const STATUS_MASK=~(DIRTY|MAYBE_DIRTY|CLEAN);function set_signal_status(t,e){t.f=t.f&STATUS_MASK|e}function push$1(t,e=!1,n){component_context={p:component_context,c:null,e:null,m:!1,s:t,x:null,l:null},legacy_mode_flag&&!e&&(component_context.l={s:null,u:null,r1:[],r2:source(!1)})}function pop(t){const e=component_context;if(e!==null){const a=e.e;if(a!==null){var n=active_effect,r=active_reaction;e.e=null;try{for(var s=0;s<a.length;s++){var o=a[s];set_active_effect(o.effect),set_active_reaction(o.reaction),effect(o.fn)}}finally{set_active_effect(n),set_active_reaction(r)}}component_context=e.p,e.m=!0}return{}}function deep_read_state(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(STATE_SYMBOL in t)deep_read(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&STATE_SYMBOL in n&&deep_read(n)}}}function deep_read(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{deep_read(t[r],e)}catch{}const n=get_prototype_of(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=get_descriptors(n);for(let s in r){const o=r[s].get;if(o)try{o.call(t)}catch{}}}}}const PASSIVE_EVENTS=["touchstart","touchmove"];function is_passive_event(t){return PASSIVE_EVENTS.includes(t)}function autofocus(t,e){{const n=document.body;t.autofocus=!0,queue_micro_task(()=>{document.activeElement===n&&t.focus()})}}let listening_to_form_reset=!1;function add_form_reset_listener(){listening_to_form_reset||(listening_to_form_reset=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function without_reactive_context(t){var e=active_reaction,n=active_effect;set_active_reaction(null),set_active_effect(null);try{return t()}finally{set_active_reaction(e),set_active_effect(n)}}function listen_to_event_and_reset_event(t,e,n,r=n){t.addEventListener(e,()=>without_reactive_context(n));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),add_form_reset_listener()}const all_registered_events=new Set,root_event_handles=new Set;function create_event(t,e,n,r){function s(o){if(r.capture||handle_event_propagation.call(e,o),!o.cancelBubble)return without_reactive_context(()=>n.call(this,o))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?queue_micro_task(()=>{e.addEventListener(t,s,r)}):e.addEventListener(t,s,r),s}function event(t,e,n,r,s){var o={capture:r,passive:s},a=create_event(t,e,n,o);(e===document.body||e===window||e===document)&&teardown(()=>{e.removeEventListener(t,a,o)})}function handle_event_propagation(t){var x;var e=this,n=e.ownerDocument,r=t.type,s=((x=t.composedPath)==null?void 0:x.call(t))||[],o=s[0]||t.target,a=0,u=t.__root;if(u){var l=s.indexOf(u);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=s.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(o=s[a]||t.target,o!==e){define_property(t,"currentTarget",{configurable:!0,get(){return o||n}});var f=active_reaction,h=active_effect;set_active_reaction(null),set_active_effect(null);try{for(var p,m=[];o!==null;){var g=o.assignedSlot||o.parentNode||o.host||null;try{var b=o["__"+r];if(b!==void 0&&!o.disabled)if(is_array(b)){var[y,..._]=b;y.apply(o,[t,..._])}else b.call(o,t)}catch(E){p?m.push(E):p=E}if(t.cancelBubble||g===e||g===null)break;o=g}if(p){for(let E of m)queueMicrotask(()=>{throw E});throw p}}finally{t.__root=e,delete t.currentTarget,set_active_reaction(f),set_active_effect(h)}}}function create_fragment_from_html(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function assign_nodes(t,e){var n=active_effect;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function template(t,e){var n=(e&TEMPLATE_FRAGMENT)!==0,r=(e&TEMPLATE_USE_IMPORT_NODE)!==0,s,o=!t.startsWith("<!>");return()=>{s===void 0&&(s=create_fragment_from_html(o?t:"<!>"+t),n||(s=get_first_child(s)));var a=r?document.importNode(s,!0):s.cloneNode(!0);if(n){var u=get_first_child(a),l=a.lastChild;assign_nodes(u,l)}else assign_nodes(a,a);return a}}function text$1(t=""){{var e=create_text(t+"");return assign_nodes(e,e),e}}function comment$1(){var t=document.createDocumentFragment(),e=document.createComment(""),n=create_text();return t.append(e,n),assign_nodes(e,n),t}function append(t,e){t!==null&&t.before(e)}function set_text(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n==null?"":n+"")}function mount(t,e){return _mount(t,e)}const document_listeners=new Map;function _mount(t,{target:e,anchor:n,props:r={},events:s,context:o,intro:a=!0}){init_operations();var u=new Set,l=h=>{for(var p=0;p<h.length;p++){var m=h[p];if(!u.has(m)){u.add(m);var g=is_passive_event(m);e.addEventListener(m,handle_event_propagation,{passive:g});var b=document_listeners.get(m);b===void 0?(document.addEventListener(m,handle_event_propagation,{passive:g}),document_listeners.set(m,1)):document_listeners.set(m,b+1)}}};l(array_from(all_registered_events)),root_event_handles.add(l);var c=void 0,f=component_root(()=>{var h=n??e.appendChild(create_text());return branch(()=>{if(o){push$1({});var p=component_context;p.c=o}s&&(r.$$events=s),c=t(h,r)||{},o&&pop()}),()=>{var g;for(var p of u){e.removeEventListener(p,handle_event_propagation);var m=document_listeners.get(p);--m===0?(document.removeEventListener(p,handle_event_propagation),document_listeners.delete(p)):document_listeners.set(p,m)}root_event_handles.delete(l),h!==n&&((g=h.parentNode)==null||g.removeChild(h))}});return mounted_components.set(c,f),c}let mounted_components=new WeakMap;function if_block(t,e,n=!1){var r=t,s=null,o=null,a=UNINITIALIZED,u=n?EFFECT_TRANSPARENT:0,l=!1;const c=(h,p=!0)=>{l=!0,f(p,h)},f=(h,p)=>{a!==(a=h)&&(a?(s?resume_effect(s):p&&(s=branch(()=>p(r))),o&&pause_effect(o,()=>{o=null})):(o?resume_effect(o):p&&(o=branch(()=>p(r))),s&&pause_effect(s,()=>{s=null})))};block$1(()=>{l=!1,e(c),l||f(null,null)},u)}function index$1(t,e){return e}function pause_effects(t,e,n,r){for(var s=[],o=e.length,a=0;a<o;a++)pause_children(e[a].e,s,!0);var u=o>0&&s.length===0&&n!==null;if(u){var l=n.parentNode;clear_text_content(l),l.append(n),r.clear(),link$1(t,e[0].prev,e[o-1].next)}run_out_transitions(s,()=>{for(var c=0;c<o;c++){var f=e[c];u||(r.delete(f.k),link$1(t,f.prev,f.next)),destroy_effect(f.e,!u)}})}function each(t,e,n,r,s,o=null){var a=t,u={flags:e,items:new Map,first:null},l=(e&EACH_IS_CONTROLLED)!==0;if(l){var c=t;a=c.appendChild(create_text())}var f=null,h=!1;block$1(()=>{var p=n(),m=is_array(p)?p:p==null?[]:array_from(p),g=m.length;if(!(h&&g===0)){h=g===0;{var b=active_reaction;reconcile(m,u,a,s,e,(b.f&INERT)!==0,r)}o!==null&&(g===0?f?resume_effect(f):f=branch(()=>o(a)):f!==null&&pause_effect(f,()=>{f=null})),n()}})}function reconcile(t,e,n,r,s,o,a,u){var D,N,F,z;var l=(s&EACH_IS_ANIMATED)!==0,c=(s&(EACH_ITEM_REACTIVE|EACH_INDEX_REACTIVE))!==0,f=t.length,h=e.items,p=e.first,m=p,g,b=null,y,_=[],x=[],E,A,v,w;if(l)for(w=0;w<f;w+=1)E=t[w],A=a(E,w),v=h.get(A),v!==void 0&&((D=v.a)==null||D.measure(),(y??(y=new Set)).add(v));for(w=0;w<f;w+=1){if(E=t[w],A=a(E,w),v=h.get(A),v===void 0){var k=m?m.e.nodes_start:n;b=create_item(k,e,b,b===null?e.first:b.next,E,A,w,r,s),h.set(A,b),_=[],x=[],m=b.next;continue}if(c&&update_item(v,E,w,s),v.e.f&INERT&&(resume_effect(v.e),l&&((N=v.a)==null||N.unfix(),(y??(y=new Set)).delete(v))),v!==m){if(g!==void 0&&g.has(v)){if(_.length<x.length){var S=x[0],T;b=S.prev;var O=_[0],C=_[_.length-1];for(T=0;T<_.length;T+=1)move(_[T],S,n);for(T=0;T<x.length;T+=1)g.delete(x[T]);link$1(e,O.prev,C.next),link$1(e,b,O),link$1(e,C,S),m=S,b=C,w-=1,_=[],x=[]}else g.delete(v),move(v,m,n),link$1(e,v.prev,v.next),link$1(e,v,b===null?e.first:b.next),link$1(e,b,v),b=v;continue}for(_=[],x=[];m!==null&&m.k!==A;)(o||!(m.e.f&INERT))&&(g??(g=new Set)).add(m),x.push(m),m=m.next;if(m===null)continue;v=m}_.push(v),b=v,m=v.next}if(m!==null||g!==void 0){for(var R=g===void 0?[]:array_from(g);m!==null;)(o||!(m.e.f&INERT))&&R.push(m),m=m.next;var M=R.length;if(M>0){var I=s&EACH_IS_CONTROLLED&&f===0?n:null;if(l){for(w=0;w<M;w+=1)(F=R[w].a)==null||F.measure();for(w=0;w<M;w+=1)(z=R[w].a)==null||z.fix()}pause_effects(e,R,I,h)}}l&&queue_micro_task(()=>{var U;if(y!==void 0)for(v of y)(U=v.a)==null||U.apply()}),active_effect.first=e.first&&e.first.e,active_effect.last=b&&b.e}function update_item(t,e,n,r){r&EACH_ITEM_REACTIVE&&internal_set(t.v,e),r&EACH_INDEX_REACTIVE?internal_set(t.i,n):t.i=n}function create_item(t,e,n,r,s,o,a,u,l,c){var f=(l&EACH_ITEM_REACTIVE)!==0,h=(l&EACH_ITEM_IMMUTABLE)===0,p=f?h?mutable_source(s):source(s):s,m=l&EACH_INDEX_REACTIVE?source(a):a,g={i:m,v:p,k:o,a:null,e:null,prev:n,next:r};try{return g.e=branch(()=>u(t,p,m),hydrating),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?e.first=g:(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function move(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,s=e?e.e.nodes_start:n,o=t.e.nodes_start;o!==r;){var a=get_next_sibling(o);s.before(o),o=a}}function link$1(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function component(t,e,n){var r=t,s,o;block$1(()=>{s!==(s=e())&&(o&&(pause_effect(o),o=null),s&&(o=branch(()=>n(r,s))))},EFFECT_TRANSPARENT)}function set_value(t,e){var n=t.__attributes??(t.__attributes={});n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e)}function set_attribute(t,e,n,r){var s=t.__attributes??(t.__attributes={});s[e]!==(s[e]=n)&&(n==null?t.removeAttribute(e):typeof n!="string"&&get_setters(t).includes(e)?t[e]=n:t.setAttribute(e,n))}var setters_cache=new Map;function get_setters(t){var e=setters_cache.get(t.nodeName);if(e)return e;setters_cache.set(t.nodeName,e=[]);for(var n,r=t,s=Element.prototype;s!==r;){n=get_descriptors(r);for(var o in n)n[o].set&&e.push(o);r=get_prototype_of(r)}return e}function toggle_class(t,e,n){if(n){if(t.classList.contains(e))return;t.classList.add(e)}else{if(!t.classList.contains(e))return;t.classList.remove(e)}}function bind_value(t,e,n=e){var r=is_runes();listen_to_event_and_reset_event(t,"input",s=>{var o=s?t.defaultValue:t.value;if(o=is_numberlike_input(t)?to_number(o):o,n(o),r&&o!==(o=e())){var a=t.selectionStart,u=t.selectionEnd;t.value=o??"",u!==null&&(t.selectionStart=a,t.selectionEnd=Math.min(u,t.value.length))}}),untrack(e)==null&&t.value&&n(is_numberlike_input(t)?to_number(t.value):t.value),render_effect(()=>{var s=e();is_numberlike_input(t)&&s===to_number(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}const pending=new Set;function bind_group(t,e,n,r,s=r){var o=n.getAttribute("type")==="checkbox",a=t;if(e!==null)for(var u of e)a=a[u]??(a[u]=[]);a.push(n),listen_to_event_and_reset_event(n,"change",()=>{var l=n.__value;o&&(l=get_binding_group_value(a,l,n.checked)),s(l)},()=>s(o?[]:null)),render_effect(()=>{var l=r();o?(l=l||[],n.checked=l.includes(n.__value)):n.checked=is(n.__value,l)}),teardown(()=>{var l=a.indexOf(n);l!==-1&&a.splice(l,1)}),pending.has(a)||(pending.add(a),queue_micro_task(()=>{a.sort((l,c)=>l.compareDocumentPosition(c)===4?-1:1),pending.delete(a)})),queue_micro_task(()=>{})}function get_binding_group_value(t,e,n){for(var r=new Set,s=0;s<t.length;s+=1)t[s].checked&&r.add(t[s].__value);return n||r.delete(e),Array.from(r)}function is_numberlike_input(t){var e=t.type;return e==="number"||e==="range"}function to_number(t){return t===""?null:+t}function is_bound_this(t,e){return t===e||(t==null?void 0:t[STATE_SYMBOL])===e}function bind_this(t={},e,n,r){return effect(()=>{var s,o;return render_effect(()=>{s=o,o=[],untrack(()=>{t!==n(...o)&&(e(t,...o),s&&is_bound_this(n(...s),t)&&e(null,...s))})}),()=>{queue_micro_task(()=>{o&&is_bound_this(n(...o),t)&&e(null,...o)})}}),t}function stopPropagation(t){return function(...e){var n=e[0];return n.stopPropagation(),t==null?void 0:t.apply(this,e)}}function preventDefault(t){return function(...e){var n=e[0];return n.preventDefault(),t==null?void 0:t.apply(this,e)}}function init(t=!1){const e=component_context,n=e.l.u;if(!n)return;let r=()=>deep_read_state(e.s);if(t){let s=0,o={};const a=derived$1(()=>{let u=!1;const l=e.s;for(const c in l)l[c]!==o[c]&&(o[c]=l[c],u=!0);return u&&s++,s});r=()=>get$1(a)}n.b.length&&user_pre_effect(()=>{observe_all(e,r),run_all(n.b)}),user_effect(()=>{const s=untrack(()=>n.m.map(run$2));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&user_effect(()=>{observe_all(e,r),run_all(n.a)})}function observe_all(t,e){if(t.l.s)for(const n of t.l.s)get$1(n);e()}function bubble_event(t,e){var o;var n=(o=t.$$events)==null?void 0:o[e.type],r=is_array(n)?n.slice():n==null?[]:[n];for(var s of r)s.call(this,e)}function subscribe_to_store(t,e,n){if(t==null)return e(void 0),n&&n(void 0),noop;const r=untrack(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}let is_store_binding=!1;function capture_store_binding(t){var e=is_store_binding;try{return is_store_binding=!1,[t(),is_store_binding]}finally{is_store_binding=e}}const spread_props_handler={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(is_function(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let s=t.props[r];is_function(s)&&(s=s());const o=get_descriptor(s,e);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(is_function(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const s=get_descriptor(r,e);return s&&!s.configurable&&(s.configurable=!0),s}}},has(t,e){if(e===STATE_SYMBOL||e===LEGACY_PROPS)return!1;for(let n of t.props)if(is_function(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props){is_function(n)&&(n=n());for(const r in n)e.includes(r)||e.push(r)}return e}};function spread_props(...t){return new Proxy({props:t},spread_props_handler)}function with_parent_branch(t){for(var e=active_effect,n=active_effect;e!==null&&!(e.f&(BRANCH_EFFECT|ROOT_EFFECT));)e=e.parent;try{return set_active_effect(e),t()}finally{set_active_effect(n)}}function prop(t,e,n,r){var k;var s=(n&PROPS_IS_IMMUTABLE)!==0,o=!legacy_mode_flag||(n&PROPS_IS_RUNES)!==0,a=(n&PROPS_IS_BINDABLE)!==0,u=(n&PROPS_IS_LAZY_INITIAL)!==0,l=!1,c;a?[c,l]=capture_store_binding(()=>t[e]):c=t[e];var f=STATE_SYMBOL in t||LEGACY_PROPS in t,h=((k=get_descriptor(t,e))==null?void 0:k.set)??(f&&a&&e in t?S=>t[e]=S:void 0),p=r,m=!0,g=!1,b=()=>(g=!0,m&&(m=!1,u?p=untrack(r):p=r),p);c===void 0&&r!==void 0&&(h&&o&&props_invalid_value(),c=b(),h&&h(c));var y;if(o)y=()=>{var S=t[e];return S===void 0?b():(m=!0,g=!1,S)};else{var _=with_parent_branch(()=>(s?derived$1:derived_safe_equal)(()=>t[e]));_.f|=LEGACY_DERIVED_PROP,y=()=>{var S=get$1(_);return S!==void 0&&(p=void 0),S===void 0?p:S}}if(!(n&PROPS_IS_UPDATED))return y;if(h){var x=t.$$legacy;return function(S,T){return arguments.length>0?((!o||!T||x||l)&&h(T?y():S),S):y()}}var E=!1,A=!1,v=mutable_source(c),w=with_parent_branch(()=>derived$1(()=>{var S=y(),T=get$1(v);return E?(E=!1,A=!0,T):(A=!1,v.v=S)}));return s||(w.equals=safe_equals),function(S,T){if(arguments.length>0){const O=T?get$1(w):o&&a?proxy(S):S;return w.equals(O)||(E=!0,set(v,O),g&&p!==void 0&&(p=O),untrack(()=>get$1(w))),S}return get$1(w)}}function onMount(t){component_context===null&&lifecycle_outside_component(),legacy_mode_flag&&component_context.l!==null?init_update_callbacks(component_context).m.push(t):user_effect(()=>{const e=untrack(t);if(typeof e=="function")return e})}function onDestroy(t){component_context===null&&lifecycle_outside_component(),onMount(()=>()=>untrack(t))}function create_custom_event(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}function createEventDispatcher(){const t=component_context;return t===null&&lifecycle_outside_component(),(e,n,r)=>{var o;const s=(o=t.s.$$events)==null?void 0:o[e];if(s){const a=is_array(s)?s.slice():[s],u=create_custom_event(e,n,r);for(const l of a)l.call(t.x,u);return!u.defaultPrevented}return!0}}function afterUpdate(t){component_context===null&&lifecycle_outside_component(),component_context.l===null&&lifecycle_legacy_only(),init_update_callbacks(component_context).a.push(t)}function init_update_callbacks(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const PUBLIC_VERSION="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(PUBLIC_VERSION);enable_legacy_mode_flag();const subscriber_queue=[];function readable(t,e){return{subscribe:writable(t,e).subscribe}}function writable(t,e=noop){let n=null;const r=new Set;function s(u){if(safe_not_equal(t,u)&&(t=u,n)){const l=!subscriber_queue.length;for(const c of r)c[1](),subscriber_queue.push(c,t);if(l){for(let c=0;c<subscriber_queue.length;c+=2)subscriber_queue[c][0](subscriber_queue[c+1]);subscriber_queue.length=0}}}function o(u){s(u(t))}function a(u,l=noop){const c=[u,l];return r.add(c),r.size===1&&(n=e(s,o)||noop),u(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:a}}function derived(t,e,n){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return readable(n,(a,u)=>{let l=!1;const c=[];let f=0,h=noop;const p=()=>{if(f)return;h();const g=e(r?c[0]:c,a,u);o?a(g):h=typeof g=="function"?g:noop},m=s.map((g,b)=>subscribe_to_store(g,y=>{c[b]=y,f&=~(1<<b),l&&p()},()=>{f|=1<<b}));return l=!0,p(),function(){run_all(m),h(),l=!1}})}function get(t){let e;return subscribe_to_store(t,n=>e=n)(),e}function parse$1(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,r,s,o,a=[],u="",l=t.split("/");for(l[0]||l.shift();s=l.shift();)n=s[0],n==="*"?(a.push("wild"),u+="/(.*)"):n===":"?(r=s.indexOf("?",1),o=s.indexOf(".",1),a.push(s.substring(1,~r?r:~o?o:s.length)),u+=~r&&!~o?"(?:/([^/]+?))?":"/([^/]+?)",~o&&(u+=(~r?"?":"")+"\\"+s.substring(o))):u+="/"+s;return{keys:a,pattern:new RegExp("^"+u+"/?$","i")}}function getLocation(){const t=window.location.href.indexOf("#/");let e=t>-1?window.location.href.substr(t+1):"/";const n=e.indexOf("?");let r="";return n>-1&&(r=e.substr(n+1),e=e.substr(0,n)),{location:e,querystring:r}}const loc=readable(null,function(e){e(getLocation());const n=()=>{e(getLocation())};return window.addEventListener("hashchange",n,!1),function(){window.removeEventListener("hashchange",n,!1)}});derived(loc,t=>t.location);derived(loc,t=>t.querystring);const params=writable(void 0);async function push(t){if(!t||t.length<1||t.charAt(0)!="/"&&t.indexOf("#/")!==0)throw Error("Invalid parameter location");await tick(),history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=(t.charAt(0)=="#"?"":"#")+t}function restoreScroll(t){t?window.scrollTo(t.__svelte_spa_router_scrollX,t.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function Router(t,e){push$1(e,!1);let n=prop(e,"routes",24,()=>({})),r=prop(e,"prefix",8,""),s=prop(e,"restoreScrollState",8,!1);class o{constructor(w,k){if(!k||typeof k!="function"&&(typeof k!="object"||k._sveltesparouter!==!0))throw Error("Invalid component object");if(!w||typeof w=="string"&&(w.length<1||w.charAt(0)!="/"&&w.charAt(0)!="*")||typeof w=="object"&&!(w instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:S,keys:T}=parse$1(w);this.path=w,typeof k=="object"&&k._sveltesparouter===!0?(this.component=k.component,this.conditions=k.conditions||[],this.userData=k.userData,this.props=k.props||{}):(this.component=()=>Promise.resolve(k),this.conditions=[],this.props={}),this._pattern=S,this._keys=T}match(w){if(r()){if(typeof r()=="string")if(w.startsWith(r()))w=w.substr(r().length)||"/";else return null;else if(r()instanceof RegExp){const O=w.match(r());if(O&&O[0])w=w.substr(O[0].length)||"/";else return null}}const k=this._pattern.exec(w);if(k===null)return null;if(this._keys===!1)return k;const S={};let T=0;for(;T<this._keys.length;){try{S[this._keys[T]]=decodeURIComponent(k[T+1]||"")||null}catch{S[this._keys[T]]=null}T++}return S}async checkConditions(w){for(let k=0;k<this.conditions.length;k++)if(!await this.conditions[k](w))return!1;return!0}}const a=[];n()instanceof Map?n().forEach((v,w)=>{a.push(new o(w,v))}):Object.keys(n()).forEach(v=>{a.push(new o(v,n()[v]))});let u=mutable_state(null),l=mutable_state(null),c=mutable_state({});const f=createEventDispatcher();async function h(v,w){await tick(),f(v,w)}let p=null,m=null;s()&&(m=v=>{v.state&&(v.state.__svelte_spa_router_scrollY||v.state.__svelte_spa_router_scrollX)?p=v.state:p=null},window.addEventListener("popstate",m),afterUpdate(()=>{restoreScroll(p)}));let g=null,b=null;const y=loc.subscribe(async v=>{g=v;let w=0;for(;w<a.length;){const k=a[w].match(v.location);if(!k){w++;continue}const S={route:a[w].path,location:v.location,querystring:v.querystring,userData:a[w].userData,params:k&&typeof k=="object"&&Object.keys(k).length?k:null};if(!await a[w].checkConditions(S)){set(u,null),b=null,h("conditionsFailed",S);return}h("routeLoading",Object.assign({},S));const T=a[w].component;if(b!=T){T.loading?(set(u,T.loading),b=T,set(l,T.loadingParams),set(c,{}),h("routeLoaded",Object.assign({},S,{component:get$1(u),name:get$1(u).name,params:get$1(l)}))):(set(u,null),b=null);const O=await T();if(v!=g)return;set(u,O&&O.default||O),b=T}k&&typeof k=="object"&&Object.keys(k).length?set(l,k):set(l,null),set(c,a[w].props),h("routeLoaded",Object.assign({},S,{component:get$1(u),name:get$1(u).name,params:get$1(l)})).then(()=>{params.set(get$1(l))});return}set(u,null),b=null,params.set(void 0)});onDestroy(()=>{y(),m&&window.removeEventListener("popstate",m)}),legacy_pre_effect(()=>deep_read_state(s()),()=>{history.scrollRestoration=s()?"manual":"auto"}),legacy_pre_effect_reset(),init();var _=comment$1(),x=first_child(_);{var E=v=>{var w=comment$1(),k=first_child(w);component(k,()=>get$1(u),(S,T)=>{T(S,spread_props({get params(){return get$1(l)}},()=>get$1(c),{$$events:{routeEvent(O){bubble_event.call(this,e,O)}}}))}),append(v,w)},A=v=>{var w=comment$1(),k=first_child(w);component(k,()=>get$1(u),(S,T)=>{T(S,spread_props(()=>get$1(c),{$$events:{routeEvent(O){bubble_event.call(this,e,O)}}}))}),append(v,w)};if_block(x,v=>{get$1(l)?v(E):v(A,!1)})}append(t,_),pop()}function number$2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function bytes$2(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function hash$1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(t.outputLen),number$2(t.blockLen)}function exists$1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function output$1(t,e){bytes$2(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const crypto$3=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$2=t=>t instanceof Uint8Array,createView$3=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),rotr$3=(t,e)=>t<<32-e|t>>>e,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$5(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function toBytes$3(t){if(typeof t=="string"&&(t=utf8ToBytes$5(t)),!u8a$2(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function concatBytes$4(...t){const e=new Uint8Array(t.reduce((r,s)=>r+s.length,0));let n=0;return t.forEach(r=>{if(!u8a$2(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let Hash$3=class{clone(){return this._cloneInto()}};function wrapConstructor$3(t){const e=r=>t().update(toBytes$3(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function randomBytes$2(t=32){if(crypto$3&&typeof crypto$3.getRandomValues=="function")return crypto$3.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$3(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(n>>s&o),u=Number(n&o),l=r?4:0,c=r?0:4;t.setUint32(e+l,a,r),t.setUint32(e+c,u,r)}let SHA2$1=class extends Hash$3{constructor(e,n,r,s){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$3(this.buffer)}update(e){exists$1(this);const{view:n,buffer:r,blockLen:s}=this;e=toBytes$3(e);const o=e.length;for(let a=0;a<o;){const u=Math.min(s-this.pos,o-a);if(u===s){const l=createView$3(e);for(;s<=o-a;a+=s)this.process(l,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$1(this),output$1(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)n[h]=0;setBigUint64$3(r,s-8,BigInt(this.length*8),o),this.process(r,0);const u=createView$3(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)u.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:a,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=a,s%n&&e.buffer.set(r),e}};const Chi$3=(t,e,n)=>t&e^~t&n,Maj$3=(t,e,n)=>t&e^t&n^e&n,SHA256_K$3=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$3=new Uint32Array(64);let SHA256$3=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:e,B:n,C:r,D:s,E:o,F:a,G:u,H:l}=this;return[e,n,r,s,o,a,u,l]}set(e,n,r,s,o,a,u,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=u|0,this.H=l|0}process(e,n){for(let h=0;h<16;h++,n+=4)SHA256_W$3[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const p=SHA256_W$3[h-15],m=SHA256_W$3[h-2],g=rotr$3(p,7)^rotr$3(p,18)^p>>>3,b=rotr$3(m,17)^rotr$3(m,19)^m>>>10;SHA256_W$3[h]=b+SHA256_W$3[h-7]+g+SHA256_W$3[h-16]|0}let{A:r,B:s,C:o,D:a,E:u,F:l,G:c,H:f}=this;for(let h=0;h<64;h++){const p=rotr$3(u,6)^rotr$3(u,11)^rotr$3(u,25),m=f+p+Chi$3(u,l,c)+SHA256_K$3[h]+SHA256_W$3[h]|0,b=(rotr$3(r,2)^rotr$3(r,13)^rotr$3(r,22))+Maj$3(r,s,o)|0;f=c,c=l,l=u,u=a+m|0,a=o,o=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,u=u+this.E|0,l=l+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(r,s,o,a,u,l,c,f)}roundClean(){SHA256_W$3.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$3=wrapConstructor$3(()=>new SHA256$3);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$9=BigInt(1),_2n$5=BigInt(2),u8a$1=t=>t instanceof Uint8Array,hexes$3=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$3(t){if(!u8a$1(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=hexes$3[t[n]];return e}function numberToHexUnpadded$1(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$1(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function hexToBytes$3(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const s=r*2,o=t.slice(s,s+2),a=Number.parseInt(o,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");n[r]=a}return n}function bytesToNumberBE$1(t){return hexToNumber$1(bytesToHex$3(t))}function bytesToNumberLE$1(t){if(!u8a$1(t))throw new Error("Uint8Array expected");return hexToNumber$1(bytesToHex$3(Uint8Array.from(t).reverse()))}function numberToBytesBE$1(t,e){return hexToBytes$3(t.toString(16).padStart(e*2,"0"))}function numberToBytesLE$1(t,e){return numberToBytesBE$1(t,e).reverse()}function numberToVarBytesBE$1(t){return hexToBytes$3(numberToHexUnpadded$1(t))}function ensureBytes$1(t,e,n){let r;if(typeof e=="string")try{r=hexToBytes$3(e)}catch(o){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${o}`)}else if(u8a$1(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const s=r.length;if(typeof n=="number"&&s!==n)throw new Error(`${t} expected ${n} bytes, got ${s}`);return r}function concatBytes$3(...t){const e=new Uint8Array(t.reduce((r,s)=>r+s.length,0));let n=0;return t.forEach(r=>{if(!u8a$1(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function equalBytes$2(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function utf8ToBytes$4(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function bitLen$1(t){let e;for(e=0;t>_0n$9;t>>=_1n$9,e+=1);return e}function bitGet$1(t,e){return t>>BigInt(e)&_1n$9}const bitSet$1=(t,e,n)=>t|(n?_1n$9:_0n$9)<<BigInt(e),bitMask$1=t=>(_2n$5<<BigInt(t-1))-_1n$9,u8n$1=t=>new Uint8Array(t),u8fr$1=t=>Uint8Array.from(t);function createHmacDrbg$1(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=u8n$1(t),s=u8n$1(t),o=0;const a=()=>{r.fill(1),s.fill(0),o=0},u=(...h)=>n(s,r,...h),l=(h=u8n$1())=>{s=u(u8fr$1([0]),h),r=u(),h.length!==0&&(s=u(u8fr$1([1]),h),r=u())},c=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){r=u();const m=r.slice();p.push(m),h+=r.length}return concatBytes$3(...p)};return(h,p)=>{a(),l(h);let m;for(;!(m=p(c()));)l();return a(),m}}const validatorFns$1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function validateObject$1(t,e,n={}){const r=(s,o,a)=>{const u=validatorFns$1[o];if(typeof u!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=t[s];if(!(a&&l===void 0)&&!u(l,t))throw new Error(`Invalid param ${String(s)}=${l} (${typeof l}), expected ${o}`)};for(const[s,o]of Object.entries(e))r(s,o,!1);for(const[s,o]of Object.entries(n))r(s,o,!0);return t}const ut$1=Object.freeze(Object.defineProperty({__proto__:null,bitGet:bitGet$1,bitLen:bitLen$1,bitMask:bitMask$1,bitSet:bitSet$1,bytesToHex:bytesToHex$3,bytesToNumberBE:bytesToNumberBE$1,bytesToNumberLE:bytesToNumberLE$1,concatBytes:concatBytes$3,createHmacDrbg:createHmacDrbg$1,ensureBytes:ensureBytes$1,equalBytes:equalBytes$2,hexToBytes:hexToBytes$3,hexToNumber:hexToNumber$1,numberToBytesBE:numberToBytesBE$1,numberToBytesLE:numberToBytesLE$1,numberToHexUnpadded:numberToHexUnpadded$1,numberToVarBytesBE:numberToVarBytesBE$1,utf8ToBytes:utf8ToBytes$4,validateObject:validateObject$1},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$8=BigInt(1),_2n$4=BigInt(2),_3n$3=BigInt(3),_4n$1=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod$1(t,e){const n=t%e;return n>=_0n$8?n:e+n}function pow$1(t,e,n){if(n<=_0n$8||e<_0n$8)throw new Error("Expected power/modulo > 0");if(n===_1n$8)return _0n$8;let r=_1n$8;for(;e>_0n$8;)e&_1n$8&&(r=r*t%n),t=t*t%n,e>>=_1n$8;return r}function pow2$1(t,e,n){let r=t;for(;e-- >_0n$8;)r*=r,r%=n;return r}function invert$1(t,e){if(t===_0n$8||e<=_0n$8)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=mod$1(t,e),r=e,s=_0n$8,o=_1n$8;for(;n!==_0n$8;){const u=r/n,l=r%n,c=s-o*u;r=n,n=l,s=o,o=c}if(r!==_1n$8)throw new Error("invert: does not exist");return mod$1(s,e)}function tonelliShanks$1(t){const e=(t-_1n$8)/_2n$4;let n,r,s;for(n=t-_1n$8,r=0;n%_2n$4===_0n$8;n/=_2n$4,r++);for(s=_2n$4;s<t&&pow$1(s,e,t)!==t-_1n$8;s++);if(r===1){const a=(t+_1n$8)/_4n$1;return function(l,c){const f=l.pow(c,a);if(!l.eql(l.sqr(f),c))throw new Error("Cannot find square root");return f}}const o=(n+_1n$8)/_2n$4;return function(u,l){if(u.pow(l,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let c=r,f=u.pow(u.mul(u.ONE,s),n),h=u.pow(l,o),p=u.pow(l,n);for(;!u.eql(p,u.ONE);){if(u.eql(p,u.ZERO))return u.ZERO;let m=1;for(let b=u.sqr(p);m<c&&!u.eql(b,u.ONE);m++)b=u.sqr(b);const g=u.pow(f,_1n$8<<BigInt(c-m-1));f=u.sqr(g),h=u.mul(h,g),p=u.mul(p,f),c=m}return h}}function FpSqrt$1(t){if(t%_4n$1===_3n$3){const e=(t+_1n$8)/_4n$1;return function(r,s){const o=r.pow(s,e);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(t%_8n$1===_5n$1){const e=(t-_5n$1)/_8n$1;return function(r,s){const o=r.mul(s,_2n$4),a=r.pow(o,e),u=r.mul(s,a),l=r.mul(r.mul(u,_2n$4),a),c=r.mul(u,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),s))throw new Error("Cannot find square root");return c}}return tonelliShanks$1(t)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=FIELD_FIELDS$1.reduce((r,s)=>(r[s]="function",r),e);return validateObject$1(t,n)}function FpPow$1(t,e,n){if(n<_0n$8)throw new Error("Expected power > 0");if(n===_0n$8)return t.ONE;if(n===_1n$8)return e;let r=t.ONE,s=e;for(;n>_0n$8;)n&_1n$8&&(r=t.mul(r,s)),s=t.sqr(s),n>>=_1n$8;return r}function FpInvertBatch$1(t,e){const n=new Array(e.length),r=e.reduce((o,a,u)=>t.is0(a)?o:(n[u]=o,t.mul(o,a)),t.ONE),s=t.inv(r);return e.reduceRight((o,a,u)=>t.is0(a)?o:(n[u]=t.mul(o,n[u]),t.mul(o,a)),s),n}function nLength$1(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Field$1(t,e,n=!1,r={}){if(t<=_0n$8)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:s,nByteLength:o}=nLength$1(t,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=FpSqrt$1(t),u=Object.freeze({ORDER:t,BITS:s,BYTES:o,MASK:bitMask$1(s),ZERO:_0n$8,ONE:_1n$8,create:l=>mod$1(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return _0n$8<=l&&l<t},is0:l=>l===_0n$8,isOdd:l=>(l&_1n$8)===_1n$8,neg:l=>mod$1(-l,t),eql:(l,c)=>l===c,sqr:l=>mod$1(l*l,t),add:(l,c)=>mod$1(l+c,t),sub:(l,c)=>mod$1(l-c,t),mul:(l,c)=>mod$1(l*c,t),pow:(l,c)=>FpPow$1(u,l,c),div:(l,c)=>mod$1(l*invert$1(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>invert$1(l,t),sqrt:r.sqrt||(l=>a(u,l)),invertBatch:l=>FpInvertBatch$1(u,l),cmov:(l,c,f)=>f?c:l,toBytes:l=>n?numberToBytesLE$1(l,o):numberToBytesBE$1(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return n?bytesToNumberLE$1(l):bytesToNumberBE$1(l)}});return Object.freeze(u)}function getFieldBytesLength$1(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$1(t){const e=getFieldBytesLength$1(t);return e+Math.ceil(e/2)}function mapHashToField$1(t,e,n=!1){const r=t.length,s=getFieldBytesLength$1(e),o=getMinHashLength$1(e);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const a=n?bytesToNumberBE$1(t):bytesToNumberLE$1(t),u=mod$1(a,e-_1n$8)+_1n$8;return n?numberToBytesLE$1(u,s):numberToBytesBE$1(u,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$7=BigInt(1);function wNAF$1(t,e){const n=(s,o)=>{const a=o.negate();return s?a:o},r=s=>{const o=Math.ceil(e/s)+1,a=2**(s-1);return{windows:o,windowSize:a}};return{constTimeNegate:n,unsafeLadder(s,o){let a=t.ZERO,u=s;for(;o>_0n$7;)o&_1n$7&&(a=a.add(u)),u=u.double(),o>>=_1n$7;return a},precomputeWindow(s,o){const{windows:a,windowSize:u}=r(o),l=[];let c=s,f=c;for(let h=0;h<a;h++){f=c,l.push(f);for(let p=1;p<u;p++)f=f.add(c),l.push(f);c=f.double()}return l},wNAF(s,o,a){const{windows:u,windowSize:l}=r(s);let c=t.ZERO,f=t.BASE;const h=BigInt(2**s-1),p=2**s,m=BigInt(s);for(let g=0;g<u;g++){const b=g*l;let y=Number(a&h);a>>=m,y>l&&(y-=p,a+=_1n$7);const _=b,x=b+Math.abs(y)-1,E=g%2!==0,A=y<0;y===0?f=f.add(n(E,o[_])):c=c.add(n(A,o[x]))}return{p:c,f}},wNAFCached(s,o,a,u){const l=s._WINDOW_SIZE||1;let c=o.get(s);return c||(c=this.precomputeWindow(s,l),l!==1&&o.set(s,u(c))),this.wNAF(l,c,a)}}}function validateBasic$1(t){return validateField$1(t.Fp),validateObject$1(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$1(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$1(t){const e=validateBasic$1(t);validateObject$1(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:s}=e;if(n){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n$1,hexToBytes:h2b$1}=ut$1,DER$1={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=DER$1;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n$1(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=DER$1,n=typeof t=="string"?h2b$1(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:s,l:o}=DER$1._parseInt(n.subarray(2)),{d:a,l:u}=DER$1._parseInt(o);if(u.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:a}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const f=c.toString(16);return f.length&1?`0${f}`:f},r=e(n(t.s)),s=e(n(t.r)),o=r.length/2,a=s.length/2,u=n(o),l=n(a);return`30${n(a+o+4)}02${l}${s}02${u}${r}`}},_0n$6=BigInt(0),_1n$6=BigInt(1);BigInt(2);const _3n$2=BigInt(3);BigInt(4);function weierstrassPoints$1(t){const e=validatePointOpts$1(t),{Fp:n}=e,r=e.toBytes||((g,b,y)=>{const _=b.toAffine();return concatBytes$3(Uint8Array.from([4]),n.toBytes(_.x),n.toBytes(_.y))}),s=e.fromBytes||(g=>{const b=g.subarray(1),y=n.fromBytes(b.subarray(0,n.BYTES)),_=n.fromBytes(b.subarray(n.BYTES,2*n.BYTES));return{x:y,y:_}});function o(g){const{a:b,b:y}=e,_=n.sqr(g),x=n.mul(_,g);return n.add(n.add(x,n.mul(g,b)),y)}if(!n.eql(n.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return typeof g=="bigint"&&_0n$6<g&&g<e.n}function u(g){if(!a(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(g){const{allowedPrivateKeyLengths:b,nByteLength:y,wrapPrivateKey:_,n:x}=e;if(b&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=bytesToHex$3(g)),typeof g!="string"||!b.includes(g.length))throw new Error("Invalid key");g=g.padStart(y*2,"0")}let E;try{E=typeof g=="bigint"?g:bytesToNumberBE$1(ensureBytes$1("private key",g,y))}catch{throw new Error(`private key must be ${y} bytes, hex or bigint, not ${typeof g}`)}return _&&(E=mod$1(E,x)),u(E),E}const c=new Map;function f(g){if(!(g instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(b,y,_){if(this.px=b,this.py=y,this.pz=_,b==null||!n.isValid(b))throw new Error("x required");if(y==null||!n.isValid(y))throw new Error("y required");if(_==null||!n.isValid(_))throw new Error("z required")}static fromAffine(b){const{x:y,y:_}=b||{};if(!b||!n.isValid(y)||!n.isValid(_))throw new Error("invalid affine point");if(b instanceof h)throw new Error("projective point not allowed");const x=E=>n.eql(E,n.ZERO);return x(y)&&x(_)?h.ZERO:new h(y,_,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const y=n.invertBatch(b.map(_=>_.pz));return b.map((_,x)=>_.toAffine(y[x])).map(h.fromAffine)}static fromHex(b){const y=h.fromAffine(s(ensureBytes$1("pointHex",b)));return y.assertValidity(),y}static fromPrivateKey(b){return h.BASE.multiply(l(b))}_setWindowSize(b){this._WINDOW_SIZE=b,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:b,y}=this.toAffine();if(!n.isValid(b)||!n.isValid(y))throw new Error("bad point: x or y not FE");const _=n.sqr(y),x=o(b);if(!n.eql(_,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:b}=this.toAffine();if(n.isOdd)return!n.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){f(b);const{px:y,py:_,pz:x}=this,{px:E,py:A,pz:v}=b,w=n.eql(n.mul(y,v),n.mul(E,x)),k=n.eql(n.mul(_,v),n.mul(A,x));return w&&k}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:b,b:y}=e,_=n.mul(y,_3n$2),{px:x,py:E,pz:A}=this;let v=n.ZERO,w=n.ZERO,k=n.ZERO,S=n.mul(x,x),T=n.mul(E,E),O=n.mul(A,A),C=n.mul(x,E);return C=n.add(C,C),k=n.mul(x,A),k=n.add(k,k),v=n.mul(b,k),w=n.mul(_,O),w=n.add(v,w),v=n.sub(T,w),w=n.add(T,w),w=n.mul(v,w),v=n.mul(C,v),k=n.mul(_,k),O=n.mul(b,O),C=n.sub(S,O),C=n.mul(b,C),C=n.add(C,k),k=n.add(S,S),S=n.add(k,S),S=n.add(S,O),S=n.mul(S,C),w=n.add(w,S),O=n.mul(E,A),O=n.add(O,O),S=n.mul(O,C),v=n.sub(v,S),k=n.mul(O,T),k=n.add(k,k),k=n.add(k,k),new h(v,w,k)}add(b){f(b);const{px:y,py:_,pz:x}=this,{px:E,py:A,pz:v}=b;let w=n.ZERO,k=n.ZERO,S=n.ZERO;const T=e.a,O=n.mul(e.b,_3n$2);let C=n.mul(y,E),R=n.mul(_,A),M=n.mul(x,v),I=n.add(y,_),D=n.add(E,A);I=n.mul(I,D),D=n.add(C,R),I=n.sub(I,D),D=n.add(y,x);let N=n.add(E,v);return D=n.mul(D,N),N=n.add(C,M),D=n.sub(D,N),N=n.add(_,x),w=n.add(A,v),N=n.mul(N,w),w=n.add(R,M),N=n.sub(N,w),S=n.mul(T,D),w=n.mul(O,M),S=n.add(w,S),w=n.sub(R,S),S=n.add(R,S),k=n.mul(w,S),R=n.add(C,C),R=n.add(R,C),M=n.mul(T,M),D=n.mul(O,D),R=n.add(R,M),M=n.sub(C,M),M=n.mul(T,M),D=n.add(D,M),C=n.mul(R,D),k=n.add(k,C),C=n.mul(N,D),w=n.mul(I,w),w=n.sub(w,C),C=n.mul(I,R),S=n.mul(N,S),S=n.add(S,C),new h(w,k,S)}subtract(b){return this.add(b.negate())}is0(){return this.equals(h.ZERO)}wNAF(b){return m.wNAFCached(this,c,b,y=>{const _=n.invertBatch(y.map(x=>x.pz));return y.map((x,E)=>x.toAffine(_[E])).map(h.fromAffine)})}multiplyUnsafe(b){const y=h.ZERO;if(b===_0n$6)return y;if(u(b),b===_1n$6)return this;const{endo:_}=e;if(!_)return m.unsafeLadder(this,b);let{k1neg:x,k1:E,k2neg:A,k2:v}=_.splitScalar(b),w=y,k=y,S=this;for(;E>_0n$6||v>_0n$6;)E&_1n$6&&(w=w.add(S)),v&_1n$6&&(k=k.add(S)),S=S.double(),E>>=_1n$6,v>>=_1n$6;return x&&(w=w.negate()),A&&(k=k.negate()),k=new h(n.mul(k.px,_.beta),k.py,k.pz),w.add(k)}multiply(b){u(b);let y=b,_,x;const{endo:E}=e;if(E){const{k1neg:A,k1:v,k2neg:w,k2:k}=E.splitScalar(y);let{p:S,f:T}=this.wNAF(v),{p:O,f:C}=this.wNAF(k);S=m.constTimeNegate(A,S),O=m.constTimeNegate(w,O),O=new h(n.mul(O.px,E.beta),O.py,O.pz),_=S.add(O),x=T.add(C)}else{const{p:A,f:v}=this.wNAF(y);_=A,x=v}return h.normalizeZ([_,x])[0]}multiplyAndAddUnsafe(b,y,_){const x=h.BASE,E=(v,w)=>w===_0n$6||w===_1n$6||!v.equals(x)?v.multiplyUnsafe(w):v.multiply(w),A=E(this,y).add(E(b,_));return A.is0()?void 0:A}toAffine(b){const{px:y,py:_,pz:x}=this,E=this.is0();b==null&&(b=E?n.ONE:n.inv(x));const A=n.mul(y,b),v=n.mul(_,b),w=n.mul(x,b);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(w,n.ONE))throw new Error("invZ was invalid");return{x:A,y:v}}isTorsionFree(){const{h:b,isTorsionFree:y}=e;if(b===_1n$6)return!0;if(y)return y(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:y}=e;return b===_1n$6?this:y?y(h,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return this.assertValidity(),r(h,this,b)}toHex(b=!0){return bytesToHex$3(this.toRawBytes(b))}}h.BASE=new h(e.Gx,e.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const p=e.nBitLength,m=wNAF$1(h,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:a}}function validateOpts$1(t){const e=validateBasic$1(t);return validateObject$1(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$1(t){const e=validateOpts$1(t),{Fp:n,n:r}=e,s=n.BYTES+1,o=2*n.BYTES+1;function a(D){return _0n$6<D&&D<n.ORDER}function u(D){return mod$1(D,r)}function l(D){return invert$1(D,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=weierstrassPoints$1({...e,toBytes(D,N,F){const z=N.toAffine(),U=n.toBytes(z.x),L=concatBytes$3;return F?L(Uint8Array.from([N.hasEvenY()?2:3]),U):L(Uint8Array.from([4]),U,n.toBytes(z.y))},fromBytes(D){const N=D.length,F=D[0],z=D.subarray(1);if(N===s&&(F===2||F===3)){const U=bytesToNumberBE$1(z);if(!a(U))throw new Error("Point is not on curve");const L=h(U);let B=n.sqrt(L);const H=(B&_1n$6)===_1n$6;return(F&1)===1!==H&&(B=n.neg(B)),{x:U,y:B}}else if(N===o&&F===4){const U=n.fromBytes(z.subarray(0,n.BYTES)),L=n.fromBytes(z.subarray(n.BYTES,2*n.BYTES));return{x:U,y:L}}else throw new Error(`Point of length ${N} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}}),m=D=>bytesToHex$3(numberToBytesBE$1(D,e.nByteLength));function g(D){const N=r>>_1n$6;return D>N}function b(D){return g(D)?u(-D):D}const y=(D,N,F)=>bytesToNumberBE$1(D.slice(N,F));class _{constructor(N,F,z){this.r=N,this.s=F,this.recovery=z,this.assertValidity()}static fromCompact(N){const F=e.nByteLength;return N=ensureBytes$1("compactSignature",N,F*2),new _(y(N,0,F),y(N,F,2*F))}static fromDER(N){const{r:F,s:z}=DER$1.toSig(ensureBytes$1("DER",N));return new _(F,z)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(N){return new _(this.r,this.s,N)}recoverPublicKey(N){const{r:F,s:z,recovery:U}=this,L=k(ensureBytes$1("msgHash",N));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const B=U===2||U===3?F+e.n:F;if(B>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const H=U&1?"03":"02",j=c.fromHex(H+m(B)),G=l(B),W=u(-L*G),Q=u(z*G),se=c.BASE.multiplyAndAddUnsafe(j,W,Q);if(!se)throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new _(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$3(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$3(this.toCompactHex())}toCompactHex(){return m(this.r)+m(this.s)}}const x={isValidPrivateKey(D){try{return f(D),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const D=getMinHashLength$1(e.n);return mapHashToField$1(e.randomBytes(D),e.n)},precompute(D=8,N=c.BASE){return N._setWindowSize(D),N.multiply(BigInt(3)),N}};function E(D,N=!0){return c.fromPrivateKey(D).toRawBytes(N)}function A(D){const N=D instanceof Uint8Array,F=typeof D=="string",z=(N||F)&&D.length;return N?z===s||z===o:F?z===2*s||z===2*o:D instanceof c}function v(D,N,F=!0){if(A(D))throw new Error("first arg must be private key");if(!A(N))throw new Error("second arg must be public key");return c.fromHex(N).multiply(f(D)).toRawBytes(F)}const w=e.bits2int||function(D){const N=bytesToNumberBE$1(D),F=D.length*8-e.nBitLength;return F>0?N>>BigInt(F):N},k=e.bits2int_modN||function(D){return u(w(D))},S=bitMask$1(e.nBitLength);function T(D){if(typeof D!="bigint")throw new Error("bigint expected");if(!(_0n$6<=D&&D<S))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE$1(D,e.nByteLength)}function O(D,N,F=C){if(["recovered","canonical"].some(ue=>ue in F))throw new Error("sign() legacy options not supported");const{hash:z,randomBytes:U}=e;let{lowS:L,prehash:B,extraEntropy:H}=F;L==null&&(L=!0),D=ensureBytes$1("msgHash",D),B&&(D=ensureBytes$1("prehashed msgHash",z(D)));const j=k(D),G=f(N),W=[T(G),T(j)];if(H!=null){const ue=H===!0?U(n.BYTES):H;W.push(ensureBytes$1("extraEntropy",ue))}const Q=concatBytes$3(...W),se=j;function X(ue){const K=w(ue);if(!p(K))return;const ne=l(K),q=c.BASE.multiply(K).toAffine(),J=u(q.x);if(J===_0n$6)return;const Y=u(ne*u(se+J*G));if(Y===_0n$6)return;let re=(q.x===J?0:2)|Number(q.y&_1n$6),V=Y;return L&&g(Y)&&(V=b(Y),re^=1),new _(J,V,re)}return{seed:Q,k2sig:X}}const C={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function M(D,N,F=C){const{seed:z,k2sig:U}=O(D,N,F),L=e;return createHmacDrbg$1(L.hash.outputLen,L.nByteLength,L.hmac)(z,U)}c.BASE._setWindowSize(8);function I(D,N,F,z=R){var q;const U=D;if(N=ensureBytes$1("msgHash",N),F=ensureBytes$1("publicKey",F),"strict"in z)throw new Error("options.strict was renamed to lowS");const{lowS:L,prehash:B}=z;let H,j;try{if(typeof U=="string"||U instanceof Uint8Array)try{H=_.fromDER(U)}catch(J){if(!(J instanceof DER$1.Err))throw J;H=_.fromCompact(U)}else if(typeof U=="object"&&typeof U.r=="bigint"&&typeof U.s=="bigint"){const{r:J,s:Y}=U;H=new _(J,Y)}else throw new Error("PARSE");j=c.fromHex(F)}catch(J){if(J.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(L&&H.hasHighS())return!1;B&&(N=e.hash(N));const{r:G,s:W}=H,Q=k(N),se=l(W),X=u(Q*se),ue=u(G*se),K=(q=c.BASE.multiplyAndAddUnsafe(j,X,ue))==null?void 0:q.toAffine();return K?u(K.x)===G:!1}return{CURVE:e,getPublicKey:E,getSharedSecret:v,sign:M,verify:I,ProjectivePoint:c,Signature:_,utils:x}}let HMAC$2=class extends Hash$3{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,hash$1(e);const r=toBytes$3(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return exists$1(this),this.iHash.update(e),this}digestInto(e){exists$1(this),bytes$2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=u,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(t,e,n)=>new HMAC$2(t,e).update(n).digest();hmac$2.create=(t,e)=>new HMAC$2(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$1(t){return{hash:t,hmac:(e,...n)=>hmac$2(t,e,concatBytes$4(...n)),randomBytes:randomBytes$2}}function createCurve$1(t,e){const n=r=>weierstrass$1({...t,...getHash$1(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P$1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N$1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$5=BigInt(1),_2n$3=BigInt(2),divNearest$1=(t,e)=>(t+e/_2n$3)/e;function sqrtMod$1(t){const e=secp256k1P$1,n=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),a=BigInt(23),u=BigInt(44),l=BigInt(88),c=t*t*t%e,f=c*c*t%e,h=pow2$1(f,n,e)*f%e,p=pow2$1(h,n,e)*f%e,m=pow2$1(p,_2n$3,e)*c%e,g=pow2$1(m,s,e)*m%e,b=pow2$1(g,o,e)*g%e,y=pow2$1(b,u,e)*b%e,_=pow2$1(y,l,e)*y%e,x=pow2$1(_,u,e)*b%e,E=pow2$1(x,n,e)*f%e,A=pow2$1(E,a,e)*g%e,v=pow2$1(A,r,e)*c%e,w=pow2$1(v,_2n$3,e);if(!Fp.eql(Fp.sqr(w),t))throw new Error("Cannot find square root");return w}const Fp=Field$1(secp256k1P$1,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1$1=createCurve$1({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N$1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=secp256k1N$1,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_1n$5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,a=BigInt("0x100000000000000000000000000000000"),u=divNearest$1(o*t,e),l=divNearest$1(-r*t,e);let c=mod$1(t-u*n-l*s,e),f=mod$1(-u*r-l*o,e);const h=c>a,p=f>a;if(h&&(c=e-c),p&&(f=e-f),c>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:c,k2neg:p,k2:f}}}},sha256$3),_0n$5=BigInt(0),fe=t=>typeof t=="bigint"&&_0n$5<t&&t<secp256k1P$1,ge=t=>typeof t=="bigint"&&_0n$5<t&&t<secp256k1N$1,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(t,...e){let n=TAGGED_HASH_PREFIXES$1[t];if(n===void 0){const r=sha256$3(Uint8Array.from(t,s=>s.charCodeAt(0)));n=concatBytes$3(r,r),TAGGED_HASH_PREFIXES$1[t]=n}return sha256$3(concatBytes$3(n,...e))}const pointToBytes$1=t=>t.toRawBytes(!0).slice(1),numTo32b$1=t=>numberToBytesBE$1(t,32),modP$1=t=>mod$1(t,secp256k1P$1),modN$1=t=>mod$1(t,secp256k1N$1),Point$1=secp256k1$1.ProjectivePoint,GmulAdd$1=(t,e,n)=>Point$1.BASE.multiplyAndAddUnsafe(t,e,n);function schnorrGetExtPubKey$1(t){let e=secp256k1$1.utils.normPrivateKeyToScalar(t),n=Point$1.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:modN$1(-e),bytes:pointToBytes$1(n)}}function lift_x$1(t){if(!fe(t))throw new Error("bad x: need 0 < x < p");const e=modP$1(t*t),n=modP$1(e*t+BigInt(7));let r=sqrtMod$1(n);r%_2n$3!==_0n$5&&(r=modP$1(-r));const s=new Point$1(t,r,_1n$5);return s.assertValidity(),s}function challenge$1(...t){return modN$1(bytesToNumberBE$1(taggedHash$1("BIP0340/challenge",...t)))}function schnorrGetPublicKey$1(t){return schnorrGetExtPubKey$1(t).bytes}function schnorrSign$1(t,e,n=randomBytes$2(32)){const r=ensureBytes$1("message",t),{bytes:s,scalar:o}=schnorrGetExtPubKey$1(e),a=ensureBytes$1("auxRand",n,32),u=numTo32b$1(o^bytesToNumberBE$1(taggedHash$1("BIP0340/aux",a))),l=taggedHash$1("BIP0340/nonce",u,s,r),c=modN$1(bytesToNumberBE$1(l));if(c===_0n$5)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=schnorrGetExtPubKey$1(c),p=challenge$1(f,s,r),m=new Uint8Array(64);if(m.set(f,0),m.set(numTo32b$1(modN$1(h+p*o)),32),!schnorrVerify$1(m,r,s))throw new Error("sign: Invalid signature produced");return m}function schnorrVerify$1(t,e,n){const r=ensureBytes$1("signature",t,64),s=ensureBytes$1("message",e),o=ensureBytes$1("publicKey",n,32);try{const a=lift_x$1(bytesToNumberBE$1(o)),u=bytesToNumberBE$1(r.subarray(0,32));if(!fe(u))return!1;const l=bytesToNumberBE$1(r.subarray(32,64));if(!ge(l))return!1;const c=challenge$1(numTo32b$1(u),pointToBytes$1(a),s),f=GmulAdd$1(a,l,modN$1(-c));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const schnorr$1={getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE:numberToBytesBE$1,bytesToNumberBE:bytesToNumberBE$1,taggedHash:taggedHash$1,mod:mod$1}},crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=t=>t instanceof Uint8Array,createView$2=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),rotr$2=(t,e)=>t<<32-e|t>>>e,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(t){if(!u8a(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=hexes$2[t[n]];return e}function hexToBytes$2(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const s=r*2,o=t.slice(s,s+2),a=Number.parseInt(o,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");n[r]=a}return n}function utf8ToBytes$3(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function toBytes$2(t){if(typeof t=="string"&&(t=utf8ToBytes$3(t)),!u8a(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function concatBytes$2(...t){const e=new Uint8Array(t.reduce((r,s)=>r+s.length,0));let n=0;return t.forEach(r=>{if(!u8a(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let Hash$2=class{clone(){return this._cloneInto()}};function wrapConstructor$2(t){const e=r=>t().update(toBytes$2(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function randomBytes$1(t=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function number$1(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function bool$1(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function bytes$1(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function hash(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$1(t.outputLen),number$1(t.blockLen)}function exists(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function output(t,e){bytes$1(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const assert={number:number$1,bool:bool$1,bytes:bytes$1,hash,exists,output};function setBigUint64$2(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(n>>s&o),u=Number(n&o),l=r?4:0,c=r?0:4;t.setUint32(e+l,a,r),t.setUint32(e+c,u,r)}class SHA2 extends Hash$2{constructor(e,n,r,s){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){assert.exists(this);const{view:n,buffer:r,blockLen:s}=this;e=toBytes$2(e);const o=e.length;for(let a=0;a<o;){const u=Math.min(s-this.pos,o-a);if(u===s){const l=createView$2(e);for(;s<=o-a;a+=s)this.process(l,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){assert.exists(this),assert.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)n[h]=0;setBigUint64$2(r,s-8,BigInt(this.length*8),o),this.process(r,0);const u=createView$2(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)u.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:a,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=a,s%n&&e.buffer.set(r),e}}const Chi$2=(t,e,n)=>t&e^~t&n,Maj$2=(t,e,n)=>t&e^t&n^e&n,SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$2=class extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:e,B:n,C:r,D:s,E:o,F:a,G:u,H:l}=this;return[e,n,r,s,o,a,u,l]}set(e,n,r,s,o,a,u,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=u|0,this.H=l|0}process(e,n){for(let h=0;h<16;h++,n+=4)SHA256_W$2[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const p=SHA256_W$2[h-15],m=SHA256_W$2[h-2],g=rotr$2(p,7)^rotr$2(p,18)^p>>>3,b=rotr$2(m,17)^rotr$2(m,19)^m>>>10;SHA256_W$2[h]=b+SHA256_W$2[h-7]+g+SHA256_W$2[h-16]|0}let{A:r,B:s,C:o,D:a,E:u,F:l,G:c,H:f}=this;for(let h=0;h<64;h++){const p=rotr$2(u,6)^rotr$2(u,11)^rotr$2(u,25),m=f+p+Chi$2(u,l,c)+SHA256_K$2[h]+SHA256_W$2[h]|0,b=(rotr$2(r,2)^rotr$2(r,13)^rotr$2(r,22))+Maj$2(r,s,o)|0;f=c,c=l,l=u,u=a+m|0,a=o,o=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,u=u+this.E|0,l=l+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(r,s,o,a,u,l,c,f)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$2{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256$2=wrapConstructor$2(()=>new SHA256$2);wrapConstructor$2(()=>new SHA224);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function chain$1(...t){const e=(s,o)=>a=>s(o(a)),n=Array.from(t).reverse().reduce((s,o)=>s?e(s,o.encode):o.encode,void 0),r=t.reduce((s,o)=>s?e(s,o.decode):o.decode,void 0);return{encode:n,decode:r}}function alphabet$1(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(assertNumber(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function join$2(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function padding(t,e="="){if(assertNumber(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function normalize$3(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function convertRadix(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const s=[],o=Array.from(t);for(o.forEach(a=>{if(assertNumber(a),a<0||a>=e)throw new Error(`Wrong integer: ${a}`)});;){let a=0,u=!0;for(let l=r;l<o.length;l++){const c=o[l],f=e*a+c;if(!Number.isSafeInteger(f)||e*a/e!==a||f-c!==e*a)throw new Error("convertRadix: carry overflow");if(a=f%n,o[l]=Math.floor(f/n),!Number.isSafeInteger(o[l])||o[l]*n+a!==f)throw new Error("convertRadix: carry overflow");if(u)o[l]?u=!1:r=l;else continue}if(s.push(a),u)break}for(let a=0;a<t.length-1&&t[a]===0;a++)s.push(0);return s.reverse()}const gcd$1=(t,e)=>e?gcd$1(e,t%e):t,radix2carry$1=(t,e)=>t+(e-gcd$1(t,e));function convertRadix2$1(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(radix2carry$1(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${radix2carry$1(e,n)}`);let s=0,o=0;const a=2**n-1,u=[];for(const l of t){if(assertNumber(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=n;o-=n)u.push((s>>o-n&a)>>>0);s&=2**o-1}if(s=s<<n-o&a,!r&&o>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&o>0&&u.push(s>>>0),u}function radix(t){return assertNumber(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(e,t,2**8))}}}function radix2$1(t,e=!1){if(assertNumber(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry$1(8,t)>32||radix2carry$1(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2$1(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2$1(n,t,8,e))}}}function unsafeWrapper$1(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const base16=chain$1(radix2$1(4),alphabet$1("0123456789ABCDEF"),join$2("")),base32=chain$1(radix2$1(5),alphabet$1("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join$2(""));chain$1(radix2$1(5),alphabet$1("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join$2(""));chain$1(radix2$1(5),alphabet$1("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join$2(""),normalize$3(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain$1(radix2$1(6),alphabet$1("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join$2("")),base64url=chain$1(radix2$1(6),alphabet$1("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join$2("")),genBase58=t=>chain$1(radix(58),alphabet$1(t),join$2("")),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=base58.encode(r).padStart(XMR_BLOCK_LEN[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),s=XMR_BLOCK_LEN.indexOf(r.length),o=base58.decode(r);for(let a=0;a<o.length-s;a++)if(o[a]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(e)}},BECH_ALPHABET$1=chain$1(alphabet$1("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join$2("")),POLYMOD_GENERATORS$1=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod$1(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<POLYMOD_GENERATORS$1.length;r++)(e>>r&1)===1&&(n^=POLYMOD_GENERATORS$1[r]);return n}function bechChecksum$1(t,e,n=1){const r=t.length;let s=1;for(let o=0;o<r;o++){const a=t.charCodeAt(o);if(a<33||a>126)throw new Error(`Invalid prefix (${t})`);s=bech32Polymod$1(s)^a>>5}s=bech32Polymod$1(s);for(let o=0;o<r;o++)s=bech32Polymod$1(s)^t.charCodeAt(o)&31;for(let o of e)s=bech32Polymod$1(s)^o;for(let o=0;o<6;o++)s=bech32Polymod$1(s);return s^=n,BECH_ALPHABET$1.encode(convertRadix2$1([s%2**30],30,5,!1))}function genBech32$1(t){const e=t==="bech32"?1:734539939,n=radix2$1(5),r=n.decode,s=n.encode,o=unsafeWrapper$1(r);function a(f,h,p=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);const m=f.length+7+h.length;if(p!==!1&&m>p)throw new TypeError(`Length ${m} exceeds limit ${p}`);return f=f.toLowerCase(),`${f}1${BECH_ALPHABET$1.encode(h)}${bechChecksum$1(f,h,e)}`}function u(f,h=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||h!==!1&&f.length>h)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${h})`);const p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=p;const m=f.lastIndexOf("1");if(m===0||m===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=f.slice(0,m),b=f.slice(m+1);if(b.length<6)throw new Error("Data must be at least 6 characters long");const y=BECH_ALPHABET$1.decode(b).slice(0,-6),_=bechChecksum$1(g,y,e);if(!b.endsWith(_))throw new Error(`Invalid checksum in ${f}: expected "${_}"`);return{prefix:g,words:y}}const l=unsafeWrapper$1(u);function c(f){const{prefix:h,words:p}=u(f,!1);return{prefix:h,words:p,bytes:r(p)}}return{encode:a,decode:u,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:o,toWords:s}}const bech32$1=genBech32$1("bech32");genBech32$1("bech32m");const utf8={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},hex=chain$1(radix2$1(4),alphabet$1("0123456789abcdef"),join$2(""),normalize$3(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),CODERS={utf8,hex,base16,base32,base64,base64url,base58,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function bool(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function isBytes$4(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function bytes(t,...e){if(!isBytes$4(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function checkOpts(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function equalBytes$1(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const wrapCipher=(t,e)=>(Object.assign(e,t),e),BLOCK_SIZE=16,POLY=283;function mul2(t){return t<<1^POLY&-(t>>7)}function mul(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=mul2(t);return n}const sbox=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=mul2(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),invSbox=sbox.map((t,e)=>sbox.indexOf(e)),rotr32_8=t=>t<<24|t>>>8,rotl32_8=t=>t<<8|t>>>24;function genTtable(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((c,f)=>e(t[f])),r=n.map(rotl32_8),s=r.map(rotl32_8),o=s.map(rotl32_8),a=new Uint32Array(256*256),u=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let c=0;c<256;c++)for(let f=0;f<256;f++){const h=c*256+f;a[h]=n[c]^r[f],u[h]=s[c]^o[f],l[h]=t[c]<<8|t[f]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:s,T3:o,T01:a,T23:u}}const tableEncoding=genTtable(sbox,t=>mul(t,3)<<24|t<<16|t<<8|mul(t,2)),tableDecoding=genTtable(invSbox,t=>mul(t,11)<<24|mul(t,13)<<16|mul(t,9)<<8|mul(t,14)),xPowers=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=mul2(n))t[e]=n;return t})();function expandKeyLE(t){bytes(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=tableEncoding,r=u32(t),s=r.length,o=u=>applySbox(n,u,u,u,u),a=new Uint32Array(e+28);a.set(r);for(let u=s;u<a.length;u++){let l=a[u-1];u%s===0?l=o(rotr32_8(l))^xPowers[u/s-1]:s>6&&u%s===4&&(l=o(l)),a[u]=a[u-s]^l}return a}function expandKeyDecLE(t){const e=expandKeyLE(t),n=e.slice(),r=e.length,{sbox2:s}=tableEncoding,{T0:o,T1:a,T2:u,T3:l}=tableDecoding;for(let c=0;c<r;c+=4)for(let f=0;f<4;f++)n[c+f]=e[r-c-4+f];e.fill(0);for(let c=4;c<r-4;c++){const f=n[c],h=applySbox(s,f,f,f,f);n[c]=o[h&255]^a[h>>>8&255]^u[h>>>16&255]^l[h>>>24]}return n}function apply0123(t,e,n,r,s,o){return t[n<<8&65280|r>>>8&255]^e[s>>>8&65280|o>>>24&255]}function applySbox(t,e,n,r,s){return t[e&255|n&65280]|t[r>>>16&255|s>>>16&65280]<<16}function encrypt$2(t,e,n,r,s){const{sbox2:o,T01:a,T23:u}=tableEncoding;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],s^=t[l++];const c=t.length/4-2;for(let g=0;g<c;g++){const b=t[l++]^apply0123(a,u,e,n,r,s),y=t[l++]^apply0123(a,u,n,r,s,e),_=t[l++]^apply0123(a,u,r,s,e,n),x=t[l++]^apply0123(a,u,s,e,n,r);e=b,n=y,r=_,s=x}const f=t[l++]^applySbox(o,e,n,r,s),h=t[l++]^applySbox(o,n,r,s,e),p=t[l++]^applySbox(o,r,s,e,n),m=t[l++]^applySbox(o,s,e,n,r);return{s0:f,s1:h,s2:p,s3:m}}function decrypt$2(t,e,n,r,s){const{sbox2:o,T01:a,T23:u}=tableDecoding;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],s^=t[l++];const c=t.length/4-2;for(let g=0;g<c;g++){const b=t[l++]^apply0123(a,u,e,s,r,n),y=t[l++]^apply0123(a,u,n,e,s,r),_=t[l++]^apply0123(a,u,r,n,e,s),x=t[l++]^apply0123(a,u,s,r,n,e);e=b,n=y,r=_,s=x}const f=t[l++]^applySbox(o,e,s,r,n),h=t[l++]^applySbox(o,n,e,s,r),p=t[l++]^applySbox(o,r,n,e,s),m=t[l++]^applySbox(o,s,r,n,e);return{s0:f,s1:h,s2:p,s3:m}}function getDst(t,e){if(!e)return new Uint8Array(t);if(bytes(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function validateBlockDecrypt(t){if(bytes(t),t.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(t,e,n){let r=t.length;const s=r%BLOCK_SIZE;if(!e&&s!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const o=u32(t);if(e){let l=BLOCK_SIZE-s;l||(l=BLOCK_SIZE),r=r+l}const a=getDst(r,n),u=u32(a);return{b:o,o:u,out:a}}function validatePCKS(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const s=t.subarray(0,-r);for(let o=0;o<r;o++)if(t[n-o-1]!==r)throw new Error("aes/pcks5: wrong padding");return s}function padPCKS(t){const e=new Uint8Array(16),n=u32(e);e.set(t);const r=BLOCK_SIZE-t.length;for(let s=BLOCK_SIZE-r;s<BLOCK_SIZE;s++)e[s]=r;return n}const cbc=wrapCipher({blockSize:16,nonceLength:16},function(e,n,r={}){bytes(e),bytes(n,16);const s=!r.disablePadding;return{encrypt:(o,a)=>{const u=expandKeyLE(e),{b:l,o:c,out:f}=validateBlockEncrypt(o,s,a),h=u32(n);let p=h[0],m=h[1],g=h[2],b=h[3],y=0;for(;y+4<=l.length;)p^=l[y+0],m^=l[y+1],g^=l[y+2],b^=l[y+3],{s0:p,s1:m,s2:g,s3:b}=encrypt$2(u,p,m,g,b),c[y++]=p,c[y++]=m,c[y++]=g,c[y++]=b;if(s){const _=padPCKS(o.subarray(y*4));p^=_[0],m^=_[1],g^=_[2],b^=_[3],{s0:p,s1:m,s2:g,s3:b}=encrypt$2(u,p,m,g,b),c[y++]=p,c[y++]=m,c[y++]=g,c[y++]=b}return u.fill(0),f},decrypt:(o,a)=>{validateBlockDecrypt(o);const u=expandKeyDecLE(e),l=u32(n),c=getDst(o.length,a),f=u32(o),h=u32(c);let p=l[0],m=l[1],g=l[2],b=l[3];for(let y=0;y+4<=f.length;){const _=p,x=m,E=g,A=b;p=f[y+0],m=f[y+1],g=f[y+2],b=f[y+3];const{s0:v,s1:w,s2:k,s3:S}=decrypt$2(u,p,m,g,b);h[y++]=v^_,h[y++]=w^x,h[y++]=k^E,h[y++]=S^A}return u.fill(0),validatePCKS(c,s)}}}),_utf8ToBytes=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl(t,e){return t<<e|t>>>32-e}function isAligned32(t){return t.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(t,e,n,r,s,o,a,u){const l=s.length,c=new Uint8Array(BLOCK_LEN),f=u32(c),h=isAligned32(s)&&isAligned32(o),p=h?u32(s):U32_EMPTY,m=h?u32(o):U32_EMPTY;for(let g=0;g<l;a++){if(t(e,n,r,f,a,u),a>=MAX_COUNTER)throw new Error("arx: counter overflow");const b=Math.min(BLOCK_LEN,l-g);if(h&&b===BLOCK_LEN){const y=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let _=0,x;_<BLOCK_LEN32;_++)x=y+_,m[x]=p[x]^f[_];g+=BLOCK_LEN;continue}for(let y=0,_;y<b;y++)_=g+y,o[_]=s[_]^c[y];g+=b}}function createCipher(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:s,counterRight:o,rounds:a}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return number(s),number(a),bool(o),bool(n),(u,l,c,f,h=0)=>{bytes(u),bytes(l),bytes(c);const p=c.length;if(f||(f=new Uint8Array(p)),bytes(f),number(h),h<0||h>=MAX_COUNTER)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);const m=[];let g=u.length,b,y;if(g===32)b=u.slice(),m.push(b),y=sigma32_32;else if(g===16&&n)b=new Uint8Array(32),b.set(u),b.set(u,16),y=sigma16_32,m.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);isAligned32(l)||(l=l.slice(),m.push(l));const _=u32(b);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(y,_,u32(l.subarray(0,16)),_),l=l.subarray(16)}const x=16-s;if(x!==l.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const A=new Uint8Array(12);A.set(l,o?0:12-l.length),l=A,m.push(l)}const E=u32(l);for(runCipher(t,y,_,E,c,f,h,a);m.length>0;)m.pop().fill(0);return f}}function chachaCore(t,e,n,r,s,o=20){let a=t[0],u=t[1],l=t[2],c=t[3],f=e[0],h=e[1],p=e[2],m=e[3],g=e[4],b=e[5],y=e[6],_=e[7],x=s,E=n[0],A=n[1],v=n[2],w=a,k=u,S=l,T=c,O=f,C=h,R=p,M=m,I=g,D=b,N=y,F=_,z=x,U=E,L=A,B=v;for(let j=0;j<o;j+=2)w=w+O|0,z=rotl(z^w,16),I=I+z|0,O=rotl(O^I,12),w=w+O|0,z=rotl(z^w,8),I=I+z|0,O=rotl(O^I,7),k=k+C|0,U=rotl(U^k,16),D=D+U|0,C=rotl(C^D,12),k=k+C|0,U=rotl(U^k,8),D=D+U|0,C=rotl(C^D,7),S=S+R|0,L=rotl(L^S,16),N=N+L|0,R=rotl(R^N,12),S=S+R|0,L=rotl(L^S,8),N=N+L|0,R=rotl(R^N,7),T=T+M|0,B=rotl(B^T,16),F=F+B|0,M=rotl(M^F,12),T=T+M|0,B=rotl(B^T,8),F=F+B|0,M=rotl(M^F,7),w=w+C|0,B=rotl(B^w,16),N=N+B|0,C=rotl(C^N,12),w=w+C|0,B=rotl(B^w,8),N=N+B|0,C=rotl(C^N,7),k=k+R|0,z=rotl(z^k,16),F=F+z|0,R=rotl(R^F,12),k=k+R|0,z=rotl(z^k,8),F=F+z|0,R=rotl(R^F,7),S=S+M|0,U=rotl(U^S,16),I=I+U|0,M=rotl(M^I,12),S=S+M|0,U=rotl(U^S,8),I=I+U|0,M=rotl(M^I,7),T=T+O|0,L=rotl(L^T,16),D=D+L|0,O=rotl(O^D,12),T=T+O|0,L=rotl(L^T,8),D=D+L|0,O=rotl(O^D,7);let H=0;r[H++]=a+w|0,r[H++]=u+k|0,r[H++]=l+S|0,r[H++]=c+T|0,r[H++]=f+O|0,r[H++]=h+C|0,r[H++]=p+R|0,r[H++]=m+M|0,r[H++]=g+I|0,r[H++]=b+D|0,r[H++]=y+N|0,r[H++]=_+F|0,r[H++]=x+z|0,r[H++]=E+U|0,r[H++]=A+L|0,r[H++]=v+B|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1});let HMAC$1=class extends Hash$2{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,assert.hash(e);const r=toBytes$2(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return assert.exists(this),this.iHash.update(e),this}digestInto(e){assert.exists(this),assert.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=u,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$1=(t,e,n)=>new HMAC$1(t,e).update(n).digest();hmac$1.create=(t,e)=>new HMAC$1(t,e);function extract(t,e,n){return assert.hash(t),hmac$1(t,toBytes$2(n),toBytes$2(e))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(t,e,n,r=32){if(assert.hash(t),assert.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/t.outputLen);n===void 0&&(n=EMPTY_BUFFER);const o=new Uint8Array(s*t.outputLen),a=hmac$1.create(t,e),u=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let c=0;c<s;c++)HKDF_COUNTER[0]=c+1,u.update(c===0?EMPTY_BUFFER:l).update(n).update(HKDF_COUNTER).digestInto(l),o.set(l,t.outputLen*c),a._cloneInto(u);return a.destroy(),u.destroy(),l.fill(0),HKDF_COUNTER.fill(0),o.slice(0,r)}var __defProp$1=Object.defineProperty,__export=(t,e)=>{for(var n in e)__defProp$1(t,n,{get:e[n],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=t=>t instanceof Object;function validateEvent(t){if(!isRecord(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue$1,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder,utf8Encoder:()=>utf8Encoder});var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder;function normalizeURL(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function insertEventIntoDescendingList(t,e){const[n,r]=binarySearch(t,s=>e.id===s.id?0:e.created_at===s.created_at?-1:s.created_at-e.created_at);return r||t.splice(n,0,e),t}function insertEventIntoAscendingList(t,e){const[n,r]=binarySearch(t,s=>e.id===s.id?0:e.created_at===s.created_at?-1:e.created_at-s.created_at);return r||t.splice(n,0,e),t}function binarySearch(t,e){let n=0,r=t.length-1;for(;n<=r;){const s=Math.floor((n+r)/2),o=e(t[s]);if(o===0)return[s,!0];o<0?r=s-1:n=s+1}return[n,!1]}var QueueNode=class{constructor(t){$(this,"value");$(this,"next",null);$(this,"prev",null);this.value=t}},Queue$1=class{constructor(){$(this,"first");$(this,"last");this.first=null,this.last=null}enqueue(e){const n=new QueueNode(e);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const e=this.first;return this.first=e.next,e.value}},JS=class{generateSecretKey(){return schnorr$1.utils.randomPrivateKey()}getPublicKey(t){return bytesToHex$2(schnorr$1.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=bytesToHex$2(schnorr$1.getPublicKey(e)),n.id=getEventHash$1(n),n.sig=bytesToHex$2(schnorr$1.sign(getEventHash$1(n),e)),n[verifiedSymbol]=!0,n}verifyEvent(t){if(typeof t[verifiedSymbol]=="boolean")return t[verifiedSymbol];const e=getEventHash$1(t);if(e!==t.id)return t[verifiedSymbol]=!1,!1;try{const n=schnorr$1.verify(t.sig,e,t.pubkey);return t[verifiedSymbol]=n,n}catch{return t[verifiedSymbol]=!1,!1}}};function serializeEvent(t){if(!validateEvent(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function getEventHash$1(t){let e=sha256$2(utf8Encoder.encode(serializeEvent(t)));return bytesToHex$2(e)}var i$1=new JS,generateSecretKey=i$1.generateSecretKey,getPublicKey=i$1.getPublicKey,finalizeEvent=i$1.finalizeEvent,verifyEvent=i$1.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Pinlist:()=>Pinlist,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Zap:()=>Zap,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isParameterizedReplaceableKind:()=>isParameterizedReplaceableKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function isReplaceableKind(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function isEphemeralKind(t){return 2e4<=t&&t<3e4}function isParameterizedReplaceableKind(t){return 3e4<=t&&t<4e4}function classifyKind(t){return isRegularKind(t)?"regular":isReplaceableKind(t)?"replaceable":isEphemeralKind(t)?"ephemeral":isParameterizedReplaceableKind(t)?"parameterized":"unknown"}function isKind(t,e){const n=e instanceof Array?e:[e];return validateEvent(t)&&n.includes(t.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,Seal=13,PrivateDirectMessage=14,GenericRepost=16,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,FileMetadata=1063,LiveChatMessage=1311,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap=9735,Highlights=9802,Mutelist=1e4,Pinlist=10001,RelayList=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550;function matchFilter(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=n.slice(1),s=t[`#${r}`];if(s&&!e.tags.find(([o,a])=>o===n.slice(1)&&s.indexOf(a)!==-1))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function matchFilters(t,e){for(let n=0;n<t.length;n++)if(matchFilter(t[n],e))return!0;return!1}var fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,s=t.slice(r).indexOf('"')+r+1;return t.slice(s,s+64)}function getInt(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,s=t.slice(r),o=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,o),10)}function getSubscriptionId(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,s=t.slice(r+1,80).indexOf('"');if(s===-1)return null;let o=r+1+s;return t.slice(r+1,o)}function matchEventId(t,e){return e===getHex64(t,"id")}function matchEventPubkey(t,e){return e===getHex64(t,"pubkey")}function matchEventKind(t,e){return e===getInt(t,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(t,e){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports={};__export(nip19_exports,{BECH32_REGEX:()=>BECH32_REGEX$1,Bech32MaxSize:()=>Bech32MaxSize,NostrTypeGuard:()=>NostrTypeGuard,decode:()=>decode$2,encodeBytes:()=>encodeBytes,naddrEncode:()=>naddrEncode,neventEncode:()=>neventEncode,noteEncode:()=>noteEncode,nprofileEncode:()=>nprofileEncode,npubEncode:()=>npubEncode,nsecEncode:()=>nsecEncode});var NostrTypeGuard={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},Bech32MaxSize=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function decode$2(t){var s,o,a,u,l,c,f;let{prefix:e,words:n}=bech32$1.decode(t,Bech32MaxSize),r=new Uint8Array(bech32$1.fromWords(n));switch(e){case"nprofile":{let h=parseTLV(r);if(!((s=h[0])!=null&&s[0]))throw new Error("missing TLV 0 for nprofile");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$2(h[0][0]),relays:h[1]?h[1].map(p=>utf8Decoder.decode(p)):[]}}}case"nevent":{let h=parseTLV(r);if(!((o=h[0])!=null&&o[0]))throw new Error("missing TLV 0 for nevent");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(h[2]&&h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(h[3]&&h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$2(h[0][0]),relays:h[1]?h[1].map(p=>utf8Decoder.decode(p)):[],author:(a=h[2])!=null&&a[0]?bytesToHex$2(h[2][0]):void 0,kind:(u=h[3])!=null&&u[0]?parseInt(bytesToHex$2(h[3][0]),16):void 0}}}case"naddr":{let h=parseTLV(r);if(!((l=h[0])!=null&&l[0]))throw new Error("missing TLV 0 for naddr");if(!((c=h[2])!=null&&c[0]))throw new Error("missing TLV 2 for naddr");if(h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=h[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(h[0][0]),pubkey:bytesToHex$2(h[2][0]),kind:parseInt(bytesToHex$2(h[3][0]),16),relays:h[1]?h[1].map(p=>utf8Decoder.decode(p)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:bytesToHex$2(r)};default:throw new Error(`unknown prefix ${e}`)}}function parseTLV(t){let e={},n=t;for(;n.length>0;){let r=n[0],s=n[1],o=n.slice(2,2+s);if(n=n.slice(2+s),o.length<s)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(o)}return e}function nsecEncode(t){return encodeBytes("nsec",t)}function npubEncode(t){return encodeBytes("npub",hexToBytes$2(t))}function noteEncode(t){return encodeBytes("note",hexToBytes$2(t))}function encodeBech32(t,e){let n=bech32$1.toWords(e);return bech32$1.encode(t,n,Bech32MaxSize)}function encodeBytes(t,e){return encodeBech32(t,e)}function nprofileEncode(t){let e=encodeTLV({0:[hexToBytes$2(t.pubkey)],1:(t.relays||[]).map(n=>utf8Encoder.encode(n))});return encodeBech32("nprofile",e)}function neventEncode(t){let e;t.kind!==void 0&&(e=integerToUint8Array(t.kind));let n=encodeTLV({0:[hexToBytes$2(t.id)],1:(t.relays||[]).map(r=>utf8Encoder.encode(r)),2:t.author?[hexToBytes$2(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return encodeBech32("nevent",n)}function naddrEncode(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=encodeTLV({0:[utf8Encoder.encode(t.identifier)],1:(t.relays||[]).map(r=>utf8Encoder.encode(r)),2:[hexToBytes$2(t.pubkey)],3:[new Uint8Array(e)]});return encodeBech32("naddr",n)}function encodeTLV(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(s=>{let o=new Uint8Array(s.length+2);o.set([parseInt(n)],0),o.set([s.length],1),o.set(s,2),e.push(o)})}),concatBytes$2(...e)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$1,encrypt:()=>encrypt$1});async function encrypt$1(t,e,n){const r=t instanceof Uint8Array?bytesToHex$2(t):t,s=secp256k1$1.getSharedSecret(r,"02"+e),o=getNormalizedX(s);let a=Uint8Array.from(randomBytes$1(16)),u=utf8Encoder.encode(n),l=cbc(o,a).encrypt(u),c=base64.encode(new Uint8Array(l)),f=base64.encode(new Uint8Array(a.buffer));return`${c}?iv=${f}`}async function decrypt$1(t,e,n){const r=t instanceof Uint8Array?bytesToHex$2(t):t;let[s,o]=n.split("?iv="),a=secp256k1$1.getSharedSecret(r,"02"+e),u=getNormalizedX(a),l=base64.decode(o),c=base64.decode(s),f=cbc(u,l).decrypt(c);return utf8Decoder.decode(f)}function getNormalizedX(t){return t.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=t=>NIP05_REGEX$1.test(t||""),_fetch;try{_fetch=fetch}catch{}function useFetchImplementation(t){_fetch=t}async function searchDomain(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await _fetch(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function queryProfile(t){var s;const e=t.match(NIP05_REGEX$1);if(!e)return null;const[,n="_",r]=e;try{const o=`https://${r}/.well-known/nostr.json?name=${n}`,a=await _fetch(o,{redirect:"manual"});if(a.status!==200)throw Error("Wrong response code");const u=await a.json(),l=u.names[n];return l?{pubkey:l,relays:(s=u.relays)==null?void 0:s[l]}:null}catch{return null}}async function isValid(t,e){const n=await queryProfile(e);return n?n.pubkey===t:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse});function parse(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let s=t.tags.length-1;s>=0;s--){const o=t.tags[s];if(o[0]==="e"&&o[1]){const[a,u,l,c,f]=o,h={id:u,relays:l?[l]:[],author:f};if(c==="root"){e.root=h;continue}if(c==="reply"){e.reply=h;continue}if(c==="mention"){e.mentions.push(h);continue}n?r=h:n=h,e.mentions.push(h);continue}if(o[0]==="q"&&o[1]){const[a,u,l]=o;e.quotes.push({id:u,relays:l?[l]:[]})}if(o[0]==="p"&&o[1]){e.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(s=>{if(!s)return;let o=e.mentions.indexOf(s);if(o!==-1&&e.mentions.splice(o,1),s.author){let a=e.profiles.find(u=>u.pubkey===s.author);a&&a.relays&&(s.relays||(s.relays=[]),a.relays.forEach(u=>{var l;((l=s.relays)==null?void 0:l.indexOf(u))===-1&&s.relays.push(u)}),a.relays=s.relays)}}),e.mentions.forEach(s=>{if(s.author){let o=e.profiles.find(a=>a.pubkey===s.author);o&&o.relays&&(s.relays||(s.relays=[]),o.relays.forEach(a=>{s.relays.indexOf(a)===-1&&s.relays.push(a)}),o.relays=s.relays)}}),e}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(t){_fetch2=t}async function fetchRelayInformation(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function minePow(t,e){let n=0;const r=t,s=["nonce",n.toString(),e.toString()];for(r.tags.push(s);;){const o=Math.floor(new Date().getTime()/1e3);if(o!==r.created_at&&(n=0,r.created_at=o),s[1]=(++n).toString(),r.id=fastEventHash(r),getPow(r.id)>=e)break}return r}function fastEventHash(t){return bytesToHex$2(sha256$2(utf8Encoder.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(t,e,n,r){return finalizeEvent({kind:Repost,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function getRepostedEventPointer(t){if(t.kind!==Repost)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const s=t.tags[r];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&n===void 0&&(n=s))}if(e!==void 0)return{id:e[1],relays:[e[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function getRepostedEvent(t,{skipVerification:e}={}){const n=getRepostedEventPointer(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!verifyEvent(r)))return r}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$1.source})`);function test(t){return typeof t=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(t)}function parse2(t){const e=t.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:decode$2(e[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(t,e,n){const r=e.tags.filter(s=>s.length>=2&&(s[0]==="e"||s[0]==="p"));return finalizeEvent({...t,kind:Reaction,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function getReactedEventPointer(t){if(t.kind!==Reaction)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const s=t.tags[r];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&n===void 0&&(n=s))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var nip27_exports={};__export(nip27_exports,{matchAll:()=>matchAll,regex:()=>regex$2,replaceAll:()=>replaceAll});var regex$2=()=>new RegExp(`\\b${NOSTR_URI_REGEX.source}\\b`,"g");function*matchAll(t){const e=t.matchAll(regex$2());for(const n of e)try{const[r,s]=n;yield{uri:r,value:s,decoded:decode$2(s),start:n.index,end:n.index+r.length}}catch{}}function replaceAll(t,e){return t.replaceAll(regex$2(),(n,r)=>e({uri:n,value:r,decoded:decode$2(r)}))}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},channelMetadataEvent=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},channelMessageEvent=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},channelHideMessageEvent=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},channelMuteUserEvent=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll2,regex:()=>regex2,replaceAll:()=>replaceAll2});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex2=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll2(t){const e=t.matchAll(regex2());for(const n of e)try{const[r,s]=n;yield{shortcode:r,name:s,start:n.index,end:n.index+r.length}}catch{}}function replaceAll2(t,e){return t.replaceAll(regex2(),(n,r)=>e({shortcode:n,name:r}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(t){_fetch3=t}async function validateGithub(t,e,n){try{return await(await _fetch3(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(t,e){const n=secp256k1$1.getSharedSecret(t,"02"+e).subarray(1,33);return extract(sha256$2,n,"nip44-v2")}function getMessageKeys(t,e){const n=expand(sha256$2,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function calcPaddedLen(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function writeU16BE(t){if(!Number.isSafeInteger(t)||t<minPlaintextSize||t>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function pad(t){const e=utf8Encoder.encode(t),n=e.length,r=writeU16BE(n),s=new Uint8Array(calcPaddedLen(n)-n);return concatBytes$2(r,e,s)}function unpad(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<minPlaintextSize||e>maxPlaintextSize||n.length!==e||t.length!==2+calcPaddedLen(e))throw new Error("invalid padding");return utf8Decoder.decode(n)}function hmacAad(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=concatBytes$2(n,e);return hmac$1(sha256$2,t,r)}function decodePayload(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=base64.decode(t)}catch(o){throw new Error("invalid base64: "+o.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const s=n[0];if(s!==2)throw new Error("unknown encryption version "+s);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function encrypt2(t,e,n=randomBytes$1(32)){const{chacha_key:r,chacha_nonce:s,hmac_key:o}=getMessageKeys(e,n),a=pad(t),u=chacha20(r,s,a),l=hmacAad(o,u,n);return base64.encode(concatBytes$2(new Uint8Array([2]),n,u,l))}function decrypt2(t,e){const{nonce:n,ciphertext:r,mac:s}=decodePayload(t),{chacha_key:o,chacha_nonce:a,hmac_key:u}=getMessageKeys(e,n),l=hmacAad(u,r,n);if(!equalBytes$1(l,s))throw new Error("invalid MAC");const c=chacha20(o,a,r);return unpad(c)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(t){const{pathname:e,searchParams:n}=new URL(t),r=e,s=n.get("relay"),o=n.get("secret");if(!r||!s||!o)throw new Error("invalid connection string");return{pubkey:r,relay:s,secret:o}}async function makeNwcRequestEvent(t,e,n){const s=await encrypt$1(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),o={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",t]]};return finalizeEvent(o,e)}var nip57_exports={};__export(nip57_exports,{getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(t){_fetch4=t}async function getZapEndpoint(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:a}=bech32$1.decode(n,1e3),u=bech32$1.fromWords(a);e=utf8Decoder.decode(u)}else if(r){let[a,u]=r.split("@");e=new URL(`/.well-known/lnurlp/${a}`,`https://${u}`).toString()}else return null;let o=await(await _fetch4(e)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function makeZapRequest({profile:t,event:e,amount:n,relays:r,comment:s=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&o.tags.push(["e",e]),o}function validateZapRequest(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!validateEvent(e))return"Zap request is not a valid Nostr event.";if(!verifyEvent(e))return"Invalid signature on zap request.";let n=e.tags.find(([o,a])=>o==="p"&&a);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([o,a])=>o==="e"&&a);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([o,a])=>o==="relays"&&a)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let s=JSON.parse(t),o=s.tags.filter(([u])=>u==="e"||u==="p"||u==="a"),a={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...o,["P",s.pubkey],["bolt11",n],["description",t]]};return e&&a.tags.push(["preimage",e]),a}var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent,wrapManyEvents:()=>wrapManyEvents});var TWO_DAYS=2*24*60*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(t,e)=>getConversationKey(t,e),nip44Encrypt=(t,e,n)=>encrypt2(JSON.stringify(t),nip44ConversationKey(e,n)),nip44Decrypt=(t,e)=>JSON.parse(decrypt2(t.content,nip44ConversationKey(e,t.pubkey)));function createRumor(t,e){const n={created_at:now(),content:"",tags:[],...t,pubkey:getPublicKey(e)};return n.id=getEventHash$1(n),n}function createSeal(t,e,n){return finalizeEvent({kind:Seal,content:nip44Encrypt(t,e,n),created_at:randomNow(),tags:[]},e)}function createWrap(t,e){const n=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(t,n,e),created_at:randomNow(),tags:[["p",e]]},n)}function wrapEvent(t,e,n){const r=createRumor(t,e),s=createSeal(r,e,n);return createWrap(s,n)}function wrapManyEvents(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=getPublicKey(e),s=[wrapEvent(t,e,r)];return n.forEach(o=>{s.push(wrapEvent(t,e,o))}),s}function unwrapEvent(t,e){const n=nip44Decrypt(t,e);return nip44Decrypt(n,e)}function unwrapManyEvents(t,e){let n=[];return t.forEach(r=>{n.push(unwrapEvent(r,e))}),n.sort((r,s)=>r.created_at-s.created_at),n}var nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(t,e,n,r=!1,s){const o={kind:HTTPAuth,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};s&&o.tags.push(["payload",hashPayload(s)]);const a=await n(o);return(r?_authorizationScheme:"")+base64.encode(utf8Encoder.encode(JSON.stringify(a)))}async function validateToken(t,e,n){const r=await unpackEventFromToken(t).catch(o=>{throw o});return await validateEvent2(r,e,n).catch(o=>{throw o})}async function unpackEventFromToken(t){if(!t)throw new Error("Missing token");t=t.replace(_authorizationScheme,"");const e=utf8Decoder.decode(base64.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function validateEventTimestamp(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function validateEventKind(t){return t.kind===HTTPAuth}function validateEventUrlTag(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function validateEventMethodTag(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function hashPayload(t){const e=sha256$2(utf8Encoder.encode(JSON.stringify(t)));return bytesToHex$2(e)}function validateEventPayloadTag(t,e){const n=t.tags.find(s=>s[0]==="payload");if(!n)return!1;const r=hashPayload(e);return n.length>0&&n[1]===r}async function validateEvent2(t,e,n,r){if(!verifyEvent(t))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(t))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!validateEventPayloadTag(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lib$2={},types={},hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0})),types}var ee={},taskCollection$1={},taskCollection={},utils$2={},hasRequiredUtils$1;function requireUtils$1(){if(hasRequiredUtils$1)return utils$2;hasRequiredUtils$1=1,Object.defineProperty(utils$2,"__esModule",{value:!0}),utils$2._fast_remove_single=void 0;function t(e,n){n!==-1&&(n===0?e.shift():n===e.length-1?e.length=e.length-1:e.splice(n,1))}return utils$2._fast_remove_single=t,utils$2}var bakeCollection={},hasRequiredBakeCollection;function requireBakeCollection(){return hasRequiredBakeCollection||(hasRequiredBakeCollection=1,function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(t){var e="";if(t===0)return e;for(var n=0;n<t-1;++n)e+="arg"+String(n)+", ";return e+="arg"+String(t-1),e}function generateBodyPartsCode(t,e){for(var n="",r="",s=0;s<e;++s)n+="var f".concat(s," = collection[").concat(s,`];
`),r+="f".concat(s,"(").concat(t,`)
`);return{funcDefCode:n,funcCallCode:r}}function generateBodyPartsVariadicCode(t){for(var e="",n="",r=0;r<t;++r)e+="var f".concat(r," = collection[").concat(r,`];
`),n+="f".concat(r,`.apply(undefined, arguments)
`);return{funcDefCode:e,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic}(bakeCollection)),bakeCollection}var hasRequiredTaskCollection$1;function requireTaskCollection$1(){if(hasRequiredTaskCollection$1)return taskCollection;hasRequiredTaskCollection$1=1;var t=taskCollection.__spreadArray||function(E,A,v){if(v||arguments.length===2)for(var w=0,k=A.length,S;w<k;w++)(S||!(w in A))&&(S||(S=Array.prototype.slice.call(A,0,w)),S[w]=A[w]);return E.concat(S||Array.prototype.slice.call(A))};Object.defineProperty(taskCollection,"__esModule",{value:!0}),taskCollection.TaskCollection=void 0;var e=requireUtils$1(),n=requireBakeCollection();function r(E,A){var v=this.length;if(v>1)if(A){var w;(w=this._tasks).push.apply(w,arguments),this.length+=arguments.length}else this._tasks.push(E),this.length++;else if(A){if(v===1){var k=Array(1+arguments.length);k.push(k),k.push.apply(k,arguments),this._tasks=k}else{var k=Array(arguments.length);k.push.apply(k,arguments),this._tasks=k}this.length+=arguments.length}else v===1?this._tasks=[this._tasks,E]:this._tasks=E,this.length++}function s(E,A){var v=this.length;if(v>1)if(A){var w;(w=this._tasks).push.apply(w,arguments),this.length+=arguments.length}else this._tasks.push(E),this.length++;else if(A){if(v===1){var k=Array(1+arguments.length);k.push(k),k.push.apply(k,arguments),this._tasks=k}else{var k=Array(arguments.length);k.push.apply(k,arguments),this._tasks=k}this.length+=arguments.length}else v===1?this._tasks=[this._tasks,E]:this._tasks=E,this.length++;this.firstEmitBuildStrategy?this.call=h:this.rebuild()}function o(E){this.length!==0&&(this.length===1?this._tasks===E&&(this.length=0):((0,e._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(E)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function a(E){if(this.length!==0){if(this.length===1)if(this._tasks===E&&(this.length=0),this.firstEmitBuildStrategy){this.call=n.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,e._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(E)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=h:this.rebuild()}}function u(E){for(var A,v=[],w=1;w<arguments.length;w++)v[w-1]=arguments[w];this.length===0?(this._tasks=v,this.length=1):this.length===1?(v.unshift(this._tasks),this._tasks=v,this.length=this._tasks.length):((A=this._tasks).splice.apply(A,t([E,0],v,!1)),this.length=this._tasks.length)}function l(E){for(var A,v=[],w=1;w<arguments.length;w++)v[w-1]=arguments[w];this.length===0?(this._tasks=v,this.length=1):this.length===1?(v.unshift(this._tasks),this._tasks=v,this.length=this._tasks.length):((A=this._tasks).splice.apply(A,t([E,0],v,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=h:this.rebuild()}function c(){this.length===0?this.call=n.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,n.bakeCollection)(this._tasks,this.argsNum)}function f(){this.length===0?this.call=n.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,n.bakeCollectionAwait)(this._tasks,this.argsNum)}function h(){this.rebuild(),this.call.apply(void 0,arguments)}var p=function(){function E(A,v,w,k){v===void 0&&(v=!0),w===void 0&&(w=null),k===void 0&&(k=!1),this.awaitTasks=k,this.call=n.BAKED_EMPTY_FUNC,this.argsNum=A,this.firstEmitBuildStrategy=!0,k?this.rebuild=f.bind(this):this.rebuild=c.bind(this),this.setAutoRebuild(v),w?typeof w=="function"?(this._tasks=w,this.length=1):(this._tasks=w,this.length=w.length):(this._tasks=null,this.length=0),v&&this.rebuild()}return E}();taskCollection.TaskCollection=p;function m(){this._tasks=null,this.length=0,this.call=n.BAKED_EMPTY_FUNC}function g(){this._tasks=null,this.length=0,this.call=n.BAKED_EMPTY_FUNC}function b(E){this.argsNum<E&&(this.argsNum=E,this.firstEmitBuildStrategy?this.call=h:this.rebuild())}function y(E){E?(this.push=s.bind(this),this.insert=l.bind(this),this.removeLast=a.bind(this)):(this.push=r.bind(this),this.insert=u.bind(this),this.removeLast=o.bind(this))}function _(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function x(E){E.length===0?(this.length=0,this.call=n.BAKED_EMPTY_FUNC):E.length===1?(this.length=1,this.call=E[0],this._tasks=E[0]):(this.length=E.length,this._tasks=E,this.firstEmitBuildStrategy?this.call=h:this.rebuild())}return p.prototype.fastClear=m,p.prototype.clear=g,p.prototype.growArgsNum=b,p.prototype.setAutoRebuild=y,p.prototype.tasksAsArray=_,p.prototype.setTasks=x,taskCollection}var hasRequiredTaskCollection;function requireTaskCollection(){return hasRequiredTaskCollection||(hasRequiredTaskCollection=1,function(t){var e=taskCollection$1.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,u)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=taskCollection$1.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(requireTaskCollection$1(),t)}(taskCollection$1)),taskCollection$1}var utils$1={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils$1;hasRequiredUtils=1,Object.defineProperty(utils$1,"__esModule",{value:!0}),utils$1.nullObj=void 0;function t(){var e={};return e.__proto__=null,e}return utils$1.nullObj=t,utils$1}var hasRequiredEe;function requireEe(){if(hasRequiredEe)return ee;hasRequiredEe=1;var t=ee.__spreadArray||function(v,w,k){if(k||arguments.length===2)for(var S=0,T=w.length,O;S<T;S++)(O||!(S in w))&&(O||(O=Array.prototype.slice.call(w,0,S)),O[S]=w[S]);return v.concat(O||Array.prototype.slice.call(w))};Object.defineProperty(ee,"__esModule",{value:!0}),ee.EventEmitter=void 0;var e=requireTaskCollection(),n=requireUtils$1(),r=requireUtils();function s(v,w,k,S,T,O){var C=this.events[v];if(C){if(C.length===0)return!1;if(C.argsNum<6)C.call(w,k,S,T,O);else{for(var R=new Array(C.argsNum),M=0,I=R.length;M<I;++M)R[M]=arguments[M+1];C.call.apply(void 0,R)}return!0}return!1}function o(v,w,k,S,T,O){var C=this.events[v],R;if(C!==void 0){if(C.length===0)return!1;if(C.argsNum<6)C.call(w,k,S,T,O);else{R=new Array(C.argsNum);for(var M=0,I=R.length;M<I;++M)R[M]=arguments[M+1];C.call.apply(void 0,R)}}var D=this.onceEvents[v];if(D){if(typeof D=="function")if(this.onceEvents[v]=void 0,arguments.length<6)D(w,k,S,T,O);else{if(R===void 0){R=new Array(arguments.length-1);for(var M=0,I=R.length;M<I;++M)R[M]=arguments[M+1]}D.apply(void 0,R)}else{var N=D;if(this.onceEvents[v]=void 0,arguments.length<6)for(var M=0;M<N.length;++M)N[M](w,k,S,T,O);else{if(R===void 0){R=new Array(arguments.length-1);for(var M=0,I=R.length;M<I;++M)R[M]=arguments[M+1]}for(var M=0;M<N.length;++M)N[M].apply(void 0,R)}}return!0}return C!==void 0}var a=function(){function v(){this.events=(0,r.nullObj)(),this.onceEvents=(0,r.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(v.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),v}();ee.EventEmitter=a;function u(v,w){switch(this.emit===s&&(this.emit=o),typeof this.onceEvents[v]){case"undefined":this.onceEvents[v]=w,typeof v=="symbol"&&this._symbolKeys.add(v);break;case"function":this.onceEvents[v]=[this.onceEvents[v],w];break;case"object":this.onceEvents[v].push(w)}return this}function l(v,w,k){if(k===void 0&&(k=w.length),typeof w!="function")throw new TypeError("The listener must be a function");var S=this.events[v];return S?(S.push(w),S.growArgsNum(k),this.maxListeners!==1/0&&this.maxListeners<=S.length&&console.warn('Maximum event listeners for "'.concat(String(v),'" event!'))):(this.events[v]=new e.TaskCollection(k,!0,w,!1),typeof v=="symbol"&&this._symbolKeys.add(v)),this}function c(v,w){var k=this.events[v];k&&k.removeLast(w);var S=this.onceEvents[v];return S&&(typeof S=="function"?this.onceEvents[v]=void 0:typeof S=="object"&&(S.length===1&&S[0]===w?this.onceEvents[v]=void 0:(0,n._fast_remove_single)(S,S.lastIndexOf(w)))),this}function f(v,w,k,S){k===void 0&&(k=this),S===void 0&&(S=w.length),this.boundFuncs||(this.boundFuncs=new Map);var T=w.bind(k);return this.boundFuncs.set(w,T),this.addListener(v,T,S)}function h(v,w){var k,S,T=(k=this.boundFuncs)===null||k===void 0?void 0:k.get(w);return(S=this.boundFuncs)===null||S===void 0||S.delete(w),this.removeListener(v,T)}function p(v){return this.events[v]&&!!this.events[v].length}function m(v,w,k){if(k===void 0&&(k=w.length),typeof w!="function")throw new TypeError("The listener must be a function");var S=this.events[v];return!S||!(S instanceof e.TaskCollection)?(S=this.events[v]=new e.TaskCollection(k,!0,w,!1),typeof v=="symbol"&&this._symbolKeys.add(v)):(S.insert(0,w),S.growArgsNum(k),this.maxListeners!==1/0&&this.maxListeners<=S.length&&console.warn('Maximum event listeners for "'.concat(String(v),'" event!'))),this}function g(v,w){this.emit===s&&(this.emit=o);var k=this.onceEvents[v];return k?typeof k!="object"?(this.onceEvents[v]=[w,k],typeof v=="symbol"&&this._symbolKeys.add(v)):(k.unshift(w),this.maxListeners!==1/0&&this.maxListeners<=k.length&&console.warn('Maximum event listeners for "'.concat(String(v),'" once event!'))):(this.onceEvents[v]=[w],typeof v=="symbol"&&this._symbolKeys.add(v)),this}function b(v){return v===void 0?(this.events=(0,r.nullObj)(),this.onceEvents=(0,r.nullObj)(),this._symbolKeys=new Set):(this.events[v]=void 0,this.onceEvents[v]=void 0,typeof v=="symbol"&&this._symbolKeys.delete(v)),this}function y(v){return this.maxListeners=v,this}function _(){return this.maxListeners}function x(v){return this.emit===s?this.events[v]?this.events[v].tasksAsArray().slice():[]:this.events[v]&&this.onceEvents[v]?t(t([],this.events[v].tasksAsArray(),!0),typeof this.onceEvents[v]=="function"?[this.onceEvents[v]]:this.onceEvents[v],!0):this.events[v]?this.events[v].tasksAsArray():this.onceEvents[v]?typeof this.onceEvents[v]=="function"?[this.onceEvents[v]]:this.onceEvents[v]:[]}function E(){var v=this;if(this.emit===s){var w=Object.keys(this.events);return t(t([],w,!0),Array.from(this._symbolKeys),!0).filter(function(S){return S in v.events&&v.events[S]&&v.events[S].length})}else{var w=Object.keys(this.events).filter(function(T){return v.events[T]&&v.events[T].length}),k=Object.keys(this.onceEvents).filter(function(T){return v.onceEvents[T]&&v.onceEvents[T].length});return t(t(t([],w,!0),k,!0),Array.from(this._symbolKeys).filter(function(T){return T in v.events&&v.events[T]&&v.events[T].length||T in v.onceEvents&&v.onceEvents[T]&&v.onceEvents[T].length}),!0)}}function A(v){return this.emit===s?this.events[v]&&this.events[v].length||0:(this.events[v]&&this.events[v].length||0)+(this.onceEvents[v]&&this.onceEvents[v].length||0)}return a.prototype.emit=s,a.prototype.on=l,a.prototype.once=u,a.prototype.addListener=l,a.prototype.removeListener=c,a.prototype.addListenerBound=f,a.prototype.removeListenerBound=h,a.prototype.hasListeners=p,a.prototype.prependListener=m,a.prototype.prependOnceListener=g,a.prototype.off=c,a.prototype.removeAllListeners=b,a.prototype.setMaxListeners=y,a.prototype.getMaxListeners=_,a.prototype.listeners=x,a.prototype.eventNames=E,a.prototype.listenerCount=A,ee}var hasRequiredLib$1;function requireLib$1(){return hasRequiredLib$1||(hasRequiredLib$1=1,function(t){var e=lib$2.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,u)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=lib$2.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(requireTypes(),t),n(requireEe(),t)}(lib$2)),lib$2}var libExports=requireLib$1(),browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var t=1e3,e=t*60,n=e*60,r=n*24,s=r*7,o=r*365.25;ms=function(f,h){h=h||{};var p=typeof f;if(p==="string"&&f.length>0)return a(f);if(p==="number"&&isFinite(f))return h.long?l(f):u(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(h){var p=parseFloat(h[1]),m=(h[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return p*o;case"weeks":case"week":case"w":return p*s;case"days":case"day":case"d":return p*r;case"hours":case"hour":case"hrs":case"hr":case"h":return p*n;case"minutes":case"minute":case"mins":case"min":case"m":return p*e;case"seconds":case"second":case"secs":case"sec":case"s":return p*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function u(f){var h=Math.abs(f);return h>=r?Math.round(f/r)+"d":h>=n?Math.round(f/n)+"h":h>=e?Math.round(f/e)+"m":h>=t?Math.round(f/t)+"s":f+"ms"}function l(f){var h=Math.abs(f);return h>=r?c(f,h,r,"day"):h>=n?c(f,h,n,"hour"):h>=e?c(f,h,e,"minute"):h>=t?c(f,h,t,"second"):f+" ms"}function c(f,h,p,m){var g=h>=p*1.5;return Math.round(f/p)+" "+m+(g?"s":"")}return ms}var common,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;function t(e){r.debug=r,r.default=r,r.coerce=c,r.disable=u,r.enable=o,r.enabled=l,r.humanize=requireMs(),r.destroy=f,Object.keys(e).forEach(h=>{r[h]=e[h]}),r.names=[],r.skips=[],r.formatters={};function n(h){let p=0;for(let m=0;m<h.length;m++)p=(p<<5)-p+h.charCodeAt(m),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=n;function r(h){let p,m=null,g,b;function y(..._){if(!y.enabled)return;const x=y,E=Number(new Date),A=E-(p||E);x.diff=A,x.prev=p,x.curr=E,p=E,_[0]=r.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let v=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(k,S)=>{if(k==="%%")return"%";v++;const T=r.formatters[S];if(typeof T=="function"){const O=_[v];k=T.call(x,O),_.splice(v,1),v--}return k}),r.formatArgs.call(x,_),(x.log||r.log).apply(x,_)}return y.namespace=h,y.useColors=r.useColors(),y.color=r.selectColor(h),y.extend=s,y.destroy=r.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(g!==r.namespaces&&(g=r.namespaces,b=r.enabled(h)),b),set:_=>{m=_}}),typeof r.init=="function"&&r.init(y),y}function s(h,p){const m=r(this.namespace+(typeof p>"u"?":":p)+h);return m.log=this.log,m}function o(h){r.save(h),r.namespaces=h,r.names=[],r.skips=[];const p=(typeof h=="string"?h:"").trim().replace(" ",",").split(",").filter(Boolean);for(const m of p)m[0]==="-"?r.skips.push(m.slice(1)):r.names.push(m)}function a(h,p){let m=0,g=0,b=-1,y=0;for(;m<h.length;)if(g<p.length&&(p[g]===h[m]||p[g]==="*"))p[g]==="*"?(b=g,y=m,g++):(m++,g++);else if(b!==-1)g=b+1,y++,m=y;else return!1;for(;g<p.length&&p[g]==="*";)g++;return g===p.length}function u(){const h=[...r.names,...r.skips.map(p=>"-"+p)].join(",");return r.enable(""),h}function l(h){for(const p of r.skips)if(a(h,p))return!1;for(const p of r.names)if(a(h,p))return!0;return!1}function c(h){return h instanceof Error?h.stack||h.message:h}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return common=t,common}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,function(t,e){var n={};e.formatArgs=s,e.save=o,e.load=a,e.useColors=r,e.storage=u(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;c.splice(1,0,f,"color: inherit");let h=0,p=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(h++,m==="%c"&&(p=h))}),c.splice(p,0,f)}e.log=console.debug||console.log||(()=>{});function o(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function a(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=n.DEBUG),c}function u(){try{return localStorage}catch{}}t.exports=requireCommon()(e);const{formatters:l}=t.exports;l.j=function(c){try{return JSON.stringify(c)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}(browser,browser.exports)),browser.exports}var browserExports=requireBrowser();const debug7=getDefaultExportFromCjs(browserExports);function isBytes$3(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function abytes$2(t,...e){if(!isBytes$3(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function aexists$1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function aoutput$1(t,e){abytes$2(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const createView$1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),rotr$1=(t,e)=>t<<32-e|t>>>e,hexes$1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1(t){abytes$2(t);let e="";for(let n=0;n<t.length;n++)e+=hexes$1[t[n]];return e}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(t){if(t>=asciis$1._0&&t<=asciis$1._9)return t-asciis$1._0;if(t>=asciis$1.A&&t<=asciis$1.F)return t-(asciis$1.A-10);if(t>=asciis$1.a&&t<=asciis$1.f)return t-(asciis$1.a-10)}function hexToBytes$1(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let s=0,o=0;s<n;s++,o+=2){const a=asciiToBase16$1(t.charCodeAt(o)),u=asciiToBase16$1(t.charCodeAt(o+1));if(a===void 0||u===void 0){const l=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}r[s]=a*16+u}return r}function utf8ToBytes$2(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function toBytes$1(t){return typeof t=="string"&&(t=utf8ToBytes$2(t)),abytes$2(t),t}let Hash$1=class{clone(){return this._cloneInto()}};function wrapConstructor$1(t){const e=r=>t().update(toBytes$1(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function setBigUint64$1(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(n>>s&o),u=Number(n&o),l=r?4:0,c=r?0:4;t.setUint32(e+l,a,r),t.setUint32(e+c,u,r)}const Chi$1=(t,e,n)=>t&e^~t&n,Maj$1=(t,e,n)=>t&e^t&n^e&n;let HashMD$1=class extends Hash$1{constructor(e,n,r,s){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$1(this.buffer)}update(e){aexists$1(this);const{view:n,buffer:r,blockLen:s}=this;e=toBytes$1(e);const o=e.length;for(let a=0;a<o;){const u=Math.min(s-this.pos,o-a);if(u===s){const l=createView$1(e);for(;s<=o-a;a+=s)this.process(l,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists$1(this),aoutput$1(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)n[h]=0;setBigUint64$1(r,s-8,BigInt(this.length*8),o),this.process(r,0);const u=createView$1(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)u.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:a,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=a,s%n&&e.buffer.set(r),e}};const SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends HashMD$1{constructor(){super(64,32,8,!1),this.A=SHA256_IV$1[0]|0,this.B=SHA256_IV$1[1]|0,this.C=SHA256_IV$1[2]|0,this.D=SHA256_IV$1[3]|0,this.E=SHA256_IV$1[4]|0,this.F=SHA256_IV$1[5]|0,this.G=SHA256_IV$1[6]|0,this.H=SHA256_IV$1[7]|0}get(){const{A:e,B:n,C:r,D:s,E:o,F:a,G:u,H:l}=this;return[e,n,r,s,o,a,u,l]}set(e,n,r,s,o,a,u,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=u|0,this.H=l|0}process(e,n){for(let h=0;h<16;h++,n+=4)SHA256_W$1[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const p=SHA256_W$1[h-15],m=SHA256_W$1[h-2],g=rotr$1(p,7)^rotr$1(p,18)^p>>>3,b=rotr$1(m,17)^rotr$1(m,19)^m>>>10;SHA256_W$1[h]=b+SHA256_W$1[h-7]+g+SHA256_W$1[h-16]|0}let{A:r,B:s,C:o,D:a,E:u,F:l,G:c,H:f}=this;for(let h=0;h<64;h++){const p=rotr$1(u,6)^rotr$1(u,11)^rotr$1(u,25),m=f+p+Chi$1(u,l,c)+SHA256_K$1[h]+SHA256_W$1[h]|0,b=(rotr$1(r,2)^rotr$1(r,13)^rotr$1(r,22))+Maj$1(r,s,o)|0;f=c,c=l,l=u,u=a+m|0,a=o,o=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,u=u+this.E|0,l=l+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(r,s,o,a,u,l,c,f)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$1=wrapConstructor$1(()=>new SHA256$1);function anumber$1(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function isBytes$2(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function abytes$1(t,...e){if(!isBytes$2(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ahash(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");anumber$1(t.outputLen),anumber$1(t.blockLen)}function aexists(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function aoutput(t,e){abytes$1(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const createView=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),rotr=(t,e)=>t<<32-e|t>>>e;function utf8ToBytes$1(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function toBytes(t){return typeof t=="string"&&(t=utf8ToBytes$1(t)),abytes$1(t),t}function concatBytes$1(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];abytes$1(s),e+=s.length}const n=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const o=t[r];n.set(o,s),s+=o.length}return n}class Hash{clone(){return this._cloneInto()}}function wrapConstructor(t){const e=r=>t().update(toBytes(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function randomBytes(t=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(t));if(crypto$1&&typeof crypto$1.randomBytes=="function")return crypto$1.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function setBigUint64(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(n>>s&o),u=Number(n&o),l=r?4:0,c=r?0:4;t.setUint32(e+l,a,r),t.setUint32(e+c,u,r)}const Chi=(t,e,n)=>t&e^~t&n,Maj=(t,e,n)=>t&e^t&n^e&n;class HashMD extends Hash{constructor(e,n,r,s){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView(this.buffer)}update(e){aexists(this);const{view:n,buffer:r,blockLen:s}=this;e=toBytes(e);const o=e.length;for(let a=0;a<o;){const u=Math.min(s-this.pos,o-a);if(u===s){const l=createView(e);for(;s<=o-a;a+=s)this.process(l,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists(this),aoutput(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)n[h]=0;setBigUint64(r,s-8,BigInt(this.length*8),o),this.process(r,0);const u=createView(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)u.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:a,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=a,s%n&&e.buffer.set(r),e}}const SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:n,C:r,D:s,E:o,F:a,G:u,H:l}=this;return[e,n,r,s,o,a,u,l]}set(e,n,r,s,o,a,u,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=u|0,this.H=l|0}process(e,n){for(let h=0;h<16;h++,n+=4)SHA256_W[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const p=SHA256_W[h-15],m=SHA256_W[h-2],g=rotr(p,7)^rotr(p,18)^p>>>3,b=rotr(m,17)^rotr(m,19)^m>>>10;SHA256_W[h]=b+SHA256_W[h-7]+g+SHA256_W[h-16]|0}let{A:r,B:s,C:o,D:a,E:u,F:l,G:c,H:f}=this;for(let h=0;h<64;h++){const p=rotr(u,6)^rotr(u,11)^rotr(u,25),m=f+p+Chi(u,l,c)+SHA256_K[h]+SHA256_W[h]|0,b=(rotr(r,2)^rotr(r,13)^rotr(r,22))+Maj(r,s,o)|0;f=c,c=l,l=u,u=a+m|0,a=o,o=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,u=u+this.E|0,l=l+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(r,s,o,a,u,l,c,f)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256=wrapConstructor(()=>new SHA256);class HMAC extends Hash{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,ahash(e);const r=toBytes(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return aexists(this),this.iHash.update(e),this}digestInto(e){aexists(this),abytes$1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=u,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(t,e,n)=>new HMAC(t,e).update(n).digest();hmac.create=(t,e)=>new HMAC(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$4=BigInt(1),_2n$2=BigInt(2);function isBytes$1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function abytes(t){if(!isBytes$1(t))throw new Error("Uint8Array expected")}function abool(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const hexes=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex(t){abytes(t);let e="";for(let n=0;n<t.length;n++)e+=hexes[t[n]];return e}function numberToHexUnpadded(t){const e=t.toString(16);return e.length&1?"0"+e:e}function hexToNumber(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?_0n$4:BigInt("0x"+t)}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(t){if(t>=asciis._0&&t<=asciis._9)return t-asciis._0;if(t>=asciis.A&&t<=asciis.F)return t-(asciis.A-10);if(t>=asciis.a&&t<=asciis.f)return t-(asciis.a-10)}function hexToBytes(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let s=0,o=0;s<n;s++,o+=2){const a=asciiToBase16(t.charCodeAt(o)),u=asciiToBase16(t.charCodeAt(o+1));if(a===void 0||u===void 0){const l=t[o]+t[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}r[s]=a*16+u}return r}function bytesToNumberBE(t){return hexToNumber(bytesToHex(t))}function bytesToNumberLE(t){return abytes(t),hexToNumber(bytesToHex(Uint8Array.from(t).reverse()))}function numberToBytesBE(t,e){return hexToBytes(t.toString(16).padStart(e*2,"0"))}function numberToBytesLE(t,e){return numberToBytesBE(t,e).reverse()}function numberToVarBytesBE(t){return hexToBytes(numberToHexUnpadded(t))}function ensureBytes(t,e,n){let r;if(typeof e=="string")try{r=hexToBytes(e)}catch(o){throw new Error(t+" must be hex string or Uint8Array, cause: "+o)}else if(isBytes$1(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=r.length;if(typeof n=="number"&&s!==n)throw new Error(t+" of length "+n+" expected, got "+s);return r}function concatBytes(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];abytes(s),e+=s.length}const n=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const o=t[r];n.set(o,s),s+=o.length}return n}function equalBytes(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function utf8ToBytes(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const isPosBig=t=>typeof t=="bigint"&&_0n$4<=t;function inRange(t,e,n){return isPosBig(t)&&isPosBig(e)&&isPosBig(n)&&e<=t&&t<n}function aInRange(t,e,n,r){if(!inRange(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function bitLen(t){let e;for(e=0;t>_0n$4;t>>=_1n$4,e+=1);return e}function bitGet(t,e){return t>>BigInt(e)&_1n$4}function bitSet(t,e,n){return t|(n?_1n$4:_0n$4)<<BigInt(e)}const bitMask=t=>(_2n$2<<BigInt(t-1))-_1n$4,u8n=t=>new Uint8Array(t),u8fr=t=>Uint8Array.from(t);function createHmacDrbg(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=u8n(t),s=u8n(t),o=0;const a=()=>{r.fill(1),s.fill(0),o=0},u=(...h)=>n(s,r,...h),l=(h=u8n())=>{s=u(u8fr([0]),h),r=u(),h.length!==0&&(s=u(u8fr([1]),h),r=u())},c=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){r=u();const m=r.slice();p.push(m),h+=r.length}return concatBytes(...p)};return(h,p)=>{a(),l(h);let m;for(;!(m=p(c()));)l();return a(),m}}const validatorFns={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||isBytes$1(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function validateObject(t,e,n={}){const r=(s,o,a)=>{const u=validatorFns[o];if(typeof u!="function")throw new Error("invalid validator function");const l=t[s];if(!(a&&l===void 0)&&!u(l,t))throw new Error("param "+String(s)+" is invalid. Expected "+o+", got "+l)};for(const[s,o]of Object.entries(e))r(s,o,!1);for(const[s,o]of Object.entries(n))r(s,o,!0);return t}const notImplemented=()=>{throw new Error("not implemented")};function memoized(t){const e=new WeakMap;return(n,...r)=>{const s=e.get(n);if(s!==void 0)return s;const o=t(n,...r);return e.set(n,o),o}}const ut=Object.freeze(Object.defineProperty({__proto__:null,aInRange,abool,abytes,bitGet,bitLen,bitMask,bitSet,bytesToHex,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes,equalBytes,hexToBytes,hexToNumber,inRange,isBytes:isBytes$1,memoized,notImplemented,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$1=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n=BigInt(5),_8n=BigInt(8);function mod(t,e){const n=t%e;return n>=_0n$3?n:e+n}function pow(t,e,n){if(e<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(n<=_0n$3)throw new Error("invalid modulus");if(n===_1n$3)return _0n$3;let r=_1n$3;for(;e>_0n$3;)e&_1n$3&&(r=r*t%n),t=t*t%n,e>>=_1n$3;return r}function pow2(t,e,n){let r=t;for(;e-- >_0n$3;)r*=r,r%=n;return r}function invert(t,e){if(t===_0n$3)throw new Error("invert: expected non-zero number");if(e<=_0n$3)throw new Error("invert: expected positive modulus, got "+e);let n=mod(t,e),r=e,s=_0n$3,o=_1n$3;for(;n!==_0n$3;){const u=r/n,l=r%n,c=s-o*u;r=n,n=l,s=o,o=c}if(r!==_1n$3)throw new Error("invert: does not exist");return mod(s,e)}function tonelliShanks(t){const e=(t-_1n$3)/_2n$1;let n,r,s;for(n=t-_1n$3,r=0;n%_2n$1===_0n$3;n/=_2n$1,r++);for(s=_2n$1;s<t&&pow(s,e,t)!==t-_1n$3;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const a=(t+_1n$3)/_4n;return function(l,c){const f=l.pow(c,a);if(!l.eql(l.sqr(f),c))throw new Error("Cannot find square root");return f}}const o=(n+_1n$3)/_2n$1;return function(u,l){if(u.pow(l,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let c=r,f=u.pow(u.mul(u.ONE,s),n),h=u.pow(l,o),p=u.pow(l,n);for(;!u.eql(p,u.ONE);){if(u.eql(p,u.ZERO))return u.ZERO;let m=1;for(let b=u.sqr(p);m<c&&!u.eql(b,u.ONE);m++)b=u.sqr(b);const g=u.pow(f,_1n$3<<BigInt(c-m-1));f=u.sqr(g),h=u.mul(h,g),p=u.mul(p,f),c=m}return h}}function FpSqrt(t){if(t%_4n===_3n$1){const e=(t+_1n$3)/_4n;return function(r,s){const o=r.pow(s,e);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(t%_8n===_5n){const e=(t-_5n)/_8n;return function(r,s){const o=r.mul(s,_2n$1),a=r.pow(o,e),u=r.mul(s,a),l=r.mul(r.mul(u,_2n$1),a),c=r.mul(u,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),s))throw new Error("Cannot find square root");return c}}return tonelliShanks(t)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=FIELD_FIELDS.reduce((r,s)=>(r[s]="function",r),e);return validateObject(t,n)}function FpPow(t,e,n){if(n<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(n===_0n$3)return t.ONE;if(n===_1n$3)return e;let r=t.ONE,s=e;for(;n>_0n$3;)n&_1n$3&&(r=t.mul(r,s)),s=t.sqr(s),n>>=_1n$3;return r}function FpInvertBatch(t,e){const n=new Array(e.length),r=e.reduce((o,a,u)=>t.is0(a)?o:(n[u]=o,t.mul(o,a)),t.ONE),s=t.inv(r);return e.reduceRight((o,a,u)=>t.is0(a)?o:(n[u]=t.mul(o,n[u]),t.mul(o,a)),s),n}function nLength(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Field(t,e,n=!1,r={}){if(t<=_0n$3)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:o}=nLength(t,e);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const u=Object.freeze({ORDER:t,BITS:s,BYTES:o,MASK:bitMask(s),ZERO:_0n$3,ONE:_1n$3,create:l=>mod(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof l);return _0n$3<=l&&l<t},is0:l=>l===_0n$3,isOdd:l=>(l&_1n$3)===_1n$3,neg:l=>mod(-l,t),eql:(l,c)=>l===c,sqr:l=>mod(l*l,t),add:(l,c)=>mod(l+c,t),sub:(l,c)=>mod(l-c,t),mul:(l,c)=>mod(l*c,t),pow:(l,c)=>FpPow(u,l,c),div:(l,c)=>mod(l*invert(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>invert(l,t),sqrt:r.sqrt||(l=>(a||(a=FpSqrt(t)),a(u,l))),invertBatch:l=>FpInvertBatch(u,l),cmov:(l,c,f)=>f?c:l,toBytes:l=>n?numberToBytesLE(l,o):numberToBytesBE(l,o),fromBytes:l=>{if(l.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+l.length);return n?bytesToNumberLE(l):bytesToNumberBE(l)}});return Object.freeze(u)}function getFieldBytesLength(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(t){const e=getFieldBytesLength(t);return e+Math.ceil(e/2)}function mapHashToField(t,e,n=!1){const r=t.length,s=getFieldBytesLength(e),o=getMinHashLength(e);if(r<16||r<o||r>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+r);const a=n?bytesToNumberBE(t):bytesToNumberLE(t),u=mod(a,e-_1n$3)+_1n$3;return n?numberToBytesLE(u,s):numberToBytesBE(u,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1);function constTimeNegate(t,e){const n=e.negate();return t?n:e}function validateW(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function calcWOpts(t,e){validateW(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1);return{windows:n,windowSize:r}}function validateMSMPoints(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function validateMSMScalars(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(t){return pointWindowSizes.get(t)||1}function wNAF(t,e){return{constTimeNegate,hasPrecomputes(n){return getW(n)!==1},unsafeLadder(n,r,s=t.ZERO){let o=n;for(;r>_0n$2;)r&_1n$2&&(s=s.add(o)),o=o.double(),r>>=_1n$2;return s},precomputeWindow(n,r){const{windows:s,windowSize:o}=calcWOpts(r,e),a=[];let u=n,l=u;for(let c=0;c<s;c++){l=u,a.push(l);for(let f=1;f<o;f++)l=l.add(u),a.push(l);u=l.double()}return a},wNAF(n,r,s){const{windows:o,windowSize:a}=calcWOpts(n,e);let u=t.ZERO,l=t.BASE;const c=BigInt(2**n-1),f=2**n,h=BigInt(n);for(let p=0;p<o;p++){const m=p*a;let g=Number(s&c);s>>=h,g>a&&(g-=f,s+=_1n$2);const b=m,y=m+Math.abs(g)-1,_=p%2!==0,x=g<0;g===0?l=l.add(constTimeNegate(_,r[b])):u=u.add(constTimeNegate(x,r[y]))}return{p:u,f:l}},wNAFUnsafe(n,r,s,o=t.ZERO){const{windows:a,windowSize:u}=calcWOpts(n,e),l=BigInt(2**n-1),c=2**n,f=BigInt(n);for(let h=0;h<a;h++){const p=h*u;if(s===_0n$2)break;let m=Number(s&l);if(s>>=f,m>u&&(m-=c,s+=_1n$2),m===0)continue;let g=r[p+Math.abs(m)-1];m<0&&(g=g.negate()),o=o.add(g)}return o},getPrecomputes(n,r,s){let o=pointPrecomputes.get(r);return o||(o=this.precomputeWindow(r,n),n!==1&&pointPrecomputes.set(r,s(o))),o},wNAFCached(n,r,s){const o=getW(n);return this.wNAF(o,this.getPrecomputes(o,n,s),r)},wNAFCachedUnsafe(n,r,s,o){const a=getW(n);return a===1?this.unsafeLadder(n,r,o):this.wNAFUnsafe(a,this.getPrecomputes(a,n,s),r,o)},setWindowSize(n,r){validateW(r,e),pointWindowSizes.set(n,r),pointPrecomputes.delete(n)}}}function pippenger(t,e,n,r){if(validateMSMPoints(n,t),validateMSMScalars(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,o=bitLen(BigInt(n.length)),a=o>12?o-3:o>4?o-2:o?2:1,u=(1<<a)-1,l=new Array(u+1).fill(s),c=Math.floor((e.BITS-1)/a)*a;let f=s;for(let h=c;h>=0;h-=a){l.fill(s);for(let m=0;m<r.length;m++){const g=r[m],b=Number(g>>BigInt(h)&BigInt(u));l[b]=l[b].add(n[m])}let p=s;for(let m=l.length-1,g=s;m>0;m--)g=g.add(l[m]),p=p.add(g);if(f=f.add(p),h!==0)for(let m=0;m<a;m++)f=f.double()}return f}function validateBasic(t){return validateField(t.Fp),validateObject(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validateSigVerOpts(t){t.lowS!==void 0&&abool("lowS",t.lowS),t.prehash!==void 0&&abool("prehash",t.prehash)}function validatePointOpts(t){const e=validateBasic(t);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:s}=e;if(n){if(!r.eql(s,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(t,e)=>{const{Err:n}=DER;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,s=numberToHexUnpadded(r);if(s.length/2&128)throw new n("tlv.encode: long form length too big");const o=r>127?numberToHexUnpadded(s.length/2|128):"";return numberToHexUnpadded(t)+o+s+e},decode(t,e){const{Err:n}=DER;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const s=e[r++],o=!!(s&128);let a=0;if(!o)a=s;else{const l=s&127;if(!l)throw new n("tlv.decode(long): indefinite length not supported");if(l>4)throw new n("tlv.decode(long): byte length is too big");const c=e.subarray(r,r+l);if(c.length!==l)throw new n("tlv.decode: length bytes not complete");if(c[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const f of c)a=a<<8|f;if(r+=l,a<128)throw new n("tlv.decode(long): not minimal encoding")}const u=e.subarray(r,r+a);if(u.length!==a)throw new n("tlv.decode: wrong value length");return{v:u,l:e.subarray(r+a)}}},_int:{encode(t){const{Err:e}=DER;if(t<_0n$1)throw new e("integer: negative integers are not allowed");let n=numberToHexUnpadded(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=DER;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return b2n(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=DER,s=typeof t=="string"?h2b(t):t;abytes(s);const{v:o,l:a}=r.decode(48,s);if(a.length)throw new e("invalid signature: left bytes after parsing");const{v:u,l}=r.decode(2,o),{v:c,l:f}=r.decode(2,l);if(f.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(u),s:n.decode(c)}},hexFromSig(t){const{_tlv:e,_int:n}=DER,r=e.encode(2,n.encode(t.r)),s=e.encode(2,n.encode(t.s)),o=r+s;return e.encode(48,o)}},_0n$1=BigInt(0),_1n$1=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(t){const e=validatePointOpts(t),{Fp:n}=e,r=Field(e.n,e.nBitLength),s=e.toBytes||((b,y,_)=>{const x=y.toAffine();return concatBytes(Uint8Array.from([4]),n.toBytes(x.x),n.toBytes(x.y))}),o=e.fromBytes||(b=>{const y=b.subarray(1),_=n.fromBytes(y.subarray(0,n.BYTES)),x=n.fromBytes(y.subarray(n.BYTES,2*n.BYTES));return{x:_,y:x}});function a(b){const{a:y,b:_}=e,x=n.sqr(b),E=n.mul(x,b);return n.add(n.add(E,n.mul(b,y)),_)}if(!n.eql(n.sqr(e.Gy),a(e.Gx)))throw new Error("bad generator point: equation left != right");function u(b){return inRange(b,_1n$1,e.n)}function l(b){const{allowedPrivateKeyLengths:y,nByteLength:_,wrapPrivateKey:x,n:E}=e;if(y&&typeof b!="bigint"){if(isBytes$1(b)&&(b=bytesToHex(b)),typeof b!="string"||!y.includes(b.length))throw new Error("invalid private key");b=b.padStart(_*2,"0")}let A;try{A=typeof b=="bigint"?b:bytesToNumberBE(ensureBytes("private key",b,_))}catch{throw new Error("invalid private key, expected hex or "+_+" bytes, got "+typeof b)}return x&&(A=mod(A,E)),aInRange("private key",A,_1n$1,E),A}function c(b){if(!(b instanceof p))throw new Error("ProjectivePoint expected")}const f=memoized((b,y)=>{const{px:_,py:x,pz:E}=b;if(n.eql(E,n.ONE))return{x:_,y:x};const A=b.is0();y==null&&(y=A?n.ONE:n.inv(E));const v=n.mul(_,y),w=n.mul(x,y),k=n.mul(E,y);if(A)return{x:n.ZERO,y:n.ZERO};if(!n.eql(k,n.ONE))throw new Error("invZ was invalid");return{x:v,y:w}}),h=memoized(b=>{if(b.is0()){if(e.allowInfinityPoint&&!n.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:y,y:_}=b.toAffine();if(!n.isValid(y)||!n.isValid(_))throw new Error("bad point: x or y not FE");const x=n.sqr(_),E=a(y);if(!n.eql(x,E))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(y,_,x){if(this.px=y,this.py=_,this.pz=x,y==null||!n.isValid(y))throw new Error("x required");if(_==null||!n.isValid(_))throw new Error("y required");if(x==null||!n.isValid(x))throw new Error("z required");Object.freeze(this)}static fromAffine(y){const{x:_,y:x}=y||{};if(!y||!n.isValid(_)||!n.isValid(x))throw new Error("invalid affine point");if(y instanceof p)throw new Error("projective point not allowed");const E=A=>n.eql(A,n.ZERO);return E(_)&&E(x)?p.ZERO:new p(_,x,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const _=n.invertBatch(y.map(x=>x.pz));return y.map((x,E)=>x.toAffine(_[E])).map(p.fromAffine)}static fromHex(y){const _=p.fromAffine(o(ensureBytes("pointHex",y)));return _.assertValidity(),_}static fromPrivateKey(y){return p.BASE.multiply(l(y))}static msm(y,_){return pippenger(p,r,y,_)}_setWindowSize(y){g.setWindowSize(this,y)}assertValidity(){h(this)}hasEvenY(){const{y}=this.toAffine();if(n.isOdd)return!n.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){c(y);const{px:_,py:x,pz:E}=this,{px:A,py:v,pz:w}=y,k=n.eql(n.mul(_,w),n.mul(A,E)),S=n.eql(n.mul(x,w),n.mul(v,E));return k&&S}negate(){return new p(this.px,n.neg(this.py),this.pz)}double(){const{a:y,b:_}=e,x=n.mul(_,_3n),{px:E,py:A,pz:v}=this;let w=n.ZERO,k=n.ZERO,S=n.ZERO,T=n.mul(E,E),O=n.mul(A,A),C=n.mul(v,v),R=n.mul(E,A);return R=n.add(R,R),S=n.mul(E,v),S=n.add(S,S),w=n.mul(y,S),k=n.mul(x,C),k=n.add(w,k),w=n.sub(O,k),k=n.add(O,k),k=n.mul(w,k),w=n.mul(R,w),S=n.mul(x,S),C=n.mul(y,C),R=n.sub(T,C),R=n.mul(y,R),R=n.add(R,S),S=n.add(T,T),T=n.add(S,T),T=n.add(T,C),T=n.mul(T,R),k=n.add(k,T),C=n.mul(A,v),C=n.add(C,C),T=n.mul(C,R),w=n.sub(w,T),S=n.mul(C,O),S=n.add(S,S),S=n.add(S,S),new p(w,k,S)}add(y){c(y);const{px:_,py:x,pz:E}=this,{px:A,py:v,pz:w}=y;let k=n.ZERO,S=n.ZERO,T=n.ZERO;const O=e.a,C=n.mul(e.b,_3n);let R=n.mul(_,A),M=n.mul(x,v),I=n.mul(E,w),D=n.add(_,x),N=n.add(A,v);D=n.mul(D,N),N=n.add(R,M),D=n.sub(D,N),N=n.add(_,E);let F=n.add(A,w);return N=n.mul(N,F),F=n.add(R,I),N=n.sub(N,F),F=n.add(x,E),k=n.add(v,w),F=n.mul(F,k),k=n.add(M,I),F=n.sub(F,k),T=n.mul(O,N),k=n.mul(C,I),T=n.add(k,T),k=n.sub(M,T),T=n.add(M,T),S=n.mul(k,T),M=n.add(R,R),M=n.add(M,R),I=n.mul(O,I),N=n.mul(C,N),M=n.add(M,I),I=n.sub(R,I),I=n.mul(O,I),N=n.add(N,I),R=n.mul(M,N),S=n.add(S,R),R=n.mul(F,N),k=n.mul(D,k),k=n.sub(k,R),R=n.mul(D,M),T=n.mul(F,T),T=n.add(T,R),new p(k,S,T)}subtract(y){return this.add(y.negate())}is0(){return this.equals(p.ZERO)}wNAF(y){return g.wNAFCached(this,y,p.normalizeZ)}multiplyUnsafe(y){const{endo:_,n:x}=e;aInRange("scalar",y,_0n$1,x);const E=p.ZERO;if(y===_0n$1)return E;if(this.is0()||y===_1n$1)return this;if(!_||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,y,p.normalizeZ);let{k1neg:A,k1:v,k2neg:w,k2:k}=_.splitScalar(y),S=E,T=E,O=this;for(;v>_0n$1||k>_0n$1;)v&_1n$1&&(S=S.add(O)),k&_1n$1&&(T=T.add(O)),O=O.double(),v>>=_1n$1,k>>=_1n$1;return A&&(S=S.negate()),w&&(T=T.negate()),T=new p(n.mul(T.px,_.beta),T.py,T.pz),S.add(T)}multiply(y){const{endo:_,n:x}=e;aInRange("scalar",y,_1n$1,x);let E,A;if(_){const{k1neg:v,k1:w,k2neg:k,k2:S}=_.splitScalar(y);let{p:T,f:O}=this.wNAF(w),{p:C,f:R}=this.wNAF(S);T=g.constTimeNegate(v,T),C=g.constTimeNegate(k,C),C=new p(n.mul(C.px,_.beta),C.py,C.pz),E=T.add(C),A=O.add(R)}else{const{p:v,f:w}=this.wNAF(y);E=v,A=w}return p.normalizeZ([E,A])[0]}multiplyAndAddUnsafe(y,_,x){const E=p.BASE,A=(w,k)=>k===_0n$1||k===_1n$1||!w.equals(E)?w.multiplyUnsafe(k):w.multiply(k),v=A(this,_).add(A(y,x));return v.is0()?void 0:v}toAffine(y){return f(this,y)}isTorsionFree(){const{h:y,isTorsionFree:_}=e;if(y===_1n$1)return!0;if(_)return _(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:_}=e;return y===_1n$1?this:_?_(p,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return abool("isCompressed",y),this.assertValidity(),s(p,this,y)}toHex(y=!0){return abool("isCompressed",y),bytesToHex(this.toRawBytes(y))}}p.BASE=new p(e.Gx,e.Gy,n.ONE),p.ZERO=new p(n.ZERO,n.ONE,n.ZERO);const m=e.nBitLength,g=wNAF(p,e.endo?Math.ceil(m/2):m);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:l,weierstrassEquation:a,isWithinCurveOrder:u}}function validateOpts(t){const e=validateBasic(t);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass(t){const e=validateOpts(t),{Fp:n,n:r}=e,s=n.BYTES+1,o=2*n.BYTES+1;function a(I){return mod(I,r)}function u(I){return invert(I,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:f,isWithinCurveOrder:h}=weierstrassPoints({...e,toBytes(I,D,N){const F=D.toAffine(),z=n.toBytes(F.x),U=concatBytes;return abool("isCompressed",N),N?U(Uint8Array.from([D.hasEvenY()?2:3]),z):U(Uint8Array.from([4]),z,n.toBytes(F.y))},fromBytes(I){const D=I.length,N=I[0],F=I.subarray(1);if(D===s&&(N===2||N===3)){const z=bytesToNumberBE(F);if(!inRange(z,_1n$1,n.ORDER))throw new Error("Point is not on curve");const U=f(z);let L;try{L=n.sqrt(U)}catch(j){const G=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+G)}const B=(L&_1n$1)===_1n$1;return(N&1)===1!==B&&(L=n.neg(L)),{x:z,y:L}}else if(D===o&&N===4){const z=n.fromBytes(F.subarray(0,n.BYTES)),U=n.fromBytes(F.subarray(n.BYTES,2*n.BYTES));return{x:z,y:U}}else{const z=s,U=o;throw new Error("invalid Point, expected length of "+z+", or uncompressed "+U+", got "+D)}}}),p=I=>bytesToHex(numberToBytesBE(I,e.nByteLength));function m(I){const D=r>>_1n$1;return I>D}function g(I){return m(I)?a(-I):I}const b=(I,D,N)=>bytesToNumberBE(I.slice(D,N));class y{constructor(D,N,F){this.r=D,this.s=N,this.recovery=F,this.assertValidity()}static fromCompact(D){const N=e.nByteLength;return D=ensureBytes("compactSignature",D,N*2),new y(b(D,0,N),b(D,N,2*N))}static fromDER(D){const{r:N,s:F}=DER.toSig(ensureBytes("DER",D));return new y(N,F)}assertValidity(){aInRange("r",this.r,_1n$1,r),aInRange("s",this.s,_1n$1,r)}addRecoveryBit(D){return new y(this.r,this.s,D)}recoverPublicKey(D){const{r:N,s:F,recovery:z}=this,U=w(ensureBytes("msgHash",D));if(z==null||![0,1,2,3].includes(z))throw new Error("recovery id invalid");const L=z===2||z===3?N+e.n:N;if(L>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const B=z&1?"03":"02",H=l.fromHex(B+p(L)),j=u(L),G=a(-U*j),W=a(F*j),Q=l.BASE.multiplyAndAddUnsafe(H,G,W);if(!Q)throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const _={isValidPrivateKey(I){try{return c(I),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const I=getMinHashLength(e.n);return mapHashToField(e.randomBytes(I),e.n)},precompute(I=8,D=l.BASE){return D._setWindowSize(I),D.multiply(BigInt(3)),D}};function x(I,D=!0){return l.fromPrivateKey(I).toRawBytes(D)}function E(I){const D=isBytes$1(I),N=typeof I=="string",F=(D||N)&&I.length;return D?F===s||F===o:N?F===2*s||F===2*o:I instanceof l}function A(I,D,N=!0){if(E(I))throw new Error("first arg must be private key");if(!E(D))throw new Error("second arg must be public key");return l.fromHex(D).multiply(c(I)).toRawBytes(N)}const v=e.bits2int||function(I){if(I.length>8192)throw new Error("input is too large");const D=bytesToNumberBE(I),N=I.length*8-e.nBitLength;return N>0?D>>BigInt(N):D},w=e.bits2int_modN||function(I){return a(v(I))},k=bitMask(e.nBitLength);function S(I){return aInRange("num < 2^"+e.nBitLength,I,_0n$1,k),numberToBytesBE(I,e.nByteLength)}function T(I,D,N=O){if(["recovered","canonical"].some(X=>X in N))throw new Error("sign() legacy options not supported");const{hash:F,randomBytes:z}=e;let{lowS:U,prehash:L,extraEntropy:B}=N;U==null&&(U=!0),I=ensureBytes("msgHash",I),validateSigVerOpts(N),L&&(I=ensureBytes("prehashed msgHash",F(I)));const H=w(I),j=c(D),G=[S(j),S(H)];if(B!=null&&B!==!1){const X=B===!0?z(n.BYTES):B;G.push(ensureBytes("extraEntropy",X))}const W=concatBytes(...G),Q=H;function se(X){const ue=v(X);if(!h(ue))return;const K=u(ue),ne=l.BASE.multiply(ue).toAffine(),q=a(ne.x);if(q===_0n$1)return;const J=a(K*a(Q+q*j));if(J===_0n$1)return;let Y=(ne.x===q?0:2)|Number(ne.y&_1n$1),re=J;return U&&m(J)&&(re=g(J),Y^=1),new y(q,re,Y)}return{seed:W,k2sig:se}}const O={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function R(I,D,N=O){const{seed:F,k2sig:z}=T(I,D,N),U=e;return createHmacDrbg(U.hash.outputLen,U.nByteLength,U.hmac)(F,z)}l.BASE._setWindowSize(8);function M(I,D,N,F=C){var Y;const z=I;D=ensureBytes("msgHash",D),N=ensureBytes("publicKey",N);const{lowS:U,prehash:L,format:B}=F;if(validateSigVerOpts(F),"strict"in F)throw new Error("options.strict was renamed to lowS");if(B!==void 0&&B!=="compact"&&B!=="der")throw new Error("format must be compact or der");const H=typeof z=="string"||isBytes$1(z),j=!H&&!B&&typeof z=="object"&&z!==null&&typeof z.r=="bigint"&&typeof z.s=="bigint";if(!H&&!j)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let G,W;try{if(j&&(G=new y(z.r,z.s)),H){try{B!=="compact"&&(G=y.fromDER(z))}catch(re){if(!(re instanceof DER.Err))throw re}!G&&B!=="der"&&(G=y.fromCompact(z))}W=l.fromHex(N)}catch{return!1}if(!G||U&&G.hasHighS())return!1;L&&(D=e.hash(D));const{r:Q,s:se}=G,X=w(D),ue=u(se),K=a(X*ue),ne=a(Q*ue),q=(Y=l.BASE.multiplyAndAddUnsafe(W,K,ne))==null?void 0:Y.toAffine();return q?a(q.x)===Q:!1}return{CURVE:e,getPublicKey:x,getSharedSecret:A,sign:R,verify:M,ProjectivePoint:l,Signature:y,utils:_}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(t){return{hash:t,hmac:(e,...n)=>hmac(t,e,concatBytes$1(...n)),randomBytes}}function createCurve(t,e){const n=r=>weierstrass({...t,...getHash(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n=BigInt(1),_2n=BigInt(2),divNearest=(t,e)=>(t+e/_2n)/e;function sqrtMod(t){const e=secp256k1P,n=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),a=BigInt(23),u=BigInt(44),l=BigInt(88),c=t*t*t%e,f=c*c*t%e,h=pow2(f,n,e)*f%e,p=pow2(h,n,e)*f%e,m=pow2(p,_2n,e)*c%e,g=pow2(m,s,e)*m%e,b=pow2(g,o,e)*g%e,y=pow2(b,u,e)*b%e,_=pow2(y,l,e)*y%e,x=pow2(_,u,e)*b%e,E=pow2(x,n,e)*f%e,A=pow2(E,a,e)*g%e,v=pow2(A,r,e)*c%e,w=pow2(v,_2n,e);if(!Fpk1.eql(Fpk1.sqr(w),t))throw new Error("Cannot find square root");return w}const Fpk1=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1=createCurve({a:BigInt(0),b:BigInt(7),Fp:Fpk1,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=secp256k1N,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_1n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,a=BigInt("0x100000000000000000000000000000000"),u=divNearest(o*t,e),l=divNearest(-r*t,e);let c=mod(t-u*n-l*s,e),f=mod(-u*r-l*o,e);const h=c>a,p=f>a;if(h&&(c=e-c),p&&(f=e-f),c>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:c,k2neg:p,k2:f}}}},sha256),_0n=BigInt(0),TAGGED_HASH_PREFIXES={};function taggedHash(t,...e){let n=TAGGED_HASH_PREFIXES[t];if(n===void 0){const r=sha256(Uint8Array.from(t,s=>s.charCodeAt(0)));n=concatBytes(r,r),TAGGED_HASH_PREFIXES[t]=n}return sha256(concatBytes(n,...e))}const pointToBytes=t=>t.toRawBytes(!0).slice(1),numTo32b=t=>numberToBytesBE(t,32),modP=t=>mod(t,secp256k1P),modN=t=>mod(t,secp256k1N),Point=secp256k1.ProjectivePoint,GmulAdd=(t,e,n)=>Point.BASE.multiplyAndAddUnsafe(t,e,n);function schnorrGetExtPubKey(t){let e=secp256k1.utils.normPrivateKeyToScalar(t),n=Point.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:modN(-e),bytes:pointToBytes(n)}}function lift_x(t){aInRange("x",t,_1n,secp256k1P);const e=modP(t*t),n=modP(e*t+BigInt(7));let r=sqrtMod(n);r%_2n!==_0n&&(r=modP(-r));const s=new Point(t,r,_1n);return s.assertValidity(),s}const num=bytesToNumberBE;function challenge(...t){return modN(num(taggedHash("BIP0340/challenge",...t)))}function schnorrGetPublicKey(t){return schnorrGetExtPubKey(t).bytes}function schnorrSign(t,e,n=randomBytes(32)){const r=ensureBytes("message",t),{bytes:s,scalar:o}=schnorrGetExtPubKey(e),a=ensureBytes("auxRand",n,32),u=numTo32b(o^num(taggedHash("BIP0340/aux",a))),l=taggedHash("BIP0340/nonce",u,s,r),c=modN(num(l));if(c===_0n)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=schnorrGetExtPubKey(c),p=challenge(f,s,r),m=new Uint8Array(64);if(m.set(f,0),m.set(numTo32b(modN(h+p*o)),32),!schnorrVerify(m,r,s))throw new Error("sign: Invalid signature produced");return m}function schnorrVerify(t,e,n){const r=ensureBytes("signature",t,64),s=ensureBytes("message",e),o=ensureBytes("publicKey",n,32);try{const a=lift_x(num(o)),u=num(r.subarray(0,32));if(!inRange(u,_1n,secp256k1P))return!1;const l=num(r.subarray(32,64));if(!inRange(l,_1n,secp256k1N))return!1;const c=challenge(numTo32b(u),pointToBytes(a),s),f=GmulAdd(a,l,modN(-c));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const schnorr={getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,utils:{randomPrivateKey:secp256k1.utils.randomPrivateKey,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,taggedHash,mod}};var dist={},LRUCache={},LRUCacheNode={},hasRequiredLRUCacheNode;function requireLRUCacheNode(){if(hasRequiredLRUCacheNode)return LRUCacheNode;hasRequiredLRUCacheNode=1,Object.defineProperty(LRUCacheNode,"__esModule",{value:!0}),LRUCacheNode.LRUCacheNode=void 0;let t=class{constructor(n,r,s){const{entryExpirationTimeInMS:o=null,next:a=null,prev:u=null,onEntryEvicted:l,onEntryMarkedAsMostRecentlyUsed:c,clone:f,cloneFn:h}=s??{};if(typeof o=="number"&&(o<=0||Number.isNaN(o)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=f??!1,this.cloneFn=h??this.defaultClone,this.key=n,this.internalValue=this.clone?this.cloneFn(r):r,this.created=Date.now(),this.entryExpirationTimeInMS=o,this.next=a,this.prev=u,this.onEntryEvicted=l,this.onEntryMarkedAsMostRecentlyUsed=c}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:n,value:r,isExpired:s}=this;this.onEntryEvicted({key:n,value:r,isExpired:s})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:n,value:r}=this;this.onEntryMarkedAsMostRecentlyUsed({key:n,value:r})}}defaultClone(n){return typeof n=="boolean"||typeof n=="string"||typeof n=="number"?n:JSON.parse(JSON.stringify(n))}};return LRUCacheNode.LRUCacheNode=t,LRUCacheNode}var hasRequiredLRUCache;function requireLRUCache(){if(hasRequiredLRUCache)return LRUCache;hasRequiredLRUCache=1,Object.defineProperty(LRUCache,"__esModule",{value:!0}),LRUCache.LRUCache=void 0;const t=requireLRUCacheNode();let e=class{constructor(r){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:s=25,entryExpirationTimeInMS:o=null,onEntryEvicted:a,onEntryMarkedAsMostRecentlyUsed:u,cloneFn:l,clone:c}=r??{};if(Number.isNaN(s)||s<=0)throw new Error("maxSize must be greater than 0.");if(typeof o=="number"&&(o<=0||Number.isNaN(o)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=s,this.entryExpirationTimeInMS=o,this.onEntryEvicted=a,this.onEntryMarkedAsMostRecentlyUsed=u,this.clone=c,this.cloneFn=l}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(r){if(Number.isNaN(r)||r<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=r,this.enforceSizeLimit()}set(r,s,o){const a=this.lookupTable.get(r);a&&this.removeNodeFromListAndLookupTable(a);const u=new t.LRUCacheNode(r,s,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...o});return this.setNodeAsHead(u),this.lookupTable.set(r,u),this.enforceSizeLimit(),this}get(r){const s=this.lookupTable.get(r);return s?s.isExpired?(this.removeNodeFromListAndLookupTable(s),null):(this.setNodeAsHead(s),s.value):null}peek(r){const s=this.lookupTable.get(r);return s?s.isExpired?(this.removeNodeFromListAndLookupTable(s),null):s.value:null}delete(r){const s=this.lookupTable.get(r);return s?this.removeNodeFromListAndLookupTable(s):!1}has(r){const s=this.lookupTable.get(r);return s?s.isExpired?(this.removeNodeFromListAndLookupTable(s),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(r){let s=this.head;for(;s;){if(s.isExpired){const a=s.next;this.removeNodeFromListAndLookupTable(s),s=a;continue}const o=this.mapNodeToEntry(s);if(r(o))return this.setNodeAsHead(s),o;s=s.next}return null}forEach(r){let s=this.head,o=0;for(;s;){if(s.isExpired){const a=s.next;this.removeNodeFromListAndLookupTable(s),s=a;continue}r(s.value,s.key,o),s=s.next,o++}}*values(){let r=this.head;for(;r;){if(r.isExpired){const s=r.next;this.removeNodeFromListAndLookupTable(r),r=s;continue}yield r.value,r=r.next}}*keys(){let r=this.head;for(;r;){if(r.isExpired){const s=r.next;this.removeNodeFromListAndLookupTable(r),r=s;continue}yield r.key,r=r.next}}*entries(){let r=this.head;for(;r;){if(r.isExpired){const s=r.next;this.removeNodeFromListAndLookupTable(r),r=s;continue}yield this.mapNodeToEntry(r),r=r.next}}*[Symbol.iterator](){let r=this.head;for(;r;){if(r.isExpired){const s=r.next;this.removeNodeFromListAndLookupTable(r),r=s;continue}yield this.mapNodeToEntry(r),r=r.next}}enforceSizeLimit(){let r=this.tail;for(;r!==null&&this.size>this.maxSizeInternal;){const s=r.prev;this.removeNodeFromListAndLookupTable(r),r=s}}mapNodeToEntry({key:r,value:s}){return{key:r,value:s}}setNodeAsHead(r){this.removeNodeFromList(r),this.head?(r.next=this.head,this.head.prev=r,this.head=r):(this.head=r,this.tail=r),r.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(r){r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.head===r&&(this.head=r.next),this.tail===r&&(this.tail=r.prev),r.next=null,r.prev=null}removeNodeFromListAndLookupTable(r){return r.invokeOnEvicted(),this.removeNodeFromList(r),this.lookupTable.delete(r.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const r=[];for(const s of this.lookupTable.values())s.isExpired&&r.push(s);r.forEach(s=>this.removeNodeFromListAndLookupTable(s))}};return LRUCache.LRUCache=e,LRUCache}var hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,function(t){var e=dist.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,u)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=dist.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(requireLRUCache(),t)}(dist)),dist}var distExports=requireDist();/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function isArrayOf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function afn(t){if(typeof t!="function")throw new Error("function expected");return!0}function astr(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function anumber(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function aArr(t){if(!Array.isArray(t))throw new Error("array expected")}function astrArr(t,e){if(!isArrayOf(!0,e))throw new Error(`${t}: array of strings expected`)}function anumArr(t,e){if(!isArrayOf(!1,e))throw new Error(`${t}: array of numbers expected`)}function chain(...t){const e=o=>o,n=(o,a)=>u=>o(a(u)),r=t.map(o=>o.encode).reduceRight(n,e),s=t.map(o=>o.decode).reduce(n,e);return{encode:r,decode:s}}function alphabet(t){const e=typeof t=="string"?t.split(""):t,n=e.length;astrArr("alphabet",e);const r=new Map(e.map((s,o)=>[s,o]));return{encode:s=>(aArr(s),s.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${t}`);return e[o]})),decode:s=>(aArr(s),s.map(o=>{astr("alphabet.decode",o);const a=r.get(o);if(a===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${t}`);return a}))}}function join$1(t=""){return astr("join",t),{encode:e=>(astrArr("join.decode",e),e.join(t)),decode:e=>(astr("join.decode",e),e.split(t))}}const gcd=(t,e)=>e===0?t:gcd(e,t%e),radix2carry=(t,e)=>t+(e-gcd(t,e)),powers=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function convertRadix2(t,e,n,r){if(aArr(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(radix2carry(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${radix2carry(e,n)}`);let s=0,o=0;const a=powers[e],u=powers[n]-1,l=[];for(const c of t){if(anumber(c),c>=a)throw new Error(`convertRadix2: invalid data word=${c} from=${e}`);if(s=s<<e|c,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=n;o-=n)l.push((s>>o-n&u)>>>0);const f=powers[o];if(f===void 0)throw new Error("invalid carry");s&=f-1}if(s=s<<n-o&u,!r&&o>=e)throw new Error("Excess padding");if(!r&&s>0)throw new Error(`Non-zero padding: ${s}`);return r&&o>0&&l.push(s>>>0),l}function radix2(t,e=!1){if(anumber(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,t)>32||radix2carry(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!isBytes(n))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(n),8,t,!e)},decode:n=>(anumArr("radix2.decode",n),Uint8Array.from(convertRadix2(n,t,8,e)))}}function unsafeWrapper(t){return afn(t),function(...e){try{return t.apply(null,e)}catch{}}}const BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join$1("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<POLYMOD_GENERATORS.length;r++)(e>>r&1)===1&&(n^=POLYMOD_GENERATORS[r]);return n}function bechChecksum(t,e,n=1){const r=t.length;let s=1;for(let o=0;o<r;o++){const a=t.charCodeAt(o);if(a<33||a>126)throw new Error(`Invalid prefix (${t})`);s=bech32Polymod(s)^a>>5}s=bech32Polymod(s);for(let o=0;o<r;o++)s=bech32Polymod(s)^t.charCodeAt(o)&31;for(let o of e)s=bech32Polymod(s)^o;for(let o=0;o<6;o++)s=bech32Polymod(s);return s^=n,BECH_ALPHABET.encode(convertRadix2([s%powers[30]],30,5,!1))}function genBech32(t){const e=t==="bech32"?1:734539939,n=radix2(5),r=n.decode,s=n.encode,o=unsafeWrapper(r);function a(h,p,m=90){astr("bech32.encode prefix",h),isBytes(p)&&(p=Array.from(p)),anumArr("bech32.encode",p);const g=h.length;if(g===0)throw new TypeError(`Invalid prefix length ${g}`);const b=g+7+p.length;if(m!==!1&&b>m)throw new TypeError(`Length ${b} exceeds limit ${m}`);const y=h.toLowerCase(),_=bechChecksum(y,p,e);return`${y}1${BECH_ALPHABET.encode(p)}${_}`}function u(h,p=90){astr("bech32.decode input",h);const m=h.length;if(m<8||p!==!1&&m>p)throw new TypeError(`invalid string length: ${m} (${h}). Expected (8..${p})`);const g=h.toLowerCase();if(h!==g&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");const b=g.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=g.slice(0,b),_=g.slice(b+1);if(_.length<6)throw new Error("Data must be at least 6 characters long");const x=BECH_ALPHABET.decode(_).slice(0,-6),E=bechChecksum(y,x,e);if(!_.endsWith(E))throw new Error(`Invalid checksum in ${h}: expected "${E}"`);return{prefix:y,words:x}}const l=unsafeWrapper(u);function c(h){const{prefix:p,words:m}=u(h,!1);return{prefix:p,words:m,bytes:r(m)}}function f(h,p){return a(h,s(p))}return{encode:a,decode:u,encodeFromBytes:f,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:o,toWords:s}}const bech32=genBech32("bech32");var lib$1={},hasRequiredLib;function requireLib(){return hasRequiredLib||(hasRequiredLib=1,function(t){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64url=t.base64=t.base32crockford=t.base32hex=t.base32=t.base16=t.utils=t.assertNumber=void 0;function e(C){if(!Number.isSafeInteger(C))throw new Error(`Wrong integer: ${C}`)}t.assertNumber=e;function n(...C){const R=(D,N)=>F=>D(N(F)),M=Array.from(C).reverse().reduce((D,N)=>D?R(D,N.encode):N.encode,void 0),I=C.reduce((D,N)=>D?R(D,N.decode):N.decode,void 0);return{encode:M,decode:I}}function r(C){return{encode:R=>{if(!Array.isArray(R)||R.length&&typeof R[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return R.map(M=>{if(e(M),M<0||M>=C.length)throw new Error(`Digit index outside alphabet: ${M} (alphabet: ${C.length})`);return C[M]})},decode:R=>{if(!Array.isArray(R)||R.length&&typeof R[0]!="string")throw new Error("alphabet.decode input should be array of strings");return R.map(M=>{if(typeof M!="string")throw new Error(`alphabet.decode: not string element=${M}`);const I=C.indexOf(M);if(I===-1)throw new Error(`Unknown letter: "${M}". Allowed: ${C}`);return I})}}}function s(C=""){if(typeof C!="string")throw new Error("join separator should be string");return{encode:R=>{if(!Array.isArray(R)||R.length&&typeof R[0]!="string")throw new Error("join.encode input should be array of strings");for(let M of R)if(typeof M!="string")throw new Error(`join.encode: non-string input=${M}`);return R.join(C)},decode:R=>{if(typeof R!="string")throw new Error("join.decode input should be string");return R.split(C)}}}function o(C,R="="){if(e(C),typeof R!="string")throw new Error("padding chr should be string");return{encode(M){if(!Array.isArray(M)||M.length&&typeof M[0]!="string")throw new Error("padding.encode input should be array of strings");for(let I of M)if(typeof I!="string")throw new Error(`padding.encode: non-string input=${I}`);for(;M.length*C%8;)M.push(R);return M},decode(M){if(!Array.isArray(M)||M.length&&typeof M[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of M)if(typeof D!="string")throw new Error(`padding.decode: non-string input=${D}`);let I=M.length;if(I*C%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;I>0&&M[I-1]===R;I--)if(!((I-1)*C%8))throw new Error("Invalid padding: string has too much padding");return M.slice(0,I)}}}function a(C){if(typeof C!="function")throw new Error("normalize fn should be function");return{encode:R=>R,decode:R=>C(R)}}function u(C,R,M){if(R<2)throw new Error(`convertRadix: wrong from=${R}, base cannot be less than 2`);if(M<2)throw new Error(`convertRadix: wrong to=${M}, base cannot be less than 2`);if(!Array.isArray(C))throw new Error("convertRadix: data should be array");if(!C.length)return[];let I=0;const D=[],N=Array.from(C);for(N.forEach(F=>{if(e(F),F<0||F>=R)throw new Error(`Wrong integer: ${F}`)});;){let F=0,z=!0;for(let U=I;U<N.length;U++){const L=N[U],B=R*F+L;if(!Number.isSafeInteger(B)||R*F/R!==F||B-L!==R*F)throw new Error("convertRadix: carry overflow");if(F=B%M,N[U]=Math.floor(B/M),!Number.isSafeInteger(N[U])||N[U]*M+F!==B)throw new Error("convertRadix: carry overflow");if(z)N[U]?z=!1:I=U;else continue}if(D.push(F),z)break}for(let F=0;F<C.length-1&&C[F]===0;F++)D.push(0);return D.reverse()}const l=(C,R)=>R?l(R,C%R):C,c=(C,R)=>C+(R-l(C,R));function f(C,R,M,I){if(!Array.isArray(C))throw new Error("convertRadix2: data should be array");if(R<=0||R>32)throw new Error(`convertRadix2: wrong from=${R}`);if(M<=0||M>32)throw new Error(`convertRadix2: wrong to=${M}`);if(c(R,M)>32)throw new Error(`convertRadix2: carry overflow from=${R} to=${M} carryBits=${c(R,M)}`);let D=0,N=0;const F=2**M-1,z=[];for(const U of C){if(e(U),U>=2**R)throw new Error(`convertRadix2: invalid data word=${U} from=${R}`);if(D=D<<R|U,N+R>32)throw new Error(`convertRadix2: carry overflow pos=${N} from=${R}`);for(N+=R;N>=M;N-=M)z.push((D>>N-M&F)>>>0);D&=2**N-1}if(D=D<<M-N&F,!I&&N>=R)throw new Error("Excess padding");if(!I&&D)throw new Error(`Non-zero padding: ${D}`);return I&&N>0&&z.push(D>>>0),z}function h(C){return e(C),{encode:R=>{if(!(R instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return u(Array.from(R),2**8,C)},decode:R=>{if(!Array.isArray(R)||R.length&&typeof R[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(u(R,C,2**8))}}}function p(C,R=!1){if(e(C),C<=0||C>32)throw new Error("radix2: bits should be in (0..32]");if(c(8,C)>32||c(C,8)>32)throw new Error("radix2: carry overflow");return{encode:M=>{if(!(M instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return f(Array.from(M),8,C,!R)},decode:M=>{if(!Array.isArray(M)||M.length&&typeof M[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(f(M,C,8,R))}}}function m(C){if(typeof C!="function")throw new Error("unsafeWrapper fn should be function");return function(...R){try{return C.apply(null,R)}catch{}}}function g(C,R){if(e(C),typeof R!="function")throw new Error("checksum fn should be function");return{encode(M){if(!(M instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const I=R(M).slice(0,C),D=new Uint8Array(M.length+C);return D.set(M),D.set(I,M.length),D},decode(M){if(!(M instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const I=M.slice(0,-C),D=R(I).slice(0,C),N=M.slice(-C);for(let F=0;F<C;F++)if(D[F]!==N[F])throw new Error("Invalid checksum");return I}}}t.utils={alphabet:r,chain:n,checksum:g,radix:h,radix2:p,join:s,padding:o},t.base16=n(p(4),r("0123456789ABCDEF"),s("")),t.base32=n(p(5),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),t.base32hex=n(p(5),r("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),t.base32crockford=n(p(5),r("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a(C=>C.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),t.base64=n(p(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),t.base64url=n(p(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const b=C=>n(h(58),r(C),s(""));t.base58=b("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=b("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=b("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(C){let R="";for(let M=0;M<C.length;M+=8){const I=C.subarray(M,M+8);R+=t.base58.encode(I).padStart(y[I.length],"1")}return R},decode(C){let R=[];for(let M=0;M<C.length;M+=11){const I=C.slice(M,M+11),D=y.indexOf(I.length),N=t.base58.decode(I);for(let F=0;F<N.length-D;F++)if(N[F]!==0)throw new Error("base58xmr: wrong padding");R=R.concat(Array.from(N.slice(N.length-D)))}return Uint8Array.from(R)}};const _=C=>n(g(4,R=>C(C(R))),t.base58);t.base58check=_;const x=n(r("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),E=[996825010,642813549,513874426,1027748829,705979059];function A(C){const R=C>>25;let M=(C&33554431)<<5;for(let I=0;I<E.length;I++)(R>>I&1)===1&&(M^=E[I]);return M}function v(C,R,M=1){const I=C.length;let D=1;for(let N=0;N<I;N++){const F=C.charCodeAt(N);if(F<33||F>126)throw new Error(`Invalid prefix (${C})`);D=A(D)^F>>5}D=A(D);for(let N=0;N<I;N++)D=A(D)^C.charCodeAt(N)&31;for(let N of R)D=A(D)^N;for(let N=0;N<6;N++)D=A(D);return D^=M,x.encode(f([D%2**30],30,5,!1))}function w(C){const R=C==="bech32"?1:734539939,M=p(5),I=M.decode,D=M.encode,N=m(I);function F(B,H,j=90){if(typeof B!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof B}`);if(!Array.isArray(H)||H.length&&typeof H[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof H}`);const G=B.length+7+H.length;if(j!==!1&&G>j)throw new TypeError(`Length ${G} exceeds limit ${j}`);return B=B.toLowerCase(),`${B}1${x.encode(H)}${v(B,H,R)}`}function z(B,H=90){if(typeof B!="string")throw new Error(`bech32.decode input should be string, not ${typeof B}`);if(B.length<8||H!==!1&&B.length>H)throw new TypeError(`Wrong string length: ${B.length} (${B}). Expected (8..${H})`);const j=B.toLowerCase();if(B!==j&&B!==B.toUpperCase())throw new Error("String must be lowercase or uppercase");B=j;const G=B.lastIndexOf("1");if(G===0||G===-1)throw new Error('Letter "1" must be present between prefix and data only');const W=B.slice(0,G),Q=B.slice(G+1);if(Q.length<6)throw new Error("Data must be at least 6 characters long");const se=x.decode(Q).slice(0,-6),X=v(W,se,R);if(!Q.endsWith(X))throw new Error(`Invalid checksum in ${B}: expected "${X}"`);return{prefix:W,words:se}}const U=m(z);function L(B){const{prefix:H,words:j}=z(B,!1);return{prefix:H,words:j,bytes:I(j)}}return{encode:F,decode:z,decodeToBytes:L,decodeUnsafe:U,fromWords:I,fromWordsUnsafe:N,toWords:D}}t.bech32=w("bech32"),t.bech32m=w("bech32m"),t.utf8={encode:C=>new TextDecoder().decode(C),decode:C=>new TextEncoder().encode(C)},t.hex=n(p(4),r("0123456789abcdef"),s(""),a(C=>{if(typeof C!="string"||C.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof C} with length ${C.length}`);return C.toLowerCase()}));const k={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},S=`Invalid encoding type. Available types: ${Object.keys(k).join(", ")}`,T=(C,R)=>{if(typeof C!="string"||!k.hasOwnProperty(C))throw new TypeError(S);if(!(R instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return k[C].encode(R)};t.bytesToString=T,t.str=t.bytesToString;const O=(C,R)=>{if(!k.hasOwnProperty(C))throw new TypeError(S);if(typeof R!="string")throw new TypeError("stringToBytes() expects string");return k[C].decode(R)};t.stringToBytes=O,t.bytes=t.stringToBytes}(lib$1)),lib$1}var bolt11,hasRequiredBolt11;function requireBolt11(){if(hasRequiredBolt11)return bolt11;hasRequiredBolt11=1;const{bech32:t,hex:e,utf8:n}=requireLib(),r={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},s={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},o={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},a={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},l=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],c={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},f=BigInt("2100000000000000000"),h=BigInt(1e11),p={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},m={};for(let v=0,w=Object.keys(p);v<w.length;v++){const k=w[v],S=p[w[v]].toString();m[S]=k}const g={1:v=>e.encode(t.fromWordsUnsafe(v)),16:v=>e.encode(t.fromWordsUnsafe(v)),13:v=>n.encode(t.fromWordsUnsafe(v)),19:v=>e.encode(t.fromWordsUnsafe(v)),23:v=>e.encode(t.fromWordsUnsafe(v)),27:v=>e.encode(t.fromWordsUnsafe(v)),6:y,24:y,3:_,5:x};function b(v){return w=>({tagCode:parseInt(v),words:t.encode("unknown",w,Number.MAX_SAFE_INTEGER)})}function y(v){return v.reverse().reduce((w,k,S)=>w+k*Math.pow(32,S),0)}function _(v){const w=[];let k,S,T,O,C,R=t.fromWordsUnsafe(v);for(;R.length>0;)k=e.encode(R.slice(0,33)),S=e.encode(R.slice(33,41)),T=parseInt(e.encode(R.slice(41,45)),16),O=parseInt(e.encode(R.slice(45,49)),16),C=parseInt(e.encode(R.slice(49,51)),16),R=R.slice(51),w.push({pubkey:k,short_channel_id:S,fee_base_msat:T,fee_proportional_millionths:O,cltv_expiry_delta:C});return w}function x(v){const w=v.slice().reverse().map(T=>[!!(T&1),!!(T&2),!!(T&4),!!(T&8),!!(T&16)]).reduce((T,O)=>T.concat(O),[]);for(;w.length<l.length*2;)w.push(!1);const k={};l.forEach((T,O)=>{let C;w[O*2]?C="required":w[O*2+1]?C="supported":C="unsupported",k[T]=C});const S=w.slice(l.length*2);return k.extra_bits={start_bit:l.length*2,bits:S,has_required:S.reduce((T,O,C)=>C%2!==0?T||!1:T||O,!1)},k}function E(v,w){let k,S;if(v.slice(-1).match(/^[munp]$/))k=v.slice(-1),S=v.slice(0,-1);else{if(v.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");S=v}if(!S.match(/^\d+$/))throw new Error("Not a valid human readable amount");const T=BigInt(S),O=k?T*h/c[k]:T*h;if(k==="p"&&T%BigInt(10)!==BigInt(0)||O>f)throw new Error("Amount is outside of valid range");return w?O.toString():O}function A(v,w){if(typeof v!="string")throw new Error("Lightning Payment Request must be string");if(v.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const k=[],S=t.decode(v,Number.MAX_SAFE_INTEGER);v=v.toLowerCase();const T=S.prefix;let O=S.words,C=v.slice(T.length+1),R=O.slice(-104);O=O.slice(0,-104);let M=T.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(M&&!M[2]&&(M=T.match(/^ln(\S+)$/)),!M)throw new Error("Not a proper lightning payment request");k.push({name:"lightning_network",letters:"ln"});const I=M[1];let D;if(w){if(w.bech32===void 0||w.pubKeyHash===void 0||w.scriptHash===void 0||!Array.isArray(w.validWitnessVersions))throw new Error("Invalid network");D=w}else switch(I){case r.bech32:D=r;break;case s.bech32:D=s;break;case o.bech32:D=o;break;case a.bech32:D=a;break;case u.bech32:D=u;break}if(!D||D.bech32!==I)throw new Error("Unknown coin bech32 prefix");k.push({name:"coin_network",letters:I,value:D});const N=M[2];let F;if(N){const W=M[3];F=E(N+W,!0),k.push({name:"amount",letters:M[2]+M[3],value:F})}else F=null;k.push({name:"separator",letters:"1"});const z=y(O.slice(0,7));O=O.slice(7),k.push({name:"timestamp",letters:C.slice(0,7),value:z}),C=C.slice(7);let U,L,B,H;for(;O.length>0;){const W=O[0].toString();U=m[W]||"unknown_tag",L=g[W]||b(W),O=O.slice(1),B=y(O.slice(0,2)),O=O.slice(2),H=O.slice(0,B),O=O.slice(B),k.push({name:U,tag:C[0],letters:C.slice(0,3+B),value:L(H)}),C=C.slice(3+B)}k.push({name:"signature",letters:C.slice(0,104),value:e.encode(t.fromWordsUnsafe(R))}),C=C.slice(104),k.push({name:"checksum",letters:C});let j={paymentRequest:v,sections:k,get expiry(){let W=k.find(Q=>Q.name==="expiry");if(W)return G("timestamp")+W.value},get route_hints(){return k.filter(W=>W.name==="route_hint").map(W=>W.value)}};for(let W in p)W!=="route_hint"&&Object.defineProperty(j,W,{get(){return G(W)}});return j;function G(W){let Q=k.find(se=>se.name===W);return Q?Q.value:void 0}}return bolt11={decode:A,hrpToMillisat:E},bolt11}requireBolt11();function getRelaysForSync(t,e,n="write"){if(!t.outboxTracker)return;const r=t.outboxTracker.data.get(e);if(r)return n==="write"?r.writeRelays:r.readRelays}async function getWriteRelaysFor(t,e,n="write"){if(t.outboxTracker)return t.outboxTracker.data.has(e)||await t.outboxTracker.trackUsers([e]),getRelaysForSync(t,e,n)}function getTopRelaysForAuthors(t,e){const n=new Map;return e.forEach(s=>{const o=getRelaysForSync(t,s);o&&o.forEach(a=>{const u=n.get(a)||0;n.set(a,u+1)})}),Array.from(n.entries()).sort((s,o)=>o[1]-s[1]).map(s=>s[0])}function getAllRelaysForAllPubkeys(t,e,n="read"){const r=new Map,s=new Set;return e.forEach(o=>{const a=getRelaysForSync(t,o,n);a&&a.size>0?(a.forEach(u=>{(r.get(u)||new Set).add(o)}),r.set(o,a)):s.add(o)}),{pubkeysToRelays:r,authorsMissingRelays:s}}function chooseRelayCombinationForPubkeys(t,e,n,{count:r,preferredRelays:s}={}){r??(r=2),s??(s=new Set);const o=t.pool,a=o.connectedRelays();a.forEach(p=>{s.add(p.url)});const u=new Map,{pubkeysToRelays:l,authorsMissingRelays:c}=getAllRelaysForAllPubkeys(t,e,n),f=getTopRelaysForAuthors(t,e),h=(p,m)=>{const g=u.get(m)||[];g.push(p),u.set(m,g)};for(const[p,m]of l.entries()){let g=r;for(const b of a)m.has(b.url)&&(h(p,b.url),g--);for(const b of m)u.has(b)&&(h(p,b),g--);if(!(g<=0))for(const b of f){if(g<=0)break;m.has(b)&&(h(p,b),g--)}}for(const p of c)o.permanentAndConnectedRelays().forEach(m=>{const g=u.get(m.url)||[];g.push(p),u.set(m.url,g)});return u}function getRelaysForFilterWithAuthors(t,e,n=2){return chooseRelayCombinationForPubkeys(t,e,"write",{count:n})}function tryNormalizeRelayUrl(t){try{return normalizeRelayUrl(t)}catch{return}}function normalizeRelayUrl(t){let e=normalizeUrl(t.toLowerCase(),{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function normalize$2(t){const e=new Set;for(const n of t)try{e.add(normalizeRelayUrl(n))}catch{}return Array.from(e)}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(t,e)=>e.some(n=>n instanceof RegExp?n.test(t):n===t),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=t=>{try{const{protocol:e}=new URL(t);return e.endsWith(":")&&!e.includes(".")&&!supportedProtocols.has(e)}catch{return!1}},normalizeDataURL=(t,{stripHash:e})=>{var h,p,m,g;const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!n)throw new Error(`Invalid URL: ${t}`);let r=((h=n.groups)==null?void 0:h.type)??"",s=((p=n.groups)==null?void 0:p.data)??"",o=((m=n.groups)==null?void 0:m.hash)??"";const a=r.split(";");o=e?"":o;let u=!1;a[a.length-1]==="base64"&&(a.pop(),u=!0);const l=((g=a.shift())==null?void 0:g.toLowerCase())??"",f=[...a.map(b=>{let[y,_=""]=b.split("=").map(x=>x.trim());return y==="charset"&&(_=_.toLowerCase(),_===DATA_URL_DEFAULT_CHARSET)?"":`${y}${_?`=${_}`:""}`}).filter(Boolean)];return u&&f.push("base64"),(f.length>0||l&&l!==DATA_URL_DEFAULT_MIME_TYPE)&&f.unshift(l),`data:${f.join(";")},${u?s.trim():s}${o?`#${o}`:""}`};function normalizeUrl(t,e){if(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e},typeof e.defaultProtocol=="string"&&!e.defaultProtocol.endsWith(":")&&(e.defaultProtocol=`${e.defaultProtocol}:`),t=t.trim(),/^data:/i.test(t))return normalizeDataURL(t,e);if(hasCustomProtocol(t))return t;const n=t.startsWith("//");!n&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const s=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&s.protocol==="https:"&&(s.protocol="http:"),e.forceHttps&&s.protocol==="http:"&&(s.protocol="https:"),e.stripAuthentication&&(s.username="",s.password=""),e.stripHash?s.hash="":e.stripTextFragment&&(s.hash=s.hash.replace(/#?:~:text.*?$/i,"")),s.pathname){const a=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let u=0,l="";for(;;){const f=a.exec(s.pathname);if(!f)break;const h=f[0],p=f.index,m=s.pathname.slice(u,p);l+=m.replace(/\/{2,}/g,"/"),l+=h,u=p+h.length}const c=s.pathname.slice(u,s.pathname.length);l+=c.replace(/\/{2,}/g,"/"),s.pathname=l}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let a=s.pathname.split("/");const u=a[a.length-1];testParameter(u,e.removeDirectoryIndex)&&(a=a.slice(0,-1),s.pathname=a.slice(1).join("/")+"/")}if(s.hostname&&(s.hostname=s.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(s.hostname)&&(s.hostname=s.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const a of[...s.searchParams.keys()])testParameter(a,e.removeQueryParameters)&&s.searchParams.delete(a);if(!Array.isArray(e.keepQueryParameters)&&e.removeQueryParameters===!0&&(s.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const a of[...s.searchParams.keys()])testParameter(a,e.keepQueryParameters)||s.searchParams.delete(a);if(e.sortQueryParameters){s.searchParams.sort();try{s.search=decodeURIComponent(s.search)}catch{}}e.removeTrailingSlash&&(s.pathname=s.pathname.replace(/\/$/,"")),e.removeExplicitPort&&s.port&&(s.port="");const o=t;return t=s.toString(),!e.removeSingleSlash&&s.pathname==="/"&&!o.endsWith("/")&&s.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||s.pathname==="/")&&s.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),n&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{constructor(t,e){$(this,"ndkRelay");$(this,"ws");$(this,"_status");$(this,"timeoutMs");$(this,"connectedAt");$(this,"_connectionStats",{attempts:0,success:0,durations:[]});$(this,"debug");$(this,"netDebug");$(this,"connectTimeout");$(this,"reconnectTimeout");$(this,"ndk");$(this,"openSubs",new Map);$(this,"openCountRequests",new Map);$(this,"openEventPublishes",new Map);$(this,"serial",0);$(this,"baseEoseTimeout",4400);$(this,"updateConnectionStats",{connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}});this.ndkRelay=t,this._status=1;const n=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend("connectivity"+n),this.ndk=e}async connect(t,e=!0){if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),t??(t=this.timeoutMs),!this.timeoutMs&&t&&(this.timeoutMs=t),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(e),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(n){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,n),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2*24*60*60*1e3),n}}disconnect(){var t;this._status=0;try{(t=this.ws)==null||t.close()}catch(e){this.debug("Failed to disconnect",e),this._status=1}}onConnectionError(t){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),t&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){var t;(t=this.netDebug)==null||t.call(this,"connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){var t;(t=this.netDebug)==null||t.call(this,"disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(t){var e;(e=this.netDebug)==null||e.call(this,t.data,this.ndkRelay,"recv");try{const n=JSON.parse(t.data),[r,s,...o]=n;switch(r){case"EVENT":{const a=this.openSubs.get(s),u=n[2];if(!a){this.debug(`Received event for unknown subscription ${s}`);return}a.onevent(u);return}case"COUNT":{const a=n[2],u=this.openCountRequests.get(s);u&&(u.resolve(a.count),this.openCountRequests.delete(s));return}case"EOSE":{const a=this.openSubs.get(s);if(!a)return;a.oneose(s);return}case"OK":{const a=n[2],u=n[3],l=this.openEventPublishes.get(s),c=l==null?void 0:l.pop();if(!l||!c){this.debug("Received OK for unknown event publish",s);return}a?c.resolve(u):c.reject(new Error(u)),l.length===0?this.openEventPublishes.delete(s):this.openEventPublishes.set(s,l);return}case"CLOSED":{const a=this.openSubs.get(s);if(!a)return;a.onclosed(n[2]);return}case"NOTICE":this.onNotice(n[1]);return;case"AUTH":{this.onAuthRequested(n[1]);return}}}catch(n){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${n.message}`,n==null?void 0:n.stack);return}}async onAuthRequested(t){var n,r,s;const e=this.ndkRelay.authPolicy??((n=this.ndk)==null?void 0:n.relayAuthDefaultPolicy);if(this.debug("Relay requested authentication",{havePolicy:!!e}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,e){if(this._status>=5){this._status=7;let o;try{o=await e(this.ndkRelay,t)}catch(a){this.debug("Authentication policy threw an error",a),o=!1}if(this.debug("Authentication policy returned",!!o),o instanceof NDKEvent||o===!0){o instanceof NDKEvent&&await this.auth(o);const a=async()=>{if(this._status>=5&&this._status<8){const u=new NDKEvent(this.ndk);u.kind=22242,u.tags=[["relay",this.ndkRelay.url],["challenge",t]],await u.sign(),this.auth(u).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")}).catch(l=>{this._status=6,this.ndkRelay.emit("auth:failed",l),this.debug("Authentication failed",l)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};o===!0&&((r=this.ndk)!=null&&r.signer?a().catch(u=>{console.error("Error authenticating",u)}):(this.debug("No signer available for authentication localhost"),(s=this.ndk)==null||s.once("signer:ready",a))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",t)}onError(t){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,t)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const t=this._connectionStats.durations;if(t.length%3!==0)return!1;const n=t.reduce((a,u)=>a+u,0)/t.length,r=t.map(a=>Math.pow(a-n,2)).reduce((a,u)=>a+u,0)/t.length;return Math.sqrt(r)<FLAPPING_THRESHOLD_MS}async onNotice(t){this.ndkRelay.emit("notice",t)}handleReconnection(t=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}const e=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(n=>{t<MAX_RECONNECT_ATTEMPTS?setTimeout(()=>{this.handleReconnection(t+1)},1e3*(t+1)^4):this.debug("Reconnect failed")})},e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(t){var e,n,r;this._status>=5&&((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN?((n=this.ws)==null||n.send(t),(r=this.netDebug)==null||r.call(this,t,this.ndkRelay,"send")):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${t}`,this._status)}async auth(t){const e=new Promise((n,r)=>{const s=this.openEventPublishes.get(t.id)??[];s.push({resolve:n,reject:r}),this.openEventPublishes.set(t.id,s)});return this.send('["AUTH",'+JSON.stringify(t.rawEvent())+"]"),e}async publish(t){const e=new Promise((n,r)=>{const s=this.openEventPublishes.get(t.id)??[];s.length>0&&console.warn("Duplicate event publishing detected, you are publishing event "+t.id+" twice"),s.push({resolve:n,reject:r}),this.openEventPublishes.set(t.id,s)});return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=(e==null?void 0:e.id)||"count:"+this.serial,r=new Promise((s,o)=>{this.openCountRequests.set(n,{resolve:s,reject:o})});return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}close(t,e){this.send('["CLOSE","'+t+'"]');const n=this.openSubs.get(t);this.openSubs.delete(t),n&&n.onclose(e)}req(t){this.send('["REQ","'+t.subId+'",'+JSON.stringify(t.executeFilters).substring(1))+"",this.openSubs.set(t.subId,t)}get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){var t;return this._status>=5&&((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN}},NDKRelayPublisher=class{constructor(t){$(this,"ndkRelay");$(this,"debug");this.ndkRelay=t,this.debug=t.debug.extend("publisher")}async publish(t,e=2500){let n;const r=()=>new Promise((f,h)=>{try{this.publishEvent(t).then(p=>{this.ndkRelay.emit("published",t),t.emit("relay:published",this.ndkRelay),f(!0)}).catch(h)}catch(p){h(p)}}),s=new Promise((f,h)=>{n=setTimeout(()=>{n=void 0,h(new Error("Timeout: "+e+"ms"))},e)}),o=()=>{r().then(f=>a(f)).catch(f=>u(f))};let a,u;const l=f=>{throw this.ndkRelay.debug("Publish failed",f,t.id),this.ndkRelay.emit("publish:failed",t,f),t.emit("relay:publish:failed",this.ndkRelay,f),f},c=()=>{n&&clearTimeout(n),this.ndkRelay.removeListener("connect",o)};return this.ndkRelay.status>=5?Promise.race([r(),s]).catch(l).finally(c):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((f,h)=>{a=f,u=h,this.ndkRelay.once("connect",o)}),s]).catch(l).finally(c))}async publishEvent(t){return this.ndkRelay.connectivity.publish(t.rawEvent())}};function filterFingerprint(t,e){const n=[];for(const s of t){const o=Object.entries(s||{}).map(([a,u])=>["since","until"].includes(a)?a+":"+u:a).sort().join("-");n.push(o)}let r=e?"+":"";return r+=n.join("|"),r}function mergeFilters(t){const e=[],n={};return t.filter(r=>!!r.limit).forEach(r=>e.push(r)),t=t.filter(r=>!r.limit),t.length===0?e:(t.forEach(r=>{Object.entries(r).forEach(([s,o])=>{Array.isArray(o)?n[s]===void 0?n[s]=[...o]:n[s]=Array.from(new Set([...n[s],...o])):n[s]=o})}),[...e,n])}var NDKRelaySubscription=class{constructor(t,e){$(this,"fingerprint");$(this,"items",new Map);$(this,"topSubscriptionManager");$(this,"debug");$(this,"status",0);$(this,"onClose");$(this,"relay");$(this,"eosed",!1);$(this,"executionTimer");$(this,"fireTime");$(this,"delayType");$(this,"executeFilters");$(this,"id",Math.random().toString(36).substring(7));$(this,"_subId");$(this,"subIdParts",new Set);$(this,"executeOnRelayReady",()=>{this.status===2&&(this.status=1,this.execute())});$(this,"reExecuteAfterAuth",(()=>{const t=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:t}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",t,this.subId)}).bind(this));this.relay=t,this.debug=t.debug.extend("subscription-"+this.id),this.fingerprint=e||Math.random().toString(36).substring(7)}get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}addSubIdPart(t){this.subIdParts.add(t)}addItem(t,e){if(!this.items.has(t.internalId))switch(t.on("close",this.removeItem.bind(this,t)),this.items.set(t.internalId,{subscription:t,filters:e}),this.status!==3&&t.subId&&(!this._subId||this._subId.length<48)&&(this.status===0||this.status===1)&&this.addSubIdPart(t.subId),this.status){case 0:this.evaluateExecutionPlan(t);break;case 3:console.log("BUG: This should not happen: This subscription needs to catch up with a subscription that was already running",e);break;case 1:this.evaluateExecutionPlan(t);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",t,e),new Error("Cannot add new items to a closed subscription")}}removeItem(t){if(this.items.delete(t.internalId),this.items.size===0){if(!this.eosed)return;this.close()}}close(){if(this.status===4)return;const t=this.status;if(this.status=4,t===3)try{this.relay.close(this.subId)}catch(e){this.debug("Error closing subscription",e,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:t,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(t){if(!t.isGroupable()){this.status=1,this.execute();return}if(t.filters.find(r=>!!r.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const e=t.groupableDelay,n=t.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(e,n);else{const r=this.delayType,s=this.fireTime-Date.now();if(r==="at-least"&&n==="at-least")s<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if(r==="at-least"&&n==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if(r==="at-most"&&n==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if(r==="at-most"&&n==="at-least")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else throw new Error("Unknown delay type combination "+r+" "+n)}}schedule(t,e){this.status=1;const n=Date.now();this.fireTime=n+t,this.delayType=e;const r=setTimeout(this.execute.bind(this),t);e==="at-least"&&(this.executionTimer=r)}finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+="-"+Math.random().toString(36).substring(2,7)}execute(){if(this.status===1){if(this.relay.connected)this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth);else{this.status=2,this.relay.once("ready",this.executeOnRelayReady);return}this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(t){var e;(e=this.topSubscriptionManager)==null||e.seenEvent(t.id,this.relay);for(const{subscription:n}of this.items.values())matchFilters(n.filters,t)&&n.eventReceived(t,this.relay,!1)}oneose(t){if(this.eosed=!0,t!==this.subId){this.debug("Received EOSE for an abandoned subscription",t,this.subId),this.relay.close(t);return}this.items.size===0&&this.close();for(const{subscription:e}of this.items.values())e.eoseReceived(this.relay),e.closeOnEose&&this.removeItem(e)}onclose(t){this.status=4}onclosed(t){if(t)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,t)}compileFilters(){const t=[],e=Array.from(this.items.values()).map(r=>r.filters);if(!e[0])return this.debug(" No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];const n=e[0].length;for(let r=0;r<n;r++){const s=e.map(o=>o[r]);t.push(...mergeFilters(s))}return t}},NDKRelaySubscriptionManager=class{constructor(t,e){$(this,"relay");$(this,"subscriptions");$(this,"topSubscriptionManager");this.relay=t,this.subscriptions=new Map,this.topSubscriptionManager=e}addSubscription(t,e){let n;if(!t.isGroupable())n=this.createSubscription(t,e);else{const r=filterFingerprint(e,t.closeOnEose);r&&(n=(this.subscriptions.get(r)||[]).find(o=>o.status<3)),n??(n=this.createSubscription(t,e,r))}n.addItem(t,e)}createSubscription(t,e,n){const r=new NDKRelaySubscription(this.relay,n);r.topSubscriptionManager=this.topSubscriptionManager,r.onClose=this.onRelaySubscriptionClose.bind(this);const s=this.subscriptions.get(r.fingerprint)??[];return this.subscriptions.set(r.fingerprint,[...s,r]),r}onRelaySubscriptionClose(t){let e=this.subscriptions.get(t.fingerprint)??[];e?e.length===1?this.subscriptions.delete(t.fingerprint):(e=e.filter(n=>n.id!==t.id),this.subscriptions.set(t.fingerprint,e),console.log("removing a subscription",{fingerprint:t.fingerprint,id:t.id,newSize:this.subscriptions.size})):console.warn("Unexpectedly did not find a subscription with fingerprint",t.fingerprint)}},ve,NDKRelay=(ve=class extends libExports.EventEmitter{constructor(n,r,s){super();$(this,"url");$(this,"scores");$(this,"connectivity");$(this,"subs");$(this,"publisher");$(this,"authPolicy");$(this,"lowestValidationRatio");$(this,"targetValidationRatio");$(this,"validationRatioFn");$(this,"validatedEventCount",0);$(this,"nonValidatedEventCount",0);$(this,"trusted",!1);$(this,"complaining",!1);$(this,"debug");$(this,"req");$(this,"close");this.url=normalizeRelayUrl(n),this.scores=new Map,this.debug=debug7(`ndk:relay:${n}`),this.connectivity=new NDKRelayConnectivity(this,s),this.connectivity.netDebug=s==null?void 0:s.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,s==null?void 0:s.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=r,this.targetValidationRatio=s==null?void 0:s.initialValidationRatio,this.lowestValidationRatio=s==null?void 0:s.lowestValidationRatio,this.validationRatioFn=((s==null?void 0:s.validationRatioFn)??ve.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),s||console.trace("relay created without ndk")}updateValidationRatio(){setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(n,r=!0){return this.connectivity.connect(n,r)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(n,r){this.subs.addSubscription(n,r)}async publish(n,r=2500){return this.publisher.publish(n,r)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0?!0:this.validationRatio<this.targetValidationRatio}get connected(){return this.connectivity.connected}},$(ve,"defaultValidationRatioUpdateFn",(n,r,s)=>{if(n.lowestValidationRatio===void 0||n.targetValidationRatio===void 0)return 1;let o=n.validationRatio;if(n.validationRatio>n.targetValidationRatio){const a=r/100;o=Math.max(n.lowestValidationRatio,n.validationRatio-a)}return o<n.validationRatio?o:n.validationRatio}),ve),NDKPublishError=class extends Error{constructor(e,n,r,s){super(e);$(this,"errors");$(this,"publishedToRelays");$(this,"intendedRelaySet");this.errors=n,this.publishedToRelays=r,this.intendedRelaySet=s}get relayErrors(){const e=[];for(const[n,r]of this.errors)e.push(`${n.url}: ${r}`);return e.join(`
`)}},NDKRelaySet=class Te{constructor(e,n,r){$(this,"relays");$(this,"debug");$(this,"ndk");$(this,"pool");this.relays=e,this.ndk=n,this.pool=r??n.pool,this.debug=n.debug.extend("relayset")}addRelay(e){this.relays.add(e)}get relayUrls(){return Array.from(this.relays).map(e=>e.url)}static fromRelayUrls(e,n,r=!0,s){if(s=s??n.pool,!s)throw new Error("No pool provided");const o=new Set;for(const a of e){const u=s.relays.get(normalizeRelayUrl(a));if(u)u.status<5&&r&&u.connect(),o.add(u);else{const l=new NDKRelay(normalizeRelayUrl(a),n==null?void 0:n.relayAuthDefaultPolicy,n);s.useTemporaryRelay(l,void 0,"requested from fromRelayUrls "+e),o.add(l)}}return new Te(new Set(o),n,s)}async publish(e,n,r=1){const s=new Set,o=new Map,a=e.isEphemeral();e.publishStatus="pending";const u=Array.from(this.relays).map(l=>new Promise(c=>{l.publish(e,n).then(f=>{s.add(l),c()}).catch(f=>{a||o.set(l,f),c()})}));if(await Promise.all(u),s.size<r){if(!a){const l=new NDKPublishError("Not enough relays received the event",o,s,this);throw e.publishStatus="error",e.publishError=l,this.ndk.emit("event:publish-failed",e,l,this.relayUrls),l}}else e.emit("published",{relaySet:this,publishedToRelays:s});return s}get size(){return this.relays.size}},d=debug7("ndk:outbox:calculate");async function calculateRelaySetFromEvent(t,e){var a;const n=new Set,r=await getWriteRelaysFor(t,e.pubkey);r&&r.forEach(u=>{var c;const l=(c=t.pool)==null?void 0:c.getRelay(u);l&&n.add(l)});let s=e.tags.filter(u=>["a","e"].includes(u[0])).map(u=>u[2]).filter(u=>u&&u.startsWith("wss://")).filter(u=>{try{return new URL(u),!0}catch{return!1}}).map(u=>normalizeRelayUrl(u));s=Array.from(new Set(s)).slice(0,5),s.forEach(u=>{var c;const l=(c=t.pool)==null?void 0:c.getRelay(u,!0,!0);l&&(d("Adding relay hint %s",u),n.add(l))});const o=e.getMatchingTags("p").map(u=>u[1]);return o.length<5?Array.from(chooseRelayCombinationForPubkeys(t,o,"read",{preferredRelays:new Set(r)}).keys()).forEach(l=>{var f;const c=(f=t.pool)==null?void 0:f.getRelay(l,!1,!0);c&&(d("Adding p-tagged relay %s",l),n.add(c))}):d("Too many p-tags to consider %d",o.length),(a=t.pool)==null||a.permanentAndConnectedRelays().forEach(u=>n.add(u)),new NDKRelaySet(n,t)}function calculateRelaySetsFromFilter(t,e,n){const r=new Map,s=new Set;if(e.forEach(o=>{o.authors&&o.authors.forEach(a=>s.add(a))}),s.size>0){const o=getRelaysForFilterWithAuthors(t,Array.from(s));for(const a of o.keys())r.set(a,[]);for(const a of e)if(a.authors)for(const[u,l]of o.entries()){const c=a.authors.filter(f=>l.includes(f));r.set(u,[...r.get(u),{...a,authors:c}])}else for(const u of o.keys())r.set(u,[...r.get(u),a])}else t.explicitRelayUrls&&t.explicitRelayUrls.forEach(o=>{r.set(o,e)});return r.size===0&&n.permanentAndConnectedRelays().slice(0,5).forEach(o=>{r.set(o.url,e)}),r}function calculateRelaySetsFromFilters(t,e,n){return calculateRelaySetsFromFilter(t,e,n)}function mergeTags(t,e){const n=new Map,r=a=>a.join(","),s=(a,u)=>a.every((l,c)=>l===u[c]),o=a=>{for(const[u,l]of n)if(s(l,a)||s(a,l)){a.length>=l.length&&n.set(u,a);return}n.set(r(a),a)};return t.concat(e).forEach(o),Array.from(n.values())}async function generateContentTags(t,e=[]){const n=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,r=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g"),s=[],o=a=>{e.find(u=>["q",a[0]].includes(u[0])&&u[1]===a[1])||e.push(a)};return t=t.replace(n,a=>{try{const u=a.split(/(@|nostr:)/)[2],{type:l,data:c}=nip19_exports.decode(u);let f;switch(l){case"npub":f=["p",c];break;case"nprofile":f=["p",c.pubkey];break;case"note":s.push(new Promise(async h=>{o(["e",c,await maybeGetEventRelayUrl(u),"mention"]),h()}));break;case"nevent":s.push(new Promise(async h=>{const{id:p,author:m}=c;let{relays:g}=c;(!g||g.length===0)&&(g=[await maybeGetEventRelayUrl(u)]),o(["e",p,g[0],"mention"]),m&&o(["p",m]),h()}));break;case"naddr":s.push(new Promise(async h=>{const p=[c.kind,c.pubkey,c.identifier].join(":");let m=c.relays??[];m.length===0&&(m=[await maybeGetEventRelayUrl(u)]),o(["a",p,m[0],"mention"]),o(["p",c.pubkey]),h()}));break;default:return a}return f&&o(f),`nostr:${u}`}catch{return a}}),await Promise.all(s),t=t.replace(r,(a,u)=>{const l=["t",u.slice(1)];return e.find(c=>c[0]===l[0]&&c[1]===l[1])||e.push(l),a}),{content:t,tags:e}}async function maybeGetEventRelayUrl(t){return""}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_ENCRYPTION_SCHEME="nip04";async function encrypt(t,e,n=DEFAULT_ENCRYPTION_SCHEME){if(!this.ndk)throw new Error("No NDK instance found!");if(e||(await this.ndk.assertSigner(),e=this.ndk.signer),!t){const r=this.getMatchingTags("p");if(r.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");t=this.ndk.getUser({pubkey:r[0][1]})}this.content=await(e==null?void 0:e.encrypt(t,this.content,n))}async function decrypt(t,e,n=DEFAULT_ENCRYPTION_SCHEME){if(!this.ndk)throw new Error("No NDK instance found!");e||(await this.ndk.assertSigner(),e=this.ndk.signer),t||(t=this.author),this.content=await(e==null?void 0:e.decrypt(t,this.content,n))}function encode$2(t=5){let e=[];return this.onRelays.length>0?e=this.onRelays.map(n=>n.url):this.relay&&(e=[this.relay.url]),e.length>t&&(e=e.slice(0,t)),this.isParamReplaceable()?nip19_exports.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?nip19_exports.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):nip19_exports.noteEncode(this.tagId())}async function repost(t=!0,e){if(!e&&t){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const n=new NDKEvent(this.ndk,{kind:getKind(this),content:""});return n.tag(this),n.kind===16?n.tags.push(["k",`${this.kind}`]):n.content=JSON.stringify(this.rawEvent()),e&&await n.sign(e),t&&await n.publish(),n}function getKind(t){return t.kind===1?6:16}function eventHasETagMarkers(t){return t.getMatchingTags("e").some(e=>e[3])}function getRootTag(t,e){e??(e=t.tagType());const n=t.tags.find(r=>r[3]==="root");if(!n){if(eventHasETagMarkers(t))return;const r=t.getMatchingTags(e);if(r.length<3)return r[0]}return n}function getReplyTag(t,e){e??(e=t.tagType());let n=t.tags.find(r=>r[3]==="reply");if(n)return n;if(n||(n=t.tags.find(r=>r[3]==="root")),!n){if(eventHasETagMarkers(t))return;const r=t.getMatchingTags(e);if(r.length===1)return r[0];if(r.length===2)return r[1]}}async function fetchTaggedEvent(t,e){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(t,e);if(n.length===0)return;const[r,s,o]=n[0];return await this.ndk.fetchEvent(s,{},void 0)}async function fetchRootEvent(t){if(!this.ndk)throw new Error("NDK instance not found");const e=getRootTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}async function fetchReplyEvent(t){if(!this.ndk)throw new Error("NDK instance not found");const e=getReplyTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}function serialize(t=!1,e=!1){const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return t&&n.push(this.sig),e&&n.push(this.id),JSON.stringify(n)}function deserialize(t){const e=JSON.parse(t),n={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};return e.length===7&&(n.sig=e[6]),e.length===8&&(n.id=e[7]),n}var worker,processingQueue={};function signatureVerificationInit(t){worker=t,worker.onmessage=e=>{const[n,r]=e.data,s=processingQueue[n];if(!s){console.error("No record found for event",n);return}delete processingQueue[n];for(const o of s.resolves)o(r)}}async function verifySignatureAsync(t,e){return new Promise(r=>{const s=t.serialize();let o=!1;processingQueue[t.id]||(processingQueue[t.id]={event:t,resolves:[]},o=!0),processingQueue[t.id].resolves.push(r),o&&worker.postMessage({serialized:s,id:t.id,sig:t.sig,pubkey:t.pubkey})})}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let t=0;t<this.tags.length;t++){const e=this.tags[t];if(!Array.isArray(e))return!1;for(let n=0;n<e.length;n++)if(typeof e[n]=="object")return!1}return!0}var verifiedSignatures=new distExports.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(t){var n;if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const e=verifiedSignatures.get(this.id);if(e!==null)return this.signatureVerified=!!e;try{if((n=this.ndk)!=null&&n.asyncSigVerification)verifySignatureAsync(this,t).then(r=>{t&&(this.signatureVerified=r,r&&verifiedSignatures.set(this.id,this.sig)),r||(this.ndk.emit("event:invalid-sig",this),verifiedSignatures.set(this.id,!1))});else{const r=sha256$1(new TextEncoder().encode(this.serialize())),s=schnorr.verify(this.sig,r,this.pubkey);return s?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=s}}catch{return this.signatureVerified=!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(t){const e=sha256$1(new TextEncoder().encode(t));return bytesToHex$1(e)}var skipClientTagOnKinds=[3],NDKEvent=class we extends libExports.EventEmitter{constructor(n,r){var s;super();$(this,"ndk");$(this,"created_at");$(this,"content","");$(this,"tags",[]);$(this,"kind");$(this,"id","");$(this,"sig");$(this,"pubkey","");$(this,"signatureVerified");$(this,"_author");$(this,"relay");$(this,"publishStatus","success");$(this,"publishError");$(this,"serialize",serialize.bind(this));$(this,"getEventHash",getEventHash.bind(this));$(this,"validate",validate.bind(this));$(this,"verifySignature",verifySignature.bind(this));$(this,"isReplaceable",isReplaceable.bind(this));$(this,"isEphemeral",isEphemeral.bind(this));$(this,"isParamReplaceable",isParamReplaceable.bind(this));$(this,"encode",encode$2.bind(this));$(this,"encrypt",encrypt.bind(this));$(this,"decrypt",decrypt.bind(this));$(this,"fetchTaggedEvent",fetchTaggedEvent.bind(this));$(this,"fetchRootEvent",fetchRootEvent.bind(this));$(this,"fetchReplyEvent",fetchReplyEvent.bind(this));$(this,"repost",repost.bind(this));this.ndk=n,this.created_at=r==null?void 0:r.created_at,this.content=(r==null?void 0:r.content)||"",this.tags=(r==null?void 0:r.tags)||[],this.id=(r==null?void 0:r.id)||"",this.sig=r==null?void 0:r.sig,this.pubkey=(r==null?void 0:r.pubkey)||"",this.kind=r==null?void 0:r.kind,r instanceof we&&(this.relay&&(this.relay=r.relay,(s=this.ndk)==null||s.subManager.seenEvent(r.id,this.relay)),this.publishStatus=r.publishStatus,this.publishError=r.publishError)}get onRelays(){let n=[];return this.ndk?n=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&n.push(this.relay),n}static deserialize(n,r){return new we(n,deserialize(r))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(n){var r;this.pubkey=n.pubkey,this._author=n,(r=this._author).ndk??(r.ndk=this.ndk)}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const n=this.ndk.getUser({pubkey:this.pubkey});return this._author=n,n}tagExternal(n,r,s){let o=["i"],a=["k"];switch(r){case"url":const u=new URL(n);u.hash="",o.push(u.toString()),a.push(`${u.protocol}//${u.host}`);break;case"hashtag":o.push(`#${n.toLowerCase()}`),a.push("#");break;case"geohash":o.push(`geo:${n.toLowerCase()}`),a.push("geo");break;case"isbn":o.push(`isbn:${n.replace(/-/g,"")}`),a.push("isbn");break;case"podcast:guid":o.push(`podcast:guid:${n}`),a.push("podcast:guid");break;case"podcast:item:guid":o.push(`podcast:item:guid:${n}`),a.push("podcast:item:guid");break;case"podcast:publisher:guid":o.push(`podcast:publisher:guid:${n}`),a.push("podcast:publisher:guid");break;case"isan":o.push(`isan:${n.split("-").slice(0,4).join("-")}`),a.push("isan");break;case"doi":o.push(`doi:${n.toLowerCase()}`),a.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${r}`)}s&&o.push(s),this.tags.push(o),this.tags.push(a)}tag(n,r,s,o){let a=[];if(n.fetchProfile!==void 0){o??(o="p");const l=[o,n.pubkey];r&&l.push("",r),a.push(l)}else if(n instanceof we){const l=n;s??(s=(l==null?void 0:l.pubkey)===this.pubkey),a=l.referenceTags(r,s,o);for(const c of l.getMatchingTags("p"))c[1]!==this.pubkey&&(this.tags.find(f=>f[0]==="p"&&f[1]===c[1])||this.tags.push(["p",c[1]]))}else if(Array.isArray(n))a=[n];else throw new Error("Invalid argument",n);this.tags=mergeTags(this.tags,a)}async toNostrEvent(n){var o,a;if(!n&&this.pubkey===""){const u=await((a=(o=this.ndk)==null?void 0:o.signer)==null?void 0:a.user());this.pubkey=(u==null?void 0:u.pubkey)||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:r,tags:s}=await this.generateTags();this.content=r||"",this.tags=s;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}getMatchingTags(n,r){const s=this.tags.filter(o=>o[0]===n);return r===void 0?s:s.filter(o=>o[3]===r)}hasTag(n,r){return this.tags.some(s=>s[0]===n&&(!r||s[3]===r))}tagValue(n){const r=this.getMatchingTags(n);if(r.length!==0)return r[0][1]}get alt(){return this.tagValue("alt")}set alt(n){this.removeTag("alt"),n&&this.tags.push(["alt",n])}get dTag(){return this.tagValue("d")}set dTag(n){this.removeTag("d"),n&&this.tags.push(["d",n])}removeTag(n){const r=Array.isArray(n)?n:[n];this.tags=this.tags.filter(s=>!r.includes(s[0]))}async sign(n){var s;n?this.author=await n.user():((s=this.ndk)==null||s.assertSigner(),n=this.ndk.signer);const r=await this.toNostrEvent();return this.sig=await n.sign(r),this.sig}async publishReplaceable(n,r,s){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(n,r,s)}async publish(n,r,s){var u,l;if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");n||(n=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this)),this.kind===5&&((u=this.ndk.cacheAdapter)!=null&&u.deleteEvent)&&this.ndk.cacheAdapter.deleteEvent(this);const o=this.rawEvent();if((l=this.ndk.cacheAdapter)!=null&&l.addUnpublishedEvent)try{this.ndk.cacheAdapter.addUnpublishedEvent(this,n.relayUrls)}catch(c){console.error("Error adding unpublished event to cache",c)}this.ndk.subManager.subscriptions.forEach(c=>{c.filters.some(f=>matchFilter(f,o))&&c.eventReceived(this,void 0,!1,!0)});const a=await n.publish(this,r,s);return a.forEach(c=>{var f;return(f=this.ndk)==null?void 0:f.subManager.seenEvent(this.id,c)}),a}async generateTags(){var o,a;let n=[];const r=await generateContentTags(this.content,this.tags),s=r.content;if(n=r.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const l=this.tagValue("title");let f=[...Array(l?6:16)].map(()=>Math.random().toString(36)[2]).join("");l&&l.length>0&&(f=l.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")+"-"+f),n.push(["d",f])}if(((o=this.ndk)!=null&&o.clientName||(a=this.ndk)!=null&&a.clientNip89)&&skipClientTagOnKinds.includes(this.kind)&&!this.tags.some(u=>u[0]==="client")){const u=["client",this.ndk.clientName??""];this.ndk.clientNip89&&u.push(this.ndk.clientNip89),n.push(u)}return{content:s||"",tags:n}}muted(){var o,a;const n=(o=this.ndk)==null?void 0:o.mutedIds.get(this.pubkey);if(n&&n==="p")return"author";const r=this.tagReference(),s=(a=this.ndk)==null?void 0:a.mutedIds.get(r[1]);return s&&s===r[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const n=this.getMatchingTags("d")[0];return n?n[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(!this.isParamReplaceable())throw new Error("This must only be called on replaceable events");const n=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${n}`}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(n){let r;return this.isParamReplaceable()?r=["a",this.tagAddress()]:r=["e",this.tagId()],this.relay?r.push(this.relay.url):r.push(""),n&&r.push(n),r}referenceTags(n,r,s){var a;let o=[];return this.isParamReplaceable()?o=[[s??"a",this.tagAddress()],[s??"e",this.id]]:o=[[s??"e",this.id]],(a=this.relay)!=null&&a.url?o=o.map(u=>{var l;return u.push((l=this.relay)==null?void 0:l.url),u}):n&&(o=o.map(u=>(u.push(""),u))),n&&o.forEach(u=>u.push(n)),o=[...o,...this.getMatchingTags("h")],r||o.push(...this.author.referenceTags()),o}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}async delete(n,r=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new we(this.ndk,{kind:5,content:n||""});return s.tag(this,void 0,!0),s.tags.push(["k",this.kind.toString()]),r&&await s.publish(),s}async react(n,r=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new we(this.ndk,{kind:7,content:n});return s.tag(this),r?await s.publish():await s.sign(),s}get isValid(){return this.validate()}};function queryFullyFilled(t){return!!(filterIncludesIds(t.filter)&&resultHasAllRequestedIds(t))}function filterIncludesIds(t){return!!t.ids}function resultHasAllRequestedIds(t){const e=t.filter.ids;return!!e&&e.length===t.eventFirstSeen.size}function filterFromId(t){let e;if(t.match(NIP33_A_REGEX)){const[n,r,s]=t.split(":"),o={authors:[r],kinds:[parseInt(n)]};return s&&(o["#d"]=[s]),o}if(t.match(BECH32_REGEX))try{switch(e=nip19_exports.decode(t),e.type){case"nevent":{const r={ids:[e.data.id]};return e.data.author&&(r.authors=[e.data.author]),e.data.kind&&(r.kinds=[e.data.kind]),r}case"note":return{ids:[e.data]};case"naddr":const n={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(n["#d"]=[e.data.identifier]),n}}catch(n){console.error("Error decoding",t,n)}return{ids:[t]}}function isNip33AValue(t){return t.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(t,e){try{const n=nip19_exports.decode(t);if(["naddr","nevent"].includes(n==null?void 0:n.type)){const r=n.data;if(r!=null&&r.relays)return r.relays.map(s=>new NDKRelay(s,e==null?void 0:e.relayAuthDefaultPolicy,e))}}catch{}return[]}var defaultOpts={closeOnEose:!1,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100,groupableDelayType:"at-most"},NDKSubscription=class extends libExports.EventEmitter{constructor(e,n,r,s,o){super();$(this,"subId");$(this,"filters");$(this,"opts");$(this,"pool");$(this,"skipVerification",!1);$(this,"skipValidation",!1);$(this,"relayFilters");$(this,"relaySet");$(this,"ndk");$(this,"debug");$(this,"eventFirstSeen",new Map);$(this,"eosesSeen",new Set);$(this,"lastEventReceivedAt");$(this,"internalId");$(this,"closeOnEose");$(this,"poolMonitor");$(this,"skipOptimisticPublishEvent",!1);$(this,"eoseTimeout");$(this,"eosed",!1);if(this.ndk=e,this.pool=(r==null?void 0:r.pool)||e.pool,this.opts={...defaultOpts,...r||{}},this.filters=n instanceof Array?n:[n],this.subId=o||(r==null?void 0:r.subId),this.internalId=Math.random().toString(36).substring(7),this.relaySet=s,this.debug=e.debug.extend(`subscription[${(r==null?void 0:r.subId)??this.internalId}]`),this.skipVerification=(r==null?void 0:r.skipVerification)||!1,this.skipValidation=(r==null?void 0:r.skipValidation)||!1,this.closeOnEose=(r==null?void 0:r.closeOnEose)||!1,this.skipOptimisticPublishEvent=(r==null?void 0:r.skipOptimisticPublishEvent)||!1,this.opts.cacheUsage==="ONLY_CACHE"&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters.keys()).filter(n=>!this.eosesSeen.has(this.pool.getRelay(n,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){var e;if(this.isGroupable())return(e=this.opts)==null?void 0:e.groupableDelay}get groupableDelayType(){var e;return((e=this.opts)==null?void 0:e.groupableDelayType)||"at-most"}isGroupable(){var e;return((e=this.opts)==null?void 0:e.groupable)||!1}shouldQueryCache(){var e;return((e=this.opts)==null?void 0:e.cacheUsage)!=="ONLY_RELAY"}shouldQueryRelays(){var e;return((e=this.opts)==null?void 0:e.cacheUsage)!=="ONLY_CACHE"}shouldWaitForCache(){var e;return this.opts.closeOnEose&&!!((e=this.ndk.cacheAdapter)!=null&&e.locking)&&this.opts.cacheUsage!=="PARALLEL"}async start(){let e;if(this.shouldQueryCache()&&(e=this.startWithCache(),this.shouldWaitForCache()&&(await e,queryFullyFilled(this)))){this.emit("eose",this);return}this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=e=>{var r,s;if((r=this.relayFilters)!=null&&r.has(e.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool).get(e.url)&&((s=this.relayFilters)==null||s.set(e.url,this.filters),e.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.removeAllListeners()}hasAuthorsFilter(){return this.filters.some(e=>{var n;return(n=e.authors)==null?void 0:n.length})}async startWithCache(){var e;if((e=this.ndk.cacheAdapter)!=null&&e.query){const n=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await n}}startWithRelays(){if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool);else{this.relayFilters=new Map;for(const e of this.relaySet.relays)this.relayFilters.set(e.url,this.filters)}if(!(!this.relayFilters||this.relayFilters.size===0))for(const[e,n]of this.relayFilters)this.pool.getRelay(e,!0,!0,n).subscribe(this,n)}eventReceived(e,n,r=!1,s=!1){const o=e.id,a=this.eventFirstSeen.has(o);let u;if(e instanceof NDKEvent&&(u=e),a){const l=Date.now()-(this.eventFirstSeen.get(o)||0);if(this.emit("event:dup",o,n,l,this),n){const c=verifiedSignatures.get(o);c&&typeof c=="string"&&e.sig===c&&n.addValidatedEvent()}}else{if(u??(u=new NDKEvent(this.ndk,e)),u.ndk=this.ndk,u.relay=n,!r&&!s){if(!this.skipValidation&&!u.isValid){this.debug("Event failed validation %s from relay %s",o,n==null?void 0:n.url);return}if(n)if((n==null?void 0:n.shouldValidateEvent())!==!1){if(!this.skipVerification)if(!u.verifySignature(!0)&&!this.ndk.asyncSigVerification){this.debug("Event failed signature validation",e);return}else n&&n.addValidatedEvent()}else n.addNonValidatedEvent();this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(u,this.filters,n)}!r&&n&&this.ndk.emit("event",u,n),(!s||this.skipOptimisticPublishEvent!==!0)&&(this.emit("event",u,n,this),this.eventFirstSeen.set(o,Date.now()))}this.lastEventReceivedAt=Date.now()}closedReceived(e,n){this.emit("closed",e,n)}eoseReceived(e){var a;this.debug("EOSE received from %s",e.url),this.eosesSeen.add(e);let n=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const r=this.eosesSeen.size===((a=this.relayFilters)==null?void 0:a.size),s=queryFullyFilled(this),o=u=>{var l;this.debug("Performing EOSE: %s %d",u,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,(l=this.opts)!=null&&l.closeOnEose&&this.stop())};if(s||r)o("query filled or seen all");else if(this.relayFilters){let u=1e3;const l=new Set(this.pool.connectedRelays().map(h=>h.url)),c=Array.from(this.relayFilters.keys()).filter(h=>l.has(h));if(c.length===0)return;const f=this.eosesSeen.size/c.length;if(this.eosesSeen.size>=2&&f>=.5){if(u=u*(1-f),u===0){o("tiem to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const h=()=>{n=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,n!==void 0&&n<20?this.eoseTimeout=setTimeout(h,u):o("send eose timeout: "+u)};this.eoseTimeout=setTimeout(h,u)}}}};async function follows(t,e,n=3){var s,o;if(!this.ndk)throw new Error("NDK not set");const r=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},t||{groupable:!1});if(r){const a=new Set;return r.tags.forEach(u=>{u[0]==="p"&&a.add(u[1])}),e&&((o=(s=this.ndk)==null?void 0:s.outboxTracker)==null||o.trackUsers(Array.from(a))),[...a].reduce((u,l)=>{const c=new NDKUser({pubkey:l});return c.ndk=this.ndk,u.add(c),u},new Set)}return new Set}function profileFromEvent(t){const e={};let n;try{n=JSON.parse(t.content)}catch(r){throw new Error(`Failed to parse profile event: ${r}`)}return e.created_at=t.created_at,e.profileEvent=JSON.stringify(t.rawEvent()),Object.keys(n).forEach(r=>{switch(r){case"name":e.name=n.name;break;case"display_name":e.displayName=n.display_name;break;case"image":case"picture":e.image=n.picture||n.image;break;case"banner":e.banner=n.banner;break;case"bio":e.bio=n.bio;break;case"nip05":e.nip05=n.nip05;break;case"lud06":e.lud06=n.lud06;break;case"lud16":e.lud16=n.lud16;break;case"about":e.about=n.about;break;case"zapService":e.zapService=n.zapService;break;case"website":e.website=n.website;break;default:e[r]=n[r];break}}),e}function serializeProfile(t){const e={};for(const[n,r]of Object.entries(t))switch(n){case"username":case"name":e.name=r;break;case"displayName":e.display_name=r;break;case"image":case"picture":e.picture=r;break;case"bio":case"about":e.about=r;break;default:e[n]=r;break}return JSON.stringify(e)}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(t,e,n=fetch,r={}){return await t.queuesNip05.add({id:e,func:async()=>{if(t.cacheAdapter&&t.cacheAdapter.loadNip05){const l=await t.cacheAdapter.loadNip05(e);if(l!=="missing"){if(l){const c=new NDKUser({pubkey:l.pubkey,relayUrls:l.relays,nip46Urls:l.nip46});return c.ndk=t,c}else if(r.cache!=="no-cache")return null}}const s=e.match(NIP05_REGEX);if(!s)return null;const[o,a="_",u]=s;try{const l=await n(`https://${u}/.well-known/nostr.json?name=${a}`,r),{names:c,relays:f,nip46:h}=parseNIP05Result(await l.json()),p=c[a.toLowerCase()];let m=null;return p&&(m={pubkey:p,relays:f==null?void 0:f[p],nip46:h==null?void 0:h[p]}),t!=null&&t.cacheAdapter&&t.cacheAdapter.saveNip05&&t.cacheAdapter.saveNip05(e,m),m}catch(l){return t!=null&&t.cacheAdapter&&t.cacheAdapter.saveNip05&&(t==null||t.cacheAdapter.saveNip05(e,null)),console.error("Failed to fetch NIP05 for",e,l),null}}})}function parseNIP05Result(t){const e={names:{}};for(const[n,r]of Object.entries(t.names))typeof n=="string"&&typeof r=="string"&&(e.names[n.toLowerCase()]=r);if(t.relays){e.relays={};for(const[n,r]of Object.entries(t.relays))typeof n=="string"&&Array.isArray(r)&&(e.relays[n]=r.filter(s=>typeof s=="string"))}if(t.nip46){e.nip46={};for(const[n,r]of Object.entries(t.nip46))typeof n=="string"&&Array.isArray(r)&&(e.nip46[n]=r.filter(s=>typeof s=="string"))}return e}var be,NDKCashuMintList=(be=class extends NDKEvent{constructor(n,r){super(n,r);$(this,"_p2pk");this.kind??(this.kind=10019)}static from(n){return new be(n.ndk,n)}set relays(n){this.tags=this.tags.filter(r=>r[0]!=="relay");for(const r of n)this.tags.push(["relay",r])}get relays(){const n=[];for(const r of this.tags)r[0]==="relay"&&n.push(r[1]);return n}set mints(n){this.tags=this.tags.filter(r=>r[0]!=="mint");for(const r of n)this.tags.push(["mint",r])}get mints(){const n=[];for(const r of this.tags)r[0]==="mint"&&n.push(r[1]);return Array.from(new Set(n))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(n){this._p2pk=n,this.removeTag("pubkey"),n&&this.tags.push(["pubkey",n])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},$(be,"kind",10019),$(be,"kinds",[10019]),be),d2=debug7("ndk:zapper:ln");async function getNip57ZapSpecFromLud({lud06:t,lud16:e},n){let r;if(e&&!e.startsWith("LNURL")){const[s,o]=e.split("@");r=`https://${o}/.well-known/lnurlp/${s}`}else if(t){const{words:s}=bech32.decode(t,1e3),o=bech32.fromWords(s);r=new TextDecoder("utf-8").decode(o)}if(!r)throw d2("No zap endpoint found %o",{lud06:t,lud16:e}),new Error("No zap endpoint found");try{const o=await(n.httpFetch||fetch)(r);if(o.status!==200){const a=await o.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${a}`)}return await o.json()}catch(s){throw new Error(`Unable to fetch zap endpoint ${r}: ${s}`)}}var NDKUser=class De{constructor(e){$(this,"ndk");$(this,"profile");$(this,"_npub");$(this,"_pubkey");$(this,"relayUrls",[]);$(this,"nip46Urls",[]);$(this,"follows",follows.bind(this));e.npub&&(this._npub=e.npub),e.hexpubkey&&(this._pubkey=e.hexpubkey),e.pubkey&&(this._pubkey=e.pubkey),e.relayUrls&&(this.relayUrls=e.relayUrls),e.nip46Urls&&(this.nip46Urls=e.nip46Urls)}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports.npubEncode(this.pubkey)}return this._npub}set npub(e){this._npub=e}get hexpubkey(){return this.pubkey}set hexpubkey(e){this._pubkey=e}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports.decode(this.npub).data}return this._pubkey}set pubkey(e){this._pubkey=e}async getZapInfo(e=!0,n=["nip61","nip57"]){if(!this.ndk)throw new Error("No NDK instance found");const r=[];if(n.includes("nip61")&&r.push(10019),n.includes("nip57")&&r.push(0),r.length===0)return[];let s=await this.ndk.fetchEvents({kinds:r,authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",groupable:!1});s.size<n.length&&(s=await this.ndk.fetchEvents({kinds:r,authors:[this.pubkey]},{cacheUsage:"ONLY_RELAY"}));const o=[],a=Array.from(s).find(l=>l.kind===10019),u=Array.from(s).find(l=>l.kind===0);if(a){const l=NDKCashuMintList.from(a);if(l.mints.length>0&&o.push({type:"nip61",data:{mints:l.mints,relays:l.relays,p2pk:l.p2pk}}),!e)return o}if(u){const l=profileFromEvent(u),{lud06:c,lud16:f}=l;try{const h=await getNip57ZapSpecFromLud({lud06:c,lud16:f},this.ndk);h&&o.push({type:"nip57",data:h})}catch(h){console.error("Error getting NIP-57 zap spec",h)}}return o}async getZapConfiguration(e){if(e??(e=this.ndk),!e)throw new Error("No NDK instance found");const n=async()=>{var s,o,a,u;if((o=(s=this.ndk)==null?void 0:s.cacheAdapter)!=null&&o.loadUsersLNURLDoc){const l=await this.ndk.cacheAdapter.loadUsersLNURLDoc(this.pubkey);if(l!=="missing"){if(l===null)return;if(l)return l}}let r;try{if(await this.fetchProfile({groupable:!1}),this.profile){const{lud06:l,lud16:c}=this.profile;r=await getNip57ZapSpecFromLud({lud06:l,lud16:c},e)}}catch{}if((u=(a=this.ndk)==null?void 0:a.cacheAdapter)!=null&&u.saveUsersLNURLDoc&&this.ndk.cacheAdapter.saveUsersLNURLDoc(this.pubkey,r||null),!!r)return r};return await e.queuesZapConfig.add({id:this.pubkey,func:n})}async getZapperPubkey(){const e=await this.getZapConfiguration();return e==null?void 0:e.nostrPubkey}static async fromNip05(e,n,r=!1){if(!n)throw new Error("No NDK instance found");const s={};r&&(s.cache="no-cache");const o=await getNip05For(n,e,n==null?void 0:n.httpFetch,s);if(o){const a=new De({pubkey:o.pubkey,relayUrls:o.relays,nip46Urls:o.nip46});return a.ndk=n,a}}async fetchProfile(e,n=!1){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});let r=null;if(this.ndk.cacheAdapter&&this.ndk.cacheAdapter.fetchProfile&&(e==null?void 0:e.cacheUsage)!=="ONLY_RELAY"){const a=await this.ndk.cacheAdapter.fetchProfile(this.pubkey);if(a)return this.profile=a,a}!e&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.locking&&(r=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",closeOnEose:!0,groupable:!1}),e={cacheUsage:"ONLY_RELAY",closeOnEose:!0,groupable:!0,groupableDelay:250}),(!r||r.size===0)&&(r=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},e));const s=Array.from(r).sort((a,u)=>a.created_at-u.created_at);if(s.length===0)return null;const o=s[0];return this.profile=profileFromEvent(o),n&&(this.profile.profileEvent=JSON.stringify(o)),this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile}tagReference(){return["p",this.pubkey]}referenceTags(e){const n=[["p",this.pubkey]];return e&&n[0].push("",e),n}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(e,n,r=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,r)),n.has(e))return!1;n.add(e);const s=new NDKEvent(this.ndk,{kind:r});for(const o of n)s.tag(o);return await s.publish(),!0}async unfollow(e,n,r=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,r));const s=new Set;let o=!1;for(const u of n)u.pubkey!==e.pubkey?s.add(u):o=!0;if(!o)return!1;const a=new NDKEvent(this.ndk,{kind:r});for(const u of s)a.tag(u);return await a.publish()}async validateNip05(e){if(!this.ndk)throw new Error("No NDK instance found");const n=await getNip05For(this.ndk,e);return n===null?null:n.pubkey===this.pubkey}async zap(e,n,r,s){return new Promise((o,a)=>{var c;if(!this.ndk){a("No NDK instance found");return}let u=(c=this.ndk.walletConfig)==null?void 0:c.onLnPay;u??(u=async({pr:f})=>{o(f)}),this.ndk.zap(this,e,{comment:n,tags:r,signer:s,onLnPay:u}).zap().then(o).catch(a)})}},NDKList=class Re extends NDKEvent{constructor(n,r){super(n,r);$(this,"_encryptedTags");$(this,"encryptedTagsLength");this.kind??(this.kind=30001)}static from(n){return new Re(n.ndk,n)}get title(){const n=this.tagValue("title")||this.tagValue("name");return n||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(n){this.removeTag(["title","name"]),n&&this.tags.push(["title",n])}get name(){return this.title}set name(n){this.title=n}get description(){return this.tagValue("description")}set description(n){this.removeTag("description"),n&&this.tags.push(["description",n])}get image(){return this.tagValue("image")}set image(n){this.removeTag("image"),n&&this.tags.push(["image",n])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(n=!0){if(n&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const r=await this.ndk.signer.user();try{if(this.content.length>0)try{const s=await this.ndk.signer.decrypt(r,this.content),o=JSON.parse(s);return o&&o[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=o):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{console.log(`error decrypting ${this.content}`)}}catch{}return[]}validateTag(n){return!0}getItems(n){return this.tags.filter(r=>r[0]===n)}get items(){return this.tags.filter(n=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(n[0]))}async addItem(n,r=void 0,s=!1,o="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let a;if(n instanceof NDKEvent)a=[n.tagReference(r)];else if(n instanceof NDKUser)a=n.referenceTags();else if(n instanceof NDKRelay)a=n.referenceTags();else if(Array.isArray(n))a=[n];else throw new Error("Invalid object type");if(r&&a[0].push(r),s){const u=await this.ndk.signer.user(),l=await this.encryptedTags();o==="top"?l.unshift(...a):l.push(...a),this._encryptedTags=l,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(l),await this.encrypt(u)}else o==="top"?this.tags.unshift(...a):this.tags.push(...a);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(n,r=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=this.tags.findIndex(l=>l[1]===n);s>=0&&this.tags.splice(s,1);const o=await this.ndk.signer.user(),a=await this.encryptedTags(),u=a.findIndex(l=>l[1]===n);if(u>=0&&(a.splice(u,1),this._encryptedTags=a,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(a),await this.encrypt(o)),r)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(n,r){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(r){const s=await this.ndk.signer.user(),o=await this.encryptedTags();o.splice(n,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(s)}else this.tags.splice(n,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(n){return this.items.some(r=>r[1]===n)}filterForItems(){const n=new Set,r=new Map,s=[];for(const o of this.items)if(o[0]==="e"&&o[1])n.add(o[1]);else if(o[0]==="a"&&o[1]){const[a,u,l]=o[1].split(":");if(!a||!u)continue;const c=`${a}:${u}`,f=r.get(c)||[];f.push(l||""),r.set(c,f)}if(n.size>0&&s.push({ids:Array.from(n)}),r.size>0)for(const[o,a]of r.entries()){const[u,l]=o.split(":");s.push({kinds:[parseInt(u)],authors:[l],"#d":a})}return s}},lists_default=NDKList,READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class $e extends NDKEvent{constructor(e,n){super(e,n),this.kind??(this.kind=10002)}static from(e){return new $e(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===READ_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set readRelayUrls(e){for(const n of e)this.tags.push(["r",n,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===WRITE_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set writeRelayUrls(e){for(const n of e)this.tags.push(["r",n,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]).map(e=>e[1])}set bothRelayUrls(e){for(const n of e)this.tags.push(["r",n])}get relays(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").map(e=>e[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(e=>this.ndk.pool.getRelay(e))),this.ndk)}};function relayListFromKind3(t,e){try{const n=JSON.parse(e.content),r=new NDKRelayList(t),s=new Set,o=new Set;for(let[a,u]of Object.entries(n)){try{a=normalizeRelayUrl(a)}catch{continue}if(!u)s.add(a),o.add(a);else{const l=u;l.write&&o.add(a),l.read&&s.add(a)}}return r.readRelayUrls=Array.from(s),r.writeRelayUrls=Array.from(o),r}catch{}}var ye,NDKNutzap=(ye=class extends NDKEvent{constructor(n,r){super(n,r);$(this,"debug");$(this,"_proofs",[]);$(this,"sender",this.author);this.kind??(this.kind=9321),this.debug=(n==null?void 0:n.debug.extend("nutzap"))??debug7("ndk:nutzap"),this.alt||(this.alt="This is a nutzap")}static from(n){const r=new this(n.ndk,n);try{const s=r.getMatchingTags("proof");s.length?r._proofs=s.map(o=>JSON.parse(o[1])):r._proofs=JSON.parse(r.content)}catch{return}if(!(!r._proofs||!r._proofs.length))return r}set comment(n){this.content=n??""}get comment(){const n=this.tagValue("comment");return n||this.content}set proofs(n){this._proofs=n,this.tags=this.tags.filter(r=>r[0]!=="proof");for(const r of n)this.tags.push(["proof",JSON.stringify(r)]);this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()])}get proofs(){return this._proofs}get p2pk(){var r;const n=this.proofs[0];try{const s=JSON.parse(n.secret);let o={};if(typeof s=="string"?(o=JSON.parse(s),this.debug("stringified payload",n.secret)):typeof s=="object"&&(o=s),o[0]==="P2PK"&&((r=o[1])==null?void 0:r.data)){const l=o[1].data.slice(2,-1);if(l)return l}}catch(s){this.debug("error parsing p2pk pubkey",s,this.proofs[0])}}get mint(){return this.tagValue("u")}set mint(n){this.removeTag("u"),this.tag(["u",n])}get unit(){return this.tagValue("unit")??"msat"}set unit(n){this.removeTag("unit"),n&&this.tag(["unit",n])}get amount(){return this.proofs.reduce((r,s)=>r+s.amount,0)*1e3}set target(n){this.tags=this.tags.filter(r=>r[0]!=="p"),n instanceof NDKEvent&&this.tags.push()}set recipientPubkey(n){this.removeTag("p"),this.tag(["p",n])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const n=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:n}):new NDKUser({pubkey:n})}get isValid(){let n=0,r=0;for(const s of this.tags)s[0]==="p"&&n++,s[0]==="u"&&r++;return n===1&&r===1&&this.proofs.length>0}},$(ye,"kind",9321),$(ye,"kinds",[ye.kind]),ye);async function payInvoice(t){return await this.sendReq("pay_invoice",{invoice:t})}var NDKPrivateKeySigner=class Ne{constructor(e){$(this,"_user");$(this,"_privateKey");if(e){if(typeof e=="string")if(e.startsWith("nsec1")){const{type:n,data:r}=nip19_exports.decode(e);n==="nsec"&&(this._privateKey=r)}else if(e.length===64)this._privateKey=hexToBytes$1(e);else throw new Error("Invalid private key provided.");else this._privateKey=e;this._privateKey&&(this._user=new NDKUser({pubkey:getPublicKey(this._privateKey)}))}}get privateKey(){if(this._privateKey)return bytesToHex$1(this._privateKey)}static generate(){const e=generateSecretKey();return new Ne(e)}async blockUntilReady(){if(!this._user)throw new Error("NDKUser not initialized");return this._user}async user(){return await this.blockUntilReady(),this._user}async sign(e){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(e,this._privateKey).sig}getConversationKey(e){if(!this._privateKey)throw Error("Attempted to get conversation key without a private key");const n=e.pubkey;return nip44_exports.getConversationKey(this._privateKey,n)}async nip44Encrypt(e,n){const r=this.getConversationKey(e);return await nip44_exports.encrypt(n,r)}async nip44Decrypt(e,n){const r=this.getConversationKey(e);return await nip44_exports.decrypt(n,r)}async encrypt(e,n,r=DEFAULT_ENCRYPTION_SCHEME){return r==="nip44"?this.nip44Encrypt(e,n):this.nip04Encrypt(e,n)}async decrypt(e,n,r=DEFAULT_ENCRYPTION_SCHEME){return r==="nip44"?this.nip44Decrypt(e,n):this.nip04Decrypt(e,n)}async nip04Encrypt(e,n){if(!this._privateKey)throw Error("Attempted to encrypt without a private key");const r=e.pubkey;return await nip04_exports.encrypt(this._privateKey,r,n)}async nip04Decrypt(e,n){if(!this._privateKey)throw Error("Attempted to decrypt without a private key");const r=e.pubkey;return await nip04_exports.decrypt(this._privateKey,r,n)}};async function sendReq(t,e){const n=new NDKEvent(this.ndk,{kind:23194,tags:[["p",this.walletService.pubkey]],content:JSON.stringify({method:t,params:e})});return this.debug("Sending request",n.content),await n.encrypt(this.walletService,this.signer),await n.sign(this.signer),this.debug("Request encrypted and signed"),new Promise(async(r,s)=>{try{const o=n.tagId();if(!o)throw new Error("Failed to get e-tag");const a=l=>{this.off(o,a),this.off("event",a),this.debug("Received response",l);try{const c=JSON.parse(l);c.error&&s(c),r(c)}catch(c){this.debug("Failed to parse response",c),s({result_type:"error",error:{code:"failed_to_parse_response",message:c.message}})}},u=this.ndk.subscribe({kinds:[23195],"#e":[o],limit:1},{groupable:!1,subId:`nwc-${t}`},this.relaySet);u.on("event",async l=>{await l.decrypt(l.author,this.signer),a(l.content),u.stop()}),this.once(o,a),this.once("event",a),this.debug("Sending request to relay",n.rawEvent()),await n.publish(this.relaySet)}catch(o){this.debug("Failed to send request",o,o.relayErrors),s({result_type:"error",error:{code:"failed_to_send_request",message:o.message}})}})}async function getBalance(){return await this.sendReq("get_balance",{})}async function getInfo(){return await this.sendReq("get_info",{})}var NDKNwc=class Me extends libExports.EventEmitter{constructor({ndk:n,pubkey:r,relayUrls:s,secret:o}){super();$(this,"ndk");$(this,"debug");$(this,"walletService");$(this,"relaySet");$(this,"signer");$(this,"active",!1);$(this,"getBalance",getBalance.bind(this));this.ndk=n,this.walletService=n.getUser({pubkey:r}),this.relaySet=new NDKRelaySet(new Set(s.map(a=>n.pool.getRelay(a))),n),this.signer=new NDKPrivateKeySigner(o instanceof Uint8Array?o:hexToBytes$1(o)),this.debug=n.debug.extend("nwc"),this.debug(`Starting with wallet service ${this.walletService.npub}`)}static async fromURI(n,r){const s=new URL(r);if(s.protocol!=="nostr+walletconnect:")throw new Error("Invalid protocol");return new Me({ndk:n,pubkey:s.host??s.pathname,relayUrls:s.searchParams.getAll("relay")??[""],secret:s.searchParams.get("secret")??""})}async blockUntilReady(n){const r=await this.signer.user(),s=new Promise((u,l)=>{setTimeout(()=>{l(new Error("Timeout"))},n)}),a=[new Promise(u=>{const l=this.ndk.subscribe({kinds:[23195],"#p":[r.pubkey],limit:1},{groupable:!1,subId:"nwc"},this.relaySet);l.on("event",async c=>{this.debug("received response",c.rawEvent());const f=c.tagValue("e");if(!f){this.debug("Received an event without an e-tag");return}this.debug("received an event",f);try{await c.decrypt(c.author,this.signer),this.emit(f,c.content)}catch(h){this.debug("Failed to decrypt event",h);return}}),l.on("eose",()=>{this.debug("Subscription ready"),this.active=!0,u()}),l.on("close",()=>{this.debug("Subscription closed"),this.active=!1})})];return n&&a.push(s),await Promise.race(a)}async sendReq(n,r){return await sendReq.call(this,n,r)}async payInvoice(n){return await payInvoice.call(this,n)}async getInfo(){return await getInfo.call(this)}},NDKNip07Signer=class{constructor(t=1e3){$(this,"_userPromise");$(this,"nip04Queue",[]);$(this,"nip04Processing",!1);$(this,"debug");$(this,"waitTimeout");this.debug=debug7("ndk:nip07"),this.waitTimeout=t}async blockUntilReady(){await this.waitForExtension();const t=await window.nostr.getPublicKey();if(!t)throw new Error("User rejected access");return new NDKUser({pubkey:t})}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}async sign(t){return await this.waitForExtension(),(await window.nostr.signEvent(t)).sig}async relays(t){var r,s;await this.waitForExtension();const e=await((s=(r=window.nostr).getRelays)==null?void 0:s.call(r))||{},n=[];for(const o of Object.keys(e))e[o].read&&e[o].write&&n.push(o);return n.map(o=>new NDKRelay(o,t==null?void 0:t.relayAuthDefaultPolicy,t))}async encrypt(t,e,n=DEFAULT_ENCRYPTION_SCHEME){return n==="nip44"?this.nip44Encrypt(t,e):this.nip04Encrypt(t,e)}async decrypt(t,e,n=DEFAULT_ENCRYPTION_SCHEME){return n==="nip44"?this.nip44Decrypt(t,e):this.nip04Decrypt(t,e)}async nip44Encrypt(t,e){return await this.waitForExtension(),await window.nostr.nip44.encrypt(t.pubkey,e)}async nip44Decrypt(t,e){return await this.waitForExtension(),await window.nostr.nip44.decrypt(t.pubkey,e)}async nip04Encrypt(t,e){await this.waitForExtension();const n=t.pubkey;return this.queueNip04("encrypt",n,e)}async nip04Decrypt(t,e){await this.waitForExtension();const n=t.pubkey;return this.queueNip04("decrypt",n,e)}async queueNip04(t,e,n){return new Promise((r,s)=>{this.nip04Queue.push({type:t,counterpartyHexpubkey:e,value:n,resolve:r,reject:s}),this.nip04Processing||this.processNip04Queue()})}async processNip04Queue(t,e=0){if(!t&&this.nip04Queue.length===0){this.nip04Processing=!1;return}this.nip04Processing=!0;const{type:n,counterpartyHexpubkey:r,value:s,resolve:o,reject:a}=t||this.nip04Queue.shift();try{let u;n==="encrypt"?u=await window.nostr.nip04.encrypt(r,s):u=await window.nostr.nip04.decrypt(r,s),o(u)}catch(u){if(u.message&&u.message.includes("call already executing")&&e<5){this.debug("Retrying encryption queue item",{type:n,counterpartyHexpubkey:r,value:s,retries:e}),setTimeout(()=>{this.processNip04Queue(t,e+1)},50*e);return}a(u)}this.processNip04Queue()}waitForExtension(){return new Promise((t,e)=>{if(window.nostr){t();return}let n;const r=setInterval(()=>{window.nostr&&(clearTimeout(n),clearInterval(r),t())},100);n=setTimeout(()=>{clearInterval(r),e(new Error("NIP-07 extension not available"))},this.waitTimeout)})}},NDKPool=class extends libExports.EventEmitter{constructor(e=[],n=[],r,s){super();$(this,"_relays",new Map);$(this,"autoConnectRelays",new Set);$(this,"blacklistRelayUrls");$(this,"debug");$(this,"temporaryRelayTimers",new Map);$(this,"flappingRelays",new Set);$(this,"backoffTimes",new Map);$(this,"ndk");this.debug=s??r.debug.extend("pool"),this.ndk=r,this.relayUrls=e,this.blacklistRelayUrls=new Set(n)}get relays(){return this._relays}set relayUrls(e){this._relays.clear();for(const n of e){const r=new NDKRelay(n,void 0,this.ndk);r.connectivity.netDebug=this.ndk.netDebug,this.addRelay(r,!1)}}set name(e){this.debug=this.debug.extend(e)}useTemporaryRelay(e,n=3e4,r){const s=this.relays.has(e.url);s||(this.addRelay(e),this.debug("Adding temporary relay %s for filters %o",e.url,r));const o=this.temporaryRelayTimers.get(e.url);if(o&&clearTimeout(o),!s||o){const a=setTimeout(()=>{var u;(u=this.ndk.explicitRelayUrls)!=null&&u.includes(e.url)||this.removeRelay(e.url)},n);this.temporaryRelayTimers.set(e.url,a)}}addRelay(e,n=!0){var b,y;const r=this.relays.has(e.url),s=(b=this.blacklistRelayUrls)==null?void 0:b.has(e.url),o=e.url.includes("/npub1");let a=!0;const u=e.url;if(r)return;if(s){this.debug(`Refusing to add relay ${u}: blacklisted`);return}if(o){this.debug(`Refusing to add relay ${u}: is a filter relay`);return}if((y=this.ndk.cacheAdapter)!=null&&y.getRelayStatus){const _=this.ndk.cacheAdapter.getRelayStatus(u);if(_&&_.dontConnectBefore)if(_.dontConnectBefore>Date.now()){const x=_.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${u}: delayed connect for ${x}ms`),setTimeout(()=>{this.addRelay(e,n)},x);return}else a=!1}const l=_=>this.emit("notice",e,_),c=()=>this.handleRelayConnect(u),f=()=>this.handleRelayReady(e),h=()=>this.emit("relay:disconnect",e),p=()=>this.handleFlapping(e),m=_=>this.emit("relay:auth",e,_),g=()=>this.emit("relay:authed",e);e.off("notice",l),e.off("connect",c),e.off("ready",f),e.off("disconnect",h),e.off("flapping",p),e.off("auth",m),e.off("authed",g),e.on("notice",l),e.on("connect",c),e.on("ready",f),e.on("disconnect",h),e.on("flapping",p),e.on("auth",m),e.on("authed",g),e.on("delayed-connect",_=>{var x;(x=this.ndk.cacheAdapter)!=null&&x.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(e.url,{dontConnectBefore:Date.now()+_})}),this.relays.set(u,e),n&&this.autoConnectRelays.add(u),n&&(this.emit("relay:connecting",e),e.connect(void 0,a).catch(_=>{this.debug(`Failed to connect to relay ${u}`,_)}))}removeRelay(e){const n=this.relays.get(e);if(n)return n.disconnect(),this.relays.delete(e),this.autoConnectRelays.delete(e),this.emit("relay:disconnect",n),!0;const r=this.temporaryRelayTimers.get(e);return r&&(clearTimeout(r),this.temporaryRelayTimers.delete(e)),!1}isRelayConnected(e){const n=normalizeRelayUrl(e),r=this.relays.get(n);return r?r.status===5:!1}getRelay(e,n=!0,r=!1,s){let o=this.relays.get(normalizeRelayUrl(e));return o||(o=new NDKRelay(e,void 0,this.ndk),o.connectivity.netDebug=this.ndk.netDebug,r?this.useTemporaryRelay(o,3e4,s):this.addRelay(o,n)),o}handleRelayConnect(e){this.emit("relay:connect",this.relays.get(e)),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(e){this.emit("relay:ready",e)}async connect(e){var s;const n=[];this.debug(`Connecting to ${this.relays.size} relays${e?`, timeout ${e}...`:""}`);const r=new Set(this.autoConnectRelays.keys());(s=this.ndk.explicitRelayUrls)==null||s.forEach(o=>{const a=normalizeRelayUrl(o);r.add(a)});for(const o of r){const a=this.relays.get(o);if(!a)continue;const u=new Promise((l,c)=>(this.emit("relay:connecting",a),a.connect(e).then(l).catch(c)));if(e){const l=new Promise((c,f)=>{setTimeout(()=>f(`Timed out after ${e}ms`),e)});n.push(Promise.race([u,l]).catch(c=>{this.debug(`Failed to connect to relay ${a.url}: ${c??"No reason specified"}`)}))}else n.push(u)}e&&setTimeout(()=>{const o=this.stats().connected===this.relays.size,a=this.stats().connected>0;!o&&a&&this.emit("connect")},e),await Promise.all(n)}checkOnFlappingRelays(){const e=this.flappingRelays.size,n=this.relays.size;if(e/n>=.8)for(const r of this.flappingRelays)this.backoffTimes.set(r,0)}handleFlapping(e){this.debug(`Relay ${e.url} is flapping`);let n=this.backoffTimes.get(e.url)||5e3;n=n*2,this.backoffTimes.set(e.url,n),this.debug(`Backoff time for ${e.url} is ${n}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${e.url}`),this.emit("relay:connecting",e),e.connect(),this.checkOnFlappingRelays()},n),e.disconnect(),this.emit("flapping",e)}size(){return this.relays.size}stats(){const e={total:0,connected:0,disconnected:0,connecting:0};for(const n of this.relays.values())e.total++,n.status===5?e.connected++:n.status===1?e.disconnected++:n.status===4&&e.connecting++;return e}connectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5&&!this.temporaryRelayTimers.has(e.url))}urls(){return Array.from(this.relays.keys())}};function dedup(t,e){return t.created_at>e.created_at?t:e}async function getRelayListForUser(t,e){return(await getRelayListForUsers([t],e)).get(t)}async function getRelayListForUsers(t,e,n=!1){var f;const r=e.outboxPool||e.pool,s=new Set;for(const h of r.relays.values())s.add(h);const o=new Map,a=new Map,u=new NDKRelaySet(s,e);if((f=e.cacheAdapter)!=null&&f.locking&&!n){const h=await e.fetchEvents({kinds:[3,10002],authors:t},{cacheUsage:"ONLY_CACHE"});for(const p of h)p.kind===10002&&o.set(p.pubkey,NDKRelayList.from(p));for(const p of h)if(p.kind===3){if(o.has(p.pubkey))continue;const m=relayListFromKind3(e,p);m&&a.set(p.pubkey,m)}t=t.filter(p=>!o.has(p)&&!a.has(p))}if(t.length===0)return o;const l=new Map,c=new Map;return new Promise(async h=>{const p=e.subscribe({kinds:[3,10002],authors:t},{closeOnEose:!0,pool:r,groupable:!0,cacheUsage:"ONLY_RELAY",subId:"ndk-relay-list-fetch"},u,!1);p.on("event",m=>{if(m.kind===10002){const g=l.get(m.pubkey);if(g&&g.created_at>m.created_at)return;l.set(m.pubkey,m)}else if(m.kind===3){const g=c.get(m.pubkey);if(g&&g.created_at>m.created_at)return;c.set(m.pubkey,m)}}),p.on("eose",()=>{for(const m of l.values())o.set(m.pubkey,NDKRelayList.from(m));for(const m of t){if(o.has(m))continue;const g=c.get(m);if(!g)continue;const b=relayListFromKind3(e,g);b&&o.set(m,b)}h(o)}),p.start()})}var OutboxItem=class{constructor(t){$(this,"type");$(this,"relayUrlScores");$(this,"readRelays");$(this,"writeRelays");this.type=t,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends libExports.EventEmitter{constructor(e){super();$(this,"data");$(this,"ndk");$(this,"debug");this.ndk=e,this.debug=e.debug.extend("outbox-tracker"),this.data=new distExports.LRUCache({maxSize:1e5,entryExpirationTimeInMS:2*60*1e3})}async trackUsers(e,n=!1){const r=[];for(let s=0;s<e.length;s+=400){const a=e.slice(s,s+400).map(u=>getKeyFromItem(u)).filter(u=>!this.data.has(u));if(a.length!==0){for(const u of a)this.data.set(u,new OutboxItem("user"));r.push(new Promise(u=>{getRelayListForUsers(a,this.ndk,n).then(l=>{for(const[c,f]of l){let h=this.data.get(c);if(h??(h=new OutboxItem("user")),f){h.readRelays=new Set(normalize$2(f.readRelayUrls)),h.writeRelays=new Set(normalize$2(f.writeRelayUrls));for(const p of h.readRelays)this.ndk.pool.blacklistRelayUrls.has(p)&&h.readRelays.delete(p);for(const p of h.writeRelays)this.ndk.pool.blacklistRelayUrls.has(p)&&h.writeRelays.delete(p);this.data.set(c,h)}}}).finally(u)}))}}return Promise.all(r)}track(e,n,r=!0){const s=getKeyFromItem(e);n??(n=getTypeFromItem(e));let o=this.data.get(s);return o||(o=new OutboxItem(n),e instanceof NDKUser&&this.trackUsers([e])),o}};function getKeyFromItem(t){return t instanceof NDKUser?t.pubkey:t}function getTypeFromItem(t){return t instanceof NDKUser?"user":"kind"}function correctRelaySet(t,e){const n=e.connectedRelays();if(!Array.from(t.relays).some(s=>n.map(o=>o.url).includes(s.url)))for(const s of n)t.addRelay(s);if(n.length===0)for(const s of e.relays.values())t.addRelay(s);return t}function isValidHint(t){if(!t||t==="")return!1;try{return new URL(t),!0}catch{return!1}}async function fetchEventFromTag(t,e,n,r={type:"timeout"}){const s=this.debug.extend("fetch-event-from-tag"),[o,a,u]=t;n={},s("fetching event from tag",t,n,r);const l=getRelaysForSync(this,e.pubkey);if(l&&l.size>0){s("fetching event from author relays %o",Array.from(l));const b=NDKRelaySet.fromRelayUrls(Array.from(l),this),y=await this.fetchEvent(a,n,b);if(y)return y}else s("no author relays found for %s",e.pubkey,e);const c=calculateRelaySetsFromFilters(this,[{ids:[a]}],this.pool);s("fetching event without relay hint",c);const f=await this.fetchEvent(a,n);if(f)return f;if(u&&u!==""){const b=await this.fetchEvent(a,n,this.pool.getRelay(u,!0,!0,[{ids:[a]}]));if(b)return b}let h;const p=isValidHint(u)?this.pool.getRelay(u,!1,!0,[{ids:[a]}]):void 0,m=new Promise(b=>{this.fetchEvent(a,n,p).then(b)});if(!isValidHint(u)||r.type==="none")return m;const g=new Promise(async b=>{const y=r.relaySet,_=r.timeout??1500,x=new Promise(E=>setTimeout(E,_));if(r.type==="timeout"&&await x,h)b(h);else{s("fallback fetch triggered");const E=await this.fetchEvent(a,n,y);b(E)}});switch(r.type){case"timeout":return Promise.race([m,g]);case"eose":return h=await m,h||g}}var SPEC_PATH="/.well-known/nostr/nip96.json",Nip96=class{constructor(t,e){$(this,"ndk");$(this,"spec");$(this,"url");$(this,"nip98Required",!1);this.url=`https://${t}${SPEC_PATH}`,this.ndk=e}async prepareUpload(t,e="POST"){if(this.validateHttpFetch(),this.spec||await this.fetchSpec(),!this.spec)throw new Error("Failed to fetch NIP96 spec");let n={};return this.nip98Required&&(n={Authorization:await this.generateNip98Header(this.spec.api_url,e,t)}),{url:this.spec.api_url,headers:n}}async xhrUpload(t,e){const n="POST",{url:r,headers:s}=await this.prepareUpload(e,n);t.open(n,r,!0),s.Authorization&&t.setRequestHeader("Authorization",s.Authorization);const o=new FormData;return o.append("file",e),new Promise((a,u)=>{t.onload=function(){t.status>=200&&t.status<300?a(JSON.parse(t.responseText)):u(new Error(t.statusText))},t.onerror=function(){u(new Error("Network Error"))},t.send(o)})}async upload(t){const e="POST",{url:n,headers:r}=await this.prepareUpload(t,e),s=new FormData;s.append("file",t);const o=await this.ndk.httpFetch(this.spec.api_url,{method:e,headers:r,body:s});if(o.status!==200)throw new Error(`Failed to upload file to ${n}`);const a=await o.json();if(a.status!=="success")throw new Error(a.message);return a}validateHttpFetch(){if(!this.ndk)throw new Error("NDK is required to fetch NIP96 spec");if(!this.ndk.httpFetch)throw new Error("NDK must have an httpFetch method to fetch NIP96 spec")}async fetchSpec(){this.validateHttpFetch();const t=await this.ndk.httpFetch(this.url);if(t.status!==200)throw new Error(`Failed to fetch NIP96 spec from ${this.url}`);const e=await t.json();if(!e)throw new Error(`Failed to parse NIP96 spec from ${this.url}`);this.spec=e,this.nip98Required=this.spec.plans.free.is_nip98_required}async generateNip98Header(t,e,n){const r=new NDKEvent(this.ndk,{kind:27235,tags:[["u",t],["method",e]]});if(["POST","PUT","PATCH"].includes(e)){const o=await this.calculateSha256(n);r.tags.push(["payload",o])}return await r.sign(),`Nostr ${btoa(JSON.stringify(r.rawEvent()))}`}async calculateSha256(t){const e=await t.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}},Queue=class{constructor(t,e){$(this,"queue",[]);$(this,"maxConcurrency");$(this,"processing",new Set);$(this,"promises",new Map);this.maxConcurrency=e}add(t){if(this.promises.has(t.id))return this.promises.get(t.id);const e=new Promise((n,r)=>{this.queue.push({...t,func:()=>t.func().then(s=>(n(s),s),s=>{throw r(s),s})}),this.process()});return this.promises.set(t.id,e),e.finally(()=>{this.promises.delete(t.id),this.processing.delete(t.id),this.process()}),e}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const t=this.queue.shift();!t||this.processing.has(t.id)||(this.processing.add(t.id),t.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},NDKSubscriptionManager=class{constructor(t){$(this,"subscriptions");$(this,"seenEvents",new Map);$(this,"debug");this.subscriptions=new Map,this.debug=t.extend("sub-manager")}add(t){this.subscriptions.set(t.internalId,t),t.on("close",()=>{this.subscriptions.delete(t.internalId)})}seenEvent(t,e){const n=this.seenEvents.get(t)||[];n.push(e),this.seenEvents.set(t,n)}},debug6=debug7("ndk:active-user");async function getUserRelayList(t){if(!this.autoConnectUserRelays)return;const e=await getRelayListForUser(t.pubkey,this);if(e){for(const n of e.relays){let r=this.pool.relays.get(n);r||(r=new NDKRelay(n,this.relayAuthDefaultPolicy,this),this.pool.addRelay(r))}return e}}async function setActiveUser(t){const e=this.outboxPool||this.pool;e.connectedRelays.length>0?setActiveUserConnected.call(this,t):e.once("connect",()=>{setActiveUserConnected.call(this,t)})}async function setActiveUserConnected(t){const e=await getUserRelayList.call(this,t),n=[{kinds:[10006],authors:[t.pubkey]}];this.autoFetchUserMutelist&&n[0].kinds.push(1e4);const r=e?e.relaySet:void 0,s=this.subscribe(n,{subId:"active-user-settings",closeOnEose:!0},r,!1),o=new Map;s.on("event",a=>{const u=o.get(a.kind);u&&u.created_at>=a.created_at||o.set(a.kind,a)}),s.on("eose",()=>{for(const a of o.values())processEvent.call(this,a)}),s.start()}async function processEvent(t){t.kind===10006?processBlockRelayList.call(this,t):t.kind===1e4&&processMuteList.call(this,t)}function processBlockRelayList(t){const e=lists_default.from(t);for(const n of e.items)this.pool.blacklistRelayUrls.add(n[0]);debug6("Added %d relays to relay blacklist",e.items.length)}function processMuteList(t){const e=lists_default.from(t);for(const n of e.items)this.mutedIds.set(n[1],n[0]);debug6("Added %d users to mute list",e.items.length)}async function generateZapRequest(t,e,n,r,s,o,a,u,l){const c=n.callback,f=nip57_exports.makeZapRequest({profile:r,event:null,amount:s,comment:a||"",relays:o.slice(0,4)});if(t instanceof NDKEvent){const m=t.referenceTags().filter(g=>g[0]!=="p");f.tags.push(...m)}f.tags.push(["lnurl",c]);const h=new NDKEvent(e,f);return u&&(h.tags=h.tags.concat(u)),h.tags=h.tags.filter(p=>p[0]!=="p"),h.tags.push(["p",r]),await h.sign(l),h}var d3=debug7("ndk:zapper"),NDKZapper=class extends libExports.EventEmitter{constructor(e,n,r="msat",s,o,a,u){super();$(this,"target");$(this,"ndk");$(this,"comment");$(this,"amount");$(this,"unit");$(this,"tags");$(this,"signer");$(this,"zapMethod");$(this,"onLnPay");$(this,"onCashuPay");$(this,"onComplete");$(this,"maxRelays",3);if(this.target=e,this.ndk=o||e.ndk,!this.ndk)throw new Error("No NDK instance provided");this.amount=n,this.comment=s,this.unit=r,this.tags=a,this.signer=u}async zap(){const e=this.getZapSplits(),n=new Map;return await Promise.all(e.map(async r=>{let s;try{s=await this.zapSplit(r)}catch(o){s=o}this.emit("split:complete",r,s),n.set(r,s)})),this.emit("complete",n),this.onComplete&&this.onComplete(n),n}async zapSplit(e){let n=await this.getZapMethods(this.ndk,e.pubkey),r;if(n.length===0)throw new Error("No zap method available for recipient");n=n.sort((o,a)=>o.type==="nip61"?-1:a.type==="nip61"?1:0);const s=await this.relays(e.pubkey);for(const o of n){d3("Zapping to %s with %d %s using %s",e.pubkey,e.amount,this.unit,o.type);try{switch(o.type){case"nip61":{const a=o.data;let u;if(u=await this.onCashuPay({target:this.target,comment:this.comment,tags:this.tags,recipientPubkey:e.pubkey,amount:e.amount,unit:this.unit,...a}),d3("NIP-61 Zap result: %o",u),u instanceof Error)r=u;else if(u){const{proofs:l,mint:c}=u;if(!l||!c)throw new Error("Invalid zap confirmation: missing proofs or mint: "+u);const f=NDKRelaySet.fromRelayUrls(s,this.ndk),h=new NDKNutzap(this.ndk);return h.tags=[...h.tags,...this.tags||[]],h.proofs=l,h.mint=c,h.comment=this.comment,h.unit=this.unit,h.recipientPubkey=e.pubkey,await h.sign(this.signer),await h.publish(f),h}break}case"nip57":{const a=o.data,u=await generateZapRequest(this.target,this.ndk,a,e.pubkey,e.amount,s,this.comment,this.tags,this.signer);if(!u)throw d3("Unable to generate zap request"),new Error("Unable to generate zap request");const l=await this.getLnInvoice(u,e.amount,a);if(!l)throw d3("Unable to get payment request"),new Error("Unable to get payment request");r=await this.onLnPay({target:this.target,comment:this.comment,recipientPubkey:e.pubkey,amount:e.amount,unit:this.unit,pr:l});break}}}catch(a){a instanceof Error?r=a:r=new Error(a),d3("Error zapping to %s with %d %s using %s: %o",e.pubkey,e.amount,this.unit,o.type,a)}}if(r instanceof Error)throw r;return r}async getLnInvoice(e,n,r){const s=r.callback,o=JSON.stringify(e.rawEvent());d3(`Fetching invoice from ${s}?`+new URLSearchParams({amount:n.toString(),nostr:o}));const a=new URL(s);a.searchParams.append("amount",n.toString()),a.searchParams.append("nostr",o),d3(`Fetching invoice from ${a.toString()}`);const u=await fetch(a.toString());if(d3(`Got response from zap endpoint: ${s}`,{status:u.status}),u.status!==200){d3(`Received non-200 status from zap endpoint: ${s}`,{status:u.status,amount:n,nostr:o});const c=await u.text();throw new Error(`Unable to fetch zap endpoint ${s}: ${c}`)}return(await u.json()).pr}getZapSplits(){if(this.target instanceof NDKUser)return[{pubkey:this.target.pubkey,amount:this.amount}];const e=this.target.getMatchingTags("zap");if(e.length===0)return[{pubkey:this.target.pubkey,amount:this.amount}];const n=[],r=e.reduce((s,o)=>s+parseInt(o[2]),0);for(const s of e){const o=s[1],a=Math.floor(parseInt(s[2])/r*this.amount);n.push({pubkey:o,amount:a})}return n}async getZapMethods(e,n){const r=[];r.push("nip61"),r.push("nip57");const s=e.getUser({pubkey:n}),o=await s.getZapInfo(!1,r);return d3("Zap info for %s: %o",s.npub,o),o}async relays(e){var r,s,o;let n=[];if((r=this.ndk)!=null&&r.activeUser){const a=await getRelayListForUsers([this.ndk.activeUser.pubkey,e],this.ndk),u=new Map;for(const l of a.values())for(const c of l.readRelayUrls){const f=u.get(c)||0;u.set(c,f+1)}n=Array.from(u.entries()).sort((l,c)=>c[1]-l[1]).map(([l])=>l).slice(0,this.maxRelays)}return(o=(s=this.ndk)==null?void 0:s.pool)!=null&&o.permanentAndConnectedRelays().length&&(n=this.ndk.pool.permanentAndConnectedRelays().map(a=>a.url)),n.length||(n=[]),n}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],DEFAULT_BLACKLISTED_RELAYS=["wss://brb.io/","wss://nostr.mutinywallet.com/"],NDK=class extends libExports.EventEmitter{constructor(e={}){super();$(this,"_explicitRelayUrls");$(this,"pool");$(this,"outboxPool");$(this,"_signer");$(this,"_activeUser");$(this,"cacheAdapter");$(this,"debug");$(this,"devWriteRelaySet");$(this,"outboxTracker");$(this,"mutedIds");$(this,"clientName");$(this,"clientNip89");$(this,"queuesZapConfig");$(this,"queuesNip05");$(this,"asyncSigVerification",!1);$(this,"initialValidationRatio",1);$(this,"lowestValidationRatio",1);$(this,"validationRatioFn");$(this,"subManager");$(this,"publishingFailureHandled",!1);$(this,"relayAuthDefaultPolicy");$(this,"httpFetch");$(this,"netDebug");$(this,"autoConnectUserRelays",!0);$(this,"autoFetchUserMutelist",!0);$(this,"walletConfig");$(this,"fetchEventFromTag",fetchEventFromTag.bind(this));this.debug=e.debug||debug7("ndk"),this.netDebug=e.netDebug,this._explicitRelayUrls=e.explicitRelayUrls||[],this.subManager=new NDKSubscriptionManager(this.debug),this.pool=new NDKPool(e.explicitRelayUrls||[],e.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this),this.pool.name="main",this.pool.on("relay:auth",async(n,r)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(n,r)}),this.autoConnectUserRelays=e.autoConnectUserRelays??!0,this.autoFetchUserMutelist=e.autoFetchUserMutelist??!0,this.clientName=e.clientName,this.clientNip89=e.clientNip89,this.relayAuthDefaultPolicy=e.relayAuthDefaultPolicy,e.enableOutboxModel&&(this.outboxPool=new NDKPool(e.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,e.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this,this.debug.extend("outbox-pool")),this.outboxPool.name="outbox",this.outboxTracker=new OutboxTracker(this)),this.signer=e.signer,this.cacheAdapter=e.cacheAdapter,this.mutedIds=e.mutedIds||new Map,e.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet.fromRelayUrls(e.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue("zaps",3),this.queuesNip05=new Queue("nip05",10),this.signatureVerificationWorker=e.signatureVerificationWorker,this.initialValidationRatio=e.initialValidationRatio||1,this.lowestValidationRatio=e.lowestValidationRatio||1;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(e){this._explicitRelayUrls=e,this.pool.relayUrls=e}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(e){this.asyncSigVerification=!!e,e&&signatureVerificationInit(e)}addExplicitRelay(e,n,r=!0){let s;return typeof e=="string"?s=new NDKRelay(e,n,this):s=e,this.pool.addRelay(s,r),this.explicitRelayUrls.push(s.url),s}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(e){var r;const n=((r=this._activeUser)==null?void 0:r.pubkey)!==(e==null?void 0:e.pubkey);this._activeUser=e,e&&n?setActiveUser.call(this,e):e||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(e){this._signer=e,e&&this.emit("signer:ready",e),e==null||e.user().then(n=>{n.ndk=this,this.activeUser=n})}async connect(e){var r,s;this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await((s=(r=this._signer).relays)==null?void 0:s.call(r,this))),this._signer.relays&&(await this._signer.relays(this)).forEach(a=>this.pool.addRelay(a)));const n=[this.pool.connect(e)];return this.outboxPool&&n.push(this.outboxPool.connect(e)),this.debug("Connecting to relays %o",{timeoutMs:e}),Promise.allSettled(n).then(()=>{})}getUser(e){const n=new NDKUser(e);return n.ndk=this,n}async getUserFromNip05(e,n=!1){return NDKUser.fromNip05(e,this,n)}subscribe(e,n,r,s=!0){var a;const o=new NDKSubscription(this,e,n,r);if(this.subManager.add(o),r)for(const u of r.relays)this.pool.useTemporaryRelay(u,void 0,o.filters);if(this.outboxPool&&o.hasAuthorsFilter()){const u=o.filters.filter(l=>{var c;return l.authors&&((c=l.authors)==null?void 0:c.length)>0}).map(l=>l.authors).flat();(a=this.outboxTracker)==null||a.trackUsers(u)}return s&&setTimeout(()=>o.start(),0),o}async publish(e,n,r){return this.debug("Deprecated: Use `event.publish()` instead"),e.publish(n,r)}async fetchEvent(e,n,r){let s,o;if(r instanceof NDKRelay?o=new NDKRelaySet(new Set([r]),this):r instanceof NDKRelaySet&&(o=r),!r&&typeof e=="string"&&!isNip33AValue(e)){const a=relaysFromBech32(e,this);a.length>0&&(o=new NDKRelaySet(new Set(a),this),o=correctRelaySet(o,this.pool))}if(typeof e=="string"?s=[filterFromId(e)]:Array.isArray(e)?s=e:s=[e],s.length===0)throw new Error(`Invalid filter: ${JSON.stringify(e)}`);return new Promise(a=>{let u=null;const l=this.subscribe(s,{...n||{},closeOnEose:!0},o,!1),c=setTimeout(()=>{l.stop(),a(u)},1e4);l.on("event",f=>{f.ndk=this,f.isReplaceable()?(!u||u.created_at<f.created_at)&&(u=f):(clearTimeout(c),a(f))}),l.on("eose",()=>{clearTimeout(c),a(u)}),l.start()})}async fetchEvents(e,n,r){return new Promise(s=>{const o=new Map,a=this.subscribe(e,{...n||{},closeOnEose:!0},r,!1),u=l=>{l instanceof NDKEvent||(l=new NDKEvent(void 0,l));const c=l.deduplicationKey(),f=o.get(c);f&&(l=dedup(f,l)),l.ndk=this,o.set(c,l)};a.on("event",u),a.on("eose",()=>{s(new Set(o.values()))}),a.start()})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getNip96(e){return new Nip96(e,this)}async nwc(e,n=2e3){const r=await NDKNwc.fromURI(this,e);return n!==!1&&await r.blockUntilReady(n),r}zap(e,n,{comment:r,unit:s,signer:o,tags:a,onLnPay:u,onCashuPay:l,onComplete:c}){var h,p,m;o||this.assertSigner();const f=new NDKZapper(e,n,s,r,this,a,o);return u!==!1&&(f.onLnPay=u??((h=this.walletConfig)==null?void 0:h.onLnPay)),l!==!1&&(f.onCashuPay=l??((p=this.walletConfig)==null?void 0:p.onCashuPay)),f.onComplete=c??((m=this.walletConfig)==null?void 0:m.onPaymentComplete),u&&f.zap(),f}};const STORAGE_KEY="nostr_kanban_login",DEFAULT_RELAYS=["wss://relay.damus.io","wss://relay.nostr.band","wss://nos.lol"],_e=class _e{constructor(){$(this,"_ndk",null);$(this,"state",writable({user:null,loginMethod:null,isReady:!1}));this.tryAutoLogin()}async tryAutoLogin(){const e=this.getStoredLoginData();if(e)try{switch(e.loginMethod){case"nsec":e.nsec&&await this.loginWithNsec(e.nsec);break;case"npub":e.npub&&await this.loginWithNpub(e.npub);break;case"nip07":await this.loginWithNip07();break;case"readonly":await this.loginReadOnly();break}}catch(n){console.error("Auto-login failed:",n),this.clearStoredLoginData()}}storeLoginData(e){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(e))}catch(n){console.error("Failed to store login data:",n)}}getStoredLoginData(){try{const e=localStorage.getItem(STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("Failed to retrieve login data:",e),null}}clearStoredLoginData(){try{localStorage.removeItem(STORAGE_KEY)}catch(e){console.error("Failed to clear login data:",e)}}static getInstance(){return _e.instance||(_e.instance=new _e),_e.instance}get ndk(){return this._ndk}get store(){return{subscribe:this.state.subscribe}}async initNDK(e,n){console.log("Initializing NDK with customRelays: ",n);const r=n||DEFAULT_RELAYS;this._ndk=new NDK({explicitRelayUrls:r,signer:e}),await this._ndk.connect()}async loginWithNsec(e){try{const n=new NDKPrivateKeySigner(e);if(await this.initNDK(n),!this._ndk)throw new Error("NDK not initialized");const r=await n.user();await r.fetchProfile(),this.state.set({user:r,loginMethod:"nsec",isReady:!0}),this.storeLoginData({loginMethod:"nsec",nsec:e,npub:r.npub})}catch(n){throw console.error("Failed to login with nsec:",n),n}}async loginWithNpub(e){try{if(await this.initNDK(),!this._ndk)throw new Error("NDK not initialized");const n=this._ndk.getUser({npub:e});this.state.set({user:n,loginMethod:"npub",isReady:!0}),this.storeLoginData({loginMethod:"npub",npub:e})}catch(n){throw console.error("Failed to login with npub:",n),n}}async resolveNip07Extension(){await(async()=>{for(console.log("waiting for window.nostr");!window.hasOwnProperty("nostr");)await new Promise(e=>setTimeout(e,1e3));for(console.log("waiting for window.nostr.getRelays");!window.nostr.hasOwnProperty("getRelays");)await new Promise(e=>setTimeout(e,1e3));console.log("Found nostr extension")})()}async loginWithNip07(){var e;try{const n=new NDKNip07Signer;let r;try{await this.resolveNip07Extension();const o=await((e=window.nostr)==null?void 0:e.getRelays());o&&Object.keys(o).length>0&&(r=Object.keys(o),console.log("Using relays from NIP-07 extension:",r))}catch(o){console.warn("Failed to get relays from NIP-07 extension:",o),console.log("Falling back to default relays")}if(console.log("Relays: "+r),await this.initNDK(n,r),!this._ndk)throw new Error("NDK not initialized");const s=await n.user();this.state.set({user:s,loginMethod:"nip07",isReady:!0}),this.storeLoginData({loginMethod:"nip07",npub:s.npub})}catch(n){throw console.error("Failed to login with NIP-07:",n),n}}async loginReadOnly(){try{const e=NDKPrivateKeySigner.generate();if(await this.initNDK(e),!this._ndk)throw new Error("NDK not initialized");const n=await e.user();this.state.set({user:n,loginMethod:"readonly",isReady:!0}),this.storeLoginData({loginMethod:"readonly",npub:n.npub})}catch(e){throw console.error("Failed to create read-only session:",e),e}}async logout(){this._ndk=null,this.state.set({user:null,loginMethod:null,isReady:!1}),this.clearStoredLoginData()}canWrite(){const e=this.getCurrentState();return e.loginMethod==="nsec"||e.loginMethod==="nip07"}getCurrentState(){let e={user:null,loginMethod:null,isReady:!1};return this.state.subscribe(n=>{e=n})(),e}};$(_e,"instance");let NDKInstance=_e;const ndkInstance=NDKInstance.getInstance();var root_1$8=template('<div class="input-group svelte-znnxpt"><input type="password" placeholder="Enter your nsec..." class="svelte-znnxpt"></div>'),root_2$6=template('<div class="input-group svelte-znnxpt"><input type="text" placeholder="Enter your npub..." class="svelte-znnxpt"></div>'),root_3$6=template('<div class="error svelte-znnxpt"> </div>'),root$c=template('<div class="login-container svelte-znnxpt"><h1 class="svelte-znnxpt">Kanbanstr</h1> <h2 class="svelte-znnxpt">Login</h2> <div class="method-selector svelte-znnxpt"><label class="svelte-znnxpt"><input type="radio"> Read-only Mode (Generate temporary keys)</label> <label class="svelte-znnxpt"><input type="radio"> Login with nsec</label> <label class="svelte-znnxpt"><input type="radio"> Login with npub (Read-only)</label> <label class="svelte-znnxpt"><input type="radio"> Login with Browser Extension</label></div> <!> <!> <!> <button class="svelte-znnxpt"> </button></div>');function Login(t,e){push$1(e,!1);const n=[];let r=mutable_state("readonly"),s=mutable_state(""),o=mutable_state(""),a=mutable_state(""),u=mutable_state(!1);async function l(){set(u,!0),set(a,"");try{switch(get$1(r)){case"nsec":if(!get$1(s).trim())throw new Error("Please enter your nsec");await ndkInstance.loginWithNsec(get$1(s));break;case"npub":if(!get$1(o).trim())throw new Error("Please enter your npub");await ndkInstance.loginWithNpub(get$1(o));break;case"nip07":await ndkInstance.loginWithNip07();break;case"readonly":await ndkInstance.loginReadOnly();break}}catch(C){set(a,C instanceof Error?C.message:"Failed to login")}finally{set(u,!1)}}init();var c=root$c(),f=sibling(child(c),4),h=child(f),p=child(h);p.value=(p.__value="readonly")==null?"":"readonly";var m=sibling(h,2),g=child(m);g.value=(g.__value="nsec")==null?"":"nsec";var b=sibling(m,2),y=child(b);y.value=(y.__value="npub")==null?"":"npub";var _=sibling(b,2),x=child(_);x.value=(x.__value="nip07")==null?"":"nip07";var E=sibling(f,2);{var A=C=>{var R=root_1$8(),M=child(R);bind_value(M,()=>get$1(s),I=>set(s,I)),append(C,R)};if_block(E,C=>{get$1(r)==="nsec"&&C(A)})}var v=sibling(E,2);{var w=C=>{var R=root_2$6(),M=child(R);bind_value(M,()=>get$1(o),I=>set(o,I)),append(C,R)};if_block(v,C=>{get$1(r)==="npub"&&C(w)})}var k=sibling(v,2);{var S=C=>{var R=root_3$6(),M=child(R);template_effect(()=>set_text(M,get$1(a))),append(C,R)};if_block(k,C=>{get$1(a)&&C(S)})}var T=sibling(k,2),O=child(T);template_effect(()=>{T.disabled=get$1(u),set_text(O,get$1(u)?"Logging in...":"Login")}),bind_group(n,[],p,()=>get$1(r),C=>set(r,C)),bind_group(n,[],g,()=>get$1(r),C=>set(r,C)),bind_group(n,[],y,()=>get$1(r),C=>set(r,C)),bind_group(n,[],x,()=>get$1(r),C=>set(r,C)),event("click",T,l),append(t,c),pop()}function createKanbanStore(){const{subscribe:t,set:e,update:n}=writable({boards:[],cards:new Map,loading:!1,currentUser:null,error:null});let r;function s(){return r!==void 0}function o(b){if(!b)throw new Error("NDK instance is required");r=b}async function a(){n(b=>({...b,loading:!0,error:null}));try{const b={kinds:[30301],limit:50},y=await r.fetchEvents(b),_=[];for(const x of y)try{const E=JSON.parse(x.content),A=x.tags.find(w=>w[0]==="title"),v=x.tags.find(w=>w[0]==="d");_.push({id:v?v[1]:x.id,pubkey:x.pubkey,title:A?A[1]:"Untitled Board",description:E.description,columnMapping:E.columnMapping||"EXACT",columns:E.columns})}catch(E){console.error("Failed to parse board event:",E)}console.log("Loaded boards:",_),n(x=>({...x,boards:_,loading:!1}))}catch(b){const y=b instanceof Error?b.message:"Failed to load boards";throw n(_=>({..._,loading:!1,error:y})),b}}async function u(b){try{const y={kinds:[30301],"#d":[b]},_=await r.fetchEvents(y),x=Array.from(_)[0];if(!x){console.error("Board not found");return}const E=x.tags.filter(k=>k[0]==="a").map(k=>{const[S,T,O]=k[1].split(":");return{kind:S,pubkey:T,identifier:O}});if(E.length===0){n(k=>{const S=new Map(k.cards);return S.set(b,[]),{...k,cards:S}});return}const A={kinds:[30302],authors:E.map(k=>k.pubkey),"#d":E.map(k=>k.identifier)},v=await r.fetchEvents(A),w=[];for(const k of v)try{const S=JSON.parse(k.content),T=k.tags.find(R=>R[0]==="title"),O=k.tags.find(R=>R[0]==="d"),C=O?O[1]:void 0;w.push({pubkey:k.pubkey,id:C,title:T?T[1]:"Untitled Card",description:S.description,status:S.status,order:S.order,attachments:S.attachments||[]})}catch(S){console.error("Failed to parse card event:",S)}n(k=>{const S=new Map(k.cards);return S.set(b,w),{...k,cards:S}})}catch(y){console.error("Failed to load cards:",y)}}async function l(b,y,_){try{const x=new NDKEvent(r);x.kind=30301,x.content=JSON.stringify({description:y,columnMapping:"EXACT",columns:_}),x.tags=[["d",crypto.randomUUID()],["title",b]],await x.publish(),console.log("Board created successfully"),await a()}catch(x){throw console.error("Failed to create board:",x),x}}async function c(b,y){var _;try{const x={kinds:[30301],"#d":[b]},E=await r.fetchEvents(x),A=Array.from(E)[0];if(!A)throw new Error("Board not found");const v=await((_=r.signer)==null?void 0:_.user());if(!v)throw new Error("User not found");if(v.pubkey!==A.pubkey)throw new Error("User does not have permission to update this board");const w=new NDKEvent(r);w.kind=30302;const k={status:y.status,description:y.description,order:y.order,attachments:y.attachments||[]},S=crypto.randomUUID();w.content=JSON.stringify(k),w.tags=[["d",S],["title",y.title]],await w.publish();const T=new NDKEvent(r);T.kind=30301,T.content=A.content,T.tags=[...A.tags.filter(C=>C[0]!=="a"),["a",`30302:${w.pubkey}:${S}`]];const O=A.tags.filter(C=>C[0]==="a");T.tags.push(...O),await T.publish(),n(C=>{const R=new Map(C.cards),M=R.get(b)||[];return M.push({id:S,pubkey:w.pubkey,title:y.title,description:y.description,status:y.status,order:y.order,attachments:y.attachments}),R.set(b,M),{...C,cards:R}})}catch(x){throw console.error("Failed to create card:",x),x}}async function f(b){const y={kinds:[30302],"#d":[b]},_=await r.fetchEvents(y);if(_.size>0)return Array.from(_)[0]}function h(b,y,_,x){const E=b.filter(w=>w.status===_&&w.id!==y).sort((w,k)=>w.order-k.order);if(E.length===0)return 10;if(x===0)return E[0].order-10;if(x>=E.length)return E[E.length-1].order+10;const A=E[x-1],v=E[x];return A.order+(v.order-A.order)/2}async function p(b,y,_){var x;try{console.log("Updating card with id: ",y.id);const E=await((x=r.signer)==null?void 0:x.user());if(!E)throw new Error("User not found");if(E.pubkey!==y.pubkey)throw new Error("User does not have permission to update this board");const A=await f(y.id);if(!A)throw new Error("Card not found");let v=y.order;if(_!==void 0){const S=get(kanbanStore).cards.get(b)||[];v=h(S,y.id,y.status,_)}const w={status:y.status,description:y.description,order:v,attachments:y.attachments||[]};A.content=JSON.stringify(w),A.tags=[["d",A.tags.find(k=>k[0]==="d")[1]],["title",y.title]],await A.publishReplaceable(),n(k=>{const S=new Map(k.cards),T=S.get(b)||[],O=T.findIndex(C=>C.id===y.id);return O!==-1&&(T[O]={...y,order:v}),S.set(b,T),{...k,cards:S}})}catch(E){throw console.error("Failed to update card:",E),E}}async function m(b,y){try{const _={kinds:[30301],authors:[b],"#d":[y]},x=await r.fetchEvents(_);let E=null;for await(const A of x)try{const v=JSON.parse(A.content),w=A.tags.find(S=>S[0]==="title"),k=A.tags.find(S=>S[0]==="d");E={id:k?k[1]:A.id,pubkey:A.pubkey,title:w?w[1]:"Untitled Board",description:v.description,columnMapping:v.columnMapping||"EXACT",columns:v.columns};break}catch(v){console.error("Failed to parse board event:",v)}return E&&await u(E.id),E}catch(_){throw console.error("Failed to load board:",_),_}}async function g(b){var y;try{const _=await((y=r.signer)==null?void 0:y.user());if(!_)throw new Error("User not found");if(_.pubkey!==b.pubkey)throw new Error("User does not have permission to update this board");const x={kinds:[30301],authors:[b.pubkey],"#d":[b.id]},E=await r.fetchEvents(x),A=Array.from(E)[0];if(!A)throw new Error("Board not found");const v=JSON.parse(A.content);v.description=b.description;const w=new NDKEvent(r);w.kind=30301,w.content=JSON.stringify({columns:b.columns,columnMapping:b.columnMapping,description:b.description}),w.tags=[["d",b.id],["title",b.title]];const k=A.tags.filter(S=>S[0]==="a");w.tags.push(...k),await w.publishReplaceable(),n(S=>({...S,boards:S.boards.map(T=>T.id===b.id?b:T)}))}catch(_){throw console.error("Failed to update board:",_),_}}return{subscribe:t,init:o,loadBoards:a,loadCardsForBoard:u,createBoard:l,createCard:c,loadBoardByPubkeyAndId:m,updateBoard:g,updateCard:p,hasNDK:s}}const kanbanStore=createKanbanStore();var root_2$5=template('<button type="button" class="remove-btn svelte-1i6ocnc">&times;</button>'),root_1$7=template('<div class="column-item svelte-1i6ocnc"><span> </span> <!></div>'),root$b=template('<div class="modal-backdrop svelte-1i6ocnc"><div class="modal svelte-1i6ocnc"><header class="svelte-1i6ocnc"><h2 class="svelte-1i6ocnc">Create New Board</h2> <button class="close-btn svelte-1i6ocnc">&times;</button></header> <form><div class="form-group svelte-1i6ocnc"><label for="name" class="svelte-1i6ocnc">Board Name</label> <input id="name" placeholder="Enter board name" required class="svelte-1i6ocnc"></div> <div class="form-group svelte-1i6ocnc"><label for="description" class="svelte-1i6ocnc">Description</label> <textarea id="description" placeholder="Enter board description" rows="3" class="svelte-1i6ocnc"></textarea></div> <div class="form-group svelte-1i6ocnc"><label class="svelte-1i6ocnc">Columns</label> <div class="columns-list svelte-1i6ocnc"></div> <div class="add-column svelte-1i6ocnc"><input placeholder="New column name" class="svelte-1i6ocnc"> <button type="button" class="svelte-1i6ocnc">Add Column</button></div></div> <div class="actions svelte-1i6ocnc"><button type="button" class="cancel svelte-1i6ocnc">Cancel</button> <button type="submit" class="create svelte-1i6ocnc">Create Board</button></div></form></div></div>');function CreateBoard(t,e){push$1(e,!1);let n=prop(e,"onClose",8),r=mutable_state(""),s=mutable_state(""),o=mutable_state([{id:crypto.randomUUID(),name:"To Do",order:0},{id:crypto.randomUUID(),name:"In Progress",order:1},{id:crypto.randomUUID(),name:"Done",order:2}]),a=mutable_state("");async function u(){get$1(r).trim()&&(await kanbanStore.createBoard(get$1(r),get$1(s),get$1(o)),n()())}function l(){get$1(a).trim()&&(set(o,[...get$1(o),{id:crypto.randomUUID(),name:get$1(a),order:get$1(o).length}]),set(a,""))}function c(O){set(o,get$1(o).filter((C,R)=>R!==O)),set(o,get$1(o).map((C,R)=>({...C,order:R})))}init();var f=root$b(),h=child(f),p=child(h),m=sibling(child(p),2),g=sibling(p,2),b=child(g),y=sibling(child(b),2),_=sibling(b,2),x=sibling(child(_),2),E=sibling(_,2),A=sibling(child(E),2);each(A,7,()=>get$1(o),O=>O.id,(O,C,R)=>{var M=root_1$7(),I=child(M),D=child(I),N=sibling(I,2);{var F=z=>{var U=root_2$5();event("click",U,()=>c(get$1(R))),append(z,U)};if_block(N,z=>{get$1(o).length>1&&z(F)})}template_effect(()=>set_text(D,get$1(C).name)),append(O,M)});var v=sibling(A,2),w=child(v),k=sibling(w,2),S=sibling(E,2),T=child(S);event("click",m,function(...O){var C;(C=n())==null||C.apply(this,O)}),bind_value(y,()=>get$1(r),O=>set(r,O)),bind_value(x,()=>get$1(s),O=>set(s,O)),bind_value(w,()=>get$1(a),O=>set(a,O)),event("keydown",w,O=>O.key==="Enter"&&l()),event("click",k,l),event("click",T,function(...O){var C;(C=n())==null||C.apply(this,O)}),event("submit",g,preventDefault(u)),event("click",h,stopPropagation(function(O){bubble_event.call(this,e,O)})),event("click",f,function(...O){var C;(C=n())==null||C.apply(this,O)}),append(t,f),pop()}var root$a=template('<div class="modal-backdrop svelte-cjtpoy"><div class="modal-content svelte-cjtpoy"><div class="error-icon svelte-cjtpoy"></div> <p class="svelte-cjtpoy"> </p> <button class="svelte-cjtpoy">Close</button></div></div>');function AlertModal(t,e){let n=prop(e,"message",8),r=prop(e,"onClose",8);var s=root$a(),o=child(s),a=sibling(child(o),2),u=child(a),l=sibling(a,2);template_effect(()=>set_text(u,n())),event("click",l,function(...c){var f;(f=r())==null||f.apply(this,c)}),event("click",o,stopPropagation(function(c){bubble_event.call(this,e,c)})),event("click",s,function(...c){var f;(f=r())==null||f.apply(this,c)}),append(t,s)}var root_1$6=template('<span class="read-only-badge svelte-1xvziw6">Read Only</span>'),root_2$4=template('<button class="svelte-1xvziw6">Create Board</button>'),root_3$5=template('<div class="loading">Loading...</div>'),root_5$2=template('<div class="empty"><p> </p></div>'),root_8=template('<input type="text" class="svelte-1xvziw6">'),root_9=template('<h3 class="svelte-1xvziw6"> </h3> <button class="edit-button svelte-1xvziw6" title="Edit title"></button>',1),root_12=template('<textarea rows="3" class="svelte-1xvziw6"></textarea>'),root_13=template('<p class="svelte-1xvziw6"> </p> <button class="edit-button svelte-1xvziw6" title="Edit description"></button>',1),root_7=template('<div class="board-card svelte-1xvziw6"><div class="board-header svelte-1xvziw6"><div class="title-section svelte-1xvziw6"><!></div> <button class="permalink-button svelte-1xvziw6" title="Copy permalink"><!></button></div> <div class="description-section svelte-1xvziw6"><!></div></div>'),root_6=template('<div class="boards-grid svelte-1xvziw6"></div>'),root$9=template('<div class="boards-list svelte-1xvziw6"><header class="svelte-1xvziw6"><div class="header-left"><h1 class="svelte-1xvziw6">Kanbanstr</h1> <!></div></header> <div class="header-right"><div class="user-npub"> </div> <!> <button class="logout svelte-1xvziw6">Logout</button></div> <!> <!> <!></div>');function BoardsList(t,e){push$1(e,!1);let n=mutable_state(!1),r=mutable_state([]),s=mutable_state(!1),o=mutable_state(null),a=mutable_state(null),u=mutable_state({}),l={},c=mutable_state(null),f=mutable_state(null);onMount(()=>((async()=>ndkInstance.store.subscribe(H=>{var j,G,W;set(o,H.user),(j=get$1(o))==null||j.fetchProfile(),console.log("Current User:"+((W=(G=get$1(o))==null?void 0:G.profile)==null?void 0:W.displayName)),set(a,H.loginMethod),H.isReady&&h()}))(),()=>{}));async function h(){try{if(console.log("NDK:"+ndkInstance.ndk),!ndkInstance.ndk)throw new Error("NDK not initialized");return await kanbanStore.init(ndkInstance.ndk),await kanbanStore.loadBoards(),kanbanStore.subscribe(B=>{set(r,B.boards),set(s,B.loading),set(c,B.error)})}catch(L){set(c,L instanceof Error?L.message:"An unexpected error occurred")}}function p(){ndkInstance.logout()}function m(L,B){push(`/board/${L}/${B}`)}function g(L,B){B.stopPropagation(),l[L.id]&&clearTimeout(l[L.id]);const H=`${window.location.origin}/#/board/${L.pubkey}/${L.id}`;navigator.clipboard.writeText(H).then(()=>{mutate(u,get$1(u)[L.id]=!0),l[L.id]=setTimeout(()=>{mutate(u,get$1(u)[L.id]=!1)},2e3)})}function b(L,B,H){H.stopPropagation(),set(f,{boardId:L.id,field:B,value:B==="title"?L.title:L.description})}async function y(L,B){if(!get$1(f))return;const j=B.target.value.trim();if(j&&j!==(get$1(f).field==="title"?L.title:L.description))try{await kanbanStore.updateBoard({...L,[get$1(f).field]:j})}catch(G){set(c,G instanceof Error?G.message:"Failed to update board")}set(f,null)}function _(L,B){B.key==="Enter"&&!B.shiftKey?y(L,B):B.key==="Escape"&&set(f,null)}init();var x=root$9(),E=child(x),A=child(E),v=sibling(child(A),2);{var w=L=>{var B=root_1$6();append(L,B)};if_block(v,L=>{(get$1(a)==="npub"||get$1(a)==="readonly")&&L(w)})}var k=sibling(E,2),S=child(k),T=child(S),O=sibling(S,2);{var C=L=>{var B=root_2$4();event("click",B,()=>set(n,!0)),append(L,B)};if_block(O,L=>{get$1(a)!=="npub"&&get$1(a)!=="readonly"&&L(C)})}var R=sibling(O,2),M=sibling(k,2);{var I=L=>{var B=root_3$5();append(L,B)},D=L=>{var B=comment$1(),H=first_child(B);{var j=W=>{var Q=root_5$2(),se=child(Q),X=child(se);template_effect(()=>set_text(X,`No boards found. ${(get$1(a)!=="npub"&&get$1(a)!=="readonly"?"Create your first board!":"")??""}`)),append(W,Q)},G=W=>{var Q=root_6();each(Q,5,()=>get$1(r),se=>se.id,(se,X)=>{var ue=root_7(),K=child(ue),ne=child(K),q=child(ne);{var J=ae=>{var oe=root_8();autofocus(oe),template_effect(()=>set_value(oe,get$1(f).value)),event("blur",oe,he=>y(get$1(X),he)),event("keydown",oe,he=>_(get$1(X),he)),append(ae,oe)},Y=ae=>{var oe=root_9(),he=first_child(oe),xe=child(he),ke=sibling(he,2);template_effect(()=>set_text(xe,get$1(X).title)),event("click",ke,Ee=>b(get$1(X),"title",Ee)),append(ae,oe)};if_block(q,ae=>{var oe;((oe=get$1(f))==null?void 0:oe.boardId)===get$1(X).id&&get$1(f).field==="title"?ae(J):ae(Y,!1)})}var re=sibling(ne,2),V=child(re);{var te=ae=>{var oe=text$1("");append(ae,oe)},ce=ae=>{var oe=text$1("");append(ae,oe)};if_block(V,ae=>{get$1(u)[get$1(X).id]?ae(te):ae(ce,!1)})}var le=sibling(K,2),de=child(le);{var pe=ae=>{var oe=root_12();autofocus(oe),template_effect(()=>set_value(oe,get$1(f).value)),event("blur",oe,he=>y(get$1(X),he)),event("keydown",oe,he=>_(get$1(X),he)),append(ae,oe)},me=ae=>{var oe=root_13(),he=first_child(oe),xe=child(he),ke=sibling(he,2);template_effect(()=>set_text(xe,get$1(X).description)),event("click",ke,Ee=>b(get$1(X),"description",Ee)),append(ae,oe)};if_block(de,ae=>{var oe;((oe=get$1(f))==null?void 0:oe.boardId)===get$1(X).id&&get$1(f).field==="description"?ae(pe):ae(me,!1)})}event("click",re,ae=>g(get$1(X),ae)),event("click",ue,()=>m(get$1(X).pubkey,get$1(X).id)),append(se,ue)}),append(W,Q)};if_block(H,W=>{get$1(r).length===0?W(j):W(G,!1)},!0)}append(L,B)};if_block(M,L=>{get$1(s)?L(I):L(D,!1)})}var N=sibling(M,2);{var F=L=>{CreateBoard(L,{onClose:()=>set(n,!1)})};if_block(N,L=>{get$1(n)&&L(F)})}var z=sibling(N,2);{var U=L=>{AlertModal(L,{get message(){return get$1(c)},onClose:()=>set(c,null)})};if_block(z,L=>{get$1(c)&&L(U)})}template_effect(()=>{var L,B;return set_text(T,`Welcome ${((B=(L=get$1(o))==null?void 0:L.profile)==null?void 0:B.displayName)||"anonymous"}!!!`)}),event("click",R,p),append(t,x),pop()}function OrderedMap(t){this.content=t}OrderedMap.prototype={constructor:OrderedMap,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),o=r.content.slice();return s==-1?o.push(n||t,e):(o[s+1]=e,n&&(o[s]=n)),new OrderedMap(o)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new OrderedMap(n)},addToStart:function(t,e){return new OrderedMap([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new OrderedMap(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),o=r.find(t);return s.splice(o==-1?s.length:o,0,e,n),new OrderedMap(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=OrderedMap.from(t),t.size?new OrderedMap(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=OrderedMap.from(t),t.size?new OrderedMap(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=OrderedMap.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};OrderedMap.from=function(t){if(t instanceof OrderedMap)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new OrderedMap(e)};function findDiffStart(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),o=e.child(r);if(s==o){n+=s.nodeSize;continue}if(!s.sameMarkup(o))return n;if(s.isText&&s.text!=o.text){for(let a=0;s.text[a]==o.text[a];a++)n++;return n}if(s.content.size||o.content.size){let a=findDiffStart(s.content,o.content,n+1);if(a!=null)return a}n+=s.nodeSize}}function findDiffEnd(t,e,n,r){for(let s=t.childCount,o=e.childCount;;){if(s==0||o==0)return s==o?null:{a:n,b:r};let a=t.child(--s),u=e.child(--o),l=a.nodeSize;if(a==u){n-=l,r-=l;continue}if(!a.sameMarkup(u))return{a:n,b:r};if(a.isText&&a.text!=u.text){let c=0,f=Math.min(a.text.length,u.text.length);for(;c<f&&a.text[a.text.length-c-1]==u.text[u.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(a.content.size||u.content.size){let c=findDiffEnd(a.content,u.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class Fragment{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,o){for(let a=0,u=0;u<n;a++){let l=this.content[a],c=u+l.nodeSize;if(c>e&&r(l,s+u,o||null,a)!==!1&&l.content.size){let f=u+1;l.nodesBetween(Math.max(0,e-f),Math.min(l.content.size,n-f),r,s+f)}u=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let o="",a=!0;return this.nodesBetween(e,n,(u,l)=>{let c=u.isText?u.text.slice(Math.max(e,l)-l,n-l):u.isLeaf?s?typeof s=="function"?s(u):s:u.type.spec.leafText?u.type.spec.leafText(u):"":"";u.isBlock&&(u.isLeaf&&c||u.isTextblock)&&r&&(a?a=!1:o+=r),o+=c},0),o}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),o=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),o=1);o<e.content.length;o++)s.push(e.content[o]);return new Fragment(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let o=0,a=0;a<n;o++){let u=this.content[o],l=a+u.nodeSize;l>e&&((a<e||l>n)&&(u.isText?u=u.cut(Math.max(0,e-a),Math.min(u.text.length,n-a)):u=u.cut(Math.max(0,e-a-1),Math.min(u.content.size,n-a-1))),r.push(u),s+=u.nodeSize),a=l}return new Fragment(r,s)}cutByIndex(e,n){return e==n?Fragment.empty:e==0&&n==this.content.length?this:new Fragment(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),o=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new Fragment(s,o)}addToStart(e){return new Fragment([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Fragment(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return findDiffStart(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return findDiffEnd(this,e,n,r)}findIndex(e,n=-1){if(e==0)return retIndex(0,e);if(e==this.size)return retIndex(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,s=0;;r++){let o=this.child(r),a=s+o.nodeSize;if(a>=e)return a==e||n>0?retIndex(r+1,a):retIndex(r,s);s=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Fragment.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Fragment.empty;let n,r=0;for(let s=0;s<e.length;s++){let o=e[s];r+=o.nodeSize,s&&o.isText&&e[s-1].sameMarkup(o)?(n||(n=e.slice(0,s)),n[n.length-1]=o.withText(n[n.length-1].text+o.text)):n&&n.push(o)}return new Fragment(n||e,r)}static from(e){if(!e)return Fragment.empty;if(e instanceof Fragment)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Fragment([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment.empty=new Fragment([],0);const found={index:0,offset:0};function retIndex(t,e){return found.index=t,found.offset=e,found}function compareDeep(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!compareDeep(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!compareDeep(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Mark$1=class Se{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let o=e[s];if(this.eq(o))return e;if(this.type.excludes(o.type))n||(n=e.slice(0,s));else{if(o.type.excludes(this.type))return e;!r&&o.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(o)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&compareDeep(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Se.none;if(e instanceof Se)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};Mark$1.none=[];class ReplaceError extends Error{}class Slice{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=insertInto(this.content,e+this.openStart,n);return r&&new Slice(r,this.openStart,this.openEnd)}removeBetween(e,n){return new Slice(removeRange(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return Slice.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let o=e.firstChild;o&&!o.isLeaf&&(n||!o.type.spec.isolating);o=o.firstChild)r++;for(let o=e.lastChild;o&&!o.isLeaf&&(n||!o.type.spec.isolating);o=o.lastChild)s++;return new Slice(e,r,s)}}Slice.empty=new Slice(Fragment.empty,0,0);function removeRange(t,e,n){let{index:r,offset:s}=t.findIndex(e),o=t.maybeChild(r),{index:a,offset:u}=t.findIndex(n);if(s==e||o.isText){if(u!=n&&!t.child(a).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=a)throw new RangeError("Removing non-flat range");return t.replaceChild(r,o.copy(removeRange(o.content,e-s-1,n-s-1)))}function insertInto(t,e,n,r){let{index:s,offset:o}=t.findIndex(e),a=t.maybeChild(s);if(o==e||a.isText)return t.cut(0,e).append(n).append(t.cut(e));let u=insertInto(a.content,e-o-1,n);return u&&t.replaceChild(s,a.copy(u))}function replace$1(t,e,n){if(n.openStart>t.depth)throw new ReplaceError("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter(t,e,n,0)}function replaceOuter(t,e,n,r){let s=t.index(r),o=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let a=replaceOuter(t,e,n,r+1);return o.copy(o.content.replaceChild(s,a))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let a=t.parent,u=a.content;return close(a,u.cut(0,t.parentOffset).append(n.content).append(u.cut(e.parentOffset)))}else{let{start:a,end:u}=prepareSliceForReplace(n,t);return close(o,replaceThreeWay(t,a,u,e,r))}else return close(o,replaceTwoWay(t,e,r))}function checkJoin(t,e){if(!e.type.compatibleContent(t.type))throw new ReplaceError("Cannot join "+e.type.name+" onto "+t.type.name)}function joinable$1(t,e,n){let r=t.node(n);return checkJoin(r,e.node(n)),r}function addNode(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function addRange(t,e,n,r){let s=(e||t).node(n),o=0,a=e?e.index(n):s.childCount;t&&(o=t.index(n),t.depth>n?o++:t.textOffset&&(addNode(t.nodeAfter,r),o++));for(let u=o;u<a;u++)addNode(s.child(u),r);e&&e.depth==n&&e.textOffset&&addNode(e.nodeBefore,r)}function close(t,e){return t.type.checkContent(e),t.copy(e)}function replaceThreeWay(t,e,n,r,s){let o=t.depth>s&&joinable$1(t,e,s+1),a=r.depth>s&&joinable$1(n,r,s+1),u=[];return addRange(null,t,s,u),o&&a&&e.index(s)==n.index(s)?(checkJoin(o,a),addNode(close(o,replaceThreeWay(t,e,n,r,s+1)),u)):(o&&addNode(close(o,replaceTwoWay(t,e,s+1)),u),addRange(e,n,s,u),a&&addNode(close(a,replaceTwoWay(n,r,s+1)),u)),addRange(r,null,s,u),new Fragment(u)}function replaceTwoWay(t,e,n){let r=[];if(addRange(null,t,n,r),t.depth>n){let s=joinable$1(t,e,n+1);addNode(close(s,replaceTwoWay(t,e,n+1)),r)}return addRange(e,null,n,r),new Fragment(r)}function prepareSliceForReplace(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let o=n-1;o>=0;o--)s=e.node(o).copy(Fragment.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class ResolvedPos{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let o=0;o<e;o++)s+=r.child(o).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Mark$1.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let u=r;r=s,s=u}let o=r.marks;for(var a=0;a<o.length;a++)o[a].type.spec.inclusive===!1&&(!s||!o[a].isInSet(s.marks))&&(o=o[a--].removeFromSet(o));return o}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!s||!r[o].isInSet(s.marks))&&(r=r[o--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new NodeRange(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,o=n;for(let a=e;;){let{index:u,offset:l}=a.content.findIndex(o),c=o-l;if(r.push(a,u,s+l),!c||(a=a.child(u),a.isText))break;o=c-1,s+=l+1}return new ResolvedPos(n,r,o)}static resolveCached(e,n){let r=resolveCache.get(e);if(r)for(let o=0;o<r.elts.length;o++){let a=r.elts[o];if(a.pos==n)return a}else resolveCache.set(e,r=new ResolveCache);let s=r.elts[r.i]=ResolvedPos.resolve(e,n);return r.i=(r.i+1)%resolveCacheSize,s}}class ResolveCache{constructor(){this.elts=[],this.i=0}}const resolveCacheSize=12,resolveCache=new WeakMap;class NodeRange{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const emptyAttrs=Object.create(null);let Node$2=class Ce{constructor(e,n,r,s=Mark$1.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||Fragment.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&compareDeep(this.attrs,n||e.defaultAttrs||emptyAttrs)&&Mark$1.sameSet(this.marks,r||Mark$1.none)}copy(e=null){return e==this.content?this:new Ce(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Ce(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return Slice.empty;let s=this.resolve(e),o=this.resolve(n),a=r?0:s.sharedDepth(n),u=s.start(a),c=s.node(a).content.cut(s.pos-u,o.pos-u);return new Slice(c,s.depth-a,o.depth-a)}replace(e,n,r){return replace$1(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return ResolvedPos.resolveCached(this,e)}resolveNoCache(e){return ResolvedPos.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,o=>(r.isInSet(o.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Fragment.empty,s=0,o=r.childCount){let a=this.contentMatchAt(e).matchFragment(r,s,o),u=a&&a.matchFragment(this.content,n);if(!u||!u.validEnd)return!1;for(let l=s;l<o;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let o=this.contentMatchAt(e).matchType(r),a=o&&o.matchFragment(this.content,n);return a?a.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Mark$1.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Mark$1.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=Fragment.fromJSON(e,n.content),o=e.nodeType(n.type).create(n.attrs,s,r);return o.type.checkAttrs(o.attrs),o}};Node$2.prototype.text=void 0;class TextNode extends Node$2{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new TextNode(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new TextNode(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function wrapMarks(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class ContentMatch{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new TokenStream(e,n);if(r.next==null)return ContentMatch.empty;let s=parseExpr(r);r.next&&r.err("Unexpected trailing text");let o=dfa(nfa(s));return checkForDeadEnds(o,r),o}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let o=n;s&&o<r;o++)s=s.matchType(e.child(o).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function o(a,u){let l=a.matchFragment(e,r);if(l&&(!n||l.validEnd))return Fragment.from(u.map(c=>c.createAndFill()));for(let c=0;c<a.next.length;c++){let{type:f,next:h}=a.next[c];if(!(f.isText||f.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let p=o(h,u.concat(f));if(p)return p}}return null}return o(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),o=s.match;if(o.matchType(e)){let a=[];for(let u=s;u.type;u=u.via)a.push(u.type);return a.reverse()}for(let a=0;a<o.next.length;a++){let{type:u,next:l}=o.next[a];!u.isLeaf&&!u.hasRequiredAttrs()&&!(u.name in n)&&(!s.type||l.validEnd)&&(r.push({match:u.contentMatch,type:u,via:s}),n[u.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let o=s+(r.validEnd?"*":" ")+" ";for(let a=0;a<r.next.length;a++)o+=(a?", ":"")+r.next[a].type.name+"->"+e.indexOf(r.next[a].next);return o}).join(`
`)}}ContentMatch.empty=new ContentMatch(!0);class TokenStream{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function parseExpr(t){let e=[];do e.push(parseExprSeq(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function parseExprSeq(t){let e=[];do e.push(parseExprSubscript(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function parseExprSubscript(t){let e=parseExprAtom(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=parseExprRange(t,e);else break;return e}function parseNum(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function parseExprRange(t,e){let n=parseNum(t),r=n;return t.eat(",")&&(t.next!="}"?r=parseNum(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function resolveName(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let o in n){let a=n[o];a.isInGroup(e)&&s.push(a)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function parseExprAtom(t){if(t.eat("(")){let e=parseExpr(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=resolveName(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function nfa(t){let e=[[]];return s(o(t,0),n()),e;function n(){return e.push([])-1}function r(a,u,l){let c={term:l,to:u};return e[a].push(c),c}function s(a,u){a.forEach(l=>l.to=u)}function o(a,u){if(a.type=="choice")return a.exprs.reduce((l,c)=>l.concat(o(c,u)),[]);if(a.type=="seq")for(let l=0;;l++){let c=o(a.exprs[l],u);if(l==a.exprs.length-1)return c;s(c,u=n())}else if(a.type=="star"){let l=n();return r(u,l),s(o(a.expr,l),l),[r(l)]}else if(a.type=="plus"){let l=n();return s(o(a.expr,u),l),s(o(a.expr,l),l),[r(l)]}else{if(a.type=="opt")return[r(u)].concat(o(a.expr,u));if(a.type=="range"){let l=u;for(let c=0;c<a.min;c++){let f=n();s(o(a.expr,l),f),l=f}if(a.max==-1)s(o(a.expr,l),l);else for(let c=a.min;c<a.max;c++){let f=n();r(l,f),s(o(a.expr,l),f),l=f}return[r(l)]}else{if(a.type=="name")return[r(u,void 0,a.value)];throw new Error("Unknown expr type")}}}}function cmp(t,e){return e-t}function nullFrom(t,e){let n=[];return r(e),n.sort(cmp);function r(s){let o=t[s];if(o.length==1&&!o[0].term)return r(o[0].to);n.push(s);for(let a=0;a<o.length;a++){let{term:u,to:l}=o[a];!u&&n.indexOf(l)==-1&&r(l)}}}function dfa(t){let e=Object.create(null);return n(nullFrom(t,0));function n(r){let s=[];r.forEach(a=>{t[a].forEach(({term:u,to:l})=>{if(!u)return;let c;for(let f=0;f<s.length;f++)s[f][0]==u&&(c=s[f][1]);nullFrom(t,l).forEach(f=>{c||s.push([u,c=[]]),c.indexOf(f)==-1&&c.push(f)})})});let o=e[r.join(",")]=new ContentMatch(r.indexOf(t.length-1)>-1);for(let a=0;a<s.length;a++){let u=s[a][1].sort(cmp);o.next.push({type:s[a][0],next:e[u.join(",")]||n(u)})}return o}}function checkForDeadEnds(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],o=!s.validEnd,a=[];for(let u=0;u<s.next.length;u++){let{type:l,next:c}=s.next[u];a.push(l.name),o&&!(l.isText||l.hasRequiredAttrs())&&(o=!1),r.indexOf(c)==-1&&r.push(c)}o&&e.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function defaultAttrs(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function computeAttrs(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let o=t[r];if(o.hasDefault)s=o.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function checkAttrs(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let o=t[s];o.validate&&o.validate(e[s])}}function initAttrs(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Attribute(t,r,e[r]);return n}let NodeType$1=class Ie{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=initAttrs(e,r.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Node$2(this,this.computeAttrs(e),Fragment.from(n),Mark$1.setFrom(r))}createChecked(e=null,n,r){return n=Fragment.from(n),this.checkContent(n),new Node$2(this,this.computeAttrs(e),n,Mark$1.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Fragment.from(n),n.size){let a=this.contentMatch.fillBefore(n);if(!a)return null;n=a.append(n)}let s=this.contentMatch.matchFragment(n),o=s&&s.fillBefore(Fragment.empty,!0);return o?new Node$2(this,e,n.append(o),Mark$1.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){checkAttrs(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Mark$1.none:e}static compile(e,n){let r=Object.create(null);e.forEach((o,a)=>r[o]=new Ie(o,n,a));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function validateType(t,e,n){let r=n.split("|");return s=>{let o=s===null?"null":typeof s;if(r.indexOf(o)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${o}`)}}class Attribute{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?validateType(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class MarkType{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=initAttrs(e,s.attrs),this.excluded=null;let o=defaultAttrs(this.attrs);this.instance=o?new Mark$1(this,o):null}create(e=null){return!e&&this.instance?this.instance:new Mark$1(this,computeAttrs(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((o,a)=>r[o]=new MarkType(o,s++,n,a)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){checkAttrs(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Schema{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=OrderedMap.from(e.nodes),n.marks=OrderedMap.from(e.marks||{}),this.nodes=NodeType$1.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let o=this.nodes[s],a=o.spec.content||"",u=o.spec.marks;if(o.contentMatch=r[a]||(r[a]=ContentMatch.parse(a,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=u=="_"?null:u?gatherMarks(this,u.split(" ")):u==""||!o.inlineContent?[]:null}for(let s in this.marks){let o=this.marks[s],a=o.spec.excludes;o.excluded=a==null?[o]:a==""?[]:gatherMarks(this,a.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof NodeType$1){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new TextNode(r,r.defaultAttrs,e,Mark$1.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeFromJSON(e){return Node$2.fromJSON(this,e)}markFromJSON(e){return Mark$1.fromJSON(this,e)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function gatherMarks(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],o=t.marks[s],a=o;if(o)n.push(o);else for(let u in t.marks){let l=t.marks[u];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(a=l)}if(!a)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function isTagRule(t){return t.tag!=null}function isStyleRule(t){return t.style!=null}class DOMParser{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(isTagRule(s))this.tags.push(s);else if(isStyleRule(s)){let o=/[^=]*/.exec(s.style)[0];r.indexOf(o)<0&&r.push(o),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let o=e.nodes[s.node];return o.contentMatch.matchType(o)})}parse(e,n={}){let r=new ParseContext(this,n,!1);return r.addAll(e,Mark$1.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new ParseContext(this,n,!0);return r.addAll(e,Mark$1.none,n.from,n.to),Slice.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let o=this.tags[s];if(matches(e,o.tag)&&(o.namespace===void 0||e.namespaceURI==o.namespace)&&(!o.context||n.matchesContext(o.context))){if(o.getAttrs){let a=o.getAttrs(e);if(a===!1)continue;o.attrs=a||void 0}return o}}}matchStyle(e,n,r,s){for(let o=s?this.styles.indexOf(s)+1:0;o<this.styles.length;o++){let a=this.styles[o],u=a.style;if(!(u.indexOf(e)!=0||a.context&&!r.matchesContext(a.context)||u.length>e.length&&(u.charCodeAt(e.length)!=61||u.slice(e.length+1)!=n))){if(a.getAttrs){let l=a.getAttrs(n);if(l===!1)continue;a.attrs=l||void 0}return a}}}static schemaRules(e){let n=[];function r(s){let o=s.priority==null?50:s.priority,a=0;for(;a<n.length;a++){let u=n[a];if((u.priority==null?50:u.priority)<o)break}n.splice(a,0,s)}for(let s in e.marks){let o=e.marks[s].spec.parseDOM;o&&o.forEach(a=>{r(a=copy(a)),a.mark||a.ignore||a.clearMark||(a.mark=s)})}for(let s in e.nodes){let o=e.nodes[s].spec.parseDOM;o&&o.forEach(a=>{r(a=copy(a)),a.node||a.ignore||a.mark||(a.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new DOMParser(e,DOMParser.schemaRules(e)))}}const blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0},OPT_PRESERVE_WS=1,OPT_PRESERVE_WS_FULL=2,OPT_OPEN_LEFT=4;function wsOptionsFor(t,e,n){return e!=null?(e?OPT_PRESERVE_WS:0)|(e==="full"?OPT_PRESERVE_WS_FULL:0):t&&t.whitespace=="pre"?OPT_PRESERVE_WS|OPT_PRESERVE_WS_FULL:n&~OPT_OPEN_LEFT}class NodeContext{constructor(e,n,r,s,o,a){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=a,this.content=[],this.activeMarks=Mark$1.none,this.match=o||(a&OPT_OPEN_LEFT?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Fragment.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&OPT_PRESERVE_WS)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let o=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-s[0].length))}}let n=Fragment.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!blockTags.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class ParseContext{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,o,a=wsOptionsFor(null,n.preserveWhitespace,0)|(r?OPT_OPEN_LEFT:0);s?o=new NodeContext(s.type,s.attrs,Mark$1.none,!0,n.topMatch||s.type.contentMatch,a):r?o=new NodeContext(null,null,Mark$1.none,!0,null,a):o=new NodeContext(e.schema.topNodeType,null,Mark$1.none,!0,null,a),this.nodes=[o],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,o=s.options&OPT_PRESERVE_WS_FULL?"full":this.localPreserveWS||(s.options&OPT_PRESERVE_WS)>0;if(o==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(o)o!=="full"?r=r.replace(/\r?\n|\r/g," "):r=r.replace(/\r\n?/g,`
`);else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],u=e.previousSibling;(!a||u&&u.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),n),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,o=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let a=e.nodeName.toLowerCase(),u;listTags.hasOwnProperty(a)&&this.parser.normalizeLists&&normalizeList(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(u=this.parser.matchTag(e,this,r));e:if(l?l.ignore:ignoreTags.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,f=this.needsBlock;if(blockTags.hasOwnProperty(a))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),c=!0,o.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let h=l&&l.skip?n:this.readStyles(e,n);h&&this.addAll(e,h),c&&this.sync(o),this.needsBlock=f}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?u:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let o=this.parser.matchedStyles[s],a=r.getPropertyValue(o);if(a)for(let u=void 0;;){let l=this.parser.matchStyle(o,a,this,u);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)u=l;else break}}return n}addElementByRule(e,n,r,s){let o,a;if(n.node)if(a=this.parser.schema.nodes[n.node],a.isLeaf)this.insertNode(a.create(n.attrs),r)||this.leafFallback(e,r);else{let l=this.enter(a,n.attrs||null,r,n.preserveWhitespace);l&&(o=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let u=this.top;if(a&&a.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}o&&this.sync(u)&&this.open--}addAll(e,n,r,s){let o=r||0;for(let a=r?e.childNodes[r]:e.firstChild,u=s==null?null:e.childNodes[s];a!=u;a=a.nextSibling,++o)this.findAtPoint(e,o),this.addDOM(a,n);this.findAtPoint(e,o)}findPlace(e,n){let r,s;for(let o=this.open;o>=0;o--){let a=this.nodes[o],u=a.findWrapping(e);if(u&&(!r||r.length>u.length)&&(r=u,s=a,!u.length)||a.solid)break}if(!r)return null;this.sync(s);for(let o=0;o<r.length;o++)n=this.enterInner(r[o],null,n,!1);return n}insertNode(e,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let r=this.findPlace(e,n);if(r){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=Mark$1.none;for(let a of r.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):markMayApply(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let o=this.findPlace(e.create(n),r);return o&&(o=this.enterInner(e,n,r,!0,s)),o}enterInner(e,n,r,s=!1,o){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(e);let u=wsOptionsFor(e,o,a.options);a.options&OPT_OPEN_LEFT&&a.content.length==0&&(u|=OPT_OPEN_LEFT);let l=Mark$1.none;return r=r.filter(c=>(a.type?a.type.allowsMarkType(c.type):markMayApply(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new NodeContext(e,n,l,s,null,u)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=OPT_PRESERVE_WS)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),o=-(r?r.depth+1:0)+(s?0:1),a=(u,l)=>{for(;u>=0;u--){let c=n[u];if(c==""){if(u==n.length-1||u==0)continue;for(;l>=o;l--)if(a(u-1,l))return!0;return!1}else{let f=l>0||l==0&&s?this.nodes[l].type:r&&l>=o?r.node(l-o).type:null;if(!f||f.name!=c&&!f.isInGroup(c))return!1;l--}}return!0};return a(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function normalizeList(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&listTags.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function matches(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function copy(t){let e={};for(let n in t)e[n]=t[n];return e}function markMayApply(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let o=[],a=u=>{o.push(u);for(let l=0;l<u.edgeCount;l++){let{type:c,next:f}=u.edge(l);if(c==e||o.indexOf(f)<0&&a(f))return!0}};if(a(s.contentMatch))return!0}}class DOMSerializer{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=doc$1(n).createDocumentFragment());let s=r,o=[];return e.forEach(a=>{if(o.length||a.marks.length){let u=0,l=0;for(;u<o.length&&l<a.marks.length;){let c=a.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(o[u][0])||c.type.spec.spanning===!1)break;u++,l++}for(;u<o.length;)s=o.pop()[1];for(;l<a.marks.length;){let c=a.marks[l++],f=this.serializeMark(c,a.isInline,n);f&&(o.push([c,s]),s.appendChild(f.dom),s=f.contentDOM||f.dom)}}s.appendChild(this.serializeNodeInner(a,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=renderSpec(doc$1(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let o=this.serializeMark(e.marks[s],e.isInline,n);o&&((o.contentDOM||o.dom).appendChild(r),r=o.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&renderSpec(doc$1(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return renderSpec(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=gatherToDOM(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return gatherToDOM(e.marks)}}function gatherToDOM(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function doc$1(t){return t.document||window.document}const suspiciousAttributeCache=new WeakMap;function suspiciousAttributes(t){let e=suspiciousAttributeCache.get(t);return e===void 0&&suspiciousAttributeCache.set(t,e=suspiciousAttributesInner(t)),e}function suspiciousAttributesInner(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function renderSpec(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],o;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(o=suspiciousAttributes(r))&&o.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let a=s.indexOf(" ");a>0&&(n=s.slice(0,a),s=s.slice(a+1));let u,l=n?t.createElementNS(n,s):t.createElement(s),c=e[1],f=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){f=2;for(let h in c)if(c[h]!=null){let p=h.indexOf(" ");p>0?l.setAttributeNS(h.slice(0,p),h.slice(p+1),c[h]):l.setAttribute(h,c[h])}}for(let h=f;h<e.length;h++){let p=e[h];if(p===0){if(h<e.length-1||h>f)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:m,contentDOM:g}=renderSpec(t,p,n,r);if(l.appendChild(m),g){if(u)throw new RangeError("Multiple content holes");u=g}}}return{dom:l,contentDOM:u}}const lower16=65535,factor16=Math.pow(2,16);function makeRecover(t,e){return t+e*factor16}function recoverIndex(t){return t&lower16}function recoverOffset(t){return(t-(t&lower16))/factor16}const DEL_BEFORE=1,DEL_AFTER=2,DEL_ACROSS=4,DEL_SIDE=8;class MapResult{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&DEL_SIDE)>0}get deletedBefore(){return(this.delInfo&(DEL_BEFORE|DEL_ACROSS))>0}get deletedAfter(){return(this.delInfo&(DEL_AFTER|DEL_ACROSS))>0}get deletedAcross(){return(this.delInfo&DEL_ACROSS)>0}}class StepMap{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&StepMap.empty)return StepMap.empty}recover(e){let n=0,r=recoverIndex(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+recoverOffset(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,o=this.inverted?2:1,a=this.inverted?1:2;for(let u=0;u<this.ranges.length;u+=3){let l=this.ranges[u]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[u+o],f=this.ranges[u+a],h=l+c;if(e<=h){let p=c?e==l?-1:e==h?1:n:n,m=l+s+(p<0?0:f);if(r)return m;let g=e==(n<0?l:h)?null:makeRecover(u/3,e-l),b=e==l?DEL_AFTER:e==h?DEL_BEFORE:DEL_ACROSS;return(n<0?e!=l:e!=h)&&(b|=DEL_SIDE),new MapResult(m,b,g)}s+=f-c}return r?e+s:new MapResult(e+s,0,null)}touches(e,n){let r=0,s=recoverIndex(n),o=this.inverted?2:1,a=this.inverted?1:2;for(let u=0;u<this.ranges.length;u+=3){let l=this.ranges[u]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[u+o],f=l+c;if(e<=f&&u==s*3)return!0;r+=this.ranges[u+a]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,o=0;s<this.ranges.length;s+=3){let a=this.ranges[s],u=a-(this.inverted?o:0),l=a+(this.inverted?0:o),c=this.ranges[s+n],f=this.ranges[s+r];e(u,u+c,l,l+f),o+=f-c}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?StepMap.empty:new StepMap(e<0?[0,-e,0]:[0,0,e])}}StepMap.empty=new StepMap([]);class Mapping{constructor(e=[],n,r=0,s=e.length){this.maps=e,this.mirror=n,this.from=r,this.to=s}slice(e=0,n=this.maps.length){return new Mapping(this.maps,this.mirror,e,n)}copy(){return new Mapping(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,n){this.to=this.maps.push(e),n!=null&&this.setMirror(this.maps.length-1,n)}appendMapping(e){for(let n=0,r=this.maps.length;n<e.maps.length;n++){let s=e.getMirror(n);this.appendMap(e.maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this.maps.length+e.maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e.maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new Mapping;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let o=this.from;o<this.to;o++){let a=this.maps[o],u=a.mapResult(e,n);if(u.recover!=null){let l=this.getMirror(o);if(l!=null&&l>o&&l<this.to){o=l,e=this.maps[l].recover(u.recover);continue}}s|=u.delInfo,e=u.pos}return r?e:new MapResult(e,s,null)}}const stepsByID=Object.create(null);class Step{getMap(){return StepMap.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=stepsByID[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+e);return stepsByID[e]=n,n.prototype.jsonID=e,n}}class StepResult{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new StepResult(e,null)}static fail(e){return new StepResult(null,e)}static fromReplace(e,n,r,s){try{return StepResult.ok(e.replace(n,r,s))}catch(o){if(o instanceof ReplaceError)return StepResult.fail(o.message);throw o}}}function mapFragment(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let o=t.child(s);o.content.size&&(o=o.copy(mapFragment(o.content,e,o))),o.isInline&&(o=e(o,n,s)),r.push(o)}return Fragment.fromArray(r)}class AddMarkStep extends Step{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),o=new Slice(mapFragment(n.content,(a,u)=>!a.isAtom||!u.type.allowsMarkType(this.mark.type)?a:a.mark(this.mark.addToSet(a.marks)),s),n.openStart,n.openEnd);return StepResult.fromReplace(e,this.from,this.to,o)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new AddMarkStep(n.pos,r.pos,this.mark)}merge(e){return e instanceof AddMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new AddMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(n.from,n.to,e.markFromJSON(n.mark))}}Step.jsonID("addMark",AddMarkStep);class RemoveMarkStep extends Step{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new Slice(mapFragment(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return StepResult.fromReplace(e,this.from,this.to,r)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new RemoveMarkStep(n.pos,r.pos,this.mark)}merge(e){return e instanceof RemoveMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new RemoveMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(n.from,n.to,e.markFromJSON(n.mark))}}Step.jsonID("removeMark",RemoveMarkStep);class AddNodeMarkStep extends Step{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return StepResult.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new AddNodeMarkStep(this.pos,n.marks[s]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new AddNodeMarkStep(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(n.pos,e.markFromJSON(n.mark))}}Step.jsonID("addNodeMark",AddNodeMarkStep);class RemoveNodeMarkStep extends Step{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return StepResult.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new AddNodeMarkStep(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new RemoveNodeMarkStep(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(n.pos,e.markFromJSON(n.mark))}}Step.jsonID("removeNodeMark",RemoveNodeMarkStep);class ReplaceStep extends Step{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&contentBetween(e,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(e){return new ReplaceStep(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new ReplaceStep(n.pos,Math.max(n.pos,r.pos),this.slice)}merge(e){if(!(e instanceof ReplaceStep)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?Slice.empty:new Slice(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ReplaceStep(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?Slice.empty:new Slice(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ReplaceStep(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(n.from,n.to,Slice.fromJSON(e,n.slice),!!n.structure)}}Step.jsonID("replace",ReplaceStep);class ReplaceAroundStep extends Step{constructor(e,n,r,s,o,a,u=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=o,this.insert=a,this.structure=u}apply(e){if(this.structure&&(contentBetween(e,this.from,this.gapFrom)||contentBetween(e,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return StepResult.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?StepResult.fromReplace(e,this.from,this.to,r):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),o=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||o>r.pos?null:new ReplaceAroundStep(n.pos,r.pos,s,o,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(n.from,n.to,n.gapFrom,n.gapTo,Slice.fromJSON(e,n.slice),n.insert,!!n.structure)}}Step.jsonID("replaceAround",ReplaceAroundStep);function contentBetween(t,e,n){let r=t.resolve(e),s=n-e,o=r.depth;for(;s>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,s--;if(s>0){let a=r.node(o).maybeChild(r.indexAfter(o));for(;s>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,s--}}return!1}function addMark(t,e,n,r){let s=[],o=[],a,u;t.doc.nodesBetween(e,n,(l,c,f)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&f.type.allowsMarkType(r.type)){let p=Math.max(c,e),m=Math.min(c+l.nodeSize,n),g=r.addToSet(h);for(let b=0;b<h.length;b++)h[b].isInSet(g)||(a&&a.to==p&&a.mark.eq(h[b])?a.to=m:s.push(a=new RemoveMarkStep(p,m,h[b])));u&&u.to==p?u.to=m:o.push(u=new AddMarkStep(p,m,r))}}),s.forEach(l=>t.step(l)),o.forEach(l=>t.step(l))}function removeMark(t,e,n,r){let s=[],o=0;t.doc.nodesBetween(e,n,(a,u)=>{if(!a.isInline)return;o++;let l=null;if(r instanceof MarkType){let c=a.marks,f;for(;f=r.isInSet(c);)(l||(l=[])).push(f),c=f.removeFromSet(c)}else r?r.isInSet(a.marks)&&(l=[r]):l=a.marks;if(l&&l.length){let c=Math.min(u+a.nodeSize,n);for(let f=0;f<l.length;f++){let h=l[f],p;for(let m=0;m<s.length;m++){let g=s[m];g.step==o-1&&h.eq(s[m].style)&&(p=g)}p?(p.to=c,p.step=o):s.push({style:h,from:Math.max(u,e),to:c,step:o})}}}),s.forEach(a=>t.step(new RemoveMarkStep(a.from,a.to,a.style)))}function clearIncompatible(t,e,n,r=n.contentMatch,s=!0){let o=t.doc.nodeAt(e),a=[],u=e+1;for(let l=0;l<o.childCount;l++){let c=o.child(l),f=u+c.nodeSize,h=r.matchType(c.type);if(!h)a.push(new ReplaceStep(u,f,Slice.empty));else{r=h;for(let p=0;p<c.marks.length;p++)n.allowsMarkType(c.marks[p].type)||t.step(new RemoveMarkStep(u,f,c.marks[p]));if(s&&c.isText&&n.whitespace!="pre"){let p,m=/\r?\n|\r/g,g;for(;p=m.exec(c.text);)g||(g=new Slice(Fragment.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),a.push(new ReplaceStep(u+p.index,u+p.index+p[0].length,g))}}u=f}if(!r.validEnd){let l=r.fillBefore(Fragment.empty,!0);t.replace(u,u,new Slice(l,0,0))}for(let l=a.length-1;l>=0;l--)t.step(a[l])}function canCut(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function liftTarget(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let s=t.$from.node(r),o=t.$from.index(r),a=t.$to.indexAfter(r);if(r<t.depth&&s.canReplace(o,a,n))return r;if(r==0||s.type.spec.isolating||!canCut(s,o,a))break}return null}function lift$2(t,e,n){let{$from:r,$to:s,depth:o}=e,a=r.before(o+1),u=s.after(o+1),l=a,c=u,f=Fragment.empty,h=0;for(let g=o,b=!1;g>n;g--)b||r.index(g)>0?(b=!0,f=Fragment.from(r.node(g).copy(f)),h++):l--;let p=Fragment.empty,m=0;for(let g=o,b=!1;g>n;g--)b||s.after(g+1)<s.end(g)?(b=!0,p=Fragment.from(s.node(g).copy(p)),m++):c++;t.step(new ReplaceAroundStep(l,c,a,u,new Slice(f.append(p),h,m),f.size-h,!0))}function findWrapping(t,e,n=null,r=t){let s=findWrappingOutside(t,e),o=s&&findWrappingInside(r,e);return o?s.map(withAttrs).concat({type:e,attrs:n}).concat(o.map(withAttrs)):null}function withAttrs(t){return{type:t,attrs:null}}function findWrappingOutside(t,e){let{parent:n,startIndex:r,endIndex:s}=t,o=n.contentMatchAt(r).findWrapping(e);if(!o)return null;let a=o.length?o[0]:e;return n.canReplaceWith(r,s,a)?o:null}function findWrappingInside(t,e){let{parent:n,startIndex:r,endIndex:s}=t,o=n.child(r),a=e.contentMatch.findWrapping(o.type);if(!a)return null;let l=(a.length?a[a.length-1]:e).contentMatch;for(let c=r;l&&c<s;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:a}function wrap(t,e,n){let r=Fragment.empty;for(let a=n.length-1;a>=0;a--){if(r.size){let u=n[a].type.contentMatch.matchFragment(r);if(!u||!u.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Fragment.from(n[a].type.create(n[a].attrs,r))}let s=e.start,o=e.end;t.step(new ReplaceAroundStep(s,o,s,o,new Slice(r,0,0),n.length,!0))}function setBlockType$1(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=t.steps.length;t.doc.nodesBetween(e,n,(a,u)=>{let l=typeof s=="function"?s(a):s;if(a.isTextblock&&!a.hasMarkup(r,l)&&canChangeType(t.doc,t.mapping.slice(o).map(u),r)){let c=null;if(r.schema.linebreakReplacement){let m=r.whitespace=="pre",g=!!r.contentMatch.matchType(r.schema.linebreakReplacement);m&&!g?c=!1:!m&&g&&(c=!0)}c===!1&&replaceLinebreaks(t,a,u,o),clearIncompatible(t,t.mapping.slice(o).map(u,1),r,void 0,c===null);let f=t.mapping.slice(o),h=f.map(u,1),p=f.map(u+a.nodeSize,1);return t.step(new ReplaceAroundStep(h,p,h+1,p-1,new Slice(Fragment.from(r.create(l,null,a.marks)),0,0),1,!0)),c===!0&&replaceNewlines(t,a,u,o),!1}})}function replaceNewlines(t,e,n,r){e.forEach((s,o)=>{if(s.isText){let a,u=/\r?\n|\r/g;for(;a=u.exec(s.text);){let l=t.mapping.slice(r).map(n+1+o+a.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function replaceLinebreaks(t,e,n,r){e.forEach((s,o)=>{if(s.type==s.type.schema.linebreakReplacement){let a=t.mapping.slice(r).map(n+1+o);t.replaceWith(a,a+1,e.type.schema.text(`
`))}})}function canChangeType(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function setNodeMarkup(t,e,n,r,s){let o=t.doc.nodeAt(e);if(!o)throw new RangeError("No node at given position");n||(n=o.type);let a=n.create(r,null,s||o.marks);if(o.isLeaf)return t.replaceWith(e,e+o.nodeSize,a);if(!n.validContent(o.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new ReplaceAroundStep(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new Slice(Fragment.from(a),0,0),1,!0))}function canSplit(t,e,n=1,r){let s=t.resolve(e),o=s.depth-n,a=r&&r[r.length-1]||s.parent;if(o<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!a.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let c=s.depth-1,f=n-2;c>o;c--,f--){let h=s.node(c),p=s.index(c);if(h.type.spec.isolating)return!1;let m=h.content.cutByIndex(p,h.childCount),g=r&&r[f+1];g&&(m=m.replaceChild(0,g.type.create(g.attrs)));let b=r&&r[f]||h;if(!h.canReplace(p+1,h.childCount)||!b.type.validContent(m))return!1}let u=s.indexAfter(o),l=r&&r[0];return s.node(o).canReplaceWith(u,u,l?l.type:s.node(o+1).type)}function split(t,e,n=1,r){let s=t.doc.resolve(e),o=Fragment.empty,a=Fragment.empty;for(let u=s.depth,l=s.depth-n,c=n-1;u>l;u--,c--){o=Fragment.from(s.node(u).copy(o));let f=r&&r[c];a=Fragment.from(f?f.type.create(f.attrs,a):s.node(u).copy(a))}t.step(new ReplaceStep(e,e,new Slice(o.append(a),n,n),!0))}function canJoin(t,e){let n=t.resolve(e),r=n.index();return joinable(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function canAppendWithSubstitutedLinebreaks(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let o=e.child(s),a=o.type==r?t.type.schema.nodes.text:o.type;if(n=n.matchType(a),!n||!t.type.allowsMarks(o.marks))return!1}return n.validEnd}function joinable(t,e){return!!(t&&e&&!t.isLeaf&&canAppendWithSubstitutedLinebreaks(t,e))}function joinPoint(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let o,a,u=r.index(s);if(s==r.depth?(o=r.nodeBefore,a=r.nodeAfter):n>0?(o=r.node(s+1),u++,a=r.node(s).maybeChild(u)):(o=r.node(s).maybeChild(u-1),a=r.node(s+1)),o&&!o.isTextblock&&joinable(o,a)&&r.node(s).canReplace(u,u+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function join(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,o=t.doc.resolve(e-n),a=o.node().type;if(s&&a.inlineContent){let f=a.whitespace=="pre",h=!!a.contentMatch.matchType(s);f&&!h?r=!1:!f&&h&&(r=!0)}let u=t.steps.length;if(r===!1){let f=t.doc.resolve(e+n);replaceLinebreaks(t,f.node(),f.before(),u)}a.inlineContent&&clearIncompatible(t,e+n-1,a,o.node().contentMatchAt(o.index()),r==null);let l=t.mapping.slice(u),c=l.map(e-n);if(t.step(new ReplaceStep(c,l.map(e+n,-1),Slice.empty,!0)),r===!0){let f=t.doc.resolve(c);replaceNewlines(t,f.node(),f.before(),t.steps.length)}return t}function insertPoint(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let o=r.index(s);if(r.node(s).canReplaceWith(o,o,n))return r.before(s+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let o=r.indexAfter(s);if(r.node(s).canReplaceWith(o,o,n))return r.after(s+1);if(o<r.node(s).childCount)return null}return null}function dropPoint(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let o=0;o<n.openStart;o++)s=s.firstChild.content;for(let o=1;o<=(n.openStart==0&&n.size?2:1);o++)for(let a=r.depth;a>=0;a--){let u=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,l=r.index(a)+(u>0?1:0),c=r.node(a),f=!1;if(o==1)f=c.canReplace(l,l,s);else{let h=c.contentMatchAt(l).findWrapping(s.firstChild.type);f=h&&c.canReplaceWith(l,l,h[0])}if(f)return u==0?r.pos:u<0?r.before(a+1):r.after(a+1)}return null}function replaceStep(t,e,n=e,r=Slice.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),o=t.resolve(n);return fitsTrivially(s,o,r)?new ReplaceStep(e,n,r):new Fitter(s,o,r).fit()}function fitsTrivially(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class Fitter{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Fragment.empty;for(let s=0;s<=e.depth;s++){let o=e.node(s);this.frontier.push({type:o.type,match:o.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Fragment.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let o=this.placed,a=r.depth,u=s.depth;for(;a&&u&&o.childCount==1;)o=o.firstChild.content,a--,u--;let l=new Slice(o,a,u);return e>-1?new ReplaceAroundStep(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new ReplaceStep(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let o=n.firstChild;if(n.childCount>1&&(s=0),o.type.spec.isolating&&s<=r){e=r;break}n=o.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,o=null;r?(o=contentAt(this.unplaced.content,r-1).firstChild,s=o.content):s=this.unplaced.content;let a=s.firstChild;for(let u=this.depth;u>=0;u--){let{type:l,match:c}=this.frontier[u],f,h=null;if(n==1&&(a?c.matchType(a.type)||(h=c.fillBefore(Fragment.from(a),!1)):o&&l.compatibleContent(o.type)))return{sliceDepth:r,frontierDepth:u,parent:o,inject:h};if(n==2&&a&&(f=c.findWrapping(a.type)))return{sliceDepth:r,frontierDepth:u,parent:o,wrap:f};if(o&&c.matchType(o.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=contentAt(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new Slice(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=contentAt(e,n);if(s.childCount<=1&&n>0){let o=e.size-n<=n+s.size;this.unplaced=new Slice(dropFromFragment(e,n-1,1),n-1,o?n-1:r)}else this.unplaced=new Slice(dropFromFragment(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:o}){for(;this.depth>n;)this.closeFrontierNode();if(o)for(let b=0;b<o.length;b++)this.openFrontierNode(o[b]);let a=this.unplaced,u=r?r.content:a.content,l=a.openStart-e,c=0,f=[],{match:h,type:p}=this.frontier[n];if(s){for(let b=0;b<s.childCount;b++)f.push(s.child(b));h=h.matchFragment(s)}let m=u.size+e-(a.content.size-a.openEnd);for(;c<u.childCount;){let b=u.child(c),y=h.matchType(b.type);if(!y)break;c++,(c>1||l==0||b.content.size)&&(h=y,f.push(closeNodeStart(b.mark(p.allowedMarks(b.marks)),c==1?l:0,c==u.childCount?m:-1)))}let g=c==u.childCount;g||(m=-1),this.placed=addToFragment(this.placed,n,Fragment.from(f)),this.frontier[n].match=h,g&&m<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let b=0,y=u;b<m;b++){let _=y.lastChild;this.frontier.push({type:_.type,match:_.contentMatchAt(_.childCount)}),y=_.content}this.unplaced=g?e==0?Slice.empty:new Slice(dropFromFragment(a.content,e-1,1),e-1,m<0?a.openEnd:e-1):new Slice(dropFromFragment(a.content,e,c),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],o=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),a=contentAfterFits(e,n,s,r,o);if(a){for(let u=n-1;u>=0;u--){let{match:l,type:c}=this.frontier[u],f=contentAfterFits(e,u,c,l,!0);if(!f||f.childCount)continue e}return{depth:n,fit:a,move:o?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=addToFragment(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),o=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,o)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=addToFragment(this.placed,this.depth,Fragment.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Fragment.empty,!0);n.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,n))}}function dropFromFragment(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(dropFromFragment(t.firstChild.content,e-1,n)))}function addToFragment(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(addToFragment(t.lastChild.content,e-1,n)))}function contentAt(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function closeNodeStart(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,closeNodeStart(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Fragment.empty,!0)))),t.copy(r)}function contentAfterFits(t,e,n,r,s){let o=t.node(e),a=s?t.indexAfter(e):t.index(e);if(a==o.childCount&&!n.compatibleContent(o.type))return null;let u=r.fillBefore(o.content,!0,a);return u&&!invalidMarks(n,o.content,a)?u:null}function invalidMarks(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function definesContent(t){return t.spec.defining||t.spec.definingForContent}function replaceRange(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),o=t.doc.resolve(n);if(fitsTrivially(s,o,r))return t.step(new ReplaceStep(e,n,r));let a=coveredDepths(s,t.doc.resolve(n));a[a.length-1]==0&&a.pop();let u=-(s.depth+1);a.unshift(u);for(let p=s.depth,m=s.pos-1;p>0;p--,m--){let g=s.node(p).type.spec;if(g.defining||g.definingAsContext||g.isolating)break;a.indexOf(p)>-1?u=p:s.before(p)==m&&a.splice(1,0,-p)}let l=a.indexOf(u),c=[],f=r.openStart;for(let p=r.content,m=0;;m++){let g=p.firstChild;if(c.push(g),m==r.openStart)break;p=g.content}for(let p=f-1;p>=0;p--){let m=c[p],g=definesContent(m.type);if(g&&!m.sameMarkup(s.node(Math.abs(u)-1)))f=p;else if(g||!m.type.isTextblock)break}for(let p=r.openStart;p>=0;p--){let m=(p+f+1)%(r.openStart+1),g=c[m];if(g)for(let b=0;b<a.length;b++){let y=a[(b+l)%a.length],_=!0;y<0&&(_=!1,y=-y);let x=s.node(y-1),E=s.index(y-1);if(x.canReplaceWith(E,E,g.type,g.marks))return t.replace(s.before(y),_?o.after(y):n,new Slice(closeFragment(r.content,0,r.openStart,m),m,r.openEnd))}}let h=t.steps.length;for(let p=a.length-1;p>=0&&(t.replace(e,n,r),!(t.steps.length>h));p--){let m=a[p];m<0||(e=s.before(m),n=o.after(m))}}function closeFragment(t,e,n,r,s){if(e<n){let o=t.firstChild;t=t.replaceChild(0,o.copy(closeFragment(o.content,e+1,n,r,o)))}if(e>r){let o=s.contentMatchAt(0),a=o.fillBefore(t).append(t);t=a.append(o.matchFragment(a).fillBefore(Fragment.empty,!0))}return t}function replaceRangeWith(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=insertPoint(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new Slice(Fragment.from(r),0,0))}function deleteRange$1(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),o=coveredDepths(r,s);for(let a=0;a<o.length;a++){let u=o[a],l=a==o.length-1;if(l&&u==0||r.node(u).type.contentMatch.validEnd)return t.delete(r.start(u),s.end(u));if(u>0&&(l||r.node(u-1).canReplace(r.index(u-1),s.indexAfter(u-1))))return t.delete(r.before(u),s.after(u))}for(let a=1;a<=r.depth&&a<=s.depth;a++)if(e-r.start(a)==r.depth-a&&n>r.end(a)&&s.end(a)-n!=s.depth-a&&r.start(a-1)==s.start(a-1)&&r.node(a-1).canReplace(r.index(a-1),s.index(a-1)))return t.delete(r.before(a),n);t.delete(e,n)}function coveredDepths(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let o=t.start(s);if(o<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(o==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==o-1)&&n.push(s)}return n}class AttrStep extends Step{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return StepResult.fail("No node at attribute step's position");let r=Object.create(null);for(let o in n.attrs)r[o]=n.attrs[o];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(s),0,n.isLeaf?0:1))}getMap(){return StepMap.empty}invert(e){return new AttrStep(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new AttrStep(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(n.pos,n.attr,n.value)}}Step.jsonID("attr",AttrStep);class DocAttrStep extends Step{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return StepResult.ok(r)}getMap(){return StepMap.empty}invert(e){return new DocAttrStep(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new DocAttrStep(n.attr,n.value)}}Step.jsonID("docAttr",DocAttrStep);let TransformError=class extends Error{};TransformError=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};TransformError.prototype=Object.create(Error.prototype);TransformError.prototype.constructor=TransformError;TransformError.prototype.name="TransformError";class Transform{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new TransformError(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=Slice.empty){let s=replaceStep(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new Slice(Fragment.from(r),0,0))}delete(e,n){return this.replace(e,n,Slice.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return replaceRange(this,e,n,r),this}replaceRangeWith(e,n,r){return replaceRangeWith(this,e,n,r),this}deleteRange(e,n){return deleteRange$1(this,e,n),this}lift(e,n){return lift$2(this,e,n),this}join(e,n=1){return join(this,e,n),this}wrap(e,n){return wrap(this,e,n),this}setBlockType(e,n=e,r,s=null){return setBlockType$1(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return setNodeMarkup(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new AttrStep(e,n,r)),this}setDocAttribute(e,n){return this.step(new DocAttrStep(e,n)),this}addNodeMark(e,n){return this.step(new AddNodeMarkStep(e,n)),this}removeNodeMark(e,n){if(!(n instanceof Mark$1)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n=n.isInSet(r.marks),!n)return this}return this.step(new RemoveNodeMarkStep(e,n)),this}split(e,n=1,r){return split(this,e,n,r),this}addMark(e,n,r){return addMark(this,e,n,r),this}removeMark(e,n,r){return removeMark(this,e,n,r),this}clearIncompatible(e,n,r){return clearIncompatible(this,e,n,r),this}}const classesById=Object.create(null);class Selection{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new SelectionRange(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=Slice.empty){let r=n.content.lastChild,s=null;for(let u=0;u<n.openEnd;u++)s=r,r=r.lastChild;let o=e.steps.length,a=this.ranges;for(let u=0;u<a.length;u++){let{$from:l,$to:c}=a[u],f=e.mapping.slice(o);e.replaceRange(f.map(l.pos),f.map(c.pos),u?Slice.empty:n),u==0&&selectionToInsertionEnd$1(e,o,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:a,$to:u}=s[o],l=e.mapping.slice(r),c=l.map(a.pos),f=l.map(u.pos);o?e.deleteRange(c,f):(e.replaceRangeWith(c,f,n),selectionToInsertionEnd$1(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new TextSelection(e):findSelectionIn(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let o=e.depth-1;o>=0;o--){let a=n<0?findSelectionIn(e.node(0),e.node(o),e.before(o+1),e.index(o),n,r):findSelectionIn(e.node(0),e.node(o),e.after(o+1),e.index(o)+1,n,r);if(a)return a}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new AllSelection(e.node(0))}static atStart(e){return findSelectionIn(e,e,0,0,1)||new AllSelection(e)}static atEnd(e){return findSelectionIn(e,e,e.content.size,e.childCount,-1)||new AllSelection(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=classesById[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in classesById)throw new RangeError("Duplicate use of selection JSON ID "+e);return classesById[e]=n,n.prototype.jsonID=e,n}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}}Selection.prototype.visible=!0;class SelectionRange{constructor(e,n){this.$from=e,this.$to=n}}let warnedAboutTextSelection=!1;function checkTextSelection(t){!warnedAboutTextSelection&&!t.parent.inlineContent&&(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class TextSelection extends Selection{constructor(e,n=e){checkTextSelection(e),checkTextSelection(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Selection.near(r);let s=e.resolve(n.map(this.anchor));return new TextSelection(s.parent.inlineContent?s:r,r)}replace(e,n=Slice.empty){if(super.replace(e,n),n==Slice.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof TextSelection&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let o=Selection.findFrom(n,r,!0)||Selection.findFrom(n,-r,!0);if(o)n=o.$head;else return Selection.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(Selection.findFrom(e,-r,!0)||Selection.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new TextSelection(e,n)}}Selection.jsonID("text",TextSelection);class TextBookmark{constructor(e,n){this.anchor=e,this.head=n}map(e){return new TextBookmark(e.map(this.anchor),e.map(this.head))}resolve(e){return TextSelection.between(e.resolve(this.anchor),e.resolve(this.head))}}class NodeSelection extends Selection{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),o=e.resolve(s);return r?Selection.near(o):new NodeSelection(o)}content(){return new Slice(Fragment.from(this.node),0,0)}eq(e){return e instanceof NodeSelection&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(e.resolve(n.anchor))}static create(e,n){return new NodeSelection(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}NodeSelection.prototype.visible=!1;Selection.jsonID("node",NodeSelection);class NodeBookmark{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new TextBookmark(r,r):new NodeBookmark(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&NodeSelection.isSelectable(r)?new NodeSelection(n):Selection.near(n)}}class AllSelection extends Selection{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=Slice.empty){if(n==Slice.empty){e.delete(0,e.doc.content.size);let r=Selection.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new AllSelection(e)}map(e){return new AllSelection(e)}eq(e){return e instanceof AllSelection}getBookmark(){return AllBookmark}}Selection.jsonID("all",AllSelection);const AllBookmark={map(){return this},resolve(t){return new AllSelection(t)}};function findSelectionIn(t,e,n,r,s,o=!1){if(e.inlineContent)return TextSelection.create(t,n);for(let a=r-(s>0?0:1);s>0?a<e.childCount:a>=0;a+=s){let u=e.child(a);if(u.isAtom){if(!o&&NodeSelection.isSelectable(u))return NodeSelection.create(t,n-(s<0?u.nodeSize:0))}else{let l=findSelectionIn(t,u,n+s,s<0?u.childCount:0,s,o);if(l)return l}n+=u.nodeSize*s}return null}function selectionToInsertionEnd$1(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof ReplaceStep||s instanceof ReplaceAroundStep))return;let o=t.mapping.maps[r],a;o.forEach((u,l,c,f)=>{a==null&&(a=f)}),t.setSelection(Selection.near(t.doc.resolve(a),n))}const UPDATED_SEL=1,UPDATED_MARKS=2,UPDATED_SCROLL=4;class Transaction extends Transform{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|UPDATED_SEL)&~UPDATED_MARKS,this.storedMarks=null,this}get selectionSet(){return(this.updated&UPDATED_SEL)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=UPDATED_MARKS,this}ensureMarks(e){return Mark$1.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&UPDATED_MARKS)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~UPDATED_MARKS,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Mark$1.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r??n,!e)return this.deleteRange(n,r);let o=this.storedMarks;if(!o){let a=this.doc.resolve(n);o=r==n?a.marks():a.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,o)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=UPDATED_SCROLL,this}get scrolledIntoView(){return(this.updated&UPDATED_SCROLL)>0}}function bind(t,e){return!e||!t?t:t.bind(e)}class FieldDesc{constructor(e,n,r){this.name=e,this.init=bind(n.init,r),this.apply=bind(n.apply,r)}}const baseFields=[new FieldDesc("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new FieldDesc("selection",{init(t,e){return t.selection||Selection.atStart(e.doc)},apply(t){return t.selection}}),new FieldDesc("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new FieldDesc("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class Configuration{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=baseFields.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new FieldDesc(r.key,r.spec.state,r))})}}class EditorState{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let o=!1;for(let a=0;a<this.config.plugins.length;a++){let u=this.config.plugins[a];if(u.spec.appendTransaction){let l=s?s[a].n:0,c=s?s[a].state:this,f=l<n.length&&u.spec.appendTransaction.call(u,l?n.slice(l):n,c,r);if(f&&r.filterTransaction(f,a)){if(f.setMeta("appendedTransaction",e),!s){s=[];for(let h=0;h<this.config.plugins.length;h++)s.push(h<a?{state:r,n:n.length}:{state:this,n:0})}n.push(f),r=r.applyInner(f),o=!0}s&&(s[a]={state:r,n:n.length})}}if(!o)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new EditorState(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let o=r[s];n[o.name]=o.apply(e,this[o.name],this,n)}return n}get tr(){return new Transaction(this)}static create(e){let n=new Configuration(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new EditorState(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new Configuration(this.schema,e.plugins),r=n.fields,s=new EditorState(n);for(let o=0;o<r.length;o++){let a=r[o].name;s[a]=this.hasOwnProperty(a)?this[a]:r[o].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],o=s.spec.state;o&&o.toJSON&&(n[r]=o.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Configuration(e.schema,e.plugins),o=new EditorState(s);return s.fields.forEach(a=>{if(a.name=="doc")o.doc=Node$2.fromJSON(e.schema,n.doc);else if(a.name=="selection")o.selection=Selection.fromJSON(o.doc,n.selection);else if(a.name=="storedMarks")n.storedMarks&&(o.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let u in r){let l=r[u],c=l.spec.state;if(l.key==a.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,u)){o[a.name]=c.fromJSON.call(l,e,n[u],o);return}}o[a.name]=a.init(e,o)}}),o}}function bindProps(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=bindProps(s,e,{})),n[r]=s}return n}class Plugin{constructor(e){this.spec=e,this.props={},e.props&&bindProps(e.props,this,this.props),this.key=e.key?e.key.key:createKey("plugin")}getState(e){return e[this.key]}}const keys=Object.create(null);function createKey(t){return t in keys?t+"$"+ ++keys[t]:(keys[t]=0,t+"$")}class PluginKey{constructor(e="key"){this.key=createKey(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const domIndex=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},parentNode=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let reusedRange=null;const textRange=function(t,e,n){let r=reusedRange||(reusedRange=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},clearReusedRange=function(){reusedRange=null},isEquivalentPosition=function(t,e,n,r){return n&&(scanFor(t,e,n,r,-1)||scanFor(t,e,n,r,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor(t,e,n,r,s){for(;;){if(t==n&&e==r)return!0;if(e==(s<0?0:nodeSize(t))){let o=t.parentNode;if(!o||o.nodeType!=1||hasBlockDesc(t)||atomElements.test(t.nodeName)||t.contentEditable=="false")return!1;e=domIndex(t)+(s<0?0:1),t=o}else if(t.nodeType==1){if(t=t.childNodes[e+(s<0?-1:0)],t.contentEditable=="false")return!1;e=s<0?nodeSize(t):0}else return!1}}function nodeSize(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function textNodeBefore$1(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=nodeSize(t)}else if(t.parentNode&&!hasBlockDesc(t))e=domIndex(t),t=t.parentNode;else return null}}function textNodeAfter$1(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!hasBlockDesc(t))e=domIndex(t)+1,t=t.parentNode;else return null}}function isOnEdge(t,e,n){for(let r=e==0,s=e==nodeSize(t);r||s;){if(t==n)return!0;let o=domIndex(t);if(t=t.parentNode,!t)return!1;r=r&&o==0,s=s&&o==nodeSize(t)}}function hasBlockDesc(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const selectionCollapsed=function(t){return t.focusNode&&isEquivalentPosition(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function keyEvent(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function deepActiveElement(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function caretFromPoint(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(nodeSize(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(nodeSize(r.startContainer),r.startOffset)}}}const nav=typeof navigator<"u"?navigator:null,doc=typeof document<"u"?document:null,agent=nav&&nav.userAgent||"",ie_edge=/Edge\/(\d+)/.exec(agent),ie_upto10=/MSIE \d/.exec(agent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent),ie$1=!!(ie_upto10||ie_11up||ie_edge),ie_version=ie_upto10?document.documentMode:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko=!ie$1&&/gecko\/(\d+)/i.test(agent);gecko&&+(/Firefox\/(\d+)/.exec(agent)||[0,0])[1];const _chrome=!ie$1&&/Chrome\/(\d+)/.exec(agent),chrome=!!_chrome,chrome_version=_chrome?+_chrome[1]:0,safari=!ie$1&&!!nav&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(agent)||!!nav&&nav.maxTouchPoints>2),mac$2=ios||(nav?/Mac/.test(nav.platform):!1),windows=nav?/Win/.test(nav.platform):!1,android=/Android \d/.test(agent),webkit=!!doc&&"webkitFontSmoothing"in doc.documentElement.style,webkit_version=webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function windowRect(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function getSide(t,e){return typeof t=="number"?t:t[e]}function clientRect(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function scrollRectIntoView(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,o=t.dom.ownerDocument;for(let a=n||t.dom;a;a=parentNode(a)){if(a.nodeType!=1)continue;let u=a,l=u==o.body,c=l?windowRect(o):clientRect(u),f=0,h=0;if(e.top<c.top+getSide(r,"top")?h=-(c.top-e.top+getSide(s,"top")):e.bottom>c.bottom-getSide(r,"bottom")&&(h=e.bottom-e.top>c.bottom-c.top?e.top+getSide(s,"top")-c.top:e.bottom-c.bottom+getSide(s,"bottom")),e.left<c.left+getSide(r,"left")?f=-(c.left-e.left+getSide(s,"left")):e.right>c.right-getSide(r,"right")&&(f=e.right-c.right+getSide(s,"right")),f||h)if(l)o.defaultView.scrollBy(f,h);else{let p=u.scrollLeft,m=u.scrollTop;h&&(u.scrollTop+=h),f&&(u.scrollLeft+=f);let g=u.scrollLeft-p,b=u.scrollTop-m;e={left:e.left-g,top:e.top-b,right:e.right-g,bottom:e.bottom-b}}if(l||/^(fixed|sticky)$/.test(getComputedStyle(a).position))break}}function storeScrollPos(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let o=(e.left+e.right)/2,a=n+1;a<Math.min(innerHeight,e.bottom);a+=5){let u=t.root.elementFromPoint(o,a);if(!u||u==t.dom||!t.dom.contains(u))continue;let l=u.getBoundingClientRect();if(l.top>=n-20){r=u,s=l.top;break}}return{refDOM:r,refTop:s,stack:scrollStack(t.dom)}}function scrollStack(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=parentNode(r));return e}function resetScrollPos({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;restoreScrollStack(n,r==0?0:r-e)}function restoreScrollStack(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:o}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=o&&(r.scrollLeft=o)}}let preventScrollSupported=null;function focusPreventScroll(t){if(t.setActive)return t.setActive();if(preventScrollSupported)return t.focus(preventScrollSupported);let e=scrollStack(t);t.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),preventScrollSupported||(preventScrollSupported=!1,restoreScrollStack(e,0))}function findOffsetInNode(t,e){let n,r=2e8,s,o=0,a=e.top,u=e.top,l,c;for(let f=t.firstChild,h=0;f;f=f.nextSibling,h++){let p;if(f.nodeType==1)p=f.getClientRects();else if(f.nodeType==3)p=textRange(f).getClientRects();else continue;for(let m=0;m<p.length;m++){let g=p[m];if(g.top<=a&&g.bottom>=u){a=Math.max(g.bottom,a),u=Math.min(g.top,u);let b=g.left>e.left?g.left-e.left:g.right<e.left?e.left-g.right:0;if(b<r){n=f,r=b,s=b&&n.nodeType==3?{left:g.right<e.left?g.right:g.left,top:e.top}:e,f.nodeType==1&&b&&(o=h+(e.left>=(g.left+g.right)/2?1:0));continue}}else g.top>e.top&&!l&&g.left<=e.left&&g.right>=e.left&&(l=f,c={left:Math.max(g.left,Math.min(g.right,e.left)),top:g.top});!n&&(e.left>=g.right&&e.top>=g.top||e.left>=g.left&&e.top>=g.bottom)&&(o=h+1)}}return!n&&l&&(n=l,s=c,r=0),n&&n.nodeType==3?findOffsetInText(n,s):!n||r&&n.nodeType==1?{node:t,offset:o}:findOffsetInNode(n,s)}function findOffsetInText(t,e){let n=t.nodeValue.length,r=document.createRange();for(let s=0;s<n;s++){r.setEnd(t,s+1),r.setStart(t,s);let o=singleRect(r,1);if(o.top!=o.bottom&&inRect(e,o))return{node:t,offset:s+(e.left>=(o.left+o.right)/2?1:0)}}return{node:t,offset:0}}function inRect(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function targetKludge(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function posFromElement(t,e,n){let{node:r,offset:s}=findOffsetInNode(e,n),o=-1;if(r.nodeType==1&&!r.firstChild){let a=r.getBoundingClientRect();o=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(r,s,o)}function posFromCaret(t,e,n,r){let s=-1;for(let o=e,a=!1;o!=t.dom;){let u=t.docView.nearestDesc(o,!0),l;if(!u)return null;if(u.dom.nodeType==1&&(u.node.isBlock&&u.parent||!u.contentDOM)&&((l=u.dom.getBoundingClientRect()).width||l.height)&&(u.node.isBlock&&u.parent&&(!a&&l.left>r.left||l.top>r.top?s=u.posBefore:(!a&&l.right<r.left||l.bottom<r.top)&&(s=u.posAfter),a=!0),!u.contentDOM&&s<0&&!u.node.isText))return(u.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?u.posBefore:u.posAfter;o=u.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function elementFromPoint(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),o=s;;){let a=t.childNodes[o];if(a.nodeType==1){let u=a.getClientRects();for(let l=0;l<u.length;l++){let c=u[l];if(inRect(e,c))return elementFromPoint(a,e,c)}}if((o=(o+1)%r)==s)break}return t}function posAtCoords(t,e){let n=t.dom.ownerDocument,r,s=0,o=caretFromPoint(n,e.left,e.top);o&&({node:r,offset:s}=o);let a=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),u;if(!a||!t.dom.contains(a.nodeType!=1?a.parentNode:a)){let c=t.dom.getBoundingClientRect();if(!inRect(e,c)||(a=elementFromPoint(t.dom,e,c),!a))return null}if(safari)for(let c=a;r&&c;c=parentNode(c))c.draggable&&(r=void 0);if(a=targetKludge(a,e),r){if(gecko&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let f=r.childNodes[s],h;f.nodeName=="IMG"&&(h=f.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&s++}let c;webkit&&s&&r.nodeType==1&&(c=r.childNodes[s-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?u=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(u=posFromCaret(t,r,s,e))}u==null&&(u=posFromElement(t,a,e));let l=t.docView.nearestDesc(a,!0);return{pos:u,inside:l?l.posAtStart-l.border:-1}}function nonZero(t){return t.top<t.bottom||t.left<t.right}function singleRect(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(nonZero(r))return r}return Array.prototype.find.call(n,nonZero)||t.getBoundingClientRect()}const BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(t,e,n){let{node:r,offset:s,atom:o}=t.docView.domFromPos(e,n<0?-1:1),a=webkit||gecko;if(r.nodeType==3)if(a&&(BIDI.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=singleRect(textRange(r,s,s),n);if(gecko&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let c=singleRect(textRange(r,s-1,s-1),-1);if(c.top==l.top){let f=singleRect(textRange(r,s,s+1),-1);if(f.top!=l.top)return flattenV(f,f.left<c.left)}}return l}else{let l=s,c=s,f=n<0?1:-1;return n<0&&!s?(c++,f=-1):n>=0&&s==r.nodeValue.length?(l--,f=1):n<0?l--:c++,flattenV(singleRect(textRange(r,l,c),f),f<0)}if(!t.state.doc.resolve(e-(o||0)).parent.inlineContent){if(o==null&&s&&(n<0||s==nodeSize(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return flattenH(l.getBoundingClientRect(),!1)}if(o==null&&s<nodeSize(r)){let l=r.childNodes[s];if(l.nodeType==1)return flattenH(l.getBoundingClientRect(),!0)}return flattenH(r.getBoundingClientRect(),n>=0)}if(o==null&&s&&(n<0||s==nodeSize(r))){let l=r.childNodes[s-1],c=l.nodeType==3?textRange(l,nodeSize(l)-(a?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return flattenV(singleRect(c,1),!1)}if(o==null&&s<nodeSize(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?textRange(l,0,a?0:1):l.nodeType==1?l:null:null;if(c)return flattenV(singleRect(c,-1),!0)}return flattenV(singleRect(r.nodeType==3?textRange(r):r,-n),n>=0)}function flattenV(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function flattenH(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function withFlushedState(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function endOfTextblockVertical(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return withFlushedState(t,e,()=>{let{node:o}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let u=t.docView.nearestDesc(o,!0);if(!u)break;if(u.node.isBlock){o=u.contentDOM||u.dom;break}o=u.dom.parentNode}let a=coordsAtPos(t,s.pos,1);for(let u=o.firstChild;u;u=u.nextSibling){let l;if(u.nodeType==1)l=u.getClientRects();else if(u.nodeType==3)l=textRange(u,0,u.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let f=l[c];if(f.bottom>f.top+1&&(n=="up"?a.top-f.top>(f.bottom-a.top)*2:f.bottom-a.bottom>(a.bottom-f.top)*2))return!1}}return!0})}const maybeRTL=/[\u0590-\u08ac]/;function endOfTextblockHorizontal(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,o=!s,a=s==r.parent.content.size,u=t.domSelection();return u?!maybeRTL.test(r.parent.textContent)||!u.modify?n=="left"||n=="backward"?o:a:withFlushedState(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:f,anchorOffset:h}=t.domSelectionRange(),p=u.caretBidiLevel;u.modify("move",n,"character");let m=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:g,focusOffset:b}=t.domSelectionRange(),y=g&&!m.contains(g.nodeType==1?g:g.parentNode)||l==g&&c==b;try{u.collapse(f,h),l&&(l!=f||c!=h)&&u.extend&&u.extend(l,c)}catch{}return p!=null&&(u.caretBidiLevel=p),y}):r.pos==r.start()||r.pos==r.end()}let cachedState=null,cachedDir=null,cachedResult=!1;function endOfTextblock(t,e,n){return cachedState==e&&cachedDir==n?cachedResult:(cachedState=e,cachedDir=n,cachedResult=n=="up"||n=="down"?endOfTextblockVertical(t,e,n):endOfTextblockHorizontal(t,e,n))}const NOT_DIRTY=0,CHILD_DIRTY=1,CONTENT_DIRTY=2,NODE_DIRTY=3;class ViewDesc{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=NOT_DIRTY,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let o,a;if(e==this.contentDOM)o=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.previousSibling}for(;o&&!((a=o.pmViewDesc)&&a.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(a)+a.size:this.posAtStart}else{let o,a;if(e==this.contentDOM)o=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.nextSibling}for(;o&&!((a=o.pmViewDesc)&&a.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(a):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>domIndex(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let o=e;;o=o.parentNode){if(o==this.dom){s=!1;break}if(o.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let o=e;;o=o.parentNode){if(o==this.dom){s=!0;break}if(o.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let o=this.getDesc(s),a;if(o&&(!n||o.node))if(r&&(a=o.nodeDOM)&&!(a.nodeType==1?a.contains(e.nodeType==1?e:e.parentNode):a==e))r=!1;else return o}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let o=this.getDesc(s);if(o)return o.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],o=r+s.size;if(r==e&&o!=r){for(;!s.border&&s.children.length;)s=s.children[0];return s}if(e<o)return s.descAt(e-r-s.border);r=o}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let o=0;r<this.children.length;r++){let a=this.children[r],u=o+a.size;if(u>e||a instanceof TrailingHackViewDesc){s=e-o;break}o=u}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let o;r&&!(o=this.children[r-1]).size&&o instanceof WidgetViewDesc&&o.side>=0;r--);if(n<=0){let o,a=!0;for(;o=r?this.children[r-1]:null,!(!o||o.dom.parentNode==this.contentDOM);r--,a=!1);return o&&n&&a&&!o.border&&!o.domAtom?o.domFromPos(o.size,n):{node:this.contentDOM,offset:o?domIndex(o.dom)+1:0}}else{let o,a=!0;for(;o=r<this.children.length?this.children[r]:null,!(!o||o.dom.parentNode==this.contentDOM);r++,a=!1);return o&&a&&!o.border&&!o.domAtom?o.domFromPos(0,n):{node:this.contentDOM,offset:o?domIndex(o.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,o=-1;for(let a=r,u=0;;u++){let l=this.children[u],c=a+l.size;if(s==-1&&e<=c){let f=a+l.border;if(e>=f&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,f);e=a;for(let h=u;h>0;h--){let p=this.children[h-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){s=domIndex(p.dom)+1;break}e-=p.size}s==-1&&(s=0)}if(s>-1&&(c>n||u==this.children.length-1)){n=c;for(let f=u+1;f<this.children.length;f++){let h=this.children[f];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){o=domIndex(h.dom);break}n+=h.size}o==-1&&(o=this.contentDOM.childNodes.length);break}a=c}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:o}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let o=Math.min(e,n),a=Math.max(e,n);for(let m=0,g=0;m<this.children.length;m++){let b=this.children[m],y=g+b.size;if(o>g&&a<y)return b.setSelection(e-g-b.border,n-g-b.border,r,s);g=y}let u=this.domFromPos(e,e?-1:1),l=n==e?u:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),f=r.domSelectionRange(),h=!1;if((gecko||safari)&&e==n){let{node:m,offset:g}=u;if(m.nodeType==3){if(h=!!(g&&m.nodeValue[g-1]==`
`),h&&g==m.nodeValue.length)for(let b=m,y;b;b=b.parentNode){if(y=b.nextSibling){y.nodeName=="BR"&&(u=l={node:y.parentNode,offset:domIndex(y)+1});break}let _=b.pmViewDesc;if(_&&_.node&&_.node.isBlock)break}}else{let b=m.childNodes[g-1];h=b&&(b.nodeName=="BR"||b.contentEditable=="false")}}if(gecko&&f.focusNode&&f.focusNode!=l.node&&f.focusNode.nodeType==1){let m=f.focusNode.childNodes[f.focusOffset];m&&m.contentEditable=="false"&&(s=!0)}if(!(s||h&&safari)&&isEquivalentPosition(u.node,u.offset,f.anchorNode,f.anchorOffset)&&isEquivalentPosition(l.node,l.offset,f.focusNode,f.focusOffset))return;let p=!1;if((c.extend||e==n)&&!h){c.collapse(u.node,u.offset);try{e!=n&&c.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>n){let g=u;u=l,l=g}let m=document.createRange();m.setEnd(l.node,l.offset),m.setStart(u.node,u.offset),c.removeAllRanges(),c.addRange(m)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let o=this.children[s],a=r+o.size;if(r==a?e<=a&&n>=r:e<a&&n>r){let u=r+o.border,l=a-o.border;if(e>=u&&n<=l){this.dirty=e==r||n==a?CONTENT_DIRTY:CHILD_DIRTY,e==u&&n==l&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=NODE_DIRTY:o.markDirty(e-u,n-u);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?CONTENT_DIRTY:NODE_DIRTY}r=a}this.dirty=CONTENT_DIRTY}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?CONTENT_DIRTY:CHILD_DIRTY;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class WidgetViewDesc extends ViewDesc{constructor(e,n,r,s){let o,a=n.type.toDOM;if(typeof a=="function"&&(a=a(r,()=>{if(!o)return s;if(o.parent)return o.parent.posBeforeChild(o)})),!n.type.spec.raw){if(a.nodeType!=1){let u=document.createElement("span");u.appendChild(a),a=u}a.contentEditable="false",a.classList.add("ProseMirror-widget")}super(e,[],a,null),this.widget=n,this.widget=n,o=this}matchesWidget(e){return this.dirty==NOT_DIRTY&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class CompositionViewDesc extends ViewDesc{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class MarkViewDesc extends ViewDesc{constructor(e,n,r,s,o){super(e,[],r,s),this.mark=n,this.spec=o}static create(e,n,r,s){let o=s.nodeViews[n.type.name],a=o&&o(n,s,r);return(!a||!a.dom)&&(a=DOMSerializer.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new MarkViewDesc(e,n,a.dom,a.contentDOM||a.dom,a)}parseRule(){return this.dirty&NODE_DIRTY||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=NODE_DIRTY&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=NOT_DIRTY){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=NOT_DIRTY}}slice(e,n,r){let s=MarkViewDesc.create(this.parent,this.mark,!0,r),o=this.children,a=this.size;n<a&&(o=replaceNodes(o,n,a,r)),e>0&&(o=replaceNodes(o,0,e,r));for(let u=0;u<o.length;u++)o[u].parent=s;return s.children=o,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class NodeViewDesc extends ViewDesc{constructor(e,n,r,s,o,a,u,l,c){super(e,[],o,a),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=u}static create(e,n,r,s,o,a){let u=o.nodeViews[n.type.name],l,c=u&&u(n,o,()=>{if(!l)return a;if(l.parent)return l.parent.posBeforeChild(l)},r,s),f=c&&c.dom,h=c&&c.contentDOM;if(n.isText){if(!f)f=document.createTextNode(n.text);else if(f.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else f||({dom:f,contentDOM:h}=DOMSerializer.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!h&&!n.isText&&f.nodeName!="BR"&&(f.hasAttribute("contenteditable")||(f.contentEditable="false"),n.type.spec.draggable&&(f.draggable=!0));let p=f;return f=applyOuterDeco(f,r,n),c?l=new CustomNodeViewDesc(e,n,r,s,f,h||null,p,c,o,a+1):n.isText?new TextViewDesc(e,n,r,s,f,p,o):new NodeViewDesc(e,n,r,s,f,h||null,p,o,a+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Fragment.empty)}return e}matchesNode(e,n,r){return this.dirty==NOT_DIRTY&&e.eq(this.node)&&sameOuterDeco(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,o=e.composing?this.localCompositionInfo(e,n):null,a=o&&o.pos>-1?o:null,u=o&&o.pos<0,l=new ViewTreeUpdater(this,a&&a.node,e);iterDeco(this.node,this.innerDeco,(c,f,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!h&&l.syncToMarks(f==this.node.childCount?Mark$1.none:this.node.child(f).marks,r,e),l.placeWidget(c,e,s)},(c,f,h,p)=>{l.syncToMarks(c.marks,r,e);let m;l.findNodeMatch(c,f,h,p)||u&&e.state.selection.from>s&&e.state.selection.to<s+c.nodeSize&&(m=l.findIndexWithChild(o.node))>-1&&l.updateNodeAt(c,f,h,m,e)||l.updateNextNode(c,f,h,e,p,s)||l.addNode(c,f,h,e,s),s+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==CONTENT_DIRTY)&&(a&&this.protectLocalComposition(e,a),renderDescs(this.contentDOM,this.children,e),ios&&iosHacks(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof TextSelection)||r<n||s>n+this.node.content.size)return null;let o=e.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let a=o.nodeValue,u=findTextInFragment(this.node.content,a,r-n,s-n);return u<0?null:{node:o,pos:u,text:a}}else return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let o=n;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let a=new CompositionViewDesc(this,o,n,s);e.input.compositionNodes.push(a),this.children=replaceNodes(this.children,r,r+s.length,e,a)}update(e,n,r,s){return this.dirty==NODE_DIRTY||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=NOT_DIRTY}updateOuterDeco(e){if(sameOuterDeco(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,n),computeOuterDeco(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function docViewDesc(t,e,n,r,s){applyOuterDeco(r,e,t);let o=new NodeViewDesc(void 0,t,e,n,r,r,r,s,0);return o.contentDOM&&o.updateChildren(s,0),o}class TextViewDesc extends NodeViewDesc{constructor(e,n,r,s,o,a,u){super(e,n,r,s,o,null,a,u,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==NODE_DIRTY||this.dirty!=NOT_DIRTY&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=NOT_DIRTY||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=NOT_DIRTY,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),o=document.createTextNode(s.text);return new TextViewDesc(this.parent,s,this.outerDeco,this.innerDeco,o,o,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=NODE_DIRTY)}get domAtom(){return!1}isText(e){return this.node.text==e}}class TrailingHackViewDesc extends ViewDesc{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==NOT_DIRTY&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class CustomNodeViewDesc extends NodeViewDesc{constructor(e,n,r,s,o,a,u,l,c,f){super(e,n,r,s,o,a,u,c,f),this.spec=l}update(e,n,r,s){if(this.dirty==NODE_DIRTY)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let o=this.spec.update(e,n,r);return o&&this.updateInner(e,n,r,s),o}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function renderDescs(t,e,n){let r=t.firstChild,s=!1;for(let o=0;o<e.length;o++){let a=e[o],u=a.dom;if(u.parentNode==t){for(;u!=r;)r=rm(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(u,r);if(a instanceof MarkViewDesc){let l=r?r.previousSibling:t.lastChild;renderDescs(a.contentDOM,a.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=rm(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const OuterDecoLevel=function(t){t&&(this.nodeName=t)};OuterDecoLevel.prototype=Object.create(null);const noDeco=[new OuterDecoLevel];function computeOuterDeco(t,e,n){if(t.length==0)return noDeco;let r=n?noDeco[0]:new OuterDecoLevel,s=[r];for(let o=0;o<t.length;o++){let a=t[o].type.attrs;if(a){a.nodeName&&s.push(r=new OuterDecoLevel(a.nodeName));for(let u in a){let l=a[u];l!=null&&(n&&s.length==1&&s.push(r=new OuterDecoLevel(e.isInline?"span":"div")),u=="class"?r.class=(r.class?r.class+" ":"")+l:u=="style"?r.style=(r.style?r.style+";":"")+l:u!="nodeName"&&(r[u]=l))}}}return s}function patchOuterDeco(t,e,n,r){if(n==noDeco&&r==noDeco)return e;let s=e;for(let o=0;o<r.length;o++){let a=r[o],u=n[o];if(o){let l;u&&u.nodeName==a.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==a.nodeName||(l=document.createElement(a.nodeName),l.pmIsDeco=!0,l.appendChild(s),u=noDeco[0]),s=l}patchAttributes(s,u||noDeco[0],a)}return s}function patchAttributes(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let o=0;o<r.length;o++)s.indexOf(r[o])==-1&&t.classList.remove(r[o]);for(let o=0;o<s.length;o++)r.indexOf(s[o])==-1&&t.classList.add(s[o]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function applyOuterDeco(t,e,n){return patchOuterDeco(t,t,noDeco,computeOuterDeco(e,n,t.nodeType!=1))}function sameOuterDeco(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function rm(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class ViewTreeUpdater{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=preMatch(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,o=this.stack.length>>1,a=Math.min(o,e.length);for(;s<a&&(s==o-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<o;)this.destroyRest(),this.top.dirty=NOT_DIRTY,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let u=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[o])&&!this.isLocked(c.dom)){u=l;break}}if(u>-1)u>this.index&&(this.changed=!0,this.destroyBetween(this.index,u)),this.top=this.top.children[this.index];else{let l=MarkViewDesc.create(this.top,e[o],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,o++}}findNodeMatch(e,n,r,s){let o=-1,a;if(s>=this.preMatch.index&&(a=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&a.matchesNode(e,n,r))o=this.top.children.indexOf(a,this.index);else for(let u=this.index,l=Math.min(this.top.children.length,u+5);u<l;u++){let c=this.top.children[u];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){o=u;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(e,n,r,s,o){let a=this.top.children[s];return a.dirty==NODE_DIRTY&&a.dom==a.contentDOM&&(a.dirty=CONTENT_DIRTY),a.update(e,n,r,o)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,o,a){for(let u=this.index;u<this.top.children.length;u++){let l=this.top.children[u];if(l instanceof NodeViewDesc){let c=this.preMatch.matched.get(l);if(c!=null&&c!=o)return!1;let f=l.dom,h,p=this.isLocked(f)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=NODE_DIRTY&&sameOuterDeco(n,l.outerDeco));if(!p&&l.update(e,n,r,s))return this.destroyBetween(this.index,u),l.dom!=f&&(this.changed=!0),this.index++,!0;if(!p&&(h=this.recreateWrapper(l,e,n,r,s,a)))return this.destroyBetween(this.index,u),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=CONTENT_DIRTY,h.updateChildren(s,a+1),h.dirty=NOT_DIRTY),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,o,a){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!sameOuterDeco(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let u=NodeViewDesc.create(this.top,n,r,s,o,a);if(u.contentDOM){u.children=e.children,e.children=[];for(let l of u.children)l.parent=u}return e.destroy(),u}addNode(e,n,r,s,o){let a=NodeViewDesc.create(this.top,e,n,r,s,o);a.contentDOM&&a.updateChildren(s,o+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let o=new WidgetViewDesc(this.top,e,n,r);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof MarkViewDesc;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof TextViewDesc)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((safari||chrome)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new TrailingHackViewDesc(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function preMatch(t,e){let n=e,r=n.children.length,s=t.childCount,o=new Map,a=[];e:for(;s>0;){let u;for(;;)if(r){let c=n.children[r-1];if(c instanceof MarkViewDesc)n=c,r=c.children.length;else{u=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=u.node;if(l){if(l!=t.child(s-1))break;--s,o.set(u,s),a.push(u)}}return{index:s,matched:o,matches:a.reverse()}}function compareSide(t,e){return t.type.side-e.type.side}function iterDeco(t,e,n,r){let s=e.locals(t),o=0;if(s.length==0){for(let c=0;c<t.childCount;c++){let f=t.child(c);r(f,s,e.forChild(o,f),c),o+=f.nodeSize}return}let a=0,u=[],l=null;for(let c=0;;){let f,h;for(;a<s.length&&s[a].to==o;){let y=s[a++];y.widget&&(f?(h||(h=[f])).push(y):f=y)}if(f)if(h){h.sort(compareSide);for(let y=0;y<h.length;y++)n(h[y],c,!!l)}else n(f,c,!!l);let p,m;if(l)m=-1,p=l,l=null;else if(c<t.childCount)m=c,p=t.child(c++);else break;for(let y=0;y<u.length;y++)u[y].to<=o&&u.splice(y--,1);for(;a<s.length&&s[a].from<=o&&s[a].to>o;)u.push(s[a++]);let g=o+p.nodeSize;if(p.isText){let y=g;a<s.length&&s[a].from<y&&(y=s[a].from);for(let _=0;_<u.length;_++)u[_].to<y&&(y=u[_].to);y<g&&(l=p.cut(y-o),p=p.cut(0,y-o),g=y,m=-1)}else for(;a<s.length&&s[a].to<g;)a++;let b=p.isInline&&!p.isLeaf?u.filter(y=>!y.inline):u.slice();r(p,b,e.forChild(o,p),m),o=g}}function iosHacks(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function findTextInFragment(t,e,n,r){for(let s=0,o=0;s<t.childCount&&o<=r;){let a=t.child(s++),u=o;if(o+=a.nodeSize,!a.isText)continue;let l=a.text;for(;s<t.childCount;){let c=t.child(s++);if(o+=c.nodeSize,!c.isText)break;l+=c.text}if(o>=n){if(o>=r&&l.slice(r-e.length-u,r-u)==e)return r-e.length;let c=u<r?l.lastIndexOf(e,r-u-1):-1;if(c>=0&&c+e.length+u>=n)return u+c;if(n==r&&l.length>=r+e.length-u&&l.slice(r-u,r-u+e.length)==e)return r}}return-1}function replaceNodes(t,e,n,r,s){let o=[];for(let a=0,u=0;a<t.length;a++){let l=t[a],c=u,f=u+=l.size;c>=n||f<=e?o.push(l):(c<e&&o.push(l.slice(0,e-c,r)),s&&(o.push(s),s=void 0),f>n&&o.push(l.slice(n-c,l.size,r)))}return o}function selectionFromDOM(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),o=s&&s.size==0,a=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(a<0)return null;let u=r.resolve(a),l,c;if(selectionCollapsed(n)){for(l=a;s&&!s.node;)s=s.parent;let h=s.node;if(s&&h.isAtom&&NodeSelection.isSelectable(h)&&s.parent&&!(h.isInline&&isOnEdge(n.focusNode,n.focusOffset,s.dom))){let p=s.posBefore;c=new NodeSelection(a==p?u:r.resolve(p))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let h=a,p=a;for(let m=0;m<n.rangeCount;m++){let g=n.getRangeAt(m);h=Math.min(h,t.docView.posFromDOM(g.startContainer,g.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(g.endContainer,g.endOffset,-1))}if(h<0)return null;[l,a]=p==t.state.selection.anchor?[p,h]:[h,p],u=r.resolve(a)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let f=r.resolve(l);if(!c){let h=e=="pointer"||t.state.selection.head<u.pos&&!o?1:-1;c=selectionBetween(t,f,u,h)}return c}function editorOwnsSelection(t){return t.editable?t.hasFocus():hasSelection(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function selectionToDOM(t,e=!1){let n=t.state.selection;if(syncNodeSelection(t,n),!!editorOwnsSelection(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&chrome){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&isEquivalentPosition(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)selectCursorWrapper(t);else{let{anchor:r,head:s}=n,o,a;brokenSelectBetweenUneditable&&!(n instanceof TextSelection)&&(n.$from.parent.inlineContent||(o=temporarilyEditableNear(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(a=temporarilyEditableNear(t,n.to))),t.docView.setSelection(r,s,t,e),brokenSelectBetweenUneditable&&(o&&resetEditable(o),a&&resetEditable(a)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&removeClassOnSelectionChange(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const brokenSelectBetweenUneditable=safari||chrome&&chrome_version<63;function temporarilyEditableNear(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,o=r?n.childNodes[r-1]:null;if(safari&&s&&s.contentEditable=="false")return setEditable(s);if((!s||s.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(s)return setEditable(s);if(o)return setEditable(o)}}function setEditable(t){return t.contentEditable="true",safari&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function resetEditable(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function removeClassOnSelectionChange(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!editorOwnsSelection(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function selectCursorWrapper(t){let e=t.domSelection(),n=document.createRange();if(!e)return;let r=t.cursorWrapper.dom,s=r.nodeName=="IMG";s?n.setStart(r.parentNode,domIndex(r)+1):n.setStart(r,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!s&&!t.state.selection.visible&&ie$1&&ie_version<=11&&(r.disabled=!0,r.disabled=!1)}function syncNodeSelection(t,e){if(e instanceof NodeSelection){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(clearNodeSelection(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else clearNodeSelection(t)}function clearNodeSelection(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function selectionBetween(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||TextSelection.between(e,n,r)}function hasFocusAndSelection(t){return t.editable&&!t.hasFocus()?!1:hasSelection(t)}function hasSelection(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function anchorInRightPlace(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return isEquivalentPosition(e.node,e.offset,n.anchorNode,n.anchorOffset)}function moveSelectionBlock(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),o=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return o&&Selection.findFrom(o,e)}function apply(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function selectHorizontally(t,e,n){let r=t.state.selection;if(r instanceof TextSelection)if(n.indexOf("s")>-1){let{$head:s}=r,o=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let a=t.state.doc.resolve(s.pos+o.nodeSize*(e<0?-1:1));return apply(t,new TextSelection(r.$anchor,a))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=moveSelectionBlock(t.state,e);return s&&s instanceof NodeSelection?apply(t,s):!1}else if(!(mac$2&&n.indexOf("m")>-1)){let s=r.$head,o=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,a;if(!o||o.isText)return!1;let u=e<0?s.pos-o.nodeSize:s.pos;return o.isAtom||(a=t.docView.descAt(u))&&!a.contentDOM?NodeSelection.isSelectable(o)?apply(t,new NodeSelection(e<0?t.state.doc.resolve(s.pos-o.nodeSize):s)):webkit?apply(t,new TextSelection(t.state.doc.resolve(e<0?u:u+o.nodeSize))):!1:!1}}else return!1;else{if(r instanceof NodeSelection&&r.node.isInline)return apply(t,new TextSelection(e>0?r.$to:r.$from));{let s=moveSelectionBlock(t.state,e);return s?apply(t,s):!1}}}function nodeLen(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function isIgnorable(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function skipIgnoredNodes(t,e){return e<0?skipIgnoredNodesBefore(t):skipIgnoredNodesAfter(t)}function skipIgnoredNodesBefore(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,o,a=!1;for(gecko&&n.nodeType==1&&r<nodeLen(n)&&isIgnorable(n.childNodes[r],-1)&&(a=!0);;)if(r>0){if(n.nodeType!=1)break;{let u=n.childNodes[r-1];if(isIgnorable(u,-1))s=n,o=--r;else if(u.nodeType==3)n=u,r=n.nodeValue.length;else break}}else{if(isBlockNode(n))break;{let u=n.previousSibling;for(;u&&isIgnorable(u,-1);)s=n.parentNode,o=domIndex(u),u=u.previousSibling;if(u)n=u,r=nodeLen(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}a?setSelFocus(t,n,r):s&&setSelFocus(t,s,o)}function skipIgnoredNodesAfter(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=nodeLen(n),o,a;for(;;)if(r<s){if(n.nodeType!=1)break;let u=n.childNodes[r];if(isIgnorable(u,1))o=n,a=++r;else break}else{if(isBlockNode(n))break;{let u=n.nextSibling;for(;u&&isIgnorable(u,1);)o=u.parentNode,a=domIndex(u)+1,u=u.nextSibling;if(u)n=u,r=0,s=nodeLen(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}o&&setSelFocus(t,o,a)}function isBlockNode(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function textNodeAfter(t,e){for(;t&&e==t.childNodes.length&&!hasBlockDesc(t);)e=domIndex(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function textNodeBefore(t,e){for(;t&&!e&&!hasBlockDesc(t);)e=domIndex(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function setSelFocus(t,e,n){if(e.nodeType!=3){let o,a;(a=textNodeAfter(e,n))?(e=a,n=0):(o=textNodeBefore(e,n))&&(e=o,n=o.nodeValue.length)}let r=t.domSelection();if(!r)return;if(selectionCollapsed(r)){let o=document.createRange();o.setEnd(e,n),o.setStart(e,n),r.removeAllRanges(),r.addRange(o)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&selectionToDOM(t)},50)}function findDirection(t,e){let n=t.state.doc.resolve(e);if(!(chrome||windows)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let o=t.coordsAtPos(e-1),a=(o.top+o.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(o.left-s.left)>1)return o.left<s.left?"ltr":"rtl"}if(e<n.end()){let o=t.coordsAtPos(e+1),a=(o.top+o.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(o.left-s.left)>1)return o.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function selectVertically(t,e,n){let r=t.state.selection;if(r instanceof TextSelection&&!r.empty||n.indexOf("s")>-1||mac$2&&n.indexOf("m")>-1)return!1;let{$from:s,$to:o}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let a=moveSelectionBlock(t.state,e);if(a&&a instanceof NodeSelection)return apply(t,a)}if(!s.parent.inlineContent){let a=e<0?s:o,u=r instanceof AllSelection?Selection.near(a,e):Selection.findFrom(a,e);return u?apply(t,u):!1}return!1}function stopNativeHorizontalDelete(t,e){if(!(t.state.selection instanceof TextSelection))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let o=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let a=t.state.tr;return e<0?a.delete(n.pos-o.nodeSize,n.pos):a.delete(n.pos,n.pos+o.nodeSize),t.dispatch(a),!0}return!1}function switchEditable(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function safariDownArrowBug(t){if(!safari||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;switchEditable(t,r,"true"),setTimeout(()=>switchEditable(t,r,"false"),20)}return!1}function getMods(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function captureKeyDown(t,e){let n=e.keyCode,r=getMods(e);if(n==8||mac$2&&n==72&&r=="c")return stopNativeHorizontalDelete(t,-1)||skipIgnoredNodes(t,-1);if(n==46&&!e.shiftKey||mac$2&&n==68&&r=="c")return stopNativeHorizontalDelete(t,1)||skipIgnoredNodes(t,1);if(n==13||n==27)return!0;if(n==37||mac$2&&n==66&&r=="c"){let s=n==37?findDirection(t,t.state.selection.from)=="ltr"?-1:1:-1;return selectHorizontally(t,s,r)||skipIgnoredNodes(t,s)}else if(n==39||mac$2&&n==70&&r=="c"){let s=n==39?findDirection(t,t.state.selection.from)=="ltr"?1:-1:1;return selectHorizontally(t,s,r)||skipIgnoredNodes(t,s)}else{if(n==38||mac$2&&n==80&&r=="c")return selectVertically(t,-1,r)||skipIgnoredNodes(t,-1);if(n==40||mac$2&&n==78&&r=="c")return safariDownArrowBug(t)||selectVertically(t,1,r)||skipIgnoredNodes(t,1);if(r==(mac$2?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function serializeForClipboard(t,e){t.someProp("transformCopied",m=>{e=m(e,t)});let n=[],{content:r,openStart:s,openEnd:o}=e;for(;s>1&&o>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,o--;let m=r.firstChild;n.push(m.type.name,m.attrs!=m.type.defaultAttrs?m.attrs:null),r=m.content}let a=t.someProp("clipboardSerializer")||DOMSerializer.fromSchema(t.state.schema),u=detachedDoc(),l=u.createElement("div");l.appendChild(a.serializeFragment(r,{document:u}));let c=l.firstChild,f,h=0;for(;c&&c.nodeType==1&&(f=wrapMap[c.nodeName.toLowerCase()]);){for(let m=f.length-1;m>=0;m--){let g=u.createElement(f[m]);for(;l.firstChild;)g.appendChild(l.firstChild);l.appendChild(g),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${o}${h?` -${h}`:""} ${JSON.stringify(n)}`);let p=t.someProp("clipboardTextSerializer",m=>m(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function parseFromClipboard(t,e,n,r,s){let o=s.parent.type.spec.code,a,u;if(!n&&!e)return null;let l=e&&(r||o||!n);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,o||r,t)}),o)return e?new Slice(Fragment.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):Slice.empty;let h=t.someProp("clipboardTextParser",p=>p(e,s,r,t));if(h)u=h;else{let p=s.marks(),{schema:m}=t.state,g=DOMSerializer.fromSchema(m);a=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(b=>{let y=a.appendChild(document.createElement("p"));b&&y.appendChild(g.serializeNode(m.text(b,p)))})}}else t.someProp("transformPastedHTML",h=>{n=h(n,t)}),a=readHTML(n),webkit&&restoreReplacedSpaces(a);let c=a&&a.querySelector("[data-pm-slice]"),f=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(f&&f[3])for(let h=+f[3];h>0;h--){let p=a.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;a=p}if(u||(u=(t.someProp("clipboardParser")||t.someProp("domParser")||DOMParser.fromSchema(t.state.schema)).parseSlice(a,{preserveWhitespace:!!(l||f),context:s,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!inlineParents.test(p.parentNode.nodeName)?{ignore:!0}:null}})),f)u=addContext(closeSlice(u,+f[1],+f[2]),f[4]);else if(u=Slice.maxOpen(normalizeSiblings(u.content,s),!0),u.openStart||u.openEnd){let h=0,p=0;for(let m=u.content.firstChild;h<u.openStart&&!m.type.spec.isolating;h++,m=m.firstChild);for(let m=u.content.lastChild;p<u.openEnd&&!m.type.spec.isolating;p++,m=m.lastChild);u=closeSlice(u,h,p)}return t.someProp("transformPasted",h=>{u=h(u,t)}),u}const inlineParents=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function normalizeSiblings(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),o,a=[];if(t.forEach(u=>{if(!a)return;let l=s.findWrapping(u.type),c;if(!l)return a=null;if(c=a.length&&o.length&&addToSibling(l,o,u,a[a.length-1],0))a[a.length-1]=c;else{a.length&&(a[a.length-1]=closeRight(a[a.length-1],o.length));let f=withWrappers(u,l);a.push(f),s=s.matchType(f.type),o=l}}),a)return Fragment.from(a)}return t}function withWrappers(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Fragment.from(t));return t}function addToSibling(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let o=addToSibling(t,e,n,r.lastChild,s+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(Fragment.from(withWrappers(n,t,s+1))))}}function closeRight(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,closeRight(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Fragment.empty,!0);return t.copy(n.append(r))}function closeRange(t,e,n,r,s,o){let a=e<0?t.firstChild:t.lastChild,u=a.content;return t.childCount>1&&(o=0),s<r-1&&(u=closeRange(u,e,n,r,s+1,o)),s>=n&&(u=e<0?a.contentMatchAt(0).fillBefore(u,o<=s).append(u):u.append(a.contentMatchAt(a.childCount).fillBefore(Fragment.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,a.copy(u))}function closeSlice(t,e,n){return e<t.openStart&&(t=new Slice(closeRange(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Slice(closeRange(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let _detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}let _policy=null;function maybeWrapTrusted(t){let e=window.trustedTypes;return e?(_policy||(_policy=e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),_policy.createHTML(t)):t}function readHTML(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=detachedDoc().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&wrapMap[r[1].toLowerCase()])&&(t=s.map(o=>"<"+o+">").join("")+t+s.map(o=>"</"+o+">").reverse().join("")),n.innerHTML=maybeWrapTrusted(t),s)for(let o=0;o<s.length;o++)n=n.querySelector(s[o])||n;return n}function restoreReplacedSpaces(t){let e=t.querySelectorAll(chrome?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function addContext(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:o,openEnd:a}=t;for(let u=r.length-2;u>=0;u-=2){let l=n.nodes[r[u]];if(!l||l.hasRequiredAttrs())break;s=Fragment.from(l.create(r[u+1],s)),o++,a++}return new Slice(s,o,a)}const handlers={},editHandlers={},passiveHandlers={touchstart:!0,touchmove:!0};class InputState{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function initInput(t){for(let e in handlers){let n=handlers[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{eventBelongsToView(t,r)&&!runCustomHandler(t,r)&&(t.editable||!(r.type in editHandlers))&&n(t,r)},passiveHandlers[e]?{passive:!0}:void 0)}safari&&t.dom.addEventListener("input",()=>null),ensureListeners(t)}function setSelectionOrigin(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function destroyInput(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function ensureListeners(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>runCustomHandler(t,r))})}function runCustomHandler(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function eventBelongsToView(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function dispatchEvent(t,e){!runCustomHandler(t,e)&&handlers[e.type]&&(t.editable||!(e.type in editHandlers))&&handlers[e.type](t,e)}editHandlers.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!inOrNearComposition(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(android&&chrome&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),ios&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,keyEvent(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||captureKeyDown(t,n)?n.preventDefault():setSelectionOrigin(t,"key")};editHandlers.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};editHandlers.keypress=(t,e)=>{let n=e;if(inOrNearComposition(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||mac$2&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof TextSelection)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode);!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s))&&t.dispatch(t.state.tr.insertText(s).scrollIntoView()),n.preventDefault()}};function eventCoords(t){return{left:t.clientX,top:t.clientY}}function isNear(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function runHandlerOnContext(t,e,n,r,s){if(r==-1)return!1;let o=t.state.doc.resolve(r);for(let a=o.depth+1;a>0;a--)if(t.someProp(e,u=>a>o.depth?u(t,n,o.nodeAfter,o.before(a),s,!0):u(t,n,o.node(a),o.before(a),s,!1)))return!0;return!1}function updateSelection(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function selectClickedLeaf(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&NodeSelection.isSelectable(r)?(updateSelection(t,new NodeSelection(n)),!0):!1}function selectClickedNode(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof NodeSelection&&(r=n.node);let o=t.state.doc.resolve(e);for(let a=o.depth+1;a>0;a--){let u=a>o.depth?o.nodeAfter:o.node(a);if(NodeSelection.isSelectable(u)){r&&n.$from.depth>0&&a>=n.$from.depth&&o.before(n.$from.depth+1)==n.$from.pos?s=o.before(n.$from.depth):s=o.before(a);break}}return s!=null?(updateSelection(t,NodeSelection.create(t.state.doc,s)),!0):!1}function handleSingleClick(t,e,n,r,s){return runHandlerOnContext(t,"handleClickOn",e,n,r)||t.someProp("handleClick",o=>o(t,e,r))||(s?selectClickedNode(t,n):selectClickedLeaf(t,n))}function handleDoubleClick(t,e,n,r){return runHandlerOnContext(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function handleTripleClick(t,e,n,r){return runHandlerOnContext(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||defaultTripleClick(t,n,r)}function defaultTripleClick(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(updateSelection(t,TextSelection.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o),u=s.before(o);if(a.inlineContent)updateSelection(t,TextSelection.create(r,u+1,u+1+a.content.size));else if(NodeSelection.isSelectable(a))updateSelection(t,NodeSelection.create(r,u));else continue;return!0}}function forceDOMFlush(t){return endComposition(t)}const selectNodeModifier=mac$2?"metaKey":"ctrlKey";handlers.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=forceDOMFlush(t),s=Date.now(),o="singleClick";s-t.input.lastClick.time<500&&isNear(n,t.input.lastClick)&&!n[selectNodeModifier]&&(t.input.lastClick.type=="singleClick"?o="doubleClick":t.input.lastClick.type=="doubleClick"&&(o="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:o};let a=t.posAtCoords(eventCoords(n));a&&(o=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new MouseDown(t,a,n,!!r)):(o=="doubleClick"?handleDoubleClick:handleTripleClick)(t,a.pos,a.inside,n)?n.preventDefault():setSelectionOrigin(t,"pointer"))};class MouseDown{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[selectNodeModifier],this.allowDefault=r.shiftKey;let o,a;if(n.inside>-1)o=e.state.doc.nodeAt(n.inside),a=n.inside;else{let f=e.state.doc.resolve(n.pos);o=f.parent,a=f.depth?f.before():0}const u=s?null:r.target,l=u?e.docView.nearestDesc(u,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=e.state;(r.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||c instanceof NodeSelection&&c.from<=a&&c.to>a)&&(this.mightDrag={node:o,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&gecko&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>selectionToDOM(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(eventCoords(e))),this.updateAllowDefault(e),this.allowDefault||!n?setSelectionOrigin(this.view,"pointer"):handleSingleClick(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||safari&&this.mightDrag&&!this.mightDrag.node.isAtom||chrome&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(updateSelection(this.view,Selection.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):setSelectionOrigin(this.view,"pointer")}move(e){this.updateAllowDefault(e),setSelectionOrigin(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}handlers.touchstart=t=>{t.input.lastTouch=Date.now(),forceDOMFlush(t),setSelectionOrigin(t,"pointer")};handlers.touchmove=t=>{t.input.lastTouch=Date.now(),setSelectionOrigin(t,"pointer")};handlers.contextmenu=t=>forceDOMFlush(t);function inOrNearComposition(t,e){return t.composing?!0:safari&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const timeoutComposition=android?5e3:-1;editHandlers.compositionstart=editHandlers.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof TextSelection&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),endComposition(t,!0),t.markCursor=null;else if(endComposition(t,!e.selection.empty),gecko&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,o=r.focusOffset;s&&s.nodeType==1&&o!=0;){let a=o<0?s.lastChild:s.childNodes[o-1];if(!a)break;if(a.nodeType==3){let u=t.domSelection();u&&u.collapse(a,a.nodeValue.length);break}else s=a,o=-1}}t.input.composing=!0}scheduleComposeEnd(t,timeoutComposition)};editHandlers.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,scheduleComposeEnd(t,20))};function scheduleComposeEnd(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>endComposition(t),e))}function clearComposition(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=timestampFromCustomEvent());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function findCompositionNode(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=textNodeBefore$1(e.focusNode,e.focusOffset),r=textNodeAfter$1(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,o=t.domObserver.lastChangedTextNode;if(n==o||r==o)return o;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let a=n.pmViewDesc;if(!(!a||!a.isText(n.nodeValue)))return r}}return n||r}function timestampFromCustomEvent(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function endComposition(t,e=!1){if(!(android&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),clearComposition(t),e||t.docView&&t.docView.dirty){let n=selectionFromDOM(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!t.state.selection.empty?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function captureCopy(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const brokenClipboardAPI=ie$1&&ie_version<15||ios&&webkit_version<604;handlers.copy=editHandlers.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let o=brokenClipboardAPI?null:n.clipboardData,a=r.content(),{dom:u,text:l}=serializeForClipboard(t,a);o?(n.preventDefault(),o.clearData(),o.setData("text/html",u.innerHTML),o.setData("text/plain",l)):captureCopy(t,u),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function sliceSingleNode(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function capturePaste(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?doPaste(t,r.value,null,s,e):doPaste(t,r.textContent,r.innerHTML,s,e)},50)}function doPaste(t,e,n,r,s){let o=parseFromClipboard(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,o||Slice.empty)))return!0;if(!o)return!1;let a=sliceSingleNode(o),u=a?t.state.tr.replaceSelectionWith(a,r):t.state.tr.replaceSelection(o);return t.dispatch(u.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function getText$1(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}editHandlers.paste=(t,e)=>{let n=e;if(t.composing&&!android)return;let r=brokenClipboardAPI?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&doPaste(t,getText$1(r),r.getData("text/html"),s,n)?n.preventDefault():capturePaste(t,n)};class Dragging{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const dragCopyModifier=mac$2?"altKey":"ctrlKey";handlers.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,o=s.empty?null:t.posAtCoords(eventCoords(n)),a;if(!(o&&o.pos>=s.from&&o.pos<=(s instanceof NodeSelection?s.to-1:s.to))){if(r&&r.mightDrag)a=NodeSelection.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let h=t.docView.nearestDesc(n.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(a=NodeSelection.create(t.state.doc,h.posBefore))}}let u=(a||t.state.selection).content(),{dom:l,text:c,slice:f}=serializeForClipboard(t,u);(!n.dataTransfer.files.length||!chrome||chrome_version>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(brokenClipboardAPI?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI||n.dataTransfer.setData("text/plain",c),t.dragging=new Dragging(f,!n[dragCopyModifier],a)};handlers.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};editHandlers.dragover=editHandlers.dragenter=(t,e)=>e.preventDefault();editHandlers.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let s=t.posAtCoords(eventCoords(n));if(!s)return;let o=t.state.doc.resolve(s.pos),a=r&&r.slice;a?t.someProp("transformPasted",g=>{a=g(a,t)}):a=parseFromClipboard(t,getText$1(n.dataTransfer),brokenClipboardAPI?null:n.dataTransfer.getData("text/html"),!1,o);let u=!!(r&&!n[dragCopyModifier]);if(t.someProp("handleDrop",g=>g(t,n,a||Slice.empty,u))){n.preventDefault();return}if(!a)return;n.preventDefault();let l=a?dropPoint(t.state.doc,o.pos,a):o.pos;l==null&&(l=o.pos);let c=t.state.tr;if(u){let{node:g}=r;g?g.replace(c):c.deleteSelection()}let f=c.mapping.map(l),h=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,p=c.doc;if(h?c.replaceRangeWith(f,f,a.content.firstChild):c.replaceRange(f,f,a),c.doc.eq(p))return;let m=c.doc.resolve(f);if(h&&NodeSelection.isSelectable(a.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(a.content.firstChild))c.setSelection(new NodeSelection(m));else{let g=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((b,y,_,x)=>g=x),c.setSelection(selectionBetween(t,m,c.doc.resolve(g)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};handlers.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&selectionToDOM(t)},20))};handlers.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};handlers.beforeinput=(t,e)=>{if(chrome&&android&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",o=>o(t,keyEvent(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in editHandlers)handlers[t]=editHandlers[t];function compareObjs(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class WidgetType{constructor(e,n){this.toDOM=e,this.spec=n||noSpec,this.side=this.spec.side||0}map(e,n,r,s){let{pos:o,deleted:a}=e.mapResult(n.from+s,this.side<0?-1:1);return a?null:new Decoration(o-r,o-r,this)}valid(){return!0}eq(e){return this==e||e instanceof WidgetType&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&compareObjs(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class InlineType{constructor(e,n){this.attrs=e,this.spec=n||noSpec}map(e,n,r,s){let o=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,a=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return o>=a?null:new Decoration(o,a,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof InlineType&&compareObjs(this.attrs,e.attrs)&&compareObjs(this.spec,e.spec)}static is(e){return e.type instanceof InlineType}destroy(){}}class NodeType{constructor(e,n){this.attrs=e,this.spec=n||noSpec}map(e,n,r,s){let o=e.mapResult(n.from+s,1);if(o.deleted)return null;let a=e.mapResult(n.to+s,-1);return a.deleted||a.pos<=o.pos?null:new Decoration(o.pos-r,a.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),o;return s==n.from&&!(o=e.child(r)).isText&&s+o.nodeSize==n.to}eq(e){return this==e||e instanceof NodeType&&compareObjs(this.attrs,e.attrs)&&compareObjs(this.spec,e.spec)}destroy(){}}class Decoration{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Decoration(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Decoration(e,e,new WidgetType(n,r))}static inline(e,n,r,s){return new Decoration(e,n,new InlineType(r,s))}static node(e,n,r,s){return new Decoration(e,n,new NodeType(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof InlineType}get widget(){return this.type instanceof WidgetType}}const none=[],noSpec={};class DecorationSet{constructor(e,n){this.local=e.length?e:none,this.children=n.length?n:none}static create(e,n){return n.length?buildTree(n,e,0,noSpec):empty}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,o){for(let a=0;a<this.local.length;a++){let u=this.local[a];u.from<=n&&u.to>=e&&(!o||o(u.spec))&&r.push(u.copy(u.from+s,u.to+s))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<n&&this.children[a+1]>e){let u=this.children[a]+1;this.children[a+2].findInner(e-u,n-u,r,s+u,o)}}map(e,n,r){return this==empty||e.maps.length==0?this:this.mapInner(e,n,0,0,r||noSpec)}mapInner(e,n,r,s,o){let a;for(let u=0;u<this.local.length;u++){let l=this.local[u].map(e,r,s);l&&l.type.valid(n,l)?(a||(a=[])).push(l):o.onRemove&&o.onRemove(this.local[u].spec)}return this.children.length?mapChildren(this.children,a||[],e,n,r,s,o):a?new DecorationSet(a.sort(byPos),none):empty}add(e,n){return n.length?this==empty?DecorationSet.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,o=0;e.forEach((u,l)=>{let c=l+r,f;if(f=takeSpansForNode(n,u,c)){for(s||(s=this.children.slice());o<s.length&&s[o]<l;)o+=3;s[o]==l?s[o+2]=s[o+2].addInner(u,f,c+1):s.splice(o,0,l,l+u.nodeSize,buildTree(f,u,c+1,noSpec)),o+=3}});let a=moveSpans(o?withoutNulls(n):n,-r);for(let u=0;u<a.length;u++)a[u].type.valid(e,a[u])||a.splice(u--,1);return new DecorationSet(a.length?this.local.concat(a).sort(byPos):this.local,s||this.children)}remove(e){return e.length==0||this==empty?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let o=0;o<r.length;o+=3){let a,u=r[o]+n,l=r[o+1]+n;for(let f=0,h;f<e.length;f++)(h=e[f])&&h.from>u&&h.to<l&&(e[f]=null,(a||(a=[])).push(h));if(!a)continue;r==this.children&&(r=this.children.slice());let c=r[o+2].removeInner(a,u+1);c!=empty?r[o+2]=c:(r.splice(o,3),o-=3)}if(s.length){for(let o=0,a;o<e.length;o++)if(a=e[o])for(let u=0;u<s.length;u++)s[u].eq(a,n)&&(s==this.local&&(s=this.local.slice()),s.splice(u--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new DecorationSet(s,r):empty}forChild(e,n){if(this==empty)return this;if(n.isLeaf)return DecorationSet.empty;let r,s;for(let u=0;u<this.children.length;u+=3)if(this.children[u]>=e){this.children[u]==e&&(r=this.children[u+2]);break}let o=e+1,a=o+n.content.size;for(let u=0;u<this.local.length;u++){let l=this.local[u];if(l.from<a&&l.to>o&&l.type instanceof InlineType){let c=Math.max(o,l.from)-o,f=Math.min(a,l.to)-o;c<f&&(s||(s=[])).push(l.copy(c,f))}}if(s){let u=new DecorationSet(s.sort(byPos),none);return r?new DecorationGroup([u,r]):u}return r||empty}eq(e){if(this==e)return!0;if(!(e instanceof DecorationSet)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return removeOverlap(this.localsInner(e))}localsInner(e){if(this==empty)return none;if(e.inlineContent||!this.local.some(InlineType.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof InlineType||n.push(this.local[r]);return n}forEachSet(e){e(this)}}DecorationSet.empty=new DecorationSet([],[]);DecorationSet.removeOverlap=removeOverlap;const empty=DecorationSet.empty;class DecorationGroup{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,noSpec));return DecorationGroup.from(r)}forChild(e,n){if(n.isLeaf)return DecorationSet.empty;let r=[];for(let s=0;s<this.members.length;s++){let o=this.members[s].forChild(e,n);o!=empty&&(o instanceof DecorationGroup?r=r.concat(o.members):r.push(o))}return DecorationGroup.from(r)}eq(e){if(!(e instanceof DecorationGroup)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let o=this.members[s].localsInner(e);if(o.length)if(!n)n=o;else{r&&(n=n.slice(),r=!1);for(let a=0;a<o.length;a++)n.push(o[a])}}return n?removeOverlap(r?n:n.sort(byPos)):none}static from(e){switch(e.length){case 0:return empty;case 1:return e[0];default:return new DecorationGroup(e.every(n=>n instanceof DecorationSet)?e:e.reduce((n,r)=>n.concat(r instanceof DecorationSet?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function mapChildren(t,e,n,r,s,o,a){let u=t.slice();for(let c=0,f=o;c<n.maps.length;c++){let h=0;n.maps[c].forEach((p,m,g,b)=>{let y=b-g-(m-p);for(let _=0;_<u.length;_+=3){let x=u[_+1];if(x<0||p>x+f-h)continue;let E=u[_]+f-h;m>=E?u[_+1]=p<=E?-2:-1:p>=f&&y&&(u[_]+=y,u[_+1]+=y)}h+=y}),f=n.maps[c].map(f,-1)}let l=!1;for(let c=0;c<u.length;c+=3)if(u[c+1]<0){if(u[c+1]==-2){l=!0,u[c+1]=-1;continue}let f=n.map(t[c]+o),h=f-s;if(h<0||h>=r.content.size){l=!0;continue}let p=n.map(t[c+1]+o,-1),m=p-s,{index:g,offset:b}=r.content.findIndex(h),y=r.maybeChild(g);if(y&&b==h&&b+y.nodeSize==m){let _=u[c+2].mapInner(n,y,f+1,t[c]+o+1,a);_!=empty?(u[c]=h,u[c+1]=m,u[c+2]=_):(u[c+1]=-2,l=!0)}else l=!0}if(l){let c=mapAndGatherRemainingDecorations(u,t,e,n,s,o,a),f=buildTree(c,r,0,a);e=f.local;for(let h=0;h<u.length;h+=3)u[h+1]<0&&(u.splice(h,3),h-=3);for(let h=0,p=0;h<f.children.length;h+=3){let m=f.children[h];for(;p<u.length&&u[p]<m;)p+=3;u.splice(p,0,f.children[h],f.children[h+1],f.children[h+2])}}return new DecorationSet(e.sort(byPos),u)}function moveSpans(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new Decoration(s.from+e,s.to+e,s.type))}return n}function mapAndGatherRemainingDecorations(t,e,n,r,s,o,a){function u(l,c){for(let f=0;f<l.local.length;f++){let h=l.local[f].map(r,s,c);h?n.push(h):a.onRemove&&a.onRemove(l.local[f].spec)}for(let f=0;f<l.children.length;f+=3)u(l.children[f+2],l.children[f]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&u(t[l+2],e[l]+o+1);return n}function takeSpansForNode(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let o=0,a;o<t.length;o++)(a=t[o])&&a.from>n&&a.to<r&&((s||(s=[])).push(a),t[o]=null);return s}function withoutNulls(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function buildTree(t,e,n,r){let s=[],o=!1;e.forEach((u,l)=>{let c=takeSpansForNode(t,u,l+n);if(c){o=!0;let f=buildTree(c,u,n+l+1,r);f!=empty&&s.push(l,l+u.nodeSize,f)}});let a=moveSpans(o?withoutNulls(t):t,-n).sort(byPos);for(let u=0;u<a.length;u++)a[u].type.valid(e,a[u])||(r.onRemove&&r.onRemove(a[u].spec),a.splice(u--,1));return a.length||s.length?new DecorationSet(a,s):empty}function byPos(t,e){return t.from-e.from||t.to-e.to}function removeOverlap(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let o=e[s];if(o.from==r.from){o.to!=r.to&&(e==t&&(e=t.slice()),e[s]=o.copy(o.from,r.to),insertAhead(e,s+1,o.copy(r.to,o.to)));continue}else{o.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,o.from),insertAhead(e,s,r.copy(o.from,r.to)));break}}}return e}function insertAhead(t,e,n){for(;e<t.length&&byPos(n,t[e])>0;)e++;t.splice(e,0,n)}function viewDecorations(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=empty&&e.push(r)}),t.cursorWrapper&&e.push(DecorationSet.create(t.state.doc,[t.cursorWrapper.deco])),DecorationGroup.from(e)}const observeOptions={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},useCharData=ie$1&&ie_version<=11;class SelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class DOMObserver{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new SelectionState,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);ie$1&&ie_version<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),useCharData&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,observeOptions)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(hasFocusAndSelection(this.view)){if(this.suppressingSelectionUpdates)return selectionToDOM(this.view);if(ie$1&&ie_version<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&isEquivalentPosition(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let o=e.focusNode;o;o=parentNode(o))n.add(o);for(let o=e.anchorNode;o;o=parentNode(o))if(n.has(o)){r=o;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&hasFocusAndSelection(e)&&!this.ignoreSelectionChange(r),o=-1,a=-1,u=!1,l=[];if(e.editable)for(let f=0;f<n.length;f++){let h=this.registerMutation(n[f],l);h&&(o=o<0?h.from:Math.min(h.from,o),a=a<0?h.to:Math.max(h.to,a),h.typeOver&&(u=!0))}if(gecko&&l.length){let f=l.filter(h=>h.nodeName=="BR");if(f.length==2){let[h,p]=f;h.parentNode&&h.parentNode.parentNode==p.parentNode?p.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let p of f){let m=p.parentNode;m&&m.nodeName=="LI"&&(!h||blockParent(e,h)!=m)&&p.remove()}}}let c=null;o<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&selectionCollapsed(r)&&(c=selectionFromDOM(e))&&c.eq(Selection.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,selectionToDOM(e),this.currentSelection.set(r),e.scrollToSelection()):(o>-1||s)&&(o>-1&&(e.docView.markDirty(o,a),checkCSS(e)),this.handleDOMChange(o,a,u,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||selectionToDOM(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let f=0;f<e.addedNodes.length;f++){let h=e.addedNodes[f];n.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,o=e.nextSibling;if(ie$1&&ie_version<=11&&e.addedNodes.length)for(let f=0;f<e.addedNodes.length;f++){let{previousSibling:h,nextSibling:p}=e.addedNodes[f];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(o=p)}let a=s&&s.parentNode==e.target?domIndex(s)+1:0,u=r.localPosFromDOM(e.target,a,-1),l=o&&o.parentNode==e.target?domIndex(o):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:u,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let cssChecked=new WeakMap,cssCheckWarned=!1;function checkCSS(t){if(!cssChecked.has(t)&&(cssChecked.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=gecko,cssCheckWarned)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cssCheckWarned=!0}}function rangeToSelectionRange(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,o=e.endOffset,a=t.domAtPos(t.state.selection.anchor);return isEquivalentPosition(a.node,a.offset,s,o)&&([n,r,s,o]=[s,o,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:o}}function safariShadowSelectionRange(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return rangeToSelectionRange(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?rangeToSelectionRange(t,n):null}function blockParent(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function parseBetween(t,e,n){let{node:r,fromOffset:s,toOffset:o,from:a,to:u}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,f=l.anchorNode;if(f&&t.dom.contains(f.nodeType==1?f:f.parentNode)&&(c=[{node:f,offset:l.anchorOffset}],selectionCollapsed(l)||c.push({node:l.focusNode,offset:l.focusOffset})),chrome&&t.input.lastKeyCode===8)for(let y=o;y>s;y--){let _=r.childNodes[y-1],x=_.pmViewDesc;if(_.nodeName=="BR"&&!x){o=y;break}if(!x||x.size)break}let h=t.state.doc,p=t.someProp("domParser")||DOMParser.fromSchema(t.state.schema),m=h.resolve(a),g=null,b=p.parse(r,{topNode:m.parent,topMatch:m.parent.contentMatchAt(m.index()),topOpen:!0,from:s,to:o,preserveWhitespace:m.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode,context:m});if(c&&c[0].pos!=null){let y=c[0].pos,_=c[1]&&c[1].pos;_==null&&(_=y),g={anchor:y+a,head:_+a}}return{doc:b,sel:g,from:a,to:u}}function ruleFromNode(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(safari&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||safari&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const isInline=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function readDOMChange(t,e,n,r,s){let o=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let T=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,O=selectionFromDOM(t,T);if(O&&!t.state.selection.eq(O)){if(chrome&&android&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",R=>R(t,keyEvent(13,"Enter"))))return;let C=t.state.tr.setSelection(O);T=="pointer"?C.setMeta("pointer",!0):T=="key"&&C.scrollIntoView(),o&&C.setMeta("composition",o),t.dispatch(C)}return}let a=t.state.doc.resolve(e),u=a.sharedDepth(n);e=a.before(u+1),n=t.state.doc.resolve(n).after(u+1);let l=t.state.selection,c=parseBetween(t,e,n),f=t.state.doc,h=f.slice(c.from,c.to),p,m;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,m="end"):(p=t.state.selection.from,m="start"),t.input.lastKeyCode=null;let g=findDiff(h.content,c.doc.content,c.from,p,m);if(g&&t.input.domChangeCount++,(ios&&t.input.lastIOSEnter>Date.now()-225||android)&&s.some(T=>T.nodeType==1&&!isInline.test(T.nodeName))&&(!g||g.endA>=g.endB)&&t.someProp("handleKeyDown",T=>T(t,keyEvent(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!g)if(r&&l instanceof TextSelection&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))g={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let T=resolveSelection(t,t.state.doc,c.sel);if(T&&!T.eq(t.state.selection)){let O=t.state.tr.setSelection(T);o&&O.setMeta("composition",o),t.dispatch(O)}}return}t.state.selection.from<t.state.selection.to&&g.start==g.endB&&t.state.selection instanceof TextSelection&&(g.start>t.state.selection.from&&g.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?g.start=t.state.selection.from:g.endA<t.state.selection.to&&g.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(g.endB+=t.state.selection.to-g.endA,g.endA=t.state.selection.to)),ie$1&&ie_version<=11&&g.endB==g.start+1&&g.endA==g.start&&g.start>c.from&&c.doc.textBetween(g.start-c.from-1,g.start-c.from+1)==" "&&(g.start--,g.endA--,g.endB--);let b=c.doc.resolveNoCache(g.start-c.from),y=c.doc.resolveNoCache(g.endB-c.from),_=f.resolve(g.start),x=b.sameParent(y)&&b.parent.inlineContent&&_.end()>=g.endA,E;if((ios&&t.input.lastIOSEnter>Date.now()-225&&(!x||s.some(T=>T.nodeName=="DIV"||T.nodeName=="P"))||!x&&b.pos<c.doc.content.size&&!b.sameParent(y)&&(E=Selection.findFrom(c.doc.resolve(b.pos+1),1,!0))&&E.head==y.pos)&&t.someProp("handleKeyDown",T=>T(t,keyEvent(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>g.start&&looksLikeBackspace(f,g.start,g.endA,b,y)&&t.someProp("handleKeyDown",T=>T(t,keyEvent(8,"Backspace")))){android&&chrome&&t.domObserver.suppressSelectionUpdates();return}chrome&&g.endB==g.start&&(t.input.lastChromeDelete=Date.now()),android&&!x&&b.start()!=y.start()&&y.parentOffset==0&&b.depth==y.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==g.endA&&(g.endB-=2,y=c.doc.resolveNoCache(g.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(T){return T(t,keyEvent(13,"Enter"))})},20));let A=g.start,v=g.endA,w,k,S;if(x){if(b.pos==y.pos)ie$1&&ie_version<=11&&b.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>selectionToDOM(t),20)),w=t.state.tr.delete(A,v),k=f.resolve(g.start).marksAcross(f.resolve(g.endA));else if(g.endA==g.endB&&(S=isMarkChange(b.parent.content.cut(b.parentOffset,y.parentOffset),_.parent.content.cut(_.parentOffset,g.endA-_.start()))))w=t.state.tr,S.type=="add"?w.addMark(A,v,S.mark):w.removeMark(A,v,S.mark);else if(b.parent.child(b.index()).isText&&b.index()==y.index()-(y.textOffset?0:1)){let T=b.parent.textBetween(b.parentOffset,y.parentOffset);if(t.someProp("handleTextInput",O=>O(t,A,v,T)))return;w=t.state.tr.insertText(T,A,v)}}if(w||(w=t.state.tr.replace(A,v,c.doc.slice(g.start-c.from,g.endB-c.from))),c.sel){let T=resolveSelection(t,w.doc,c.sel);T&&!(chrome&&t.composing&&T.empty&&(g.start!=g.endB||t.input.lastChromeDelete<Date.now()-100)&&(T.head==A||T.head==w.mapping.map(v)-1)||ie$1&&T.empty&&T.head==A)&&w.setSelection(T)}k&&w.ensureMarks(k),o&&w.setMeta("composition",o),t.dispatch(w.scrollIntoView())}function resolveSelection(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:selectionBetween(t,e.resolve(n.anchor),e.resolve(n.head))}function isMarkChange(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,o=r,a,u,l;for(let f=0;f<r.length;f++)s=r[f].removeFromSet(s);for(let f=0;f<n.length;f++)o=n[f].removeFromSet(o);if(s.length==1&&o.length==0)u=s[0],a="add",l=f=>f.mark(u.addToSet(f.marks));else if(s.length==0&&o.length==1)u=o[0],a="remove",l=f=>f.mark(u.removeFromSet(f.marks));else return null;let c=[];for(let f=0;f<e.childCount;f++)c.push(l(e.child(f)));if(Fragment.from(c).eq(t))return{mark:u,type:a}}function looksLikeBackspace(t,e,n,r,s){if(n-e<=s.pos-r.pos||skipClosingAndOpening(r,!0,!1)<s.pos)return!1;let o=t.resolve(e);if(!r.parent.isTextblock){let u=o.nodeAfter;return u!=null&&n==e+u.nodeSize}if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let a=t.resolve(skipClosingAndOpening(o,!0,!0));return!a.parent.isTextblock||a.pos>n||skipClosingAndOpening(a,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(a.parent.content)}function skipClosingAndOpening(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let o=t.node(r).maybeChild(t.indexAfter(r));for(;o&&!o.isLeaf;)o=o.firstChild,s++}return s}function findDiff(t,e,n,r,s){let o=t.findDiffStart(e,n);if(o==null)return null;let{a,b:u}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,o-Math.min(a,u));r-=a+l-o}if(a<o&&t.size<e.size){let l=r<=o&&r>=a?o-r:0;o-=l,o&&o<e.size&&isSurrogatePair(e.textBetween(o-1,o+1))&&(o+=l?1:-1),u=o+(u-a),a=o}else if(u<o){let l=r<=o&&r>=u?o-r:0;o-=l,o&&o<t.size&&isSurrogatePair(t.textBetween(o-1,o+1))&&(o+=l?1:-1),a=o+(a-u),u=o}return{start:o,endA:a,endB:u}}function isSurrogatePair(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class EditorView{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new InputState,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(checkStateComponent),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=getEditable(this),updateCursorWrapper(this),this.nodeViews=buildNodeViews(this),this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this),this.domObserver=new DOMObserver(this,(r,s,o,a)=>readDOMChange(this,r,s,o,a)),this.domObserver.start(),initInput(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&ensureListeners(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(checkStateComponent),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,o=!1,a=!1;e.storedMarks&&this.composing&&(clearComposition(this),a=!0),this.state=e;let u=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(u||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let m=buildNodeViews(this);changedNodeViews(m,this.nodeViews)&&(this.nodeViews=m,o=!0)}(u||n.handleDOMEvents!=this._props.handleDOMEvents)&&ensureListeners(this),this.editable=getEditable(this),updateCursorWrapper(this);let l=viewDecorations(this),c=computeDocDeco(this),f=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",h=o||!this.docView.matchesNode(e.doc,c,l);(h||!e.selection.eq(s.selection))&&(a=!0);let p=f=="preserve"&&a&&this.dom.style.overflowAnchor==null&&storeScrollPos(this);if(a){this.domObserver.stop();let m=h&&(ie$1||chrome)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&selectionContextChanged(s.selection,e.selection);if(h){let g=chrome?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=findCompositionNode(this)),(o||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=docViewDesc(e.doc,c,l,this.dom,this)),g&&!this.trackWrites&&(m=!0)}m||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&anchorInRightPlace(this))?selectionToDOM(this,m):(syncNodeSelection(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),f=="reset"?this.dom.scrollTop=0:f=="to selection"?this.scrollToSelection():p&&resetScrollPos(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof NodeSelection){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&scrollRectIntoView(this,n.getBoundingClientRect(),e)}else scrollRectIntoView(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let o=r.from+(this.state.doc.content.size-n.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==r.node&&(s=o)}this.dragging=new Dragging(e.slice,e.move,s<0?void 0:NodeSelection.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let a=0;a<this.directPlugins.length;a++){let u=this.directPlugins[a].props[e];if(u!=null&&(s=n?n(u):u))return s}let o=this.state.plugins;if(o)for(let a=0;a<o.length;a++){let u=o[a].props[e];if(u!=null&&(s=n?n(u):u))return s}}hasFocus(){if(ie$1){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&focusPreventScroll(this.dom),selectionToDOM(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return posAtCoords(this,e)}coordsAtPos(e,n=1){return coordsAtPos(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return endOfTextblock(this,n||this.state,e)}pasteHTML(e,n){return doPaste(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return doPaste(this,e,null,!0,n||new ClipboardEvent("paste"))}destroy(){this.docView&&(destroyInput(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],viewDecorations(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,clearReusedRange())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return dispatchEvent(this,e)}dispatch(e){let n=this._props.dispatchTransaction;n?n.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return e?safari&&this.root.nodeType===11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariShadowSelectionRange(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function computeDocDeco(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Decoration.node(0,t.state.doc.content.size,e)]}function updateCursorWrapper(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Decoration.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function getEditable(t){return!t.someProp("editable",e=>e(t.state)===!1)}function selectionContextChanged(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function buildNodeViews(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function changedNodeViews(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function checkStateComponent(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var base$1={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac$1=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var i=0;i<10;i++)base$1[48+i]=base$1[96+i]=String(i);for(var i=1;i<=24;i++)base$1[i+111]="F"+i;for(var i=65;i<=90;i++)base$1[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code$1 in base$1)shift.hasOwnProperty(code$1)||(shift[code$1]=base$1[code$1]);function keyName(t){var e=mac$1&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||ie&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?shift:base$1)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const mac=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function normalizeKeyName$1(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,o,a;for(let u=0;u<e.length-1;u++){let l=e[u];if(/^(cmd|meta|m)$/i.test(l))a=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))mac?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),a&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function normalize$1(t){let e=Object.create(null);for(let n in t)e[normalizeKeyName$1(n)]=t[n];return e}function modifiers(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function keymap(t){return new Plugin({props:{handleKeyDown:keydownHandler(t)}})}function keydownHandler(t){let e=normalize$1(t);return function(n,r){let s=keyName(r),o,a=e[modifiers(s,r)];if(a&&a(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let u=e[modifiers(s,r,!1)];if(u&&u(n.state,n.dispatch,n))return!0}if((r.shiftKey||r.altKey||r.metaKey||s.charCodeAt(0)>127)&&(o=base$1[r.keyCode])&&o!=s){let u=e[modifiers(o,r)];if(u&&u(n.state,n.dispatch,n))return!0}}return!1}}const deleteSelection$1=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function atBlockStart(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const joinBackward$1=(t,e,n)=>{let r=atBlockStart(t,n);if(!r)return!1;let s=findCutBefore(r);if(!s){let a=r.blockRange(),u=a&&liftTarget(a);return u==null?!1:(e&&e(t.tr.lift(a,u).scrollIntoView()),!0)}let o=s.nodeBefore;if(deleteBarrier(t,s,e,-1))return!0;if(r.parent.content.size==0&&(textblockAt(o,"end")||NodeSelection.isSelectable(o)))for(let a=r.depth;;a--){let u=replaceStep(t.doc,r.before(a),r.after(a),Slice.empty);if(u&&u.slice.size<u.to-u.from){if(e){let l=t.tr.step(u);l.setSelection(textblockAt(o,"end")?Selection.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):NodeSelection.create(l.doc,s.pos-o.nodeSize)),e(l.scrollIntoView())}return!0}if(a==1||r.node(a-1).childCount>1)break}return o.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-o.nodeSize,s.pos).scrollIntoView()),!0):!1},joinTextblockBackward$1=(t,e,n)=>{let r=atBlockStart(t,n);if(!r)return!1;let s=findCutBefore(r);return s?joinTextblocksAround(t,s,e):!1},joinTextblockForward$1=(t,e,n)=>{let r=atBlockEnd(t,n);if(!r)return!1;let s=findCutAfter(r);return s?joinTextblocksAround(t,s,e):!1};function joinTextblocksAround(t,e,n){let r=e.nodeBefore,s=r,o=e.pos-1;for(;!s.isTextblock;o--){if(s.type.spec.isolating)return!1;let f=s.lastChild;if(!f)return!1;s=f}let a=e.nodeAfter,u=a,l=e.pos+1;for(;!u.isTextblock;l++){if(u.type.spec.isolating)return!1;let f=u.firstChild;if(!f)return!1;u=f}let c=replaceStep(t.doc,o,l,Slice.empty);if(!c||c.from!=o||c instanceof ReplaceStep&&c.slice.size>=l-o)return!1;if(n){let f=t.tr.step(c);f.setSelection(TextSelection.create(f.doc,o)),n(f.scrollIntoView())}return!0}function textblockAt(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const selectNodeBackward$1=(t,e,n)=>{let{$head:r,empty:s}=t.selection,o=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;o=findCutBefore(r)}let a=o&&o.nodeBefore;return!a||!NodeSelection.isSelectable(a)?!1:(e&&e(t.tr.setSelection(NodeSelection.create(t.doc,o.pos-a.nodeSize)).scrollIntoView()),!0)};function findCutBefore(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function atBlockEnd(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const joinForward$1=(t,e,n)=>{let r=atBlockEnd(t,n);if(!r)return!1;let s=findCutAfter(r);if(!s)return!1;let o=s.nodeAfter;if(deleteBarrier(t,s,e,1))return!0;if(r.parent.content.size==0&&(textblockAt(o,"start")||NodeSelection.isSelectable(o))){let a=replaceStep(t.doc,r.before(),r.after(),Slice.empty);if(a&&a.slice.size<a.to-a.from){if(e){let u=t.tr.step(a);u.setSelection(textblockAt(o,"start")?Selection.findFrom(u.doc.resolve(u.mapping.map(s.pos)),1):NodeSelection.create(u.doc,u.mapping.map(s.pos))),e(u.scrollIntoView())}return!0}}return o.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+o.nodeSize).scrollIntoView()),!0):!1},selectNodeForward$1=(t,e,n)=>{let{$head:r,empty:s}=t.selection,o=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;o=findCutAfter(r)}let a=o&&o.nodeAfter;return!a||!NodeSelection.isSelectable(a)?!1:(e&&e(t.tr.setSelection(NodeSelection.create(t.doc,o.pos)).scrollIntoView()),!0)};function findCutAfter(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const joinUp$1=(t,e)=>{let n=t.selection,r=n instanceof NodeSelection,s;if(r){if(n.node.isTextblock||!canJoin(t.doc,n.from))return!1;s=n.from}else if(s=joinPoint(t.doc,n.from,-1),s==null)return!1;if(e){let o=t.tr.join(s);r&&o.setSelection(NodeSelection.create(o.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(o.scrollIntoView())}return!0},joinDown$1=(t,e)=>{let n=t.selection,r;if(n instanceof NodeSelection){if(n.node.isTextblock||!canJoin(t.doc,n.to))return!1;r=n.to}else if(r=joinPoint(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},lift$1=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),o=s&&liftTarget(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)},newlineInCode$1=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function defaultBlockAt$1(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const exitCode$1=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),o=n.indexAfter(-1),a=defaultBlockAt$1(s.contentMatchAt(o));if(!a||!s.canReplaceWith(o,o,a))return!1;if(e){let u=n.after(),l=t.tr.replaceWith(u,u,a.createAndFill());l.setSelection(Selection.near(l.doc.resolve(u),1)),e(l.scrollIntoView())}return!0},createParagraphNear$1=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof AllSelection||r.parent.inlineContent||s.parent.inlineContent)return!1;let o=defaultBlockAt$1(s.parent.contentMatchAt(s.indexAfter()));if(!o||!o.isTextblock)return!1;if(e){let a=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,u=t.tr.insert(a,o.createAndFill());u.setSelection(TextSelection.create(u.doc,a+1)),e(u.scrollIntoView())}return!0},liftEmptyBlock$1=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let o=n.before();if(canSplit(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}let r=n.blockRange(),s=r&&liftTarget(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)},selectParentNode$1=(t,e)=>{let{$from:n,to:r}=t.selection,s,o=n.sharedDepth(r);return o==0?!1:(s=n.before(o),e&&e(t.tr.setSelection(NodeSelection.create(t.doc,s))),!0)};function joinMaybeClear(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,o=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(o-1,o)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(o,o+1)||!(s.isTextblock||canJoin(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function deleteBarrier(t,e,n,r){let s=e.nodeBefore,o=e.nodeAfter,a,u,l=s.type.spec.isolating||o.type.spec.isolating;if(!l&&joinMaybeClear(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(a=(u=s.contentMatchAt(s.childCount)).findWrapping(o.type))&&u.matchType(a[0]||o.type).validEnd){if(n){let m=e.pos+o.nodeSize,g=Fragment.empty;for(let _=a.length-1;_>=0;_--)g=Fragment.from(a[_].create(null,g));g=Fragment.from(s.copy(g));let b=t.tr.step(new ReplaceAroundStep(e.pos-1,m,e.pos,m,new Slice(g,1,0),a.length,!0)),y=b.doc.resolve(m+2*a.length);y.nodeAfter&&y.nodeAfter.type==s.type&&canJoin(b.doc,y.pos)&&b.join(y.pos),n(b.scrollIntoView())}return!0}let f=o.type.spec.isolating||r>0&&l?null:Selection.findFrom(e,1),h=f&&f.$from.blockRange(f.$to),p=h&&liftTarget(h);if(p!=null&&p>=e.depth)return n&&n(t.tr.lift(h,p).scrollIntoView()),!0;if(c&&textblockAt(o,"start",!0)&&textblockAt(s,"end")){let m=s,g=[];for(;g.push(m),!m.isTextblock;)m=m.lastChild;let b=o,y=1;for(;!b.isTextblock;b=b.firstChild)y++;if(m.canReplace(m.childCount,m.childCount,b.content)){if(n){let _=Fragment.empty;for(let E=g.length-1;E>=0;E--)_=Fragment.from(g[E].copy(_));let x=t.tr.step(new ReplaceAroundStep(e.pos-g.length,e.pos+o.nodeSize,e.pos+y,e.pos+o.nodeSize-y,new Slice(_,g.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function selectTextblockSide(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,o=s.depth;for(;s.node(o).isInline;){if(!o)return!1;o--}return s.node(o).isTextblock?(n&&n(e.tr.setSelection(TextSelection.create(e.doc,t<0?s.start(o):s.end(o)))),!0):!1}}const selectTextblockStart$1=selectTextblockSide(-1),selectTextblockEnd$1=selectTextblockSide(1);function wrapIn$1(t,e=null){return function(n,r){let{$from:s,$to:o}=n.selection,a=s.blockRange(o),u=a&&findWrapping(a,t,e);return u?(r&&r(n.tr.wrap(a,u).scrollIntoView()),!0):!1}}function setBlockType(t,e=null){return function(n,r){let s=!1;for(let o=0;o<n.selection.ranges.length&&!s;o++){let{$from:{pos:a},$to:{pos:u}}=n.selection.ranges[o];n.doc.nodesBetween(a,u,(l,c)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let f=n.doc.resolve(c),h=f.index();s=f.parent.canReplaceWith(h,h+1,t)}})}if(!s)return!1;if(r){let o=n.tr;for(let a=0;a<n.selection.ranges.length;a++){let{$from:{pos:u},$to:{pos:l}}=n.selection.ranges[a];o.setBlockType(u,l,t,e)}r(o.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function wrapInList$1(t,e=null){return function(n,r){let{$from:s,$to:o}=n.selection,a=s.blockRange(o);if(!a)return!1;let u=r?n.tr:null;return wrapRangeInList(u,a,t,e)?(r&&r(u.scrollIntoView()),!0):!1}}function wrapRangeInList(t,e,n,r=null){let s=!1,o=e,a=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=a.resolve(e.start-2);o=new NodeRange(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new NodeRange(e.$from,a.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let u=findWrapping(o,n,r,e);return u?(t&&doWrapInList(t,e,u,s,n),!0):!1}function doWrapInList(t,e,n,r,s){let o=Fragment.empty;for(let f=n.length-1;f>=0;f--)o=Fragment.from(n[f].type.create(n[f].attrs,o));t.step(new ReplaceAroundStep(e.start-(r?2:0),e.end,e.start,e.end,new Slice(o,0,0),n.length,!0));let a=0;for(let f=0;f<n.length;f++)n[f].type==s&&(a=f+1);let u=n.length-a,l=e.start+n.length-(r?2:0),c=e.parent;for(let f=e.startIndex,h=e.endIndex,p=!0;f<h;f++,p=!1)!p&&canSplit(t.doc,l,u)&&(t.split(l,u),l+=2*u),l+=c.child(f).nodeSize;return t}function liftListItem$1(t){return function(e,n){let{$from:r,$to:s}=e.selection,o=r.blockRange(s,a=>a.childCount>0&&a.firstChild.type==t);return o?n?r.node(o.depth-1).type==t?liftToOuterList(e,n,t,o):liftOutOfList(e,n,o):!0:!1}}function liftToOuterList(t,e,n,r){let s=t.tr,o=r.end,a=r.$to.end(r.depth);o<a&&(s.step(new ReplaceAroundStep(o-1,a,o,a,new Slice(Fragment.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new NodeRange(s.doc.resolve(r.$from.pos),s.doc.resolve(a),r.depth));const u=liftTarget(r);if(u==null)return!1;s.lift(r,u);let l=s.mapping.map(o,-1)-1;return canJoin(s.doc,l)&&s.join(l),e(s.scrollIntoView()),!0}function liftOutOfList(t,e,n){let r=t.tr,s=n.parent;for(let m=n.end,g=n.endIndex-1,b=n.startIndex;g>b;g--)m-=s.child(g).nodeSize,r.delete(m-1,m+1);let o=r.doc.resolve(n.start),a=o.nodeAfter;if(r.mapping.map(n.end)!=n.start+o.nodeAfter.nodeSize)return!1;let u=n.startIndex==0,l=n.endIndex==s.childCount,c=o.node(-1),f=o.index(-1);if(!c.canReplace(f+(u?0:1),f+1,a.content.append(l?Fragment.empty:Fragment.from(s))))return!1;let h=o.pos,p=h+a.nodeSize;return r.step(new ReplaceAroundStep(h-(u?1:0),p+(l?1:0),h+1,p-1,new Slice((u?Fragment.empty:Fragment.from(s.copy(Fragment.empty))).append(l?Fragment.empty:Fragment.from(s.copy(Fragment.empty))),u?0:1,l?0:1),u?0:1)),e(r.scrollIntoView()),!0}function sinkListItem$1(t){return function(e,n){let{$from:r,$to:s}=e.selection,o=r.blockRange(s,c=>c.childCount>0&&c.firstChild.type==t);if(!o)return!1;let a=o.startIndex;if(a==0)return!1;let u=o.parent,l=u.child(a-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==u.type,f=Fragment.from(c?t.create():null),h=new Slice(Fragment.from(t.create(null,Fragment.from(u.type.create(null,f)))),c?3:1,0),p=o.start,m=o.end;n(e.tr.step(new ReplaceAroundStep(p-(c?3:1),m,p,m,h,1,!0)).scrollIntoView())}return!0}}function createChainableState(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,o=n.storedMarks,n}}}class CommandManager{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:o}=r,a=this.buildProps(o);return Object.fromEntries(Object.entries(e).map(([u,l])=>[u,(...f)=>{const h=l(...f)(a);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(o),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:o}=this,{view:a}=s,u=[],l=!!e,c=e||o.tr,f=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(c),u.every(p=>p===!0)),h={...Object.fromEntries(Object.entries(r).map(([p,m])=>[p,(...b)=>{const y=this.buildProps(c,n),_=m(...b)(y);return u.push(_),h}])),run:f};return h}createCan(e){const{rawCommands:n,state:r}=this,s=!1,o=e||r.tr,a=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...f)=>c(...f)({...a,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:o}=this,{view:a}=s,u={tr:e,editor:s,view:a,state:createChainableState({state:o,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...f)=>c(...f)(u)]))}};return u}}class EventEmitter{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function getExtensionField(t,e,n){return t.config[e]===void 0&&t.parent?getExtensionField(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?getExtensionField(t.parent,e,n):null}):t.config[e]}function splitExtensions(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function getAttributesFromExtensions(t){const e=[],{nodeExtensions:n,markExtensions:r}=splitExtensions(t),s=[...n,...r],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(a=>{const u={name:a.name,options:a.options,storage:a.storage,extensions:s},l=getExtensionField(a,"addGlobalAttributes",u);if(!l)return;l().forEach(f=>{f.types.forEach(h=>{Object.entries(f.attributes).forEach(([p,m])=>{e.push({type:h,name:p,attribute:{...o,...m}})})})})}),s.forEach(a=>{const u={name:a.name,options:a.options,storage:a.storage},l=getExtensionField(a,"addAttributes",u);if(!l)return;const c=l();Object.entries(c).forEach(([f,h])=>{const p={...o,...h};typeof(p==null?void 0:p.default)=="function"&&(p.default=p.default()),p!=null&&p.isRequired&&(p==null?void 0:p.default)===void 0&&delete p.default,e.push({type:a.name,name:f,attribute:p})})}),e}function getNodeType(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function mergeAttributes(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,o])=>{if(!r[s]){r[s]=o;return}if(s==="class"){const u=o?o.split(" "):[],l=r[s]?r[s].split(" "):[],c=u.filter(f=>!l.includes(f));r[s]=[...l,...c].join(" ")}else if(s==="style"){const u=o?o.split(";").map(f=>f.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(f=>f.trim()).filter(Boolean):[],c=new Map;l.forEach(f=>{const[h,p]=f.split(":").map(m=>m.trim());c.set(h,p)}),u.forEach(f=>{const[h,p]=f.split(":").map(m=>m.trim());c.set(h,p)}),r[s]=Array.from(c.entries()).map(([f,h])=>`${f}: ${h}`).join("; ")}else r[s]=o}),r},{})}function getRenderedAttributes(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>mergeAttributes(n,r),{})}function isFunction$1(t){return typeof t=="function"}function callOrReturn(t,e=void 0,...n){return isFunction$1(t)?e?t.bind(e)(...n):t(...n):t}function isEmptyObject(t={}){return Object.keys(t).length===0&&t.constructor===Object}function fromString(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function injectExtensionAttributesToParseRule(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((o,a)=>{const u=a.attribute.parseHTML?a.attribute.parseHTML(n):fromString(n.getAttribute(a.name));return u==null?o:{...o,[a.name]:u}},{});return{...r,...s}}}}function cleanUpSchemaItem(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&isEmptyObject(n)?!1:n!=null))}function getSchemaByResolvedExtensions(t,e){var n;const r=getAttributesFromExtensions(t),{nodeExtensions:s,markExtensions:o}=splitExtensions(t),a=(n=s.find(c=>getExtensionField(c,"topNode")))===null||n===void 0?void 0:n.name,u=Object.fromEntries(s.map(c=>{const f=r.filter(_=>_.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((_,x)=>{const E=getExtensionField(x,"extendNodeSchema",h);return{..._,...E?E(c):{}}},{}),m=cleanUpSchemaItem({...p,content:callOrReturn(getExtensionField(c,"content",h)),marks:callOrReturn(getExtensionField(c,"marks",h)),group:callOrReturn(getExtensionField(c,"group",h)),inline:callOrReturn(getExtensionField(c,"inline",h)),atom:callOrReturn(getExtensionField(c,"atom",h)),selectable:callOrReturn(getExtensionField(c,"selectable",h)),draggable:callOrReturn(getExtensionField(c,"draggable",h)),code:callOrReturn(getExtensionField(c,"code",h)),whitespace:callOrReturn(getExtensionField(c,"whitespace",h)),linebreakReplacement:callOrReturn(getExtensionField(c,"linebreakReplacement",h)),defining:callOrReturn(getExtensionField(c,"defining",h)),isolating:callOrReturn(getExtensionField(c,"isolating",h)),attrs:Object.fromEntries(f.map(_=>{var x;return[_.name,{default:(x=_==null?void 0:_.attribute)===null||x===void 0?void 0:x.default}]}))}),g=callOrReturn(getExtensionField(c,"parseHTML",h));g&&(m.parseDOM=g.map(_=>injectExtensionAttributesToParseRule(_,f)));const b=getExtensionField(c,"renderHTML",h);b&&(m.toDOM=_=>b({node:_,HTMLAttributes:getRenderedAttributes(_,f)}));const y=getExtensionField(c,"renderText",h);return y&&(m.toText=y),[c.name,m]})),l=Object.fromEntries(o.map(c=>{const f=r.filter(y=>y.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((y,_)=>{const x=getExtensionField(_,"extendMarkSchema",h);return{...y,...x?x(c):{}}},{}),m=cleanUpSchemaItem({...p,inclusive:callOrReturn(getExtensionField(c,"inclusive",h)),excludes:callOrReturn(getExtensionField(c,"excludes",h)),group:callOrReturn(getExtensionField(c,"group",h)),spanning:callOrReturn(getExtensionField(c,"spanning",h)),code:callOrReturn(getExtensionField(c,"code",h)),attrs:Object.fromEntries(f.map(y=>{var _;return[y.name,{default:(_=y==null?void 0:y.attribute)===null||_===void 0?void 0:_.default}]}))}),g=callOrReturn(getExtensionField(c,"parseHTML",h));g&&(m.parseDOM=g.map(y=>injectExtensionAttributesToParseRule(y,f)));const b=getExtensionField(c,"renderHTML",h);return b&&(m.toDOM=y=>b({mark:y,HTMLAttributes:getRenderedAttributes(y,f)})),[c.name,m]}));return new Schema({topNode:a,nodes:u,marks:l})}function getSchemaTypeByName(t,e){return e.nodes[t]||e.marks[t]||null}function isExtensionRulesEnabled(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function getHTMLFromFragment(t,e){const n=DOMSerializer.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const getTextContentFromNodes=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,o,a,u)=>{var l,c;const f=((c=(l=s.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:s,pos:o,parent:a,index:u}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?f:f.slice(0,Math.max(0,r-o))}),n};function isRegExp$1(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class InputRule{constructor(e){this.find=e.find,this.handler=e.handler}}const inputRuleMatcherHandler=(t,e)=>{if(isRegExp$1(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function run$1(t){var e;const{editor:n,from:r,to:s,text:o,rules:a,plugin:u}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(p=>p.type.spec.code))return!1;let f=!1;const h=getTextContentFromNodes(c)+o;return a.forEach(p=>{if(f)return;const m=inputRuleMatcherHandler(h,p.find);if(!m)return;const g=l.state.tr,b=createChainableState({state:l.state,transaction:g}),y={from:r-(m[0].length-o.length),to:s},{commands:_,chain:x,can:E}=new CommandManager({editor:n,state:b});p.handler({state:b,range:y,match:m,commands:_,chain:x,can:E})===null||!g.steps.length||(g.setMeta(u,{transform:g,from:r,to:s,text:o}),l.dispatch(g),f=!0)}),f}function inputRulesPlugin(t){const{editor:e,rules:n}=t,r=new Plugin({state:{init(){return null},apply(s,o,a){const u=s.getMeta(r);if(u)return u;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:f}=l;typeof f=="string"?f=f:f=getHTMLFromFragment(Fragment.from(f),a.schema);const{from:h}=l,p=h+f.length;run$1({editor:e,from:h,to:p,text:f,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:o}},props:{handleTextInput(s,o,a,u){return run$1({editor:e,from:o,to:a,text:u,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:o}=s.state.selection;o&&run$1({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,o){if(o.key!=="Enter")return!1;const{$cursor:a}=s.state.selection;return a?run$1({editor:e,from:a.pos,to:a.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function getType(t){return Object.prototype.toString.call(t).slice(8,-1)}function isPlainObject(t){return getType(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function mergeDeep(t,e){const n={...t};return isPlainObject(t)&&isPlainObject(e)&&Object.keys(e).forEach(r=>{isPlainObject(e[r])&&isPlainObject(t[r])?n[r]=mergeDeep(t[r],e[r]):n[r]=e[r]}),n}class Mark{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Mark(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Mark(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=callOrReturn(getExtensionField(n,"addOptions",{name:n.name})),n.storage=callOrReturn(getExtensionField(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const a=s.marks();if(!!!a.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=a.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function isNumber$1(t){return typeof t=="number"}class PasteRule{constructor(e){this.find=e.find,this.handler=e.handler}}const pasteRuleMatcherHandler=(t,e,n)=>{if(isRegExp$1(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const o=[s.text];return o.index=s.index,o.input=t,o.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(s.replaceWith)),o}):[]};function run(t){const{editor:e,state:n,from:r,to:s,rule:o,pasteEvent:a,dropEvent:u}=t,{commands:l,chain:c,can:f}=new CommandManager({editor:e,state:n}),h=[];return n.doc.nodesBetween(r,s,(m,g)=>{if(!m.isTextblock||m.type.spec.code)return;const b=Math.max(r,g),y=Math.min(s,g+m.content.size),_=m.textBetween(b-g,y-g,void 0,"");pasteRuleMatcherHandler(_,o.find,a).forEach(E=>{if(E.index===void 0)return;const A=b+E.index+1,v=A+E[0].length,w={from:n.tr.mapping.map(A),to:n.tr.mapping.map(v)},k=o.handler({state:n,range:w,match:E,commands:l,chain:c,can:f,pasteEvent:a,dropEvent:u});h.push(k)})}),h.every(m=>m!==null)}let tiptapDragFromOtherEditor=null;const createClipboardPasteEvent=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function pasteRulesPlugin(t){const{editor:e,rules:n}=t;let r=null,s=!1,o=!1,a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,u;try{u=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{u=null}const l=({state:f,from:h,to:p,rule:m,pasteEvt:g})=>{const b=f.tr,y=createChainableState({state:f,transaction:b});if(!(!run({editor:e,state:y,from:Math.max(h-1,0),to:p.b-1,rule:m,pasteEvent:g,dropEvent:u})||!b.steps.length)){try{u=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{u=null}return a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,b}};return n.map(f=>new Plugin({view(h){const p=g=>{var b;r=!((b=h.dom.parentElement)===null||b===void 0)&&b.contains(g.target)?h.dom.parentElement:null,r&&(tiptapDragFromOtherEditor=e)},m=()=>{tiptapDragFromOtherEditor&&(tiptapDragFromOtherEditor=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",m),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",m)}}},props:{handleDOMEvents:{drop:(h,p)=>{if(o=r===h.dom.parentElement,u=p,!o){const m=tiptapDragFromOtherEditor;m&&setTimeout(()=>{const g=m.state.selection;g&&m.commands.deleteRange({from:g.from,to:g.to})},10)}return!1},paste:(h,p)=>{var m;const g=(m=p.clipboardData)===null||m===void 0?void 0:m.getData("text/html");return a=p,s=!!(g!=null&&g.includes("data-pm-slice")),!1}}},appendTransaction:(h,p,m)=>{const g=h[0],b=g.getMeta("uiEvent")==="paste"&&!s,y=g.getMeta("uiEvent")==="drop"&&!o,_=g.getMeta("applyPasteRules"),x=!!_;if(!b&&!y&&!x)return;if(x){let{text:v}=_;typeof v=="string"?v=v:v=getHTMLFromFragment(Fragment.from(v),m.schema);const{from:w}=_,k=w+v.length,S=createClipboardPasteEvent(v);return l({rule:f,state:m,from:w,to:{b:k},pasteEvt:S})}const E=p.doc.content.findDiffStart(m.doc.content),A=p.doc.content.findDiffEnd(m.doc.content);if(!(!isNumber$1(E)||!A||E===A.b))return l({rule:f,state:m,from:E,to:A,pasteEvt:a})}}))}function findDuplicates(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class ExtensionManager{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=ExtensionManager.resolve(e),this.schema=getSchemaByResolvedExtensions(this.extensions,n),this.setupExtensions()}static resolve(e){const n=ExtensionManager.sort(ExtensionManager.flatten(e)),r=findDuplicates(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=getExtensionField(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const o=getExtensionField(r,"priority")||100,a=getExtensionField(s,"priority")||100;return o>a?-1:o<a?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:getSchemaTypeByName(n.name,this.schema)},s=getExtensionField(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=ExtensionManager.sort([...this.extensions].reverse()),r=[],s=[],o=n.map(a=>{const u={name:a.name,options:a.options,storage:a.storage,editor:e,type:getSchemaTypeByName(a.name,this.schema)},l=[],c=getExtensionField(a,"addKeyboardShortcuts",u);let f={};if(a.type==="mark"&&getExtensionField(a,"exitable",u)&&(f.ArrowRight=()=>Mark.handleExit({editor:e,mark:a})),c){const b=Object.fromEntries(Object.entries(c()).map(([y,_])=>[y,()=>_({editor:e})]));f={...f,...b}}const h=keymap(f);l.push(h);const p=getExtensionField(a,"addInputRules",u);isExtensionRulesEnabled(a,e.options.enableInputRules)&&p&&r.push(...p());const m=getExtensionField(a,"addPasteRules",u);isExtensionRulesEnabled(a,e.options.enablePasteRules)&&m&&s.push(...m());const g=getExtensionField(a,"addProseMirrorPlugins",u);if(g){const b=g();l.push(...b)}return l}).flat();return[inputRulesPlugin({editor:e,rules:r}),...pasteRulesPlugin({editor:e,rules:s}),...o]}get attributes(){return getAttributesFromExtensions(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=splitExtensions(this.extensions);return Object.fromEntries(n.filter(r=>!!getExtensionField(r,"addNodeView")).map(r=>{const s=this.attributes.filter(l=>l.type===r.name),o={name:r.name,options:r.options,storage:r.storage,editor:e,type:getNodeType(r.name,this.schema)},a=getExtensionField(r,"addNodeView",o);if(!a)return[];const u=(l,c,f,h,p)=>{const m=getRenderedAttributes(l,s);return a()({node:l,view:c,getPos:f,decorations:h,innerDecorations:p,editor:e,extension:r,HTMLAttributes:m})};return[r.name,u]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:getSchemaTypeByName(e.name,this.schema)};e.type==="mark"&&(!((n=callOrReturn(getExtensionField(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=getExtensionField(e,"onBeforeCreate",r),o=getExtensionField(e,"onCreate",r),a=getExtensionField(e,"onUpdate",r),u=getExtensionField(e,"onSelectionUpdate",r),l=getExtensionField(e,"onTransaction",r),c=getExtensionField(e,"onFocus",r),f=getExtensionField(e,"onBlur",r),h=getExtensionField(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),o&&this.editor.on("create",o),a&&this.editor.on("update",a),u&&this.editor.on("selectionUpdate",u),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),f&&this.editor.on("blur",f),h&&this.editor.on("destroy",h)})}}class Extension{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Extension(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Extension({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=callOrReturn(getExtensionField(n,"addOptions",{name:n.name})),n.storage=callOrReturn(getExtensionField(n,"addStorage",{name:n.name,options:n.options})),n}}function getTextBetween(t,e,n){const{from:r,to:s}=e,{blockSeparator:o=`

`,textSerializers:a={}}=n||{};let u="";return t.nodesBetween(r,s,(l,c,f,h)=>{var p;l.isBlock&&c>r&&(u+=o);const m=a==null?void 0:a[l.type.name];if(m)return f&&(u+=m({node:l,pos:c,parent:f,index:h,range:e})),!1;l.isText&&(u+=(p=l==null?void 0:l.text)===null||p===void 0?void 0:p.slice(Math.max(r,c)-c,s-c))}),u}function getTextSerializersFromSchema(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const ClipboardTextSerializer=Extension.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:o}=s,a=Math.min(...o.map(f=>f.$from.pos)),u=Math.max(...o.map(f=>f.$to.pos)),l=getTextSerializersFromSchema(n);return getTextBetween(r,{from:a,to:u},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),blur=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),clearContent=(t=!1)=>({commands:e})=>e.setContent("",t),clearNodes=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:o,$to:a})=>{t.doc.nodesBetween(o.pos,a.pos,(u,l)=>{if(u.type.isText)return;const{doc:c,mapping:f}=e,h=c.resolve(f.map(l)),p=c.resolve(f.map(l+u.nodeSize)),m=h.blockRange(p);if(!m)return;const g=liftTarget(m);if(u.type.isTextblock){const{defaultType:b}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(m.start,b)}(g||g===0)&&e.lift(m,g)})}),!0},command=t=>e=>t(e),createParagraphNear=()=>({state:t,dispatch:e})=>createParagraphNear$1(t,e),cut=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,o=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const a=r.mapping.map(e);return r.insert(a,o.content),r.setSelection(new TextSelection(r.doc.resolve(a-1))),!0},deleteCurrentNode=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===r.type){if(e){const u=s.before(o),l=s.after(o);t.delete(u,l).scrollIntoView()}return!0}return!1},deleteNode=t=>({tr:e,state:n,dispatch:r})=>{const s=getNodeType(t,n.schema),o=e.selection.$anchor;for(let a=o.depth;a>0;a-=1)if(o.node(a).type===s){if(r){const l=o.before(a),c=o.after(a);e.delete(l,c).scrollIntoView()}return!0}return!1},deleteRange=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},deleteSelection=()=>({state:t,dispatch:e})=>deleteSelection$1(t,e),enter=()=>({commands:t})=>t.keyboardShortcut("Enter"),exitCode=()=>({state:t,dispatch:e})=>exitCode$1(t,e);function objectIncludes(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:isRegExp$1(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function findMarkInSet(t,e,n={}){return t.find(r=>r.type===e&&objectIncludes(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function isMarkInSet(t,e,n={}){return!!findMarkInSet(t,e,n)}function getMarkRange(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(f=>f.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(f=>f.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!findMarkInSet([...s.node.marks],e,n)))return;let a=s.index,u=t.start()+s.offset,l=a+1,c=u+s.node.nodeSize;for(;a>0&&isMarkInSet([...t.parent.child(a-1).marks],e,n);)a-=1,u-=t.parent.child(a).nodeSize;for(;l<t.parent.childCount&&isMarkInSet([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:u,to:c}}function getMarkType(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const extendMarkRange=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const o=getMarkType(t,r.schema),{doc:a,selection:u}=n,{$from:l,from:c,to:f}=u;if(s){const h=getMarkRange(l,o,e);if(h&&h.from<=c&&h.to>=f){const p=TextSelection.create(a,h.from,h.to);n.setSelection(p)}}return!0},first=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function isTextSelection(t){return t instanceof TextSelection}function minMax(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function resolveFocusPosition(t,e=null){if(!e)return null;const n=Selection.atStart(t),r=Selection.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,o=r.to;return e==="all"?TextSelection.create(t,minMax(0,s,o),minMax(t.content.size,s,o)):TextSelection.create(t,minMax(e,s,o),minMax(e,s,o))}const focus=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:o})=>{e={scrollIntoView:!0,...e};const a=()=>{r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(o&&t===null&&!isTextSelection(n.state.selection))return a(),!0;const u=resolveFocusPosition(s.doc,t)||n.state.selection,l=n.state.selection.eq(u);return o&&(l||s.setSelection(u),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),a()),!0},forEach=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),insertContent=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),removeWhitespaces=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&removeWhitespaces(r)}return t};function elementFromString$1(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return removeWhitespaces(n)}function createNodeFromContent(t,e,n){if(t instanceof Node$2||t instanceof Fragment)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Fragment.fromArray(t.map(u=>e.nodeFromJSON(u)));const a=e.nodeFromJSON(t);return n.errorOnInvalidContent&&a.check(),a}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),createNodeFromContent("",e,n)}if(s){if(n.errorOnInvalidContent){let a=!1,u="";const l=new Schema({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(a=!0,u=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?DOMParser.fromSchema(l).parseSlice(elementFromString$1(t),n.parseOptions):DOMParser.fromSchema(l).parse(elementFromString$1(t),n.parseOptions),n.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${u}`)})}const o=DOMParser.fromSchema(e);return n.slice?o.parseSlice(elementFromString$1(t),n.parseOptions).content:o.parse(elementFromString$1(t),n.parseOptions)}return createNodeFromContent("",e,n)}function selectionToInsertionEnd(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof ReplaceStep||s instanceof ReplaceAroundStep))return;const o=t.mapping.maps[r];let a=0;o.forEach((u,l,c,f)=>{a===0&&(a=f)}),t.setSelection(Selection.near(t.doc.resolve(a),n))}const isFragment=t=>!("type"in t),insertContentAt=(t,e,n)=>({tr:r,dispatch:s,editor:o})=>{var a;if(s){n={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let u;try{u=createNodeFromContent(e,o.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:(a=n.errorOnInvalidContent)!==null&&a!==void 0?a:o.options.enableContentCheck})}catch(g){return o.emit("contentError",{editor:o,error:g,disableCollaboration:()=>{o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}}),!1}let{from:l,to:c}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,h=!0;if((isFragment(u)?u:[u]).forEach(g=>{g.check(),f=f?g.isText&&g.marks.length===0:!1,h=h?g.isBlock:!1}),l===c&&h){const{parent:g}=r.doc.resolve(l);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(l-=1,c+=1)}let m;if(f){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Fragment){let g="";e.forEach(b=>{b.text&&(g+=b.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;r.insertText(m,l,c)}else m=u,r.replaceWith(l,c,m);n.updateSelection&&selectionToInsertionEnd(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:l,text:m}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:l,text:m})}return!0},joinUp=()=>({state:t,dispatch:e})=>joinUp$1(t,e),joinDown=()=>({state:t,dispatch:e})=>joinDown$1(t,e),joinBackward=()=>({state:t,dispatch:e})=>joinBackward$1(t,e),joinForward=()=>({state:t,dispatch:e})=>joinForward$1(t,e),joinItemBackward=()=>({state:t,dispatch:e,tr:n})=>{try{const r=joinPoint(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},joinItemForward=()=>({state:t,dispatch:e,tr:n})=>{try{const r=joinPoint(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},joinTextblockBackward=()=>({state:t,dispatch:e})=>joinTextblockBackward$1(t,e),joinTextblockForward=()=>({state:t,dispatch:e})=>joinTextblockForward$1(t,e);function isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function isMacOS(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function normalizeKeyName(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,o,a;for(let u=0;u<e.length-1;u+=1){const l=e[u];if(/^(cmd|meta|m)$/i.test(l))a=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))isiOS()||isMacOS()?a=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),a&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}const keyboardShortcut=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const o=normalizeKeyName(t).split(/-(?!$)/),a=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),u=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,u))});return l==null||l.steps.forEach(c=>{const f=c.map(r.mapping);f&&s&&r.maybeStep(f)}),!0};function isNodeActive(t,e,n={}){const{from:r,to:s,empty:o}=t.selection,a=e?getNodeType(e,t.schema):null,u=[];t.doc.nodesBetween(r,s,(h,p)=>{if(h.isText)return;const m=Math.max(r,p),g=Math.min(s,p+h.nodeSize);u.push({node:h,from:m,to:g})});const l=s-r,c=u.filter(h=>a?a.name===h.node.type.name:!0).filter(h=>objectIncludes(h.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((h,p)=>h+p.to-p.from,0)>=l}const lift=(t,e={})=>({state:n,dispatch:r})=>{const s=getNodeType(t,n.schema);return isNodeActive(n,s,e)?lift$1(n,r):!1},liftEmptyBlock=()=>({state:t,dispatch:e})=>liftEmptyBlock$1(t,e),liftListItem=t=>({state:e,dispatch:n})=>{const r=getNodeType(t,e.schema);return liftListItem$1(r)(e,n)},newlineInCode=()=>({state:t,dispatch:e})=>newlineInCode$1(t,e);function getSchemaTypeNameByName(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function deleteProps(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const resetAttributes=(t,e)=>({tr:n,state:r,dispatch:s})=>{let o=null,a=null;const u=getSchemaTypeNameByName(typeof t=="string"?t:t.name,r.schema);return u?(u==="node"&&(o=getNodeType(t,r.schema)),u==="mark"&&(a=getMarkType(t,r.schema)),s&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,f)=>{o&&o===c.type&&n.setNodeMarkup(f,void 0,deleteProps(c.attrs,e)),a&&c.marks.length&&c.marks.forEach(h=>{a===h.type&&n.addMark(f,f+c.nodeSize,a.create(deleteProps(h.attrs,e)))})})}),!0):!1},scrollIntoView=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),selectAll=()=>({tr:t,dispatch:e})=>{if(e){const n=new AllSelection(t.doc);t.setSelection(n)}return!0},selectNodeBackward=()=>({state:t,dispatch:e})=>selectNodeBackward$1(t,e),selectNodeForward=()=>({state:t,dispatch:e})=>selectNodeForward$1(t,e),selectParentNode=()=>({state:t,dispatch:e})=>selectParentNode$1(t,e),selectTextblockEnd=()=>({state:t,dispatch:e})=>selectTextblockEnd$1(t,e),selectTextblockStart=()=>({state:t,dispatch:e})=>selectTextblockStart$1(t,e);function createDocument(t,e,n={},r={}){return createNodeFromContent(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const setContent=(t,e=!1,n={},r={})=>({editor:s,tr:o,dispatch:a,commands:u})=>{var l,c;const{doc:f}=o;if(n.preserveWhitespace!=="full"){const h=createDocument(t,s.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck});return a&&o.replaceWith(0,f.content.size,h).setMeta("preventUpdate",!e),!0}return a&&o.setMeta("preventUpdate",!e),u.insertContentAt({from:0,to:f.content.size},t,{parseOptions:n,errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:s.options.enableContentCheck})};function getMarkAttributes(t,e){const n=getMarkType(e,t.schema),{from:r,to:s,empty:o}=t.selection,a=[];o?(t.storedMarks&&a.push(...t.storedMarks),a.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{a.push(...l.marks)});const u=a.find(l=>l.type.name===n.name);return u?{...u.attrs}:{}}function defaultBlockAt(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function findParentNodeClosestToPos(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function findParentNode(t){return e=>findParentNodeClosestToPos(e.$from,t)}function getText(t,e){const n={from:0,to:t.content.size};return getTextBetween(t,n,e)}function getNodeAttributes(t,e){const n=getNodeType(e,t.schema),{from:r,to:s}=t.selection,o=[];t.doc.nodesBetween(r,s,u=>{o.push(u)});const a=o.reverse().find(u=>u.type.name===n.name);return a?{...a.attrs}:{}}function getAttributes(t,e){const n=getSchemaTypeNameByName(typeof e=="string"?e:e.name,t.schema);return n==="node"?getNodeAttributes(t,e):n==="mark"?getMarkAttributes(t,e):{}}function getMarksBetween(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const o=n.resolve(t),a=getMarkRange(o,s.type);a&&r.push({mark:s,...a})}):n.nodesBetween(t,e,(s,o)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(a=>({from:o,to:o+s.nodeSize,mark:a})))}),r}function getSplittedAttributes(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(o=>o.type===e&&o.name===r);return s?s.attribute.keepOnSplit:!1}))}function isMarkActive(t,e,n={}){const{empty:r,ranges:s}=t.selection,o=e?getMarkType(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>o?o.name===h.type.name:!0).find(h=>objectIncludes(h.attrs,n,{strict:!1}));let a=0;const u=[];if(s.forEach(({$from:h,$to:p})=>{const m=h.pos,g=p.pos;t.doc.nodesBetween(m,g,(b,y)=>{if(!b.isText&&!b.marks.length)return;const _=Math.max(m,y),x=Math.min(g,y+b.nodeSize),E=x-_;a+=E,u.push(...b.marks.map(A=>({mark:A,from:_,to:x})))})}),a===0)return!1;const l=u.filter(h=>o?o.name===h.mark.type.name:!0).filter(h=>objectIncludes(h.mark.attrs,n,{strict:!1})).reduce((h,p)=>h+p.to-p.from,0),c=u.filter(h=>o?h.mark.type!==o&&h.mark.type.excludes(o):!0).reduce((h,p)=>h+p.to-p.from,0);return(l>0?l+c:l)>=a}function isActive(t,e,n={}){if(!e)return isNodeActive(t,null,n)||isMarkActive(t,null,n);const r=getSchemaTypeNameByName(e,t.schema);return r==="node"?isNodeActive(t,e,n):r==="mark"?isMarkActive(t,e,n):!1}function isList(t,e){const{nodeExtensions:n}=splitExtensions(e),r=n.find(a=>a.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},o=callOrReturn(getExtensionField(r,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function isNodeEmpty(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(o=>{s!==!1&&(isNodeEmpty(o,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function isNodeSelection(t){return t instanceof NodeSelection}function canSetMark(t,e,n){var r;const{selection:s}=e;let o=null;if(isTextSelection(s)&&(o=s.$cursor),o){const u=(r=t.storedMarks)!==null&&r!==void 0?r:o.marks();return!!n.isInSet(u)||!u.some(l=>l.type.excludes(n))}const{ranges:a}=s;return a.some(({$from:u,$to:l})=>{let c=u.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(u.pos,l.pos,(f,h,p)=>{if(c)return!1;if(f.isInline){const m=!p||p.type.allowsMarkType(n),g=!!n.isInSet(f.marks)||!f.marks.some(b=>b.type.excludes(n));c=m&&g}return!c}),c})}const setMark=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:o}=n,{empty:a,ranges:u}=o,l=getMarkType(t,r.schema);if(s)if(a){const c=getMarkAttributes(r,l);n.addStoredMark(l.create({...c,...e}))}else u.forEach(c=>{const f=c.$from.pos,h=c.$to.pos;r.doc.nodesBetween(f,h,(p,m)=>{const g=Math.max(m,f),b=Math.min(m+p.nodeSize,h);p.marks.find(_=>_.type===l)?p.marks.forEach(_=>{l===_.type&&n.addMark(g,b,l.create({..._.attrs,...e}))}):n.addMark(g,b,l.create(e))})});return canSetMark(r,n,l)},setMeta=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),setNode=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const o=getNodeType(t,n.schema);let a;return n.selection.$anchor.sameParent(n.selection.$head)&&(a=n.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:u})=>setBlockType(o,{...a,...e})(n)?!0:u.clearNodes()).command(({state:u})=>setBlockType(o,{...a,...e})(u,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=minMax(t,0,r.content.size),o=NodeSelection.create(r,s);e.setSelection(o)}return!0},setTextSelection=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:o}=typeof t=="number"?{from:t,to:t}:t,a=TextSelection.atStart(r).from,u=TextSelection.atEnd(r).to,l=minMax(s,a,u),c=minMax(o,a,u),f=TextSelection.create(r,l,c);e.setSelection(f)}return!0},sinkListItem=t=>({state:e,dispatch:n})=>{const r=getNodeType(t,e.schema);return sinkListItem$1(r)(e,n)};function ensureMarks(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const splitBlock=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:o,doc:a}=e,{$from:u,$to:l}=o,c=s.extensionManager.attributes,f=getSplittedAttributes(c,u.node().type.name,u.node().attrs);if(o instanceof NodeSelection&&o.node.isBlock)return!u.parentOffset||!canSplit(a,u.pos)?!1:(r&&(t&&ensureMarks(n,s.extensionManager.splittableMarks),e.split(u.pos).scrollIntoView()),!0);if(!u.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,p=u.depth===0?void 0:defaultBlockAt(u.node(-1).contentMatchAt(u.indexAfter(-1)));let m=h&&p?[{type:p,attrs:f}]:void 0,g=canSplit(e.doc,e.mapping.map(u.pos),1,m);if(!m&&!g&&canSplit(e.doc,e.mapping.map(u.pos),1,p?[{type:p}]:void 0)&&(g=!0,m=p?[{type:p,attrs:f}]:void 0),r){if(g&&(o instanceof TextSelection&&e.deleteSelection(),e.split(e.mapping.map(u.pos),1,m),p&&!h&&!u.parentOffset&&u.parent.type!==p)){const b=e.mapping.map(u.before()),y=e.doc.resolve(b);u.node(-1).canReplaceWith(y.index(),y.index()+1,p)&&e.setNodeMarkup(e.mapping.map(u.before()),p)}t&&ensureMarks(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return g},splitListItem=(t,e={})=>({tr:n,state:r,dispatch:s,editor:o})=>{var a;const u=getNodeType(t,r.schema),{$from:l,$to:c}=r.selection,f=r.selection.node;if(f&&f.isBlock||l.depth<2||!l.sameParent(c))return!1;const h=l.node(-1);if(h.type!==u)return!1;const p=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==u||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let _=Fragment.empty;const x=l.index(-1)?1:l.index(-2)?2:3;for(let S=l.depth-x;S>=l.depth-3;S-=1)_=Fragment.from(l.node(S).copy(_));const E=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,A={...getSplittedAttributes(p,l.node().type.name,l.node().attrs),...e},v=((a=u.contentMatch.defaultType)===null||a===void 0?void 0:a.createAndFill(A))||void 0;_=_.append(Fragment.from(u.createAndFill(null,v)||void 0));const w=l.before(l.depth-(x-1));n.replace(w,l.after(-E),new Slice(_,4-x,0));let k=-1;n.doc.nodesBetween(w,n.doc.content.size,(S,T)=>{if(k>-1)return!1;S.isTextblock&&S.content.size===0&&(k=T+1)}),k>-1&&n.setSelection(TextSelection.near(n.doc.resolve(k))),n.scrollIntoView()}return!0}const m=c.pos===l.end()?h.contentMatchAt(0).defaultType:null,g={...getSplittedAttributes(p,h.type.name,h.attrs),...e},b={...getSplittedAttributes(p,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const y=m?[{type:u,attrs:g},{type:m,attrs:b}]:[{type:u,attrs:g}];if(!canSplit(n.doc,l.pos,2))return!1;if(s){const{selection:_,storedMarks:x}=r,{splittableMarks:E}=o.extensionManager,A=x||_.$to.parentOffset&&_.$from.marks();if(n.split(l.pos,2,y).scrollIntoView(),!A||!s)return!0;const v=A.filter(w=>E.includes(w.type.name));n.ensureMarks(v)}return!0},joinListBackwards=(t,e)=>{const n=findParentNode(a=>a.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&canJoin(t.doc,n.pos)&&t.join(n.pos),!0},joinListForwards=(t,e)=>{const n=findParentNode(a=>a.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&canJoin(t.doc,r)&&t.join(r),!0},toggleList=(t,e,n,r={})=>({editor:s,tr:o,state:a,dispatch:u,chain:l,commands:c,can:f})=>{const{extensions:h,splittableMarks:p}=s.extensionManager,m=getNodeType(t,a.schema),g=getNodeType(e,a.schema),{selection:b,storedMarks:y}=a,{$from:_,$to:x}=b,E=_.blockRange(x),A=y||b.$to.parentOffset&&b.$from.marks();if(!E)return!1;const v=findParentNode(w=>isList(w.type.name,h))(b);if(E.depth>=1&&v&&E.depth-v.depth<=1){if(v.node.type===m)return c.liftListItem(g);if(isList(v.node.type.name,h)&&m.validContent(v.node.content)&&u)return l().command(()=>(o.setNodeMarkup(v.pos,m),!0)).command(()=>joinListBackwards(o,m)).command(()=>joinListForwards(o,m)).run()}return!n||!A||!u?l().command(()=>f().wrapInList(m,r)?!0:c.clearNodes()).wrapInList(m,r).command(()=>joinListBackwards(o,m)).command(()=>joinListForwards(o,m)).run():l().command(()=>{const w=f().wrapInList(m,r),k=A.filter(S=>p.includes(S.type.name));return o.ensureMarks(k),w?!0:c.clearNodes()}).wrapInList(m,r).command(()=>joinListBackwards(o,m)).command(()=>joinListForwards(o,m)).run()},toggleMark=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:o=!1}=n,a=getMarkType(t,r.schema);return isMarkActive(r,a,e)?s.unsetMark(a,{extendEmptyMarkRange:o}):s.setMark(a,e)},toggleNode=(t,e,n={})=>({state:r,commands:s})=>{const o=getNodeType(t,r.schema),a=getNodeType(e,r.schema),u=isNodeActive(r,o,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),u?s.setNode(a,l):s.setNode(o,{...l,...n})},toggleWrap=(t,e={})=>({state:n,commands:r})=>{const s=getNodeType(t,n.schema);return isNodeActive(n,s,e)?r.lift(s):r.wrapIn(s,e)},undoInputRule=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let o;if(s.spec.isInputRules&&(o=s.getState(t))){if(e){const a=t.tr,u=o.transform;for(let l=u.steps.length-1;l>=0;l-=1)a.step(u.steps[l].invert(u.docs[l]));if(o.text){const l=a.doc.resolve(o.from).marks();a.replaceWith(o.from,o.to,t.schema.text(o.text,l))}else a.delete(o.from,o.to)}return!0}}return!1},unsetAllMarks=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},unsetMark=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var o;const{extendEmptyMarkRange:a=!1}=e,{selection:u}=n,l=getMarkType(t,r.schema),{$from:c,empty:f,ranges:h}=u;if(!s)return!0;if(f&&a){let{from:p,to:m}=u;const g=(o=c.marks().find(y=>y.type===l))===null||o===void 0?void 0:o.attrs,b=getMarkRange(c,l,g);b&&(p=b.from,m=b.to),n.removeMark(p,m,l)}else h.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,l)});return n.removeStoredMark(l),!0},updateAttributes=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let o=null,a=null;const u=getSchemaTypeNameByName(typeof t=="string"?t:t.name,r.schema);return u?(u==="node"&&(o=getNodeType(t,r.schema)),u==="mark"&&(a=getMarkType(t,r.schema)),s&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,f=l.$to.pos;let h,p,m,g;n.selection.empty?r.doc.nodesBetween(c,f,(b,y)=>{o&&o===b.type&&(m=Math.max(y,c),g=Math.min(y+b.nodeSize,f),h=y,p=b)}):r.doc.nodesBetween(c,f,(b,y)=>{y<c&&o&&o===b.type&&(m=Math.max(y,c),g=Math.min(y+b.nodeSize,f),h=y,p=b),y>=c&&y<=f&&(o&&o===b.type&&n.setNodeMarkup(y,void 0,{...b.attrs,...e}),a&&b.marks.length&&b.marks.forEach(_=>{if(a===_.type){const x=Math.max(y,c),E=Math.min(y+b.nodeSize,f);n.addMark(x,E,a.create({..._.attrs,...e}))}}))}),p&&(h!==void 0&&n.setNodeMarkup(h,void 0,{...p.attrs,...e}),a&&p.marks.length&&p.marks.forEach(b=>{a===b.type&&n.addMark(m,g,a.create({...b.attrs,...e}))}))}),!0):!1},wrapIn=(t,e={})=>({state:n,dispatch:r})=>{const s=getNodeType(t,n.schema);return wrapIn$1(s,e)(n,r)},wrapInList=(t,e={})=>({state:n,dispatch:r})=>{const s=getNodeType(t,n.schema);return wrapInList$1(s,e)(n,r)};var commands=Object.freeze({__proto__:null,blur,clearContent,clearNodes,command,createParagraphNear,cut,deleteCurrentNode,deleteNode,deleteRange,deleteSelection,enter,exitCode,extendMarkRange,first,focus,forEach,insertContent,insertContentAt,joinBackward,joinDown,joinForward,joinItemBackward,joinItemForward,joinTextblockBackward,joinTextblockForward,joinUp,keyboardShortcut,lift,liftEmptyBlock,liftListItem,newlineInCode,resetAttributes,scrollIntoView,selectAll,selectNodeBackward,selectNodeForward,selectParentNode,selectTextblockEnd,selectTextblockStart,setContent,setMark,setMeta,setNode,setNodeSelection,setTextSelection,sinkListItem,splitBlock,splitListItem,toggleList,toggleMark,toggleNode,toggleWrap,undoInputRule,unsetAllMarks,unsetMark,updateAttributes,wrapIn,wrapInList});const Commands=Extension.create({name:"commands",addCommands(){return{...commands}}}),Drop=Extension.create({name:"drop",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),Editable=Extension.create({name:"editable",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("editable"),props:{editable:()=>this.editor.options.editable}})]}}),FocusEvents=Extension.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Plugin({key:new PluginKey("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),Keymap=Extension.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:u})=>{const{selection:l,doc:c}=u,{empty:f,$anchor:h}=l,{pos:p,parent:m}=h,g=h.parent.isTextblock&&p>0?u.doc.resolve(p-1):h,b=g.parent.type.spec.isolating,y=h.pos-h.parentOffset,_=b&&g.parent.childCount===1?y===h.pos:Selection.atStart(c).from===p;return!f||!m.type.isTextblock||m.textContent.length||!_||_&&h.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},o={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return isiOS()||isMacOS()?o:s},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clearDocument"),appendTransaction:(t,e,n)=>{const r=t.some(b=>b.docChanged)&&!e.doc.eq(n.doc),s=t.some(b=>b.getMeta("preventClearDocument"));if(!r||s)return;const{empty:o,from:a,to:u}=e.selection,l=Selection.atStart(e.doc).from,c=Selection.atEnd(e.doc).to;if(o||!(a===l&&u===c)||!isNodeEmpty(n.doc))return;const p=n.tr,m=createChainableState({state:n,transaction:p}),{commands:g}=new CommandManager({editor:this.editor,state:m});if(g.clearNodes(),!!p.steps.length)return p}})]}}),Paste=Extension.create({name:"paste",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),Tabindex=Extension.create({name:"tabindex",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});var index=Object.freeze({__proto__:null,ClipboardTextSerializer,Commands,Drop,Editable,FocusEvents,Keymap,Paste,Tabindex});class NodePos{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new NodePos(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new NodePos(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new NodePos(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,o=n.isAtom&&!n.isText,a=this.pos+r+(o?0:1),u=this.resolvedPos.doc.resolve(a);if(!s&&u.depth<=this.depth)return;const l=new NodePos(u,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new NodePos(u,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const o=s.node.attrs,a=Object.keys(n);for(let u=0;u<a.length;u+=1){const l=a[u];if(o[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const o=Object.keys(n);return this.children.forEach(a=>{r&&s.length>0||(a.node.type.name===e&&o.every(l=>n[l]===a.node.attrs[l])&&s.push(a),!(r&&s.length>0)&&(s=s.concat(a.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const style=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function createStyleTag(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}class Editor extends EventEmitter{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=createStyleTag(style,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=isFunction$1(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(o=>{const a=typeof o=="string"?`${o}$`:o.key;r=n.filter(u=>!u.key.startsWith(a))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[Editable,ClipboardTextSerializer.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),Commands,FocusEvents,Keymap,Tabindex,Drop,Paste].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o==null?void 0:o.type));this.extensionManager=new ExtensionManager(s,this)}createCommandManager(){this.commandManager=new CommandManager({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(a){if(!(a instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(a.message))throw a;this.emit("contentError",{editor:this,error:a,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(u=>u.name!=="collaboration"),this.createExtensionManager()}}),n=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=resolveFocusPosition(n,this.options.autofocus);this.view=new EditorView(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:EditorState.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(a=>{var u;return(u=this.capturedTransaction)===null||u===void 0?void 0:u.step(a)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),o=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),o&&this.emit("blur",{editor:this,event:o.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return getAttributes(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return isActive(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return getHTMLFromFragment(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return getText(this.state.doc,{blockSeparator:n,textSerializers:{...getTextSerializersFromSchema(this.schema),...r}})}get isEmpty(){return isNodeEmpty(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new NodePos(n,this)}get $doc(){return this.$pos(0)}}function markInputRule(t){return new InputRule({find:t.find,handler:({state:e,range:n,match:r})=>{const s=callOrReturn(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],u=r[0];if(a){const l=u.search(/\S/),c=n.from+u.indexOf(a),f=c+a.length;if(getMarksBetween(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(b=>b===t.type&&b!==m.mark.type)).filter(m=>m.to>c).length)return null;f<n.to&&o.delete(f,n.to),c>n.from&&o.delete(n.from+l,c);const p=n.from+l+a.length;o.addMark(n.from+l,p,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}function nodeInputRule(t){return new InputRule({find:t.find,handler:({state:e,range:n,match:r})=>{const s=callOrReturn(t.getAttributes,void 0,r)||{},{tr:o}=e,a=n.from;let u=n.to;const l=t.type.create(s);if(r[1]){const c=r[0].lastIndexOf(r[1]);let f=a+c;f>u?f=u:u=f+r[1].length;const h=r[0][r[0].length-1];o.insertText(h,a+r[0].length-1),o.replaceWith(f,u,l)}else if(r[0]){const c=t.type.isInline?a:a-1;o.insert(c,t.type.create(s)).delete(o.mapping.map(a),o.mapping.map(u))}o.scrollIntoView()}})}function textblockTypeInputRule(t){return new InputRule({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),o=callOrReturn(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,o)}})}function wrappingInputRule(t){return new InputRule({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const o=callOrReturn(t.getAttributes,void 0,r)||{},a=e.tr.delete(n.from,n.to),l=a.doc.resolve(n.from).blockRange(),c=l&&findWrapping(l,t.type,o);if(!c)return null;if(a.wrap(l,c),t.keepMarks&&t.editor){const{selection:h,storedMarks:p}=e,{splittableMarks:m}=t.editor.extensionManager,g=p||h.$to.parentOffset&&h.$from.marks();if(g){const b=g.filter(y=>m.includes(y.type.name));a.ensureMarks(b)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(h,o).run()}const f=a.doc.resolve(n.from-1).nodeBefore;f&&f.type===t.type&&canJoin(a.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,f))&&a.join(n.from-1)}})}let Node$1=class Ae{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ae(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Ae(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=callOrReturn(getExtensionField(n,"addOptions",{name:n.name})),n.storage=callOrReturn(getExtensionField(n,"addStorage",{name:n.name,options:n.options})),n}};function markPasteRule(t){return new PasteRule({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const o=callOrReturn(t.getAttributes,void 0,r,s);if(o===!1||o===null)return null;const{tr:a}=e,u=r[r.length-1],l=r[0];let c=n.to;if(u){const f=l.search(/\S/),h=n.from+l.indexOf(u),p=h+u.length;if(getMarksBetween(n.from,n.to,e.doc).filter(g=>g.mark.type.excluded.find(y=>y===t.type&&y!==g.mark.type)).filter(g=>g.to>h).length)return null;p<n.to&&a.delete(p,n.to),h>n.from&&a.delete(n.from+f,h),c=n.from+f+u.length,a.addMark(n.from+f,c,t.type.create(o||{})),a.removeStoredMark(t.type)}}})}const inputRegex$4=/^\s*>\s$/,Blockquote$2=Node$1.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[wrappingInputRule({find:inputRegex$4,type:this.type})]}}),starInputRegex$1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,starPasteRegex$1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,underscoreInputRegex$1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,underscorePasteRegex$1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Bold$2=Mark.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[markInputRule({find:starInputRegex$1,type:this.type}),markInputRule({find:underscoreInputRegex$1,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex$1,type:this.type}),markPasteRule({find:underscorePasteRegex$1,type:this.type})]}}),ListItemName$1="listItem",TextStyleName$1="textStyle",inputRegex$3=/^\s*([-+*])\s$/,BulletList$2=Node$1.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItemName$1,this.editor.getAttributes(TextStyleName$1)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=wrappingInputRule({find:inputRegex$3,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=wrappingInputRule({find:inputRegex$3,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(TextStyleName$1),editor:this.editor})),[t]}}),inputRegex$2=/(^|[^`])`([^`]+)`(?!`)/,pasteRegex$1=/(^|[^`])`([^`]+)`(?!`)/g,Code$2=Mark.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[markInputRule({find:inputRegex$2,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex$1,type:this.type})]}}),backtickInputRegex=/^```([a-z]+)?[\s\n]$/,tildeInputRegex=/^~~~([a-z]+)?[\s\n]$/,CodeBlock$2=Node$1.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,o=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(a=>a.startsWith(n)).map(a=>a.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",mergeAttributes(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const o=r.parentOffset===r.parent.nodeSize-2,a=r.parent.textContent.endsWith(`

`);return!o||!a?!1:t.chain().command(({tr:u})=>(u.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:o}=n;if(!o||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const u=s.after();return u===void 0?!1:r.nodeAt(u)?t.commands.command(({tr:c})=>(c.setSelection(Selection.near(r.resolve(u))),!0)):t.commands.exitCode()}}},addInputRules(){return[textblockTypeInputRule({find:backtickInputRegex,type:this.type,getAttributes:t=>({language:t[1]})}),textblockTypeInputRule({find:tildeInputRegex,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,o=s==null?void 0:s.mode;if(!n||!o)return!1;const{tr:a,schema:u}=t.state,l=u.text(n.replace(/\r\n?/g,`
`));return a.replaceSelectionWith(this.type.create({language:o},l)),a.selection.$from.parent.type!==this.type&&a.setSelection(TextSelection.near(a.doc.resolve(Math.max(0,a.selection.from-2)))),a.setMeta("paste",!0),t.dispatch(a),!0}}})]}}),Document=Node$1.create({name:"doc",topNode:!0,content:"block+"});function dropCursor(t={}){return new Plugin({view(e){return new DropCursorView(e,t)}})}class DropCursorView{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let o=a=>{this[s](a)};return e.dom.addEventListener(s,o),{name:s,handler:o}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r;if(n){let u=e.nodeBefore,l=e.nodeAfter;if(u||l){let c=this.editorView.nodeDOM(this.cursorPos-(u?u.nodeSize:0));if(c){let f=c.getBoundingClientRect(),h=u?f.bottom:f.top;u&&l&&(h=(h+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:f.left,right:f.right,top:h-this.width/2,bottom:h+this.width/2}}}}if(!r){let u=this.editorView.coordsAtPos(this.cursorPos);r={left:u.left-this.width/2,right:u.left+this.width/2,top:u.top,bottom:u.bottom}}let s=this.editorView.dom.offsetParent;this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let o,a;if(!s||s==document.body&&getComputedStyle(s).position=="static")o=-pageXOffset,a=-pageYOffset;else{let u=s.getBoundingClientRect();o=u.left-s.scrollLeft,a=u.top-s.scrollTop}this.element.style.left=r.left-o+"px",this.element.style.top=r.top-a+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,o=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!o){let a=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let u=dropPoint(this.editorView.state.doc,a,this.editorView.dragging.slice);u!=null&&(a=u)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const Dropcursor=Extension.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[dropCursor(this.options)]}});class GapCursor extends Selection{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return GapCursor.valid(r)?new GapCursor(r):Selection.near(r)}content(){return Slice.empty}eq(e){return e instanceof GapCursor&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new GapCursor(e.resolve(n.pos))}getBookmark(){return new GapBookmark(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!closedBefore(e)||!closedAfter(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&GapCursor.valid(e))return e;let s=e.pos,o=null;for(let a=e.depth;;a--){let u=e.node(a);if(n>0?e.indexAfter(a)<u.childCount:e.index(a)>0){o=u.child(n>0?e.indexAfter(a):e.index(a)-1);break}else if(a==0)return null;s+=n;let l=e.doc.resolve(s);if(GapCursor.valid(l))return l}for(;;){let a=n>0?o.firstChild:o.lastChild;if(!a){if(o.isAtom&&!o.isText&&!NodeSelection.isSelectable(o)){e=e.doc.resolve(s+o.nodeSize*n),r=!1;continue e}break}o=a,s+=n;let u=e.doc.resolve(s);if(GapCursor.valid(u))return u}return null}}}GapCursor.prototype.visible=!1;GapCursor.findFrom=GapCursor.findGapCursorFrom;Selection.jsonID("gapcursor",GapCursor);class GapBookmark{constructor(e){this.pos=e}map(e){return new GapBookmark(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return GapCursor.valid(n)?new GapCursor(n):Selection.near(n)}}function closedBefore(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function closedAfter(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function gapCursor(){return new Plugin({props:{decorations:drawGapCursor,createSelectionBetween(t,e,n){return e.pos==n.pos&&GapCursor.valid(n)?new GapCursor(n):null},handleClick,handleKeyDown,handleDOMEvents:{beforeinput}}})}const handleKeyDown=keydownHandler({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1)});function arrow(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,o){let a=r.selection,u=e>0?a.$to:a.$from,l=a.empty;if(a instanceof TextSelection){if(!o.endOfTextblock(n)||u.depth==0)return!1;l=!1,u=r.doc.resolve(e>0?u.after():u.before())}let c=GapCursor.findGapCursorFrom(u,e,l);return c?(s&&s(r.tr.setSelection(new GapCursor(c))),!0):!1}}function handleClick(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!GapCursor.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&NodeSelection.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new GapCursor(r))),!0)}function beforeinput(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof GapCursor))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=Fragment.empty;for(let a=r.length-1;a>=0;a--)s=Fragment.from(r[a].createAndFill(null,s));let o=t.state.tr.replace(n.pos,n.pos,new Slice(s,0,0));return o.setSelection(TextSelection.near(o.doc.resolve(n.pos+1))),t.dispatch(o),!1}function drawGapCursor(t){if(!(t.selection instanceof GapCursor))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",DecorationSet.create(t.doc,[Decoration.widget(t.selection.head,e,{key:"gapcursor"})])}const Gapcursor=Extension.create({name:"gapCursor",addProseMirrorPlugins(){return[gapCursor()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=callOrReturn(getExtensionField(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),HardBreak$2=Node$1.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",mergeAttributes(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:o}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:a}=this.options,{splittableMarks:u}=r.extensionManager,l=o||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:f})=>{if(f&&l&&a){const h=l.filter(p=>u.includes(p.type.name));c.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Heading$2=Node$1.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,mergeAttributes(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>textblockTypeInputRule({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var GOOD_LEAF_SIZE=200,RopeSequence=function t(){};RopeSequence.prototype.append=function t(e){return e.length?(e=RopeSequence.from(e),!this.length&&e||e.length<GOOD_LEAF_SIZE&&this.leafAppend(e)||this.length<GOOD_LEAF_SIZE&&e.leafPrepend(this)||this.appendInner(e)):this};RopeSequence.prototype.prepend=function t(e){return e.length?RopeSequence.from(e).append(this):this};RopeSequence.prototype.appendInner=function t(e){return new Append(this,e)};RopeSequence.prototype.slice=function t(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?RopeSequence.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};RopeSequence.prototype.get=function t(e){if(!(e<0||e>=this.length))return this.getInner(e)};RopeSequence.prototype.forEach=function t(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};RopeSequence.prototype.map=function t(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(o,a){return s.push(e(o,a))},n,r),s};RopeSequence.from=function t(e){return e instanceof RopeSequence?e:e&&e.length?new Leaf(e):RopeSequence.empty};var Leaf=function(t){function e(r){t.call(this),this.values=r}e.__proto__=t,e.prototype=Object.create(t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,o){return s==0&&o==this.length?this:new e(this.values.slice(s,o))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,o,a,u){for(var l=o;l<a;l++)if(s(this.values[l],u+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,o,a,u){for(var l=o-1;l>=a;l--)if(s(this.values[l],u+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=GOOD_LEAF_SIZE)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=GOOD_LEAF_SIZE)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(RopeSequence);RopeSequence.empty=new Leaf([]);var Append=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return e.__proto__=t,e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,o,a){var u=this.left.length;if(s<u&&this.left.forEachInner(r,s,Math.min(o,u),a)===!1||o>u&&this.right.forEachInner(r,Math.max(s-u,0),Math.min(this.length,o)-u,a+u)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,o,a){var u=this.left.length;if(s>u&&this.right.forEachInvertedInner(r,s-u,Math.max(o,u)-u,a+u)===!1||o<u&&this.left.forEachInvertedInner(r,Math.min(s,u),o,a)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var o=this.left.length;return s<=o?this.left.slice(r,s):r>=o?this.right.slice(r-o,s-o):this.left.slice(r,o).append(this.right.slice(0,s-o))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(RopeSequence);const max_empty_items=500;class Branch{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,o;n&&(s=this.remapping(r,this.items.length),o=s.maps.length);let a=e.tr,u,l,c=[],f=[];return this.items.forEach((h,p)=>{if(!h.step){s||(s=this.remapping(r,p+1),o=s.maps.length),o--,f.push(h);return}if(s){f.push(new Item(h.map));let m=h.step.map(s.slice(o)),g;m&&a.maybeStep(m).doc&&(g=a.mapping.maps[a.mapping.maps.length-1],c.push(new Item(g,void 0,void 0,c.length+f.length))),o--,g&&s.appendMap(g,o)}else a.maybeStep(h.step);if(h.selection)return u=s?h.selection.map(s.slice(o)):h.selection,l=new Branch(this.items.slice(0,r).append(f.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:a,selection:u}}addTransform(e,n,r,s){let o=[],a=this.eventCount,u=this.items,l=!s&&u.length?u.get(u.length-1):null;for(let f=0;f<e.steps.length;f++){let h=e.steps[f].invert(e.docs[f]),p=new Item(e.mapping.maps[f],h,n),m;(m=l&&l.merge(p))&&(p=m,f?o.pop():u=u.slice(0,u.length-1)),o.push(p),n&&(a++,n=void 0),s||(l=p)}let c=a-r.depth;return c>DEPTH_OVERFLOW&&(u=cutOffEvents(u,c),a-=c),new Branch(u.append(o),a)}remapping(e,n){let r=new Mapping;return this.items.forEach((s,o)=>{let a=s.mirrorOffset!=null&&o-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,a)},e,n),r}addMaps(e){return this.eventCount==0?this:new Branch(this.items.append(e.map(n=>new Item(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),o=e.mapping,a=e.steps.length,u=this.eventCount;this.items.forEach(p=>{p.selection&&u--},s);let l=n;this.items.forEach(p=>{let m=o.getMirror(--l);if(m==null)return;a=Math.min(a,m);let g=o.maps[m];if(p.step){let b=e.steps[m].invert(e.docs[m]),y=p.selection&&p.selection.map(o.slice(l+1,m));y&&u++,r.push(new Item(g,b,y))}else r.push(new Item(g))},s);let c=[];for(let p=n;p<a;p++)c.push(new Item(o.maps[p]));let f=this.items.slice(0,s).append(c).append(r),h=new Branch(f,u);return h.emptyItemCount()>max_empty_items&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],o=0;return this.items.forEach((a,u)=>{if(u>=e)s.push(a),a.selection&&o++;else if(a.step){let l=a.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let f=a.selection&&a.selection.map(n.slice(r));f&&o++;let h=new Item(c.invert(),l,f),p,m=s.length-1;(p=s.length&&s[m].merge(h))?s[m]=p:s.push(h)}}else a.map&&r--},this.items.length,0),new Branch(RopeSequence.from(s.reverse()),o)}}Branch.empty=new Branch(RopeSequence.empty,0);function cutOffEvents(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class Item{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Item(n.getMap().invert(),n,this.selection)}}}class HistoryState{constructor(e,n,r,s,o){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=o}}const DEPTH_OVERFLOW=20;function applyTransaction(t,e,n,r){let s=n.getMeta(historyKey),o;if(s)return s.historyState;n.getMeta(closeHistoryKey)&&(t=new HistoryState(t.done,t.undone,null,0,-1));let a=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(a&&a.getMeta(historyKey))return a.getMeta(historyKey).redo?new HistoryState(t.done.addTransform(n,void 0,r,mustPreserveItems(e)),t.undone,rangesFor(n.mapping.maps),t.prevTime,t.prevComposition):new HistoryState(t.done,t.undone.addTransform(n,void 0,r,mustPreserveItems(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(a&&a.getMeta("addToHistory")===!1)){let u=n.getMeta("composition"),l=t.prevTime==0||!a&&t.prevComposition!=u&&(t.prevTime<(n.time||0)-r.newGroupDelay||!isAdjacentTo(n,t.prevRanges)),c=a?mapRanges(t.prevRanges,n.mapping):rangesFor(n.mapping.maps);return new HistoryState(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,mustPreserveItems(e)),Branch.empty,c,n.time,u??t.prevComposition)}else return(o=n.getMeta("rebased"))?new HistoryState(t.done.rebased(n,o),t.undone.rebased(n,o),mapRanges(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new HistoryState(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),mapRanges(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function isAdjacentTo(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let o=0;o<e.length;o+=2)r<=e[o+1]&&s>=e[o]&&(n=!0)}),n}function rangesFor(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,o,a)=>e.push(o,a));return e}function mapRanges(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),o=e.map(t[r+1],-1);s<=o&&n.push(s,o)}return n}function histTransaction(t,e,n){let r=mustPreserveItems(e),s=historyKey.get(e).spec.config,o=(n?t.undone:t.done).popEvent(e,r);if(!o)return null;let a=o.selection.resolve(o.transform.doc),u=(n?t.done:t.undone).addTransform(o.transform,e.selection.getBookmark(),s,r),l=new HistoryState(n?u:o.remaining,n?o.remaining:u,null,0,-1);return o.transform.setSelection(a).setMeta(historyKey,{redo:n,historyState:l})}let cachedPreserveItems=!1,cachedPreserveItemsPlugins=null;function mustPreserveItems(t){let e=t.plugins;if(cachedPreserveItemsPlugins!=e){cachedPreserveItems=!1,cachedPreserveItemsPlugins=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){cachedPreserveItems=!0;break}}return cachedPreserveItems}const historyKey=new PluginKey("history"),closeHistoryKey=new PluginKey("closeHistory");function history$1(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Plugin({key:historyKey,state:{init(){return new HistoryState(Branch.empty,Branch.empty,null,0,-1)},apply(e,n,r){return applyTransaction(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?undo:r=="historyRedo"?redo:null;return s?(n.preventDefault(),s(e.state,e.dispatch)):!1}}}})}function buildCommand(t,e){return(n,r)=>{let s=historyKey.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let o=histTransaction(s,n,t);o&&r(e?o.scrollIntoView():o)}return!0}}const undo=buildCommand(!1,!0),redo=buildCommand(!0,!0),History=Extension.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>undo(t,e),redo:()=>({state:t,dispatch:e})=>redo(t,e)}},addProseMirrorPlugins(){return[history$1(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),HorizontalRule$2=Node$1.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",mergeAttributes(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{const{selection:n}=e,{$from:r,$to:s}=n,o=t();return r.parentOffset===0?o.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):isNodeSelection(n)?o.insertContentAt(s.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({tr:a,dispatch:u})=>{var l;if(u){const{$to:c}=a.selection,f=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?a.setSelection(TextSelection.create(a.doc,c.pos+1)):c.nodeAfter.isBlock?a.setSelection(NodeSelection.create(a.doc,c.pos)):a.setSelection(TextSelection.create(a.doc,c.pos));else{const h=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();h&&(a.insert(f,h),a.setSelection(TextSelection.create(a.doc,f+1)))}a.scrollIntoView()}return!0}).run()}}},addInputRules(){return[nodeInputRule({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),starInputRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,starPasteRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,underscoreInputRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,underscorePasteRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Italic$2=Mark.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[markInputRule({find:starInputRegex,type:this.type}),markInputRule({find:underscoreInputRegex,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex,type:this.type}),markPasteRule({find:underscorePasteRegex,type:this.type})]}}),ListItem$2=Node$1.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",mergeAttributes(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ListItemName="listItem",TextStyleName="textStyle",inputRegex$1=/^(\d+)\.\s$/,OrderedList$2=Node$1.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:void 0,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",mergeAttributes(this.options.HTMLAttributes,n),0]:["ol",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItemName,this.editor.getAttributes(TextStyleName)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=wrappingInputRule({find:inputRegex$1,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=wrappingInputRule({find:inputRegex$1,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(TextStyleName)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),Paragraph$2=Node$1.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),inputRegex=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,pasteRegex=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Strike$2=Mark.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[markInputRule({find:inputRegex,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex,type:this.type})]}}),Text$2=Node$1.create({name:"text",group:"inline"}),StarterKit=Extension.create({name:"starterKit",addExtensions(){var t,e,n,r,s,o,a,u,l,c,f,h,p,m,g,b,y,_;const x=[];return this.options.bold!==!1&&x.push(Bold$2.configure((t=this.options)===null||t===void 0?void 0:t.bold)),this.options.blockquote!==!1&&x.push(Blockquote$2.configure((e=this.options)===null||e===void 0?void 0:e.blockquote)),this.options.bulletList!==!1&&x.push(BulletList$2.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&x.push(Code$2.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&x.push(CodeBlock$2.configure((s=this.options)===null||s===void 0?void 0:s.codeBlock)),this.options.document!==!1&&x.push(Document.configure((o=this.options)===null||o===void 0?void 0:o.document)),this.options.dropcursor!==!1&&x.push(Dropcursor.configure((a=this.options)===null||a===void 0?void 0:a.dropcursor)),this.options.gapcursor!==!1&&x.push(Gapcursor.configure((u=this.options)===null||u===void 0?void 0:u.gapcursor)),this.options.hardBreak!==!1&&x.push(HardBreak$2.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&x.push(Heading$2.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&x.push(History.configure((f=this.options)===null||f===void 0?void 0:f.history)),this.options.horizontalRule!==!1&&x.push(HorizontalRule$2.configure((h=this.options)===null||h===void 0?void 0:h.horizontalRule)),this.options.italic!==!1&&x.push(Italic$2.configure((p=this.options)===null||p===void 0?void 0:p.italic)),this.options.listItem!==!1&&x.push(ListItem$2.configure((m=this.options)===null||m===void 0?void 0:m.listItem)),this.options.orderedList!==!1&&x.push(OrderedList$2.configure((g=this.options)===null||g===void 0?void 0:g.orderedList)),this.options.paragraph!==!1&&x.push(Paragraph$2.configure((b=this.options)===null||b===void 0?void 0:b.paragraph)),this.options.strike!==!1&&x.push(Strike$2.configure((y=this.options)===null||y===void 0?void 0:y.strike)),this.options.text!==!1&&x.push(Text$2.configure((_=this.options)===null||_===void 0?void 0:_.text)),x}}),decodeCache={};function getDecodeCache(t){let e=decodeCache[t];if(e)return e;e=decodeCache[t]=[];for(let n=0;n<128;n++){const r=String.fromCharCode(n);e.push(r)}for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e[r]="%"+("0"+r.toString(16).toUpperCase()).slice(-2)}return e}function decode$1(t,e){typeof e!="string"&&(e=decode$1.defaultChars);const n=getDecodeCache(e);return t.replace(/(%[a-f0-9]{2})+/gi,function(r){let s="";for(let o=0,a=r.length;o<a;o+=3){const u=parseInt(r.slice(o+1,o+3),16);if(u<128){s+=n[u];continue}if((u&224)===192&&o+3<a){const l=parseInt(r.slice(o+4,o+6),16);if((l&192)===128){const c=u<<6&1984|l&63;c<128?s+="":s+=String.fromCharCode(c),o+=3;continue}}if((u&240)===224&&o+6<a){const l=parseInt(r.slice(o+4,o+6),16),c=parseInt(r.slice(o+7,o+9),16);if((l&192)===128&&(c&192)===128){const f=u<<12&61440|l<<6&4032|c&63;f<2048||f>=55296&&f<=57343?s+="":s+=String.fromCharCode(f),o+=6;continue}}if((u&248)===240&&o+9<a){const l=parseInt(r.slice(o+4,o+6),16),c=parseInt(r.slice(o+7,o+9),16),f=parseInt(r.slice(o+10,o+12),16);if((l&192)===128&&(c&192)===128&&(f&192)===128){let h=u<<18&1835008|l<<12&258048|c<<6&4032|f&63;h<65536||h>1114111?s+="":(h-=65536,s+=String.fromCharCode(55296+(h>>10),56320+(h&1023))),o+=9;continue}}s+=""}return s})}decode$1.defaultChars=";/?:@&=+$,#";decode$1.componentChars="";const encodeCache={};function getEncodeCache(t){let e=encodeCache[t];if(e)return e;e=encodeCache[t]=[];for(let n=0;n<128;n++){const r=String.fromCharCode(n);/^[0-9a-z]$/i.test(r)?e.push(r):e.push("%"+("0"+n.toString(16).toUpperCase()).slice(-2))}for(let n=0;n<t.length;n++)e[t.charCodeAt(n)]=t[n];return e}function encode$1(t,e,n){typeof e!="string"&&(n=e,e=encode$1.defaultChars),typeof n>"u"&&(n=!0);const r=getEncodeCache(e);let s="";for(let o=0,a=t.length;o<a;o++){const u=t.charCodeAt(o);if(n&&u===37&&o+2<a&&/^[0-9a-f]{2}$/i.test(t.slice(o+1,o+3))){s+=t.slice(o,o+3),o+=2;continue}if(u<128){s+=r[u];continue}if(u>=55296&&u<=57343){if(u>=55296&&u<=56319&&o+1<a){const l=t.charCodeAt(o+1);if(l>=56320&&l<=57343){s+=encodeURIComponent(t[o]+t[o+1]),o++;continue}}s+="%EF%BF%BD";continue}s+=encodeURIComponent(t[o])}return s}encode$1.defaultChars=";/?:@&=+$,-_.!~*'()#";encode$1.componentChars="-_.!~*'()";function format(t){let e="";return e+=t.protocol||"",e+=t.slashes?"//":"",e+=t.auth?t.auth+"@":"",t.hostname&&t.hostname.indexOf(":")!==-1?e+="["+t.hostname+"]":e+=t.hostname||"",e+=t.port?":"+t.port:"",e+=t.pathname||"",e+=t.search||"",e+=t.hash||"",e}function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}const protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r",`
`,"	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(t,e){if(t&&t instanceof Url)return t;const n=new Url;return n.parse(t,e),n}Url.prototype.parse=function(t,e){let n,r,s,o=t;if(o=o.trim(),!e&&t.split("#").length===1){const c=simplePathPattern.exec(o);if(c)return this.pathname=c[1],c[2]&&(this.search=c[2]),this}let a=protocolPattern.exec(o);if(a&&(a=a[0],n=a.toLowerCase(),this.protocol=a,o=o.substr(a.length)),(e||a||o.match(/^\/\/[^@\/]+@[^@\/]+/))&&(s=o.substr(0,2)==="//",s&&!(a&&hostlessProtocol[a])&&(o=o.substr(2),this.slashes=!0)),!hostlessProtocol[a]&&(s||a&&!slashedProtocol[a])){let c=-1;for(let g=0;g<hostEndingChars.length;g++)r=o.indexOf(hostEndingChars[g]),r!==-1&&(c===-1||r<c)&&(c=r);let f,h;c===-1?h=o.lastIndexOf("@"):h=o.lastIndexOf("@",c),h!==-1&&(f=o.slice(0,h),o=o.slice(h+1),this.auth=f),c=-1;for(let g=0;g<nonHostChars.length;g++)r=o.indexOf(nonHostChars[g]),r!==-1&&(c===-1||r<c)&&(c=r);c===-1&&(c=o.length),o[c-1]===":"&&c--;const p=o.slice(0,c);o=o.slice(c),this.parseHost(p),this.hostname=this.hostname||"";const m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!m){const g=this.hostname.split(/\./);for(let b=0,y=g.length;b<y;b++){const _=g[b];if(_&&!_.match(hostnamePartPattern)){let x="";for(let E=0,A=_.length;E<A;E++)_.charCodeAt(E)>127?x+="x":x+=_[E];if(!x.match(hostnamePartPattern)){const E=g.slice(0,b),A=g.slice(b+1),v=_.match(hostnamePartStart);v&&(E.push(v[1]),A.unshift(v[2])),A.length&&(o=A.join(".")+o),this.hostname=E.join(".");break}}}}this.hostname.length>hostnameMaxLen&&(this.hostname=""),m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}const u=o.indexOf("#");u!==-1&&(this.hash=o.substr(u),o=o.slice(0,u));const l=o.indexOf("?");return l!==-1&&(this.search=o.substr(l),o=o.slice(0,l)),o&&(this.pathname=o),slashedProtocol[n]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Url.prototype.parseHost=function(t){let e=portPattern.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const mdurl=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$1,encode:encode$1,format,parse:urlParse},Symbol.toStringTag,{value:"Module"})),Any=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Cc=/[\0-\x1F\x7F-\x9F]/,regex$1=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,P=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,regex=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,Z=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,ucmicro=Object.freeze(Object.defineProperty({__proto__:null,Any,Cc,Cf:regex$1,P,S:regex,Z},Symbol.toStringTag,{value:"Module"})),htmlDecodeTree=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(t=>t.charCodeAt(0))),xmlDecodeTree=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(t=>t.charCodeAt(0)));var _a;const decodeMap=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),fromCodePoint$1=(_a=String.fromCodePoint)!==null&&_a!==void 0?_a:function(t){let e="";return t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|t&1023),e+=String.fromCharCode(t),e};function replaceCodePoint(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=decodeMap.get(t))!==null&&e!==void 0?e:t}var CharCodes;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(CharCodes||(CharCodes={}));const TO_LOWER_BIT=32;var BinTrieFlags;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(BinTrieFlags||(BinTrieFlags={}));function isNumber(t){return t>=CharCodes.ZERO&&t<=CharCodes.NINE}function isHexadecimalCharacter(t){return t>=CharCodes.UPPER_A&&t<=CharCodes.UPPER_F||t>=CharCodes.LOWER_A&&t<=CharCodes.LOWER_F}function isAsciiAlphaNumeric(t){return t>=CharCodes.UPPER_A&&t<=CharCodes.UPPER_Z||t>=CharCodes.LOWER_A&&t<=CharCodes.LOWER_Z||isNumber(t)}function isEntityInAttributeInvalidEnd(t){return t===CharCodes.EQUALS||isAsciiAlphaNumeric(t)}var EntityDecoderState;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(EntityDecoderState||(EntityDecoderState={}));var DecodingMode;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(DecodingMode||(DecodingMode={}));class EntityDecoder{constructor(e,n,r){this.decodeTree=e,this.emitCodePoint=n,this.errors=r,this.state=EntityDecoderState.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=DecodingMode.Strict}startEntity(e){this.decodeMode=e,this.state=EntityDecoderState.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,n){switch(this.state){case EntityDecoderState.EntityStart:return e.charCodeAt(n)===CharCodes.NUM?(this.state=EntityDecoderState.NumericStart,this.consumed+=1,this.stateNumericStart(e,n+1)):(this.state=EntityDecoderState.NamedEntity,this.stateNamedEntity(e,n));case EntityDecoderState.NumericStart:return this.stateNumericStart(e,n);case EntityDecoderState.NumericDecimal:return this.stateNumericDecimal(e,n);case EntityDecoderState.NumericHex:return this.stateNumericHex(e,n);case EntityDecoderState.NamedEntity:return this.stateNamedEntity(e,n)}}stateNumericStart(e,n){return n>=e.length?-1:(e.charCodeAt(n)|TO_LOWER_BIT)===CharCodes.LOWER_X?(this.state=EntityDecoderState.NumericHex,this.consumed+=1,this.stateNumericHex(e,n+1)):(this.state=EntityDecoderState.NumericDecimal,this.stateNumericDecimal(e,n))}addToNumericResult(e,n,r,s){if(n!==r){const o=r-n;this.result=this.result*Math.pow(s,o)+parseInt(e.substr(n,o),s),this.consumed+=o}}stateNumericHex(e,n){const r=n;for(;n<e.length;){const s=e.charCodeAt(n);if(isNumber(s)||isHexadecimalCharacter(s))n+=1;else return this.addToNumericResult(e,r,n,16),this.emitNumericEntity(s,3)}return this.addToNumericResult(e,r,n,16),-1}stateNumericDecimal(e,n){const r=n;for(;n<e.length;){const s=e.charCodeAt(n);if(isNumber(s))n+=1;else return this.addToNumericResult(e,r,n,10),this.emitNumericEntity(s,2)}return this.addToNumericResult(e,r,n,10),-1}emitNumericEntity(e,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===CharCodes.SEMI)this.consumed+=1;else if(this.decodeMode===DecodingMode.Strict)return 0;return this.emitCodePoint(replaceCodePoint(this.result),this.consumed),this.errors&&(e!==CharCodes.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,n){const{decodeTree:r}=this;let s=r[this.treeIndex],o=(s&BinTrieFlags.VALUE_LENGTH)>>14;for(;n<e.length;n++,this.excess++){const a=e.charCodeAt(n);if(this.treeIndex=determineBranch(r,s,this.treeIndex+Math.max(1,o),a),this.treeIndex<0)return this.result===0||this.decodeMode===DecodingMode.Attribute&&(o===0||isEntityInAttributeInvalidEnd(a))?0:this.emitNotTerminatedNamedEntity();if(s=r[this.treeIndex],o=(s&BinTrieFlags.VALUE_LENGTH)>>14,o!==0){if(a===CharCodes.SEMI)return this.emitNamedEntityData(this.treeIndex,o,this.consumed+this.excess);this.decodeMode!==DecodingMode.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:n,decodeTree:r}=this,s=(r[n]&BinTrieFlags.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,s,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,n,r){const{decodeTree:s}=this;return this.emitCodePoint(n===1?s[e]&~BinTrieFlags.VALUE_LENGTH:s[e+1],r),n===3&&this.emitCodePoint(s[e+2],r),r}end(){var e;switch(this.state){case EntityDecoderState.NamedEntity:return this.result!==0&&(this.decodeMode!==DecodingMode.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case EntityDecoderState.NumericDecimal:return this.emitNumericEntity(0,2);case EntityDecoderState.NumericHex:return this.emitNumericEntity(0,3);case EntityDecoderState.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case EntityDecoderState.EntityStart:return 0}}}function getDecoder(t){let e="";const n=new EntityDecoder(t,r=>e+=fromCodePoint$1(r));return function(s,o){let a=0,u=0;for(;(u=s.indexOf("&",u))>=0;){e+=s.slice(a,u),n.startEntity(o);const c=n.write(s,u+1);if(c<0){a=u+n.end();break}a=u+c,u=c===0?a+1:a}const l=e+s.slice(a);return e="",l}}function determineBranch(t,e,n,r){const s=(e&BinTrieFlags.BRANCH_LENGTH)>>7,o=e&BinTrieFlags.JUMP_TABLE;if(s===0)return o!==0&&r===o?n:-1;if(o){const l=r-o;return l<0||l>=s?-1:t[n+l]-1}let a=n,u=a+s-1;for(;a<=u;){const l=a+u>>>1,c=t[l];if(c<r)a=l+1;else if(c>r)u=l-1;else return t[l+s]}return-1}const htmlDecoder=getDecoder(htmlDecodeTree);getDecoder(xmlDecodeTree);function decodeHTML(t,e=DecodingMode.Legacy){return htmlDecoder(t,e)}function _class$1(t){return Object.prototype.toString.call(t)}function isString$1(t){return _class$1(t)==="[object String]"}const _hasOwnProperty=Object.prototype.hasOwnProperty;function has(t,e){return _hasOwnProperty.call(t,e)}function assign$1(t){return Array.prototype.slice.call(arguments,1).forEach(function(n){if(n){if(typeof n!="object")throw new TypeError(n+"must be object");Object.keys(n).forEach(function(r){t[r]=n[r]})}}),t}function arrayReplaceAt(t,e,n){return[].concat(t.slice(0,e),n,t.slice(e+1))}function isValidEntityCode(t){return!(t>=55296&&t<=57343||t>=64976&&t<=65007||(t&65535)===65535||(t&65535)===65534||t>=0&&t<=8||t===11||t>=14&&t<=31||t>=127&&t<=159||t>1114111)}function fromCodePoint(t){if(t>65535){t-=65536;const e=55296+(t>>10),n=56320+(t&1023);return String.fromCharCode(e,n)}return String.fromCharCode(t)}const UNESCAPE_MD_RE=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,ENTITY_RE=/&([a-z#][a-z0-9]{1,31});/gi,UNESCAPE_ALL_RE=new RegExp(UNESCAPE_MD_RE.source+"|"+ENTITY_RE.source,"gi"),DIGITAL_ENTITY_TEST_RE=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function replaceEntityPattern(t,e){if(e.charCodeAt(0)===35&&DIGITAL_ENTITY_TEST_RE.test(e)){const r=e[1].toLowerCase()==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);return isValidEntityCode(r)?fromCodePoint(r):t}const n=decodeHTML(t);return n!==t?n:t}function unescapeMd(t){return t.indexOf("\\")<0?t:t.replace(UNESCAPE_MD_RE,"$1")}function unescapeAll(t){return t.indexOf("\\")<0&&t.indexOf("&")<0?t:t.replace(UNESCAPE_ALL_RE,function(e,n,r){return n||replaceEntityPattern(e,r)})}const HTML_ESCAPE_TEST_RE=/[&<>"]/,HTML_ESCAPE_REPLACE_RE=/[&<>"]/g,HTML_REPLACEMENTS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(t){return HTML_REPLACEMENTS[t]}function escapeHtml(t){return HTML_ESCAPE_TEST_RE.test(t)?t.replace(HTML_ESCAPE_REPLACE_RE,replaceUnsafeChar):t}const REGEXP_ESCAPE_RE=/[.?*+^$[\]\\(){}|-]/g;function escapeRE$1(t){return t.replace(REGEXP_ESCAPE_RE,"\\$&")}function isSpace(t){switch(t){case 9:case 32:return!0}return!1}function isWhiteSpace(t){if(t>=8192&&t<=8202)return!0;switch(t){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function isPunctChar(t){return P.test(t)||regex.test(t)}function isMdAsciiPunct(t){switch(t){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function normalizeReference(t){return t=t.trim().replace(/\s+/g," "),"".toLowerCase()===""&&(t=t.replace(//g,"")),t.toLowerCase().toUpperCase()}const lib={mdurl,ucmicro},utils=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt,assign:assign$1,escapeHtml,escapeRE:escapeRE$1,fromCodePoint,has,isMdAsciiPunct,isPunctChar,isSpace,isString:isString$1,isValidEntityCode,isWhiteSpace,lib,normalizeReference,unescapeAll,unescapeMd},Symbol.toStringTag,{value:"Module"}));function parseLinkLabel(t,e,n){let r,s,o,a;const u=t.posMax,l=t.pos;for(t.pos=e+1,r=1;t.pos<u;){if(o=t.src.charCodeAt(t.pos),o===93&&(r--,r===0)){s=!0;break}if(a=t.pos,t.md.inline.skipToken(t),o===91){if(a===t.pos-1)r++;else if(n)return t.pos=l,-1}}let c=-1;return s&&(c=t.pos),t.pos=l,c}function parseLinkDestination(t,e,n){let r,s=e;const o={ok:!1,pos:0,str:""};if(t.charCodeAt(s)===60){for(s++;s<n;){if(r=t.charCodeAt(s),r===10||r===60)return o;if(r===62)return o.pos=s+1,o.str=unescapeAll(t.slice(e+1,s)),o.ok=!0,o;if(r===92&&s+1<n){s+=2;continue}s++}return o}let a=0;for(;s<n&&(r=t.charCodeAt(s),!(r===32||r<32||r===127));){if(r===92&&s+1<n){if(t.charCodeAt(s+1)===32)break;s+=2;continue}if(r===40&&(a++,a>32))return o;if(r===41){if(a===0)break;a--}s++}return e===s||a!==0||(o.str=unescapeAll(t.slice(e,s)),o.pos=s,o.ok=!0),o}function parseLinkTitle(t,e,n,r){let s,o=e;const a={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(r)a.str=r.str,a.marker=r.marker;else{if(o>=n)return a;let u=t.charCodeAt(o);if(u!==34&&u!==39&&u!==40)return a;e++,o++,u===40&&(u=41),a.marker=u}for(;o<n;){if(s=t.charCodeAt(o),s===a.marker)return a.pos=o+1,a.str+=unescapeAll(t.slice(e,o)),a.ok=!0,a;if(s===40&&a.marker===41)return a;s===92&&o+1<n&&o++,o++}return a.can_continue=!0,a.str+=unescapeAll(t.slice(e,o)),a}const helpers=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination,parseLinkLabel,parseLinkTitle},Symbol.toStringTag,{value:"Module"})),default_rules={};default_rules.code_inline=function(t,e,n,r,s){const o=t[e];return"<code"+s.renderAttrs(o)+">"+escapeHtml(o.content)+"</code>"};default_rules.code_block=function(t,e,n,r,s){const o=t[e];return"<pre"+s.renderAttrs(o)+"><code>"+escapeHtml(t[e].content)+`</code></pre>
`};default_rules.fence=function(t,e,n,r,s){const o=t[e],a=o.info?unescapeAll(o.info).trim():"";let u="",l="";if(a){const f=a.split(/(\s+)/g);u=f[0],l=f.slice(2).join("")}let c;if(n.highlight?c=n.highlight(o.content,u,l)||escapeHtml(o.content):c=escapeHtml(o.content),c.indexOf("<pre")===0)return c+`
`;if(a){const f=o.attrIndex("class"),h=o.attrs?o.attrs.slice():[];f<0?h.push(["class",n.langPrefix+u]):(h[f]=h[f].slice(),h[f][1]+=" "+n.langPrefix+u);const p={attrs:h};return`<pre><code${s.renderAttrs(p)}>${c}</code></pre>
`}return`<pre><code${s.renderAttrs(o)}>${c}</code></pre>
`};default_rules.image=function(t,e,n,r,s){const o=t[e];return o.attrs[o.attrIndex("alt")][1]=s.renderInlineAsText(o.children,n,r),s.renderToken(t,e,n)};default_rules.hardbreak=function(t,e,n){return n.xhtmlOut?`<br />
`:`<br>
`};default_rules.softbreak=function(t,e,n){return n.breaks?n.xhtmlOut?`<br />
`:`<br>
`:`
`};default_rules.text=function(t,e){return escapeHtml(t[e].content)};default_rules.html_block=function(t,e){return t[e].content};default_rules.html_inline=function(t,e){return t[e].content};function Renderer(){this.rules=assign$1({},default_rules)}Renderer.prototype.renderAttrs=function t(e){let n,r,s;if(!e.attrs)return"";for(s="",n=0,r=e.attrs.length;n<r;n++)s+=" "+escapeHtml(e.attrs[n][0])+'="'+escapeHtml(e.attrs[n][1])+'"';return s};Renderer.prototype.renderToken=function t(e,n,r){const s=e[n];let o="";if(s.hidden)return"";s.block&&s.nesting!==-1&&n&&e[n-1].hidden&&(o+=`
`),o+=(s.nesting===-1?"</":"<")+s.tag,o+=this.renderAttrs(s),s.nesting===0&&r.xhtmlOut&&(o+=" /");let a=!1;if(s.block&&(a=!0,s.nesting===1&&n+1<e.length)){const u=e[n+1];(u.type==="inline"||u.hidden||u.nesting===-1&&u.tag===s.tag)&&(a=!1)}return o+=a?`>
`:">",o};Renderer.prototype.renderInline=function(t,e,n){let r="";const s=this.rules;for(let o=0,a=t.length;o<a;o++){const u=t[o].type;typeof s[u]<"u"?r+=s[u](t,o,e,n,this):r+=this.renderToken(t,o,e)}return r};Renderer.prototype.renderInlineAsText=function(t,e,n){let r="";for(let s=0,o=t.length;s<o;s++)switch(t[s].type){case"text":r+=t[s].content;break;case"image":r+=this.renderInlineAsText(t[s].children,e,n);break;case"html_inline":case"html_block":r+=t[s].content;break;case"softbreak":case"hardbreak":r+=`
`;break}return r};Renderer.prototype.render=function(t,e,n){let r="";const s=this.rules;for(let o=0,a=t.length;o<a;o++){const u=t[o].type;u==="inline"?r+=this.renderInline(t[o].children,e,n):typeof s[u]<"u"?r+=s[u](t,o,e,n,this):r+=this.renderToken(t,o,e,n)}return r};function Ruler(){this.__rules__=[],this.__cache__=null}Ruler.prototype.__find__=function(t){for(let e=0;e<this.__rules__.length;e++)if(this.__rules__[e].name===t)return e;return-1};Ruler.prototype.__compile__=function(){const t=this,e=[""];t.__rules__.forEach(function(n){n.enabled&&n.alt.forEach(function(r){e.indexOf(r)<0&&e.push(r)})}),t.__cache__={},e.forEach(function(n){t.__cache__[n]=[],t.__rules__.forEach(function(r){r.enabled&&(n&&r.alt.indexOf(n)<0||t.__cache__[n].push(r.fn))})})};Ruler.prototype.at=function(t,e,n){const r=this.__find__(t),s=n||{};if(r===-1)throw new Error("Parser rule not found: "+t);this.__rules__[r].fn=e,this.__rules__[r].alt=s.alt||[],this.__cache__=null};Ruler.prototype.before=function(t,e,n,r){const s=this.__find__(t),o=r||{};if(s===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(s,0,{name:e,enabled:!0,fn:n,alt:o.alt||[]}),this.__cache__=null};Ruler.prototype.after=function(t,e,n,r){const s=this.__find__(t),o=r||{};if(s===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(s+1,0,{name:e,enabled:!0,fn:n,alt:o.alt||[]}),this.__cache__=null};Ruler.prototype.push=function(t,e,n){const r=n||{};this.__rules__.push({name:t,enabled:!0,fn:e,alt:r.alt||[]}),this.__cache__=null};Ruler.prototype.enable=function(t,e){Array.isArray(t)||(t=[t]);const n=[];return t.forEach(function(r){const s=this.__find__(r);if(s<0){if(e)return;throw new Error("Rules manager: invalid rule name "+r)}this.__rules__[s].enabled=!0,n.push(r)},this),this.__cache__=null,n};Ruler.prototype.enableOnly=function(t,e){Array.isArray(t)||(t=[t]),this.__rules__.forEach(function(n){n.enabled=!1}),this.enable(t,e)};Ruler.prototype.disable=function(t,e){Array.isArray(t)||(t=[t]);const n=[];return t.forEach(function(r){const s=this.__find__(r);if(s<0){if(e)return;throw new Error("Rules manager: invalid rule name "+r)}this.__rules__[s].enabled=!1,n.push(r)},this),this.__cache__=null,n};Ruler.prototype.getRules=function(t){return this.__cache__===null&&this.__compile__(),this.__cache__[t]||[]};function Token(t,e,n){this.type=t,this.tag=e,this.attrs=null,this.map=null,this.nesting=n,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}Token.prototype.attrIndex=function t(e){if(!this.attrs)return-1;const n=this.attrs;for(let r=0,s=n.length;r<s;r++)if(n[r][0]===e)return r;return-1};Token.prototype.attrPush=function t(e){this.attrs?this.attrs.push(e):this.attrs=[e]};Token.prototype.attrSet=function t(e,n){const r=this.attrIndex(e),s=[e,n];r<0?this.attrPush(s):this.attrs[r]=s};Token.prototype.attrGet=function t(e){const n=this.attrIndex(e);let r=null;return n>=0&&(r=this.attrs[n][1]),r};Token.prototype.attrJoin=function t(e,n){const r=this.attrIndex(e);r<0?this.attrPush([e,n]):this.attrs[r][1]=this.attrs[r][1]+" "+n};function StateCore(t,e,n){this.src=t,this.env=n,this.tokens=[],this.inlineMode=!1,this.md=e}StateCore.prototype.Token=Token;const NEWLINES_RE=/\r\n?|\n/g,NULL_RE=/\0/g;function normalize(t){let e;e=t.src.replace(NEWLINES_RE,`
`),e=e.replace(NULL_RE,""),t.src=e}function block(t){let e;t.inlineMode?(e=new t.Token("inline","",0),e.content=t.src,e.map=[0,1],e.children=[],t.tokens.push(e)):t.md.block.parse(t.src,t.md,t.env,t.tokens)}function inline(t){const e=t.tokens;for(let n=0,r=e.length;n<r;n++){const s=e[n];s.type==="inline"&&t.md.inline.parse(s.content,t.md,t.env,s.children)}}function isLinkOpen$1(t){return/^<a[>\s]/i.test(t)}function isLinkClose$1(t){return/^<\/a\s*>/i.test(t)}function linkify$1(t){const e=t.tokens;if(t.md.options.linkify)for(let n=0,r=e.length;n<r;n++){if(e[n].type!=="inline"||!t.md.linkify.pretest(e[n].content))continue;let s=e[n].children,o=0;for(let a=s.length-1;a>=0;a--){const u=s[a];if(u.type==="link_close"){for(a--;s[a].level!==u.level&&s[a].type!=="link_open";)a--;continue}if(u.type==="html_inline"&&(isLinkOpen$1(u.content)&&o>0&&o--,isLinkClose$1(u.content)&&o++),!(o>0)&&u.type==="text"&&t.md.linkify.test(u.content)){const l=u.content;let c=t.md.linkify.match(l);const f=[];let h=u.level,p=0;c.length>0&&c[0].index===0&&a>0&&s[a-1].type==="text_special"&&(c=c.slice(1));for(let m=0;m<c.length;m++){const g=c[m].url,b=t.md.normalizeLink(g);if(!t.md.validateLink(b))continue;let y=c[m].text;c[m].schema?c[m].schema==="mailto:"&&!/^mailto:/i.test(y)?y=t.md.normalizeLinkText("mailto:"+y).replace(/^mailto:/,""):y=t.md.normalizeLinkText(y):y=t.md.normalizeLinkText("http://"+y).replace(/^http:\/\//,"");const _=c[m].index;if(_>p){const v=new t.Token("text","",0);v.content=l.slice(p,_),v.level=h,f.push(v)}const x=new t.Token("link_open","a",1);x.attrs=[["href",b]],x.level=h++,x.markup="linkify",x.info="auto",f.push(x);const E=new t.Token("text","",0);E.content=y,E.level=h,f.push(E);const A=new t.Token("link_close","a",-1);A.level=--h,A.markup="linkify",A.info="auto",f.push(A),p=c[m].lastIndex}if(p<l.length){const m=new t.Token("text","",0);m.content=l.slice(p),m.level=h,f.push(m)}e[n].children=s=arrayReplaceAt(s,a,f)}}}}const RARE_RE=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,SCOPED_ABBR_TEST_RE=/\((c|tm|r)\)/i,SCOPED_ABBR_RE=/\((c|tm|r)\)/ig,SCOPED_ABBR={c:"",r:"",tm:""};function replaceFn(t,e){return SCOPED_ABBR[e.toLowerCase()]}function replace_scoped(t){let e=0;for(let n=t.length-1;n>=0;n--){const r=t[n];r.type==="text"&&!e&&(r.content=r.content.replace(SCOPED_ABBR_RE,replaceFn)),r.type==="link_open"&&r.info==="auto"&&e--,r.type==="link_close"&&r.info==="auto"&&e++}}function replace_rare(t){let e=0;for(let n=t.length-1;n>=0;n--){const r=t[n];r.type==="text"&&!e&&RARE_RE.test(r.content)&&(r.content=r.content.replace(/\+-/g,"").replace(/\.{2,}/g,"").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1").replace(/(^|\s)--(?=\s|$)/mg,"$1").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1")),r.type==="link_open"&&r.info==="auto"&&e--,r.type==="link_close"&&r.info==="auto"&&e++}}function replace(t){let e;if(t.md.options.typographer)for(e=t.tokens.length-1;e>=0;e--)t.tokens[e].type==="inline"&&(SCOPED_ABBR_TEST_RE.test(t.tokens[e].content)&&replace_scoped(t.tokens[e].children),RARE_RE.test(t.tokens[e].content)&&replace_rare(t.tokens[e].children))}const QUOTE_TEST_RE=/['"]/,QUOTE_RE=/['"]/g,APOSTROPHE="";function replaceAt(t,e,n){return t.slice(0,e)+n+t.slice(e+1)}function process_inlines(t,e){let n;const r=[];for(let s=0;s<t.length;s++){const o=t[s],a=t[s].level;for(n=r.length-1;n>=0&&!(r[n].level<=a);n--);if(r.length=n+1,o.type!=="text")continue;let u=o.content,l=0,c=u.length;e:for(;l<c;){QUOTE_RE.lastIndex=l;const f=QUOTE_RE.exec(u);if(!f)break;let h=!0,p=!0;l=f.index+1;const m=f[0]==="'";let g=32;if(f.index-1>=0)g=u.charCodeAt(f.index-1);else for(n=s-1;n>=0&&!(t[n].type==="softbreak"||t[n].type==="hardbreak");n--)if(t[n].content){g=t[n].content.charCodeAt(t[n].content.length-1);break}let b=32;if(l<c)b=u.charCodeAt(l);else for(n=s+1;n<t.length&&!(t[n].type==="softbreak"||t[n].type==="hardbreak");n++)if(t[n].content){b=t[n].content.charCodeAt(0);break}const y=isMdAsciiPunct(g)||isPunctChar(String.fromCharCode(g)),_=isMdAsciiPunct(b)||isPunctChar(String.fromCharCode(b)),x=isWhiteSpace(g),E=isWhiteSpace(b);if(E?h=!1:_&&(x||y||(h=!1)),x?p=!1:y&&(E||_||(p=!1)),b===34&&f[0]==='"'&&g>=48&&g<=57&&(p=h=!1),h&&p&&(h=y,p=_),!h&&!p){m&&(o.content=replaceAt(o.content,f.index,APOSTROPHE));continue}if(p)for(n=r.length-1;n>=0;n--){let A=r[n];if(r[n].level<a)break;if(A.single===m&&r[n].level===a){A=r[n];let v,w;m?(v=e.md.options.quotes[2],w=e.md.options.quotes[3]):(v=e.md.options.quotes[0],w=e.md.options.quotes[1]),o.content=replaceAt(o.content,f.index,w),t[A.token].content=replaceAt(t[A.token].content,A.pos,v),l+=w.length-1,A.token===s&&(l+=v.length-1),u=o.content,c=u.length,r.length=n;continue e}}h?r.push({token:s,pos:f.index,single:m,level:a}):p&&m&&(o.content=replaceAt(o.content,f.index,APOSTROPHE))}}}function smartquotes(t){if(t.md.options.typographer)for(let e=t.tokens.length-1;e>=0;e--)t.tokens[e].type!=="inline"||!QUOTE_TEST_RE.test(t.tokens[e].content)||process_inlines(t.tokens[e].children,t)}function text_join(t){let e,n;const r=t.tokens,s=r.length;for(let o=0;o<s;o++){if(r[o].type!=="inline")continue;const a=r[o].children,u=a.length;for(e=0;e<u;e++)a[e].type==="text_special"&&(a[e].type="text");for(e=n=0;e<u;e++)a[e].type==="text"&&e+1<u&&a[e+1].type==="text"?a[e+1].content=a[e].content+a[e+1].content:(e!==n&&(a[n]=a[e]),n++);e!==n&&(a.length=n)}}const _rules$2=[["normalize",normalize],["block",block],["inline",inline],["linkify",linkify$1],["replacements",replace],["smartquotes",smartquotes],["text_join",text_join]];function Core(){this.ruler=new Ruler;for(let t=0;t<_rules$2.length;t++)this.ruler.push(_rules$2[t][0],_rules$2[t][1])}Core.prototype.process=function(t){const e=this.ruler.getRules("");for(let n=0,r=e.length;n<r;n++)e[n](t)};Core.prototype.State=StateCore;function StateBlock(t,e,n,r){this.src=t,this.md=e,this.env=n,this.tokens=r,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const s=this.src;for(let o=0,a=0,u=0,l=0,c=s.length,f=!1;a<c;a++){const h=s.charCodeAt(a);if(!f)if(isSpace(h)){u++,h===9?l+=4-l%4:l++;continue}else f=!0;(h===10||a===c-1)&&(h!==10&&a++,this.bMarks.push(o),this.eMarks.push(a),this.tShift.push(u),this.sCount.push(l),this.bsCount.push(0),f=!1,u=0,l=0,o=a+1)}this.bMarks.push(s.length),this.eMarks.push(s.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}StateBlock.prototype.push=function(t,e,n){const r=new Token(t,e,n);return r.block=!0,n<0&&this.level--,r.level=this.level,n>0&&this.level++,this.tokens.push(r),r};StateBlock.prototype.isEmpty=function t(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};StateBlock.prototype.skipEmptyLines=function t(e){for(let n=this.lineMax;e<n&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e};StateBlock.prototype.skipSpaces=function t(e){for(let n=this.src.length;e<n;e++){const r=this.src.charCodeAt(e);if(!isSpace(r))break}return e};StateBlock.prototype.skipSpacesBack=function t(e,n){if(e<=n)return e;for(;e>n;)if(!isSpace(this.src.charCodeAt(--e)))return e+1;return e};StateBlock.prototype.skipChars=function t(e,n){for(let r=this.src.length;e<r&&this.src.charCodeAt(e)===n;e++);return e};StateBlock.prototype.skipCharsBack=function t(e,n,r){if(e<=r)return e;for(;e>r;)if(n!==this.src.charCodeAt(--e))return e+1;return e};StateBlock.prototype.getLines=function t(e,n,r,s){if(e>=n)return"";const o=new Array(n-e);for(let a=0,u=e;u<n;u++,a++){let l=0;const c=this.bMarks[u];let f=c,h;for(u+1<n||s?h=this.eMarks[u]+1:h=this.eMarks[u];f<h&&l<r;){const p=this.src.charCodeAt(f);if(isSpace(p))p===9?l+=4-(l+this.bsCount[u])%4:l++;else if(f-c<this.tShift[u])l++;else break;f++}l>r?o[a]=new Array(l-r+1).join(" ")+this.src.slice(f,h):o[a]=this.src.slice(f,h)}return o.join("")};StateBlock.prototype.Token=Token;const MAX_AUTOCOMPLETED_CELLS=65536;function getLine(t,e){const n=t.bMarks[e]+t.tShift[e],r=t.eMarks[e];return t.src.slice(n,r)}function escapedSplit(t){const e=[],n=t.length;let r=0,s=t.charCodeAt(r),o=!1,a=0,u="";for(;r<n;)s===124&&(o?(u+=t.substring(a,r-1),a=r):(e.push(u+t.substring(a,r)),u="",a=r+1)),o=s===92,r++,s=t.charCodeAt(r);return e.push(u+t.substring(a)),e}function table(t,e,n,r){if(e+2>n)return!1;let s=e+1;if(t.sCount[s]<t.blkIndent||t.sCount[s]-t.blkIndent>=4)return!1;let o=t.bMarks[s]+t.tShift[s];if(o>=t.eMarks[s])return!1;const a=t.src.charCodeAt(o++);if(a!==124&&a!==45&&a!==58||o>=t.eMarks[s])return!1;const u=t.src.charCodeAt(o++);if(u!==124&&u!==45&&u!==58&&!isSpace(u)||a===45&&isSpace(u))return!1;for(;o<t.eMarks[s];){const A=t.src.charCodeAt(o);if(A!==124&&A!==45&&A!==58&&!isSpace(A))return!1;o++}let l=getLine(t,e+1),c=l.split("|");const f=[];for(let A=0;A<c.length;A++){const v=c[A].trim();if(!v){if(A===0||A===c.length-1)continue;return!1}if(!/^:?-+:?$/.test(v))return!1;v.charCodeAt(v.length-1)===58?f.push(v.charCodeAt(0)===58?"center":"right"):v.charCodeAt(0)===58?f.push("left"):f.push("")}if(l=getLine(t,e).trim(),l.indexOf("|")===-1||t.sCount[e]-t.blkIndent>=4)return!1;c=escapedSplit(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop();const h=c.length;if(h===0||h!==f.length)return!1;if(r)return!0;const p=t.parentType;t.parentType="table";const m=t.md.block.ruler.getRules("blockquote"),g=t.push("table_open","table",1),b=[e,0];g.map=b;const y=t.push("thead_open","thead",1);y.map=[e,e+1];const _=t.push("tr_open","tr",1);_.map=[e,e+1];for(let A=0;A<c.length;A++){const v=t.push("th_open","th",1);f[A]&&(v.attrs=[["style","text-align:"+f[A]]]);const w=t.push("inline","",0);w.content=c[A].trim(),w.children=[],t.push("th_close","th",-1)}t.push("tr_close","tr",-1),t.push("thead_close","thead",-1);let x,E=0;for(s=e+2;s<n&&!(t.sCount[s]<t.blkIndent);s++){let A=!1;for(let w=0,k=m.length;w<k;w++)if(m[w](t,s,n,!0)){A=!0;break}if(A||(l=getLine(t,s).trim(),!l)||t.sCount[s]-t.blkIndent>=4||(c=escapedSplit(l),c.length&&c[0]===""&&c.shift(),c.length&&c[c.length-1]===""&&c.pop(),E+=h-c.length,E>MAX_AUTOCOMPLETED_CELLS))break;if(s===e+2){const w=t.push("tbody_open","tbody",1);w.map=x=[e+2,0]}const v=t.push("tr_open","tr",1);v.map=[s,s+1];for(let w=0;w<h;w++){const k=t.push("td_open","td",1);f[w]&&(k.attrs=[["style","text-align:"+f[w]]]);const S=t.push("inline","",0);S.content=c[w]?c[w].trim():"",S.children=[],t.push("td_close","td",-1)}t.push("tr_close","tr",-1)}return x&&(t.push("tbody_close","tbody",-1),x[1]=s),t.push("table_close","table",-1),b[1]=s,t.parentType=p,t.line=s,!0}function code(t,e,n){if(t.sCount[e]-t.blkIndent<4)return!1;let r=e+1,s=r;for(;r<n;){if(t.isEmpty(r)){r++;continue}if(t.sCount[r]-t.blkIndent>=4){r++,s=r;continue}break}t.line=s;const o=t.push("code_block","code",0);return o.content=t.getLines(e,s,4+t.blkIndent,!1)+`
`,o.map=[e,t.line],!0}function fence(t,e,n,r){let s=t.bMarks[e]+t.tShift[e],o=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||s+3>o)return!1;const a=t.src.charCodeAt(s);if(a!==126&&a!==96)return!1;let u=s;s=t.skipChars(s,a);let l=s-u;if(l<3)return!1;const c=t.src.slice(u,s),f=t.src.slice(s,o);if(a===96&&f.indexOf(String.fromCharCode(a))>=0)return!1;if(r)return!0;let h=e,p=!1;for(;h++,!(h>=n||(s=u=t.bMarks[h]+t.tShift[h],o=t.eMarks[h],s<o&&t.sCount[h]<t.blkIndent));)if(t.src.charCodeAt(s)===a&&!(t.sCount[h]-t.blkIndent>=4)&&(s=t.skipChars(s,a),!(s-u<l)&&(s=t.skipSpaces(s),!(s<o)))){p=!0;break}l=t.sCount[e],t.line=h+(p?1:0);const m=t.push("fence","code",0);return m.info=f,m.content=t.getLines(e+1,h,l,!0),m.markup=c,m.map=[e,t.line],!0}function blockquote(t,e,n,r){let s=t.bMarks[e]+t.tShift[e],o=t.eMarks[e];const a=t.lineMax;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(s)!==62)return!1;if(r)return!0;const u=[],l=[],c=[],f=[],h=t.md.block.ruler.getRules("blockquote"),p=t.parentType;t.parentType="blockquote";let m=!1,g;for(g=e;g<n;g++){const E=t.sCount[g]<t.blkIndent;if(s=t.bMarks[g]+t.tShift[g],o=t.eMarks[g],s>=o)break;if(t.src.charCodeAt(s++)===62&&!E){let v=t.sCount[g]+1,w,k;t.src.charCodeAt(s)===32?(s++,v++,k=!1,w=!0):t.src.charCodeAt(s)===9?(w=!0,(t.bsCount[g]+v)%4===3?(s++,v++,k=!1):k=!0):w=!1;let S=v;for(u.push(t.bMarks[g]),t.bMarks[g]=s;s<o;){const T=t.src.charCodeAt(s);if(isSpace(T))T===9?S+=4-(S+t.bsCount[g]+(k?1:0))%4:S++;else break;s++}m=s>=o,l.push(t.bsCount[g]),t.bsCount[g]=t.sCount[g]+1+(w?1:0),c.push(t.sCount[g]),t.sCount[g]=S-v,f.push(t.tShift[g]),t.tShift[g]=s-t.bMarks[g];continue}if(m)break;let A=!1;for(let v=0,w=h.length;v<w;v++)if(h[v](t,g,n,!0)){A=!0;break}if(A){t.lineMax=g,t.blkIndent!==0&&(u.push(t.bMarks[g]),l.push(t.bsCount[g]),f.push(t.tShift[g]),c.push(t.sCount[g]),t.sCount[g]-=t.blkIndent);break}u.push(t.bMarks[g]),l.push(t.bsCount[g]),f.push(t.tShift[g]),c.push(t.sCount[g]),t.sCount[g]=-1}const b=t.blkIndent;t.blkIndent=0;const y=t.push("blockquote_open","blockquote",1);y.markup=">";const _=[e,0];y.map=_,t.md.block.tokenize(t,e,g);const x=t.push("blockquote_close","blockquote",-1);x.markup=">",t.lineMax=a,t.parentType=p,_[1]=t.line;for(let E=0;E<f.length;E++)t.bMarks[E+e]=u[E],t.tShift[E+e]=f[E],t.sCount[E+e]=c[E],t.bsCount[E+e]=l[E];return t.blkIndent=b,!0}function hr(t,e,n,r){const s=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let o=t.bMarks[e]+t.tShift[e];const a=t.src.charCodeAt(o++);if(a!==42&&a!==45&&a!==95)return!1;let u=1;for(;o<s;){const c=t.src.charCodeAt(o++);if(c!==a&&!isSpace(c))return!1;c===a&&u++}if(u<3)return!1;if(r)return!0;t.line=e+1;const l=t.push("hr","hr",0);return l.map=[e,t.line],l.markup=Array(u+1).join(String.fromCharCode(a)),!0}function skipBulletListMarker(t,e){const n=t.eMarks[e];let r=t.bMarks[e]+t.tShift[e];const s=t.src.charCodeAt(r++);if(s!==42&&s!==45&&s!==43)return-1;if(r<n){const o=t.src.charCodeAt(r);if(!isSpace(o))return-1}return r}function skipOrderedListMarker(t,e){const n=t.bMarks[e]+t.tShift[e],r=t.eMarks[e];let s=n;if(s+1>=r)return-1;let o=t.src.charCodeAt(s++);if(o<48||o>57)return-1;for(;;){if(s>=r)return-1;if(o=t.src.charCodeAt(s++),o>=48&&o<=57){if(s-n>=10)return-1;continue}if(o===41||o===46)break;return-1}return s<r&&(o=t.src.charCodeAt(s),!isSpace(o))?-1:s}function markTightParagraphs(t,e){const n=t.level+2;for(let r=e+2,s=t.tokens.length-2;r<s;r++)t.tokens[r].level===n&&t.tokens[r].type==="paragraph_open"&&(t.tokens[r+2].hidden=!0,t.tokens[r].hidden=!0,r+=2)}function list(t,e,n,r){let s,o,a,u,l=e,c=!0;if(t.sCount[l]-t.blkIndent>=4||t.listIndent>=0&&t.sCount[l]-t.listIndent>=4&&t.sCount[l]<t.blkIndent)return!1;let f=!1;r&&t.parentType==="paragraph"&&t.sCount[l]>=t.blkIndent&&(f=!0);let h,p,m;if((m=skipOrderedListMarker(t,l))>=0){if(h=!0,a=t.bMarks[l]+t.tShift[l],p=Number(t.src.slice(a,m-1)),f&&p!==1)return!1}else if((m=skipBulletListMarker(t,l))>=0)h=!1;else return!1;if(f&&t.skipSpaces(m)>=t.eMarks[l])return!1;if(r)return!0;const g=t.src.charCodeAt(m-1),b=t.tokens.length;h?(u=t.push("ordered_list_open","ol",1),p!==1&&(u.attrs=[["start",p]])):u=t.push("bullet_list_open","ul",1);const y=[l,0];u.map=y,u.markup=String.fromCharCode(g);let _=!1;const x=t.md.block.ruler.getRules("list"),E=t.parentType;for(t.parentType="list";l<n;){o=m,s=t.eMarks[l];const A=t.sCount[l]+m-(t.bMarks[l]+t.tShift[l]);let v=A;for(;o<s;){const D=t.src.charCodeAt(o);if(D===9)v+=4-(v+t.bsCount[l])%4;else if(D===32)v++;else break;o++}const w=o;let k;w>=s?k=1:k=v-A,k>4&&(k=1);const S=A+k;u=t.push("list_item_open","li",1),u.markup=String.fromCharCode(g);const T=[l,0];u.map=T,h&&(u.info=t.src.slice(a,m-1));const O=t.tight,C=t.tShift[l],R=t.sCount[l],M=t.listIndent;if(t.listIndent=t.blkIndent,t.blkIndent=S,t.tight=!0,t.tShift[l]=w-t.bMarks[l],t.sCount[l]=v,w>=s&&t.isEmpty(l+1)?t.line=Math.min(t.line+2,n):t.md.block.tokenize(t,l,n,!0),(!t.tight||_)&&(c=!1),_=t.line-l>1&&t.isEmpty(t.line-1),t.blkIndent=t.listIndent,t.listIndent=M,t.tShift[l]=C,t.sCount[l]=R,t.tight=O,u=t.push("list_item_close","li",-1),u.markup=String.fromCharCode(g),l=t.line,T[1]=l,l>=n||t.sCount[l]<t.blkIndent||t.sCount[l]-t.blkIndent>=4)break;let I=!1;for(let D=0,N=x.length;D<N;D++)if(x[D](t,l,n,!0)){I=!0;break}if(I)break;if(h){if(m=skipOrderedListMarker(t,l),m<0)break;a=t.bMarks[l]+t.tShift[l]}else if(m=skipBulletListMarker(t,l),m<0)break;if(g!==t.src.charCodeAt(m-1))break}return h?u=t.push("ordered_list_close","ol",-1):u=t.push("bullet_list_close","ul",-1),u.markup=String.fromCharCode(g),y[1]=l,t.line=l,t.parentType=E,c&&markTightParagraphs(t,b),!0}function reference(t,e,n,r){let s=t.bMarks[e]+t.tShift[e],o=t.eMarks[e],a=e+1;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(s)!==91)return!1;function u(x){const E=t.lineMax;if(x>=E||t.isEmpty(x))return null;let A=!1;if(t.sCount[x]-t.blkIndent>3&&(A=!0),t.sCount[x]<0&&(A=!0),!A){const k=t.md.block.ruler.getRules("reference"),S=t.parentType;t.parentType="reference";let T=!1;for(let O=0,C=k.length;O<C;O++)if(k[O](t,x,E,!0)){T=!0;break}if(t.parentType=S,T)return null}const v=t.bMarks[x]+t.tShift[x],w=t.eMarks[x];return t.src.slice(v,w+1)}let l=t.src.slice(s,o+1);o=l.length;let c=-1;for(s=1;s<o;s++){const x=l.charCodeAt(s);if(x===91)return!1;if(x===93){c=s;break}else if(x===10){const E=u(a);E!==null&&(l+=E,o=l.length,a++)}else if(x===92&&(s++,s<o&&l.charCodeAt(s)===10)){const E=u(a);E!==null&&(l+=E,o=l.length,a++)}}if(c<0||l.charCodeAt(c+1)!==58)return!1;for(s=c+2;s<o;s++){const x=l.charCodeAt(s);if(x===10){const E=u(a);E!==null&&(l+=E,o=l.length,a++)}else if(!isSpace(x))break}const f=t.md.helpers.parseLinkDestination(l,s,o);if(!f.ok)return!1;const h=t.md.normalizeLink(f.str);if(!t.md.validateLink(h))return!1;s=f.pos;const p=s,m=a,g=s;for(;s<o;s++){const x=l.charCodeAt(s);if(x===10){const E=u(a);E!==null&&(l+=E,o=l.length,a++)}else if(!isSpace(x))break}let b=t.md.helpers.parseLinkTitle(l,s,o);for(;b.can_continue;){const x=u(a);if(x===null)break;l+=x,s=o,o=l.length,a++,b=t.md.helpers.parseLinkTitle(l,s,o,b)}let y;for(s<o&&g!==s&&b.ok?(y=b.str,s=b.pos):(y="",s=p,a=m);s<o;){const x=l.charCodeAt(s);if(!isSpace(x))break;s++}if(s<o&&l.charCodeAt(s)!==10&&y)for(y="",s=p,a=m;s<o;){const x=l.charCodeAt(s);if(!isSpace(x))break;s++}if(s<o&&l.charCodeAt(s)!==10)return!1;const _=normalizeReference(l.slice(1,c));return _?(r||(typeof t.env.references>"u"&&(t.env.references={}),typeof t.env.references[_]>"u"&&(t.env.references[_]={title:y,href:h}),t.line=a),!0):!1}const block_names=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],attr_name="[a-zA-Z_:][a-zA-Z0-9:._-]*",unquoted="[^\"'=<>`\\x00-\\x20]+",single_quoted="'[^']*'",double_quoted='"[^"]*"',attr_value="(?:"+unquoted+"|"+single_quoted+"|"+double_quoted+")",attribute="(?:\\s+"+attr_name+"(?:\\s*=\\s*"+attr_value+")?)",open_tag="<[A-Za-z][A-Za-z0-9\\-]*"+attribute+"*\\s*\\/?>",close_tag="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",comment="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",processing="<[?][\\s\\S]*?[?]>",declaration="<![A-Za-z][^>]*>",cdata="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",HTML_TAG_RE=new RegExp("^(?:"+open_tag+"|"+close_tag+"|"+comment+"|"+processing+"|"+declaration+"|"+cdata+")"),HTML_OPEN_CLOSE_TAG_RE=new RegExp("^(?:"+open_tag+"|"+close_tag+")"),HTML_SEQUENCES=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+block_names.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(HTML_OPEN_CLOSE_TAG_RE.source+"\\s*$"),/^$/,!1]];function html_block(t,e,n,r){let s=t.bMarks[e]+t.tShift[e],o=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||!t.md.options.html||t.src.charCodeAt(s)!==60)return!1;let a=t.src.slice(s,o),u=0;for(;u<HTML_SEQUENCES.length&&!HTML_SEQUENCES[u][0].test(a);u++);if(u===HTML_SEQUENCES.length)return!1;if(r)return HTML_SEQUENCES[u][2];let l=e+1;if(!HTML_SEQUENCES[u][1].test(a)){for(;l<n&&!(t.sCount[l]<t.blkIndent);l++)if(s=t.bMarks[l]+t.tShift[l],o=t.eMarks[l],a=t.src.slice(s,o),HTML_SEQUENCES[u][1].test(a)){a.length!==0&&l++;break}}t.line=l;const c=t.push("html_block","",0);return c.map=[e,l],c.content=t.getLines(e,l,t.blkIndent,!0),!0}function heading(t,e,n,r){let s=t.bMarks[e]+t.tShift[e],o=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let a=t.src.charCodeAt(s);if(a!==35||s>=o)return!1;let u=1;for(a=t.src.charCodeAt(++s);a===35&&s<o&&u<=6;)u++,a=t.src.charCodeAt(++s);if(u>6||s<o&&!isSpace(a))return!1;if(r)return!0;o=t.skipSpacesBack(o,s);const l=t.skipCharsBack(o,35,s);l>s&&isSpace(t.src.charCodeAt(l-1))&&(o=l),t.line=e+1;const c=t.push("heading_open","h"+String(u),1);c.markup="########".slice(0,u),c.map=[e,t.line];const f=t.push("inline","",0);f.content=t.src.slice(s,o).trim(),f.map=[e,t.line],f.children=[];const h=t.push("heading_close","h"+String(u),-1);return h.markup="########".slice(0,u),!0}function lheading(t,e,n){const r=t.md.block.ruler.getRules("paragraph");if(t.sCount[e]-t.blkIndent>=4)return!1;const s=t.parentType;t.parentType="paragraph";let o=0,a,u=e+1;for(;u<n&&!t.isEmpty(u);u++){if(t.sCount[u]-t.blkIndent>3)continue;if(t.sCount[u]>=t.blkIndent){let m=t.bMarks[u]+t.tShift[u];const g=t.eMarks[u];if(m<g&&(a=t.src.charCodeAt(m),(a===45||a===61)&&(m=t.skipChars(m,a),m=t.skipSpaces(m),m>=g))){o=a===61?1:2;break}}if(t.sCount[u]<0)continue;let p=!1;for(let m=0,g=r.length;m<g;m++)if(r[m](t,u,n,!0)){p=!0;break}if(p)break}if(!o)return!1;const l=t.getLines(e,u,t.blkIndent,!1).trim();t.line=u+1;const c=t.push("heading_open","h"+String(o),1);c.markup=String.fromCharCode(a),c.map=[e,t.line];const f=t.push("inline","",0);f.content=l,f.map=[e,t.line-1],f.children=[];const h=t.push("heading_close","h"+String(o),-1);return h.markup=String.fromCharCode(a),t.parentType=s,!0}function paragraph(t,e,n){const r=t.md.block.ruler.getRules("paragraph"),s=t.parentType;let o=e+1;for(t.parentType="paragraph";o<n&&!t.isEmpty(o);o++){if(t.sCount[o]-t.blkIndent>3||t.sCount[o]<0)continue;let c=!1;for(let f=0,h=r.length;f<h;f++)if(r[f](t,o,n,!0)){c=!0;break}if(c)break}const a=t.getLines(e,o,t.blkIndent,!1).trim();t.line=o;const u=t.push("paragraph_open","p",1);u.map=[e,t.line];const l=t.push("inline","",0);return l.content=a,l.map=[e,t.line],l.children=[],t.push("paragraph_close","p",-1),t.parentType=s,!0}const _rules$1=[["table",table,["paragraph","reference"]],["code",code],["fence",fence,["paragraph","reference","blockquote","list"]],["blockquote",blockquote,["paragraph","reference","blockquote","list"]],["hr",hr,["paragraph","reference","blockquote","list"]],["list",list,["paragraph","reference","blockquote"]],["reference",reference],["html_block",html_block,["paragraph","reference","blockquote"]],["heading",heading,["paragraph","reference","blockquote"]],["lheading",lheading],["paragraph",paragraph]];function ParserBlock(){this.ruler=new Ruler;for(let t=0;t<_rules$1.length;t++)this.ruler.push(_rules$1[t][0],_rules$1[t][1],{alt:(_rules$1[t][2]||[]).slice()})}ParserBlock.prototype.tokenize=function(t,e,n){const r=this.ruler.getRules(""),s=r.length,o=t.md.options.maxNesting;let a=e,u=!1;for(;a<n&&(t.line=a=t.skipEmptyLines(a),!(a>=n||t.sCount[a]<t.blkIndent));){if(t.level>=o){t.line=n;break}const l=t.line;let c=!1;for(let f=0;f<s;f++)if(c=r[f](t,a,n,!1),c){if(l>=t.line)throw new Error("block rule didn't increment state.line");break}if(!c)throw new Error("none of the block rules matched");t.tight=!u,t.isEmpty(t.line-1)&&(u=!0),a=t.line,a<n&&t.isEmpty(a)&&(u=!0,a++,t.line=a)}};ParserBlock.prototype.parse=function(t,e,n,r){if(!t)return;const s=new this.State(t,e,n,r);this.tokenize(s,s.line,s.lineMax)};ParserBlock.prototype.State=StateBlock;function StateInline(t,e,n,r){this.src=t,this.env=n,this.md=e,this.tokens=r,this.tokens_meta=Array(r.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}StateInline.prototype.pushPending=function(){const t=new Token("text","",0);return t.content=this.pending,t.level=this.pendingLevel,this.tokens.push(t),this.pending="",t};StateInline.prototype.push=function(t,e,n){this.pending&&this.pushPending();const r=new Token(t,e,n);let s=null;return n<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),r.level=this.level,n>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],s={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(r),this.tokens_meta.push(s),r};StateInline.prototype.scanDelims=function(t,e){const n=this.posMax,r=this.src.charCodeAt(t),s=t>0?this.src.charCodeAt(t-1):32;let o=t;for(;o<n&&this.src.charCodeAt(o)===r;)o++;const a=o-t,u=o<n?this.src.charCodeAt(o):32,l=isMdAsciiPunct(s)||isPunctChar(String.fromCharCode(s)),c=isMdAsciiPunct(u)||isPunctChar(String.fromCharCode(u)),f=isWhiteSpace(s),h=isWhiteSpace(u),p=!h&&(!c||f||l),m=!f&&(!l||h||c);return{can_open:p&&(e||!m||l),can_close:m&&(e||!p||c),length:a}};StateInline.prototype.Token=Token;function isTerminatorChar(t){switch(t){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function text(t,e){let n=t.pos;for(;n<t.posMax&&!isTerminatorChar(t.src.charCodeAt(n));)n++;return n===t.pos?!1:(e||(t.pending+=t.src.slice(t.pos,n)),t.pos=n,!0)}const SCHEME_RE=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function linkify(t,e){if(!t.md.options.linkify||t.linkLevel>0)return!1;const n=t.pos,r=t.posMax;if(n+3>r||t.src.charCodeAt(n)!==58||t.src.charCodeAt(n+1)!==47||t.src.charCodeAt(n+2)!==47)return!1;const s=t.pending.match(SCHEME_RE);if(!s)return!1;const o=s[1],a=t.md.linkify.matchAtStart(t.src.slice(n-o.length));if(!a)return!1;let u=a.url;if(u.length<=o.length)return!1;u=u.replace(/\*+$/,"");const l=t.md.normalizeLink(u);if(!t.md.validateLink(l))return!1;if(!e){t.pending=t.pending.slice(0,-o.length);const c=t.push("link_open","a",1);c.attrs=[["href",l]],c.markup="linkify",c.info="auto";const f=t.push("text","",0);f.content=t.md.normalizeLinkText(u);const h=t.push("link_close","a",-1);h.markup="linkify",h.info="auto"}return t.pos+=u.length-o.length,!0}function newline(t,e){let n=t.pos;if(t.src.charCodeAt(n)!==10)return!1;const r=t.pending.length-1,s=t.posMax;if(!e)if(r>=0&&t.pending.charCodeAt(r)===32)if(r>=1&&t.pending.charCodeAt(r-1)===32){let o=r-1;for(;o>=1&&t.pending.charCodeAt(o-1)===32;)o--;t.pending=t.pending.slice(0,o),t.push("hardbreak","br",0)}else t.pending=t.pending.slice(0,-1),t.push("softbreak","br",0);else t.push("softbreak","br",0);for(n++;n<s&&isSpace(t.src.charCodeAt(n));)n++;return t.pos=n,!0}const ESCAPED=[];for(let t=0;t<256;t++)ESCAPED.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(t){ESCAPED[t.charCodeAt(0)]=1});function escape(t,e){let n=t.pos;const r=t.posMax;if(t.src.charCodeAt(n)!==92||(n++,n>=r))return!1;let s=t.src.charCodeAt(n);if(s===10){for(e||t.push("hardbreak","br",0),n++;n<r&&(s=t.src.charCodeAt(n),!!isSpace(s));)n++;return t.pos=n,!0}let o=t.src[n];if(s>=55296&&s<=56319&&n+1<r){const u=t.src.charCodeAt(n+1);u>=56320&&u<=57343&&(o+=t.src[n+1],n++)}const a="\\"+o;if(!e){const u=t.push("text_special","",0);s<256&&ESCAPED[s]!==0?u.content=o:u.content=a,u.markup=a,u.info="escape"}return t.pos=n+1,!0}function backtick(t,e){let n=t.pos;if(t.src.charCodeAt(n)!==96)return!1;const s=n;n++;const o=t.posMax;for(;n<o&&t.src.charCodeAt(n)===96;)n++;const a=t.src.slice(s,n),u=a.length;if(t.backticksScanned&&(t.backticks[u]||0)<=s)return e||(t.pending+=a),t.pos+=u,!0;let l=n,c;for(;(c=t.src.indexOf("`",l))!==-1;){for(l=c+1;l<o&&t.src.charCodeAt(l)===96;)l++;const f=l-c;if(f===u){if(!e){const h=t.push("code_inline","code",0);h.markup=a,h.content=t.src.slice(n,c).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return t.pos=l,!0}t.backticks[f]=c}return t.backticksScanned=!0,e||(t.pending+=a),t.pos+=u,!0}function strikethrough_tokenize(t,e){const n=t.pos,r=t.src.charCodeAt(n);if(e||r!==126)return!1;const s=t.scanDelims(t.pos,!0);let o=s.length;const a=String.fromCharCode(r);if(o<2)return!1;let u;o%2&&(u=t.push("text","",0),u.content=a,o--);for(let l=0;l<o;l+=2)u=t.push("text","",0),u.content=a+a,t.delimiters.push({marker:r,length:0,token:t.tokens.length-1,end:-1,open:s.can_open,close:s.can_close});return t.pos+=s.length,!0}function postProcess$1(t,e){let n;const r=[],s=e.length;for(let o=0;o<s;o++){const a=e[o];if(a.marker!==126||a.end===-1)continue;const u=e[a.end];n=t.tokens[a.token],n.type="s_open",n.tag="s",n.nesting=1,n.markup="~~",n.content="",n=t.tokens[u.token],n.type="s_close",n.tag="s",n.nesting=-1,n.markup="~~",n.content="",t.tokens[u.token-1].type==="text"&&t.tokens[u.token-1].content==="~"&&r.push(u.token-1)}for(;r.length;){const o=r.pop();let a=o+1;for(;a<t.tokens.length&&t.tokens[a].type==="s_close";)a++;a--,o!==a&&(n=t.tokens[a],t.tokens[a]=t.tokens[o],t.tokens[o]=n)}}function strikethrough_postProcess(t){const e=t.tokens_meta,n=t.tokens_meta.length;postProcess$1(t,t.delimiters);for(let r=0;r<n;r++)e[r]&&e[r].delimiters&&postProcess$1(t,e[r].delimiters)}const r_strikethrough={tokenize:strikethrough_tokenize,postProcess:strikethrough_postProcess};function emphasis_tokenize(t,e){const n=t.pos,r=t.src.charCodeAt(n);if(e||r!==95&&r!==42)return!1;const s=t.scanDelims(t.pos,r===42);for(let o=0;o<s.length;o++){const a=t.push("text","",0);a.content=String.fromCharCode(r),t.delimiters.push({marker:r,length:s.length,token:t.tokens.length-1,end:-1,open:s.can_open,close:s.can_close})}return t.pos+=s.length,!0}function postProcess(t,e){const n=e.length;for(let r=n-1;r>=0;r--){const s=e[r];if(s.marker!==95&&s.marker!==42||s.end===-1)continue;const o=e[s.end],a=r>0&&e[r-1].end===s.end+1&&e[r-1].marker===s.marker&&e[r-1].token===s.token-1&&e[s.end+1].token===o.token+1,u=String.fromCharCode(s.marker),l=t.tokens[s.token];l.type=a?"strong_open":"em_open",l.tag=a?"strong":"em",l.nesting=1,l.markup=a?u+u:u,l.content="";const c=t.tokens[o.token];c.type=a?"strong_close":"em_close",c.tag=a?"strong":"em",c.nesting=-1,c.markup=a?u+u:u,c.content="",a&&(t.tokens[e[r-1].token].content="",t.tokens[e[s.end+1].token].content="",r--)}}function emphasis_post_process(t){const e=t.tokens_meta,n=t.tokens_meta.length;postProcess(t,t.delimiters);for(let r=0;r<n;r++)e[r]&&e[r].delimiters&&postProcess(t,e[r].delimiters)}const r_emphasis={tokenize:emphasis_tokenize,postProcess:emphasis_post_process};function link(t,e){let n,r,s,o,a="",u="",l=t.pos,c=!0;if(t.src.charCodeAt(t.pos)!==91)return!1;const f=t.pos,h=t.posMax,p=t.pos+1,m=t.md.helpers.parseLinkLabel(t,t.pos,!0);if(m<0)return!1;let g=m+1;if(g<h&&t.src.charCodeAt(g)===40){for(c=!1,g++;g<h&&(n=t.src.charCodeAt(g),!(!isSpace(n)&&n!==10));g++);if(g>=h)return!1;if(l=g,s=t.md.helpers.parseLinkDestination(t.src,g,t.posMax),s.ok){for(a=t.md.normalizeLink(s.str),t.md.validateLink(a)?g=s.pos:a="",l=g;g<h&&(n=t.src.charCodeAt(g),!(!isSpace(n)&&n!==10));g++);if(s=t.md.helpers.parseLinkTitle(t.src,g,t.posMax),g<h&&l!==g&&s.ok)for(u=s.str,g=s.pos;g<h&&(n=t.src.charCodeAt(g),!(!isSpace(n)&&n!==10));g++);}(g>=h||t.src.charCodeAt(g)!==41)&&(c=!0),g++}if(c){if(typeof t.env.references>"u")return!1;if(g<h&&t.src.charCodeAt(g)===91?(l=g+1,g=t.md.helpers.parseLinkLabel(t,g),g>=0?r=t.src.slice(l,g++):g=m+1):g=m+1,r||(r=t.src.slice(p,m)),o=t.env.references[normalizeReference(r)],!o)return t.pos=f,!1;a=o.href,u=o.title}if(!e){t.pos=p,t.posMax=m;const b=t.push("link_open","a",1),y=[["href",a]];b.attrs=y,u&&y.push(["title",u]),t.linkLevel++,t.md.inline.tokenize(t),t.linkLevel--,t.push("link_close","a",-1)}return t.pos=g,t.posMax=h,!0}function image(t,e){let n,r,s,o,a,u,l,c,f="";const h=t.pos,p=t.posMax;if(t.src.charCodeAt(t.pos)!==33||t.src.charCodeAt(t.pos+1)!==91)return!1;const m=t.pos+2,g=t.md.helpers.parseLinkLabel(t,t.pos+1,!1);if(g<0)return!1;if(o=g+1,o<p&&t.src.charCodeAt(o)===40){for(o++;o<p&&(n=t.src.charCodeAt(o),!(!isSpace(n)&&n!==10));o++);if(o>=p)return!1;for(c=o,u=t.md.helpers.parseLinkDestination(t.src,o,t.posMax),u.ok&&(f=t.md.normalizeLink(u.str),t.md.validateLink(f)?o=u.pos:f=""),c=o;o<p&&(n=t.src.charCodeAt(o),!(!isSpace(n)&&n!==10));o++);if(u=t.md.helpers.parseLinkTitle(t.src,o,t.posMax),o<p&&c!==o&&u.ok)for(l=u.str,o=u.pos;o<p&&(n=t.src.charCodeAt(o),!(!isSpace(n)&&n!==10));o++);else l="";if(o>=p||t.src.charCodeAt(o)!==41)return t.pos=h,!1;o++}else{if(typeof t.env.references>"u")return!1;if(o<p&&t.src.charCodeAt(o)===91?(c=o+1,o=t.md.helpers.parseLinkLabel(t,o),o>=0?s=t.src.slice(c,o++):o=g+1):o=g+1,s||(s=t.src.slice(m,g)),a=t.env.references[normalizeReference(s)],!a)return t.pos=h,!1;f=a.href,l=a.title}if(!e){r=t.src.slice(m,g);const b=[];t.md.inline.parse(r,t.md,t.env,b);const y=t.push("image","img",0),_=[["src",f],["alt",""]];y.attrs=_,y.children=b,y.content=r,l&&_.push(["title",l])}return t.pos=o,t.posMax=p,!0}const EMAIL_RE=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,AUTOLINK_RE=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function autolink(t,e){let n=t.pos;if(t.src.charCodeAt(n)!==60)return!1;const r=t.pos,s=t.posMax;for(;;){if(++n>=s)return!1;const a=t.src.charCodeAt(n);if(a===60)return!1;if(a===62)break}const o=t.src.slice(r+1,n);if(AUTOLINK_RE.test(o)){const a=t.md.normalizeLink(o);if(!t.md.validateLink(a))return!1;if(!e){const u=t.push("link_open","a",1);u.attrs=[["href",a]],u.markup="autolink",u.info="auto";const l=t.push("text","",0);l.content=t.md.normalizeLinkText(o);const c=t.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return t.pos+=o.length+2,!0}if(EMAIL_RE.test(o)){const a=t.md.normalizeLink("mailto:"+o);if(!t.md.validateLink(a))return!1;if(!e){const u=t.push("link_open","a",1);u.attrs=[["href",a]],u.markup="autolink",u.info="auto";const l=t.push("text","",0);l.content=t.md.normalizeLinkText(o);const c=t.push("link_close","a",-1);c.markup="autolink",c.info="auto"}return t.pos+=o.length+2,!0}return!1}function isLinkOpen(t){return/^<a[>\s]/i.test(t)}function isLinkClose(t){return/^<\/a\s*>/i.test(t)}function isLetter(t){const e=t|32;return e>=97&&e<=122}function html_inline(t,e){if(!t.md.options.html)return!1;const n=t.posMax,r=t.pos;if(t.src.charCodeAt(r)!==60||r+2>=n)return!1;const s=t.src.charCodeAt(r+1);if(s!==33&&s!==63&&s!==47&&!isLetter(s))return!1;const o=t.src.slice(r).match(HTML_TAG_RE);if(!o)return!1;if(!e){const a=t.push("html_inline","",0);a.content=o[0],isLinkOpen(a.content)&&t.linkLevel++,isLinkClose(a.content)&&t.linkLevel--}return t.pos+=o[0].length,!0}const DIGITAL_RE=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,NAMED_RE=/^&([a-z][a-z0-9]{1,31});/i;function entity(t,e){const n=t.pos,r=t.posMax;if(t.src.charCodeAt(n)!==38||n+1>=r)return!1;if(t.src.charCodeAt(n+1)===35){const o=t.src.slice(n).match(DIGITAL_RE);if(o){if(!e){const a=o[1][0].toLowerCase()==="x"?parseInt(o[1].slice(1),16):parseInt(o[1],10),u=t.push("text_special","",0);u.content=isValidEntityCode(a)?fromCodePoint(a):fromCodePoint(65533),u.markup=o[0],u.info="entity"}return t.pos+=o[0].length,!0}}else{const o=t.src.slice(n).match(NAMED_RE);if(o){const a=decodeHTML(o[0]);if(a!==o[0]){if(!e){const u=t.push("text_special","",0);u.content=a,u.markup=o[0],u.info="entity"}return t.pos+=o[0].length,!0}}}return!1}function processDelimiters(t){const e={},n=t.length;if(!n)return;let r=0,s=-2;const o=[];for(let a=0;a<n;a++){const u=t[a];if(o.push(0),(t[r].marker!==u.marker||s!==u.token-1)&&(r=a),s=u.token,u.length=u.length||0,!u.close)continue;e.hasOwnProperty(u.marker)||(e[u.marker]=[-1,-1,-1,-1,-1,-1]);const l=e[u.marker][(u.open?3:0)+u.length%3];let c=r-o[r]-1,f=c;for(;c>l;c-=o[c]+1){const h=t[c];if(h.marker===u.marker&&h.open&&h.end<0){let p=!1;if((h.close||u.open)&&(h.length+u.length)%3===0&&(h.length%3!==0||u.length%3!==0)&&(p=!0),!p){const m=c>0&&!t[c-1].open?o[c-1]+1:0;o[a]=a-c+m,o[c]=m,u.open=!1,h.end=a,h.close=!1,f=-1,s=-2;break}}}f!==-1&&(e[u.marker][(u.open?3:0)+(u.length||0)%3]=f)}}function link_pairs(t){const e=t.tokens_meta,n=t.tokens_meta.length;processDelimiters(t.delimiters);for(let r=0;r<n;r++)e[r]&&e[r].delimiters&&processDelimiters(e[r].delimiters)}function fragments_join(t){let e,n,r=0;const s=t.tokens,o=t.tokens.length;for(e=n=0;e<o;e++)s[e].nesting<0&&r--,s[e].level=r,s[e].nesting>0&&r++,s[e].type==="text"&&e+1<o&&s[e+1].type==="text"?s[e+1].content=s[e].content+s[e+1].content:(e!==n&&(s[n]=s[e]),n++);e!==n&&(s.length=n)}const _rules=[["text",text],["linkify",linkify],["newline",newline],["escape",escape],["backticks",backtick],["strikethrough",r_strikethrough.tokenize],["emphasis",r_emphasis.tokenize],["link",link],["image",image],["autolink",autolink],["html_inline",html_inline],["entity",entity]],_rules2=[["balance_pairs",link_pairs],["strikethrough",r_strikethrough.postProcess],["emphasis",r_emphasis.postProcess],["fragments_join",fragments_join]];function ParserInline(){this.ruler=new Ruler;for(let t=0;t<_rules.length;t++)this.ruler.push(_rules[t][0],_rules[t][1]);this.ruler2=new Ruler;for(let t=0;t<_rules2.length;t++)this.ruler2.push(_rules2[t][0],_rules2[t][1])}ParserInline.prototype.skipToken=function(t){const e=t.pos,n=this.ruler.getRules(""),r=n.length,s=t.md.options.maxNesting,o=t.cache;if(typeof o[e]<"u"){t.pos=o[e];return}let a=!1;if(t.level<s){for(let u=0;u<r;u++)if(t.level++,a=n[u](t,!0),t.level--,a){if(e>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}else t.pos=t.posMax;a||t.pos++,o[e]=t.pos};ParserInline.prototype.tokenize=function(t){const e=this.ruler.getRules(""),n=e.length,r=t.posMax,s=t.md.options.maxNesting;for(;t.pos<r;){const o=t.pos;let a=!1;if(t.level<s){for(let u=0;u<n;u++)if(a=e[u](t,!1),a){if(o>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}if(a){if(t.pos>=r)break;continue}t.pending+=t.src[t.pos++]}t.pending&&t.pushPending()};ParserInline.prototype.parse=function(t,e,n,r){const s=new this.State(t,e,n,r);this.tokenize(s);const o=this.ruler2.getRules(""),a=o.length;for(let u=0;u<a;u++)o[u](s)};ParserInline.prototype.State=StateInline;function reFactory(t){const e={};t=t||{},e.src_Any=Any.source,e.src_Cc=Cc.source,e.src_Z=Z.source,e.src_P=P.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");const n="[><]";return e.src_pseudo_letter="(?:(?!"+n+"|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|"+n+"|"+e.src_ZPCc+")(?!"+(t["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+n+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(t["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy="(^|"+n+'|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+e.src_ZPCc+"))((?![$+<=>^`|])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+e.src_ZPCc+"))((?![$+<=>^`|])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}function assign(t){return Array.prototype.slice.call(arguments,1).forEach(function(n){n&&Object.keys(n).forEach(function(r){t[r]=n[r]})}),t}function _class(t){return Object.prototype.toString.call(t)}function isString(t){return _class(t)==="[object String]"}function isObject(t){return _class(t)==="[object Object]"}function isRegExp(t){return _class(t)==="[object RegExp]"}function isFunction(t){return _class(t)==="[object Function]"}function escapeRE(t){return t.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const defaultOptions={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function isOptionsObj(t){return Object.keys(t||{}).reduce(function(e,n){return e||defaultOptions.hasOwnProperty(n)},!1)}const defaultSchemas={"http:":{validate:function(t,e,n){const r=t.slice(e);return n.re.http||(n.re.http=new RegExp("^\\/\\/"+n.re.src_auth+n.re.src_host_port_strict+n.re.src_path,"i")),n.re.http.test(r)?r.match(n.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(t,e,n){const r=t.slice(e);return n.re.no_http||(n.re.no_http=new RegExp("^"+n.re.src_auth+"(?:localhost|(?:(?:"+n.re.src_domain+")\\.)+"+n.re.src_domain_root+")"+n.re.src_port+n.re.src_host_terminator+n.re.src_path,"i")),n.re.no_http.test(r)?e>=3&&t[e-3]===":"||e>=3&&t[e-3]==="/"?0:r.match(n.re.no_http)[0].length:0}},"mailto:":{validate:function(t,e,n){const r=t.slice(e);return n.re.mailto||(n.re.mailto=new RegExp("^"+n.re.src_email_name+"@"+n.re.src_host_strict,"i")),n.re.mailto.test(r)?r.match(n.re.mailto)[0].length:0}}},tlds_2ch_src_re="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",tlds_default="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|".split("|");function resetScanCache(t){t.__index__=-1,t.__text_cache__=""}function createValidator(t){return function(e,n){const r=e.slice(n);return t.test(r)?r.match(t)[0].length:0}}function createNormalizer(){return function(t,e){e.normalize(t)}}function compile(t){const e=t.re=reFactory(t.__opts__),n=t.__tlds__.slice();t.onCompile(),t.__tlds_replaced__||n.push(tlds_2ch_src_re),n.push(e.src_xn),e.src_tlds=n.join("|");function r(u){return u.replace("%TLDS%",e.src_tlds)}e.email_fuzzy=RegExp(r(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(r(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(r(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(r(e.tpl_host_fuzzy_test),"i");const s=[];t.__compiled__={};function o(u,l){throw new Error('(LinkifyIt) Invalid schema "'+u+'": '+l)}Object.keys(t.__schemas__).forEach(function(u){const l=t.__schemas__[u];if(l===null)return;const c={validate:null,link:null};if(t.__compiled__[u]=c,isObject(l)){isRegExp(l.validate)?c.validate=createValidator(l.validate):isFunction(l.validate)?c.validate=l.validate:o(u,l),isFunction(l.normalize)?c.normalize=l.normalize:l.normalize?o(u,l):c.normalize=createNormalizer();return}if(isString(l)){s.push(u);return}o(u,l)}),s.forEach(function(u){t.__compiled__[t.__schemas__[u]]&&(t.__compiled__[u].validate=t.__compiled__[t.__schemas__[u]].validate,t.__compiled__[u].normalize=t.__compiled__[t.__schemas__[u]].normalize)}),t.__compiled__[""]={validate:null,normalize:createNormalizer()};const a=Object.keys(t.__compiled__).filter(function(u){return u.length>0&&t.__compiled__[u]}).map(escapeRE).join("|");t.re.schema_test=RegExp("(^|(?!_)(?:[><]|"+e.src_ZPCc+"))("+a+")","i"),t.re.schema_search=RegExp("(^|(?!_)(?:[><]|"+e.src_ZPCc+"))("+a+")","ig"),t.re.schema_at_start=RegExp("^"+t.re.schema_search.source,"i"),t.re.pretest=RegExp("("+t.re.schema_test.source+")|("+t.re.host_fuzzy_test.source+")|@","i"),resetScanCache(t)}function Match(t,e){const n=t.__index__,r=t.__last_index__,s=t.__text_cache__.slice(n,r);this.schema=t.__schema__.toLowerCase(),this.index=n+e,this.lastIndex=r+e,this.raw=s,this.text=s,this.url=s}function createMatch(t,e){const n=new Match(t,e);return t.__compiled__[n.schema].normalize(n,t),n}function LinkifyIt(t,e){if(!(this instanceof LinkifyIt))return new LinkifyIt(t,e);e||isOptionsObj(t)&&(e=t,t={}),this.__opts__=assign({},defaultOptions,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=assign({},defaultSchemas,t),this.__compiled__={},this.__tlds__=tlds_default,this.__tlds_replaced__=!1,this.re={},compile(this)}LinkifyIt.prototype.add=function t(e,n){return this.__schemas__[e]=n,compile(this),this};LinkifyIt.prototype.set=function t(e){return this.__opts__=assign(this.__opts__,e),this};LinkifyIt.prototype.test=function t(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;let n,r,s,o,a,u,l,c,f;if(this.re.schema_test.test(e)){for(l=this.re.schema_search,l.lastIndex=0;(n=l.exec(e))!==null;)if(o=this.testSchemaAt(e,n[2],l.lastIndex),o){this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+o;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(c=e.search(this.re.host_fuzzy_test),c>=0&&(this.__index__<0||c<this.__index__)&&(r=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(a=r.index+r[1].length,(this.__index__<0||a<this.__index__)&&(this.__schema__="",this.__index__=a,this.__last_index__=r.index+r[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(f=e.indexOf("@"),f>=0&&(s=e.match(this.re.email_fuzzy))!==null&&(a=s.index+s[1].length,u=s.index+s[0].length,(this.__index__<0||a<this.__index__||a===this.__index__&&u>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=a,this.__last_index__=u))),this.__index__>=0};LinkifyIt.prototype.pretest=function t(e){return this.re.pretest.test(e)};LinkifyIt.prototype.testSchemaAt=function t(e,n,r){return this.__compiled__[n.toLowerCase()]?this.__compiled__[n.toLowerCase()].validate(e,r,this):0};LinkifyIt.prototype.match=function t(e){const n=[];let r=0;this.__index__>=0&&this.__text_cache__===e&&(n.push(createMatch(this,r)),r=this.__last_index__);let s=r?e.slice(r):e;for(;this.test(s);)n.push(createMatch(this,r)),s=s.slice(this.__last_index__),r+=this.__last_index__;return n.length?n:null};LinkifyIt.prototype.matchAtStart=function t(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return null;const n=this.re.schema_at_start.exec(e);if(!n)return null;const r=this.testSchemaAt(e,n[2],n[0].length);return r?(this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+r,createMatch(this,0)):null};LinkifyIt.prototype.tlds=function t(e,n){return e=Array.isArray(e)?e:[e],n?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(r,s,o){return r!==o[s-1]}).reverse(),compile(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,compile(this),this)};LinkifyIt.prototype.normalize=function t(e){e.schema||(e.url="http://"+e.url),e.schema==="mailto:"&&!/^mailto:/i.test(e.url)&&(e.url="mailto:"+e.url)};LinkifyIt.prototype.onCompile=function t(){};const maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\0-\x7F]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(t){throw new RangeError(errors[t])}function map(t,e){const n=[];let r=t.length;for(;r--;)n[r]=e(t[r]);return n}function mapDomain(t,e){const n=t.split("@");let r="";n.length>1&&(r=n[0]+"@",t=n[1]),t=t.replace(regexSeparators,".");const s=t.split("."),o=map(s,e).join(".");return r+o}function ucs2decode(t){const e=[];let n=0;const r=t.length;for(;n<r;){const s=t.charCodeAt(n++);if(s>=55296&&s<=56319&&n<r){const o=t.charCodeAt(n++);(o&64512)==56320?e.push(((s&1023)<<10)+(o&1023)+65536):(e.push(s),n--)}else e.push(s)}return e}const ucs2encode=t=>String.fromCodePoint(...t),basicToDigit=function(t){return t>=48&&t<58?26+(t-48):t>=65&&t<91?t-65:t>=97&&t<123?t-97:base},digitToBasic=function(t,e){return t+22+75*(t<26)-((e!=0)<<5)},adapt=function(t,e,n){let r=0;for(t=n?floor(t/damp):t>>1,t+=floor(t/e);t>baseMinusTMin*tMax>>1;r+=base)t=floor(t/baseMinusTMin);return floor(r+(baseMinusTMin+1)*t/(t+skew))},decode=function(t){const e=[],n=t.length;let r=0,s=initialN,o=initialBias,a=t.lastIndexOf(delimiter);a<0&&(a=0);for(let u=0;u<a;++u)t.charCodeAt(u)>=128&&error("not-basic"),e.push(t.charCodeAt(u));for(let u=a>0?a+1:0;u<n;){const l=r;for(let f=1,h=base;;h+=base){u>=n&&error("invalid-input");const p=basicToDigit(t.charCodeAt(u++));p>=base&&error("invalid-input"),p>floor((maxInt-r)/f)&&error("overflow"),r+=p*f;const m=h<=o?tMin:h>=o+tMax?tMax:h-o;if(p<m)break;const g=base-m;f>floor(maxInt/g)&&error("overflow"),f*=g}const c=e.length+1;o=adapt(r-l,c,l==0),floor(r/c)>maxInt-s&&error("overflow"),s+=floor(r/c),r%=c,e.splice(r++,0,s)}return String.fromCodePoint(...e)},encode=function(t){const e=[];t=ucs2decode(t);const n=t.length;let r=initialN,s=0,o=initialBias;for(const l of t)l<128&&e.push(stringFromCharCode(l));const a=e.length;let u=a;for(a&&e.push(delimiter);u<n;){let l=maxInt;for(const f of t)f>=r&&f<l&&(l=f);const c=u+1;l-r>floor((maxInt-s)/c)&&error("overflow"),s+=(l-r)*c,r=l;for(const f of t)if(f<r&&++s>maxInt&&error("overflow"),f===r){let h=s;for(let p=base;;p+=base){const m=p<=o?tMin:p>=o+tMax?tMax:p-o;if(h<m)break;const g=h-m,b=base-m;e.push(stringFromCharCode(digitToBasic(m+g%b,0))),h=floor(g/b)}e.push(stringFromCharCode(digitToBasic(h,0))),o=adapt(s,c,u===a),s=0,++u}++s,++r}return e.join("")},toUnicode=function(t){return mapDomain(t,function(e){return regexPunycode.test(e)?decode(e.slice(4).toLowerCase()):e})},toASCII=function(t){return mapDomain(t,function(e){return regexNonASCII.test(e)?"xn--"+encode(e):e})},punycode={version:"2.3.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode,encode,toASCII,toUnicode},cfg_default={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},cfg_zero={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},cfg_commonmark={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},config={default:cfg_default,zero:cfg_zero,commonmark:cfg_commonmark},BAD_PROTO_RE=/^(vbscript|javascript|file|data):/,GOOD_DATA_RE=/^data:image\/(gif|png|jpeg|webp);/;function validateLink(t){const e=t.trim().toLowerCase();return BAD_PROTO_RE.test(e)?GOOD_DATA_RE.test(e):!0}const RECODE_HOSTNAME_FOR=["http:","https:","mailto:"];function normalizeLink(t){const e=urlParse(t,!0);if(e.hostname&&(!e.protocol||RECODE_HOSTNAME_FOR.indexOf(e.protocol)>=0))try{e.hostname=punycode.toASCII(e.hostname)}catch{}return encode$1(format(e))}function normalizeLinkText(t){const e=urlParse(t,!0);if(e.hostname&&(!e.protocol||RECODE_HOSTNAME_FOR.indexOf(e.protocol)>=0))try{e.hostname=punycode.toUnicode(e.hostname)}catch{}return decode$1(format(e),decode$1.defaultChars+"%")}function MarkdownIt(t,e){if(!(this instanceof MarkdownIt))return new MarkdownIt(t,e);e||isString$1(t)||(e=t||{},t="default"),this.inline=new ParserInline,this.block=new ParserBlock,this.core=new Core,this.renderer=new Renderer,this.linkify=new LinkifyIt,this.validateLink=validateLink,this.normalizeLink=normalizeLink,this.normalizeLinkText=normalizeLinkText,this.utils=utils,this.helpers=assign$1({},helpers),this.options={},this.configure(t),e&&this.set(e)}MarkdownIt.prototype.set=function(t){return assign$1(this.options,t),this};MarkdownIt.prototype.configure=function(t){const e=this;if(isString$1(t)){const n=t;if(t=config[n],!t)throw new Error('Wrong `markdown-it` preset "'+n+'", check name')}if(!t)throw new Error("Wrong `markdown-it` preset, can't be empty");return t.options&&e.set(t.options),t.components&&Object.keys(t.components).forEach(function(n){t.components[n].rules&&e[n].ruler.enableOnly(t.components[n].rules),t.components[n].rules2&&e[n].ruler2.enableOnly(t.components[n].rules2)}),this};MarkdownIt.prototype.enable=function(t,e){let n=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(s){n=n.concat(this[s].ruler.enable(t,!0))},this),n=n.concat(this.inline.ruler2.enable(t,!0));const r=t.filter(function(s){return n.indexOf(s)<0});if(r.length&&!e)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+r);return this};MarkdownIt.prototype.disable=function(t,e){let n=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(s){n=n.concat(this[s].ruler.disable(t,!0))},this),n=n.concat(this.inline.ruler2.disable(t,!0));const r=t.filter(function(s){return n.indexOf(s)<0});if(r.length&&!e)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+r);return this};MarkdownIt.prototype.use=function(t){const e=[this].concat(Array.prototype.slice.call(arguments,1));return t.apply(t,e),this};MarkdownIt.prototype.parse=function(t,e){if(typeof t!="string")throw new Error("Input data should be a String");const n=new this.core.State(t,this,e);return this.core.process(n),n.tokens};MarkdownIt.prototype.render=function(t,e){return e=e||{},this.renderer.render(this.parse(t,e),this.options,e)};MarkdownIt.prototype.parseInline=function(t,e){const n=new this.core.State(t,this,e);return n.inlineMode=!0,this.core.process(n),n.tokens};MarkdownIt.prototype.renderInline=function(t,e){return e=e||{},this.renderer.render(this.parseInline(t,e),this.options,e)};const schema=new Schema({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({params:t.getAttribute("data-params")||""})}],toDOM(t){return["pre",t.attrs.params?{"data-params":t.attrs.params}:{},["code",0]]}},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1,tight:t.hasAttribute("data-tight")}}}],toDOM(t){return["ol",{start:t.attrs.order==1?null:t.attrs.order,"data-tight":t.attrs.tight?"true":null},0]}},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:t=>({tight:t.hasAttribute("data-tight")})}],toDOM(t){return["ul",{"data-tight":t.attrs.tight?"true":null},0]}},list_item:{content:"block+",defining:!0,parseDOM:[{tag:"li"}],toDOM(){return["li",0]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM(t){return["img",t.attrs]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:t=>t.type.name=="em"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name=="strong"},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM(){return["strong"]}},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM(t){return["a",t.attrs]}},code:{parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}});function maybeMerge(t,e){if(t.isText&&e.isText&&Mark$1.sameSet(t.marks,e.marks))return t.withText(t.text+e.text)}class MarkdownParseState{constructor(e,n){this.schema=e,this.tokenHandlers=n,this.stack=[{type:e.topNodeType,attrs:null,content:[],marks:Mark$1.none}]}top(){return this.stack[this.stack.length-1]}push(e){this.stack.length&&this.top().content.push(e)}addText(e){if(!e)return;let n=this.top(),r=n.content,s=r[r.length-1],o=this.schema.text(e,n.marks),a;s&&(a=maybeMerge(s,o))?r[r.length-1]=a:r.push(o)}openMark(e){let n=this.top();n.marks=e.addToSet(n.marks)}closeMark(e){let n=this.top();n.marks=e.removeFromSet(n.marks)}parseTokens(e){for(let n=0;n<e.length;n++){let r=e[n],s=this.tokenHandlers[r.type];if(!s)throw new Error("Token type `"+r.type+"` not supported by Markdown parser");s(this,r,e,n)}}addNode(e,n,r){let s=this.top(),o=e.createAndFill(n,r,s?s.marks:[]);return o?(this.push(o),o):null}openNode(e,n){this.stack.push({type:e,attrs:n,content:[],marks:Mark$1.none})}closeNode(){let e=this.stack.pop();return this.addNode(e.type,e.attrs,e.content)}}function attrs(t,e,n,r){return t.getAttrs?t.getAttrs(e,n,r):t.attrs instanceof Function?t.attrs(e):t.attrs}function noCloseToken(t,e){return t.noCloseToken||e=="code_inline"||e=="code_block"||e=="fence"}function withoutTrailingNewline(t){return t[t.length-1]==`
`?t.slice(0,t.length-1):t}function noOp(){}function tokenHandlers(t,e){let n=Object.create(null);for(let r in e){let s=e[r];if(s.block){let o=t.nodeType(s.block);noCloseToken(s,r)?n[r]=(a,u,l,c)=>{a.openNode(o,attrs(s,u,l,c)),a.addText(withoutTrailingNewline(u.content)),a.closeNode()}:(n[r+"_open"]=(a,u,l,c)=>a.openNode(o,attrs(s,u,l,c)),n[r+"_close"]=a=>a.closeNode())}else if(s.node){let o=t.nodeType(s.node);n[r]=(a,u,l,c)=>a.addNode(o,attrs(s,u,l,c))}else if(s.mark){let o=t.marks[s.mark];noCloseToken(s,r)?n[r]=(a,u,l,c)=>{a.openMark(o.create(attrs(s,u,l,c))),a.addText(withoutTrailingNewline(u.content)),a.closeMark(o)}:(n[r+"_open"]=(a,u,l,c)=>a.openMark(o.create(attrs(s,u,l,c))),n[r+"_close"]=a=>a.closeMark(o))}else if(s.ignore)noCloseToken(s,r)?n[r]=noOp:(n[r+"_open"]=noOp,n[r+"_close"]=noOp);else throw new RangeError("Unrecognized parsing spec "+JSON.stringify(s))}return n.text=(r,s)=>r.addText(s.content),n.inline=(r,s)=>r.parseTokens(s.children),n.softbreak=n.softbreak||(r=>r.addText(" ")),n}let MarkdownParser$1=class{constructor(e,n,r){this.schema=e,this.tokenizer=n,this.tokens=r,this.tokenHandlers=tokenHandlers(e,r)}parse(e,n={}){let r=new MarkdownParseState(this.schema,this.tokenHandlers),s;r.parseTokens(this.tokenizer.parse(e,n));do s=r.closeNode();while(r.stack.length);return s||this.schema.topNodeType.createAndFill()}};function listIsTight(t,e){for(;++e<t.length;)if(t[e].type!="list_item_open")return t[e].hidden;return!1}new MarkdownParser$1(schema,MarkdownIt("commonmark",{html:!1}),{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(t,e,n)=>({tight:listIsTight(e,n)})},ordered_list:{block:"ordered_list",getAttrs:(t,e,n)=>({order:+t.attrGet("start")||1,tight:listIsTight(e,n)})},heading:{block:"heading",getAttrs:t=>({level:+t.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:t=>({params:t.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:t=>({src:t.attrGet("src"),title:t.attrGet("title")||null,alt:t.children[0]&&t.children[0].content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:t=>({href:t.attrGet("href"),title:t.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}});const blankMark={open:"",close:"",mixable:!0};let MarkdownSerializer$1=class{constructor(e,n,r={}){this.nodes=e,this.marks=n,this.options=r}serialize(e,n={}){n=Object.assign({},this.options,n);let r=new MarkdownSerializerState$1(this.nodes,this.marks,n);return r.renderContent(e),r.out}};const defaultMarkdownSerializer=new MarkdownSerializer$1({blockquote(t,e){t.wrapBlock("> ",null,e,()=>t.renderContent(e))},code_block(t,e){const n=e.textContent.match(/`{3,}/gm),r=n?n.sort().slice(-1)[0]+"`":"```";t.write(r+(e.attrs.params||"")+`
`),t.text(e.textContent,!1),t.write(`
`),t.write(r),t.closeBlock(e)},heading(t,e){t.write(t.repeat("#",e.attrs.level)+" "),t.renderInline(e,!1),t.closeBlock(e)},horizontal_rule(t,e){t.write(e.attrs.markup||"---"),t.closeBlock(e)},bullet_list(t,e){t.renderList(e,"  ",()=>(e.attrs.bullet||"*")+" ")},ordered_list(t,e){let n=e.attrs.order||1,r=String(n+e.childCount-1).length,s=t.repeat(" ",r+2);t.renderList(e,s,o=>{let a=String(n+o);return t.repeat(" ",r-a.length)+a+". "})},list_item(t,e){t.renderContent(e)},paragraph(t,e){t.renderInline(e),t.closeBlock(e)},image(t,e){t.write("!["+t.esc(e.attrs.alt||"")+"]("+e.attrs.src.replace(/[\(\)]/g,"\\$&")+(e.attrs.title?' "'+e.attrs.title.replace(/"/g,'\\"')+'"':"")+")")},hard_break(t,e,n,r){for(let s=r+1;s<n.childCount;s++)if(n.child(s).type!=e.type){t.write(`\\
`);return}},text(t,e){t.text(e.text,!t.inAutolink)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open(t,e,n,r){return t.inAutolink=isPlainURL(e,n,r),t.inAutolink?"<":"["},close(t,e,n,r){let{inAutolink:s}=t;return t.inAutolink=void 0,s?">":"]("+e.attrs.href.replace(/[\(\)"]/g,"\\$&")+(e.attrs.title?` "${e.attrs.title.replace(/"/g,'\\"')}"`:"")+")"},mixable:!0},code:{open(t,e,n,r){return backticksFor(n.child(r),-1)},close(t,e,n,r){return backticksFor(n.child(r-1),1)},escape:!1}});function backticksFor(t,e){let n=/`+/g,r,s=0;if(t.isText)for(;r=n.exec(t.text);)s=Math.max(s,r[0].length);let o=s>0&&e>0?" `":"`";for(let a=0;a<s;a++)o+="`";return s>0&&e<0&&(o+=" "),o}function isPlainURL(t,e,n){if(t.attrs.title||!/^\w+:/.test(t.attrs.href))return!1;let r=e.child(n);return!r.isText||r.text!=t.attrs.href||r.marks[r.marks.length-1]!=t?!1:n==e.childCount-1||!t.isInSet(e.child(n+1).marks)}let MarkdownSerializerState$1=class{constructor(e,n,r){this.nodes=e,this.marks=n,this.options=r,this.delim="",this.out="",this.closed=null,this.inAutolink=void 0,this.atBlockStart=!1,this.inTightList=!1,typeof this.options.tightLists>"u"&&(this.options.tightLists=!1),typeof this.options.hardBreakNodeName>"u"&&(this.options.hardBreakNodeName="hard_break")}flushClose(e=2){if(this.closed){if(this.atBlank()||(this.out+=`
`),e>1){let n=this.delim,r=/\s+$/.exec(n);r&&(n=n.slice(0,n.length-r[0].length));for(let s=1;s<e;s++)this.out+=n+`
`}this.closed=null}}getMark(e){let n=this.marks[e];if(!n){if(this.options.strict!==!1)throw new Error(`Mark type \`${e}\` not supported by Markdown renderer`);n=blankMark}return n}wrapBlock(e,n,r,s){let o=this.delim;this.write(n??e),this.delim+=e,s(),this.delim=o,this.closeBlock(r)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+=`
`)}write(e){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),e&&(this.out+=e)}closeBlock(e){this.closed=e}text(e,n=!0){let r=e.split(`
`);for(let s=0;s<r.length;s++)this.write(),!n&&r[s][0]=="["&&/(^|[^\\])\!$/.test(this.out)&&(this.out=this.out.slice(0,this.out.length-1)+"\\!"),this.out+=n?this.esc(r[s],this.atBlockStart):r[s],s!=r.length-1&&(this.out+=`
`)}render(e,n,r){if(this.nodes[e.type.name])this.nodes[e.type.name](this,e,n,r);else{if(this.options.strict!==!1)throw new Error("Token type `"+e.type.name+"` not supported by Markdown renderer");e.type.isLeaf||(e.type.inlineContent?this.renderInline(e):this.renderContent(e),e.isBlock&&this.closeBlock(e))}}renderContent(e){e.forEach((n,r,s)=>this.render(n,e,s))}renderInline(e,n=!0){this.atBlockStart=n;let r=[],s="",o=(a,u,l)=>{let c=a?a.marks:[];a&&a.type.name===this.options.hardBreakNodeName&&(c=c.filter(b=>{if(l+1==e.childCount)return!1;let y=e.child(l+1);return b.isInSet(y.marks)&&(!y.isText||/\S/.test(y.text))}));let f=s;if(s="",a&&a.isText&&c.some(b=>{let y=this.getMark(b.type.name);return y&&y.expelEnclosingWhitespace&&!b.isInSet(r)})){let[b,y,_]=/^(\s*)(.*)$/m.exec(a.text);y&&(f+=y,a=_?a.withText(_):null,a||(c=r))}if(a&&a.isText&&c.some(b=>{let y=this.getMark(b.type.name);return y&&y.expelEnclosingWhitespace&&(l==e.childCount-1||!b.isInSet(e.child(l+1).marks))})){let[b,y,_]=/^(.*?)(\s*)$/m.exec(a.text);_&&(s=_,a=y?a.withText(y):null,a||(c=r))}let h=c.length?c[c.length-1]:null,p=h&&this.getMark(h.type.name).escape===!1,m=c.length-(p?1:0);e:for(let b=0;b<m;b++){let y=c[b];if(!this.getMark(y.type.name).mixable)break;for(let _=0;_<r.length;_++){let x=r[_];if(!this.getMark(x.type.name).mixable)break;if(y.eq(x)){b>_?c=c.slice(0,_).concat(y).concat(c.slice(_,b)).concat(c.slice(b+1,m)):_>b&&(c=c.slice(0,b).concat(c.slice(b+1,_)).concat(y).concat(c.slice(_,m)));continue e}}}let g=0;for(;g<Math.min(r.length,m)&&c[g].eq(r[g]);)++g;for(;g<r.length;)this.text(this.markString(r.pop(),!1,e,l),!1);if(f&&this.text(f),a){for(;r.length<m;){let b=c[r.length];r.push(b),this.text(this.markString(b,!0,e,l),!1),this.atBlockStart=!1}p&&a.isText?this.text(this.markString(h,!0,e,l)+a.text+this.markString(h,!1,e,l+1),!1):this.render(a,e,l),this.atBlockStart=!1}a!=null&&a.isText&&a.nodeSize>0&&(this.atBlockStart=!1)};e.forEach(o),o(null,0,e.childCount),this.atBlockStart=!1}renderList(e,n,r){this.closed&&this.closed.type==e.type?this.flushClose(3):this.inTightList&&this.flushClose(1);let s=typeof e.attrs.tight<"u"?e.attrs.tight:this.options.tightLists,o=this.inTightList;this.inTightList=s,e.forEach((a,u,l)=>{l&&s&&this.flushClose(1),this.wrapBlock(n,r(l),e,()=>this.render(a,e,l))}),this.inTightList=o}esc(e,n=!1){return e=e.replace(/[`*\\~\[\]_]/g,(r,s)=>r=="_"&&s>0&&s+1<e.length&&e[s-1].match(/\w/)&&e[s+1].match(/\w/)?r:"\\"+r),n&&(e=e.replace(/^(\+[ ]|[\-*>])/,"\\$&").replace(/^(\s*)(#{1,6})(\s|$)/,"$1\\$2$3").replace(/^(\s*\d+)\.\s/,"$1\\. ")),this.options.escapeExtraCharacters&&(e=e.replace(this.options.escapeExtraCharacters,"\\$&")),e}quote(e){let n=e.indexOf('"')==-1?'""':e.indexOf("'")==-1?"''":"()";return n[0]+e+n[1]}repeat(e,n){let r="";for(let s=0;s<n;s++)r+=e;return r}markString(e,n,r,s){let o=this.getMark(e.type.name),a=n?o.open:o.close;return typeof a=="string"?a:a(this,e,r,s)}getEnclosingWhitespace(e){return{leading:(e.match(/^(\s+)/)||[void 0])[0],trailing:(e.match(/(\s+)$/)||[void 0])[0]}}};var markdownItTaskLists,hasRequiredMarkdownItTaskLists;function requireMarkdownItTaskLists(){if(hasRequiredMarkdownItTaskLists)return markdownItTaskLists;hasRequiredMarkdownItTaskLists=1;var t=!0,e=!1,n=!1;markdownItTaskLists=function(b,y){y&&(t=!y.enabled,e=!!y.label,n=!!y.labelAfter),b.core.ruler.after("inline","github-task-lists",function(_){for(var x=_.tokens,E=2;E<x.length;E++)o(x,E)&&(a(x[E],_.Token),r(x[E-2],"class","task-list-item"+(t?"":" enabled")),r(x[s(x,E-2)],"class","contains-task-list"))})};function r(b,y,_){var x=b.attrIndex(y),E=[y,_];x<0?b.attrPush(E):b.attrs[x]=E}function s(b,y){for(var _=b[y].level-1,x=y-1;x>=0;x--)if(b[x].level===_)return x;return-1}function o(b,y){return h(b[y])&&p(b[y-1])&&m(b[y-2])&&g(b[y])}function a(b,y){if(b.children.unshift(u(b,y)),b.children[1].content=b.children[1].content.slice(3),b.content=b.content.slice(3),e)if(n){b.children.pop();var _="task-item-"+Math.ceil(Math.random()*(1e4*1e3)-1e3);b.children[0].content=b.children[0].content.slice(0,-1)+' id="'+_+'">',b.children.push(f(b.content,_,y))}else b.children.unshift(l(y)),b.children.push(c(y))}function u(b,y){var _=new y("html_inline","",0),x=t?' disabled="" ':"";return b.content.indexOf("[ ] ")===0?_.content='<input class="task-list-item-checkbox"'+x+'type="checkbox">':(b.content.indexOf("[x] ")===0||b.content.indexOf("[X] ")===0)&&(_.content='<input class="task-list-item-checkbox" checked=""'+x+'type="checkbox">'),_}function l(b){var y=new b("html_inline","",0);return y.content="<label>",y}function c(b){var y=new b("html_inline","",0);return y.content="</label>",y}function f(b,y,_){var x=new _("html_inline","",0);return x.content='<label class="task-list-item-label" for="'+y+'">'+b+"</label>",x.attrs=[{for:y}],x}function h(b){return b.type==="inline"}function p(b){return b.type==="paragraph_open"}function m(b){return b.type==="list_item_open"}function g(b){return b.content.indexOf("[ ] ")===0||b.content.indexOf("[x] ")===0||b.content.indexOf("[X] ")===0}return markdownItTaskLists}var markdownItTaskListsExports=requireMarkdownItTaskLists();const taskListPlugin=getDefaultExportFromCjs(markdownItTaskListsExports);var __defProp=Object.defineProperty,__defNormalProp=(t,e,n)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,__publicField=(t,e,n)=>(__defNormalProp(t,typeof e!="symbol"?e+"":e,n),n);const MarkdownTightLists=Extension.create({name:"markdownTightLists",addOptions:()=>({tight:!0,tightClass:"tight",listTypes:["bulletList","orderedList"]}),addGlobalAttributes(){return[{types:this.options.listTypes,attributes:{tight:{default:this.options.tight,parseHTML:t=>t.getAttribute("data-tight")==="true"||!t.querySelector("p"),renderHTML:t=>({class:t.tight?this.options.tightClass:null,"data-tight":t.tight?"true":null})}}}]},addCommands(){var t=this;return{toggleTight:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return n=>{let{editor:r,commands:s}=n;function o(a){if(!r.isActive(a))return!1;const u=r.getAttributes(a);return s.updateAttributes(a,{tight:e??!(u!=null&&u.tight)})}return t.options.listTypes.some(a=>o(a))}}}}}),md=MarkdownIt();function scanDelims(t,e){return md.inline.State.prototype.scanDelims.call({src:t,posMax:t.length}),new md.inline.State(t,null,null,[]).scanDelims(e,!0)}function shiftDelim(t,e,n,r){let s=t.substring(0,n)+t.substring(n+e.length);return s=s.substring(0,n+r)+e+s.substring(n+r),s}function trimStart(t,e,n,r){let s=n,o=t;for(;s<r&&!scanDelims(o,s).can_open;)o=shiftDelim(o,e,s,1),s++;return{text:o,from:s,to:r}}function trimEnd(t,e,n,r){let s=r,o=t;for(;s>n&&!scanDelims(o,s).can_close;)o=shiftDelim(o,e,s,-1),s--;return{text:o,from:n,to:s}}function trimInline(t,e,n,r){let s={text:t,from:n,to:r};return s=trimStart(s.text,e,s.from,s.to),s=trimEnd(s.text,e,s.from,s.to),s.to-s.from<e.length+1&&(s.text=s.text.substring(0,s.from)+s.text.substring(s.to+e.length)),s.text}class MarkdownSerializerState extends MarkdownSerializerState$1{constructor(e,n,r){super(e,n,r??{}),__publicField(this,"inTable",!1),this.inlines=[]}render(e,n,r){super.render(e,n,r);const s=this.inlines[this.inlines.length-1];if(s!=null&&s.start&&s!==null&&s!==void 0&&s.end){const{delimiter:o,start:a,end:u}=this.normalizeInline(s);this.out=trimInline(this.out,o,a,u),this.inlines.pop()}}markString(e,n,r,s){const o=this.marks[e.type.name];if(o.expelEnclosingWhitespace)if(n)this.inlines.push({start:this.out.length,delimiter:o.open});else{const a=this.inlines.pop();this.inlines.push({...a,end:this.out.length})}return super.markString(e,n,r,s)}normalizeInline(e){let{start:n,end:r}=e;for(;this.out.charAt(n).match(/\s/);)n++;return{...e,start:n}}}const HTMLMark=Mark.create({name:"markdownHTMLMark",addStorage(){return{markdown:{serialize:{open(t,e){var n,r;return this.editor.storage.markdown.options.html?(n=(r=getMarkTags(e))===null||r===void 0?void 0:r[0])!==null&&n!==void 0?n:"":(console.warn(`Tiptap Markdown: "${e.type.name}" mark is only available in html mode`),"")},close(t,e){var n,r;return this.editor.storage.markdown.options.html&&(n=(r=getMarkTags(e))===null||r===void 0?void 0:r[1])!==null&&n!==void 0?n:""}},parse:{}}}}});function getMarkTags(t){const e=t.type.schema,n=e.text(" ",[t]),s=getHTMLFromFragment(Fragment.from(n),e).match(/^(<.*?>) (<\/.*?>)$/);return s?[s[1],s[2]]:null}function elementFromString(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function escapeHTML(t){return t==null?void 0:t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function extractElement(t){const e=t.parentElement,n=e.cloneNode();for(;e.firstChild&&e.firstChild!==t;)n.appendChild(e.firstChild);n.childNodes.length>0&&e.parentElement.insertBefore(n,e),e.parentElement.insertBefore(t,e),e.childNodes.length===0&&e.remove()}function unwrapElement(t){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}const HTMLNode=Node$1.create({name:"markdownHTMLNode",addStorage(){return{markdown:{serialize(t,e,n){this.editor.storage.markdown.options.html?t.write(serializeHTML(e,n)):(console.warn(`Tiptap Markdown: "${e.type.name}" node is only available in html mode`),t.write(`[${e.type.name}]`)),e.isBlock&&t.closeBlock(e)},parse:{}}}}});function serializeHTML(t,e){const n=t.type.schema,r=getHTMLFromFragment(Fragment.from(t),n);return t.isBlock&&(e instanceof Fragment||e.type.name===n.topNodeType.name)?formatBlock(r):r}function formatBlock(t){const n=elementFromString(t).firstElementChild;return n.innerHTML=n.innerHTML.trim()?`
${n.innerHTML}
`:`
`,n.outerHTML}const Blockquote=Node$1.create({name:"blockquote"}),Blockquote$1=Blockquote.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.blockquote,parse:{}}}}}),BulletList=Node$1.create({name:"bulletList"}),BulletList$1=BulletList.extend({addStorage(){return{markdown:{serialize(t,e){return t.renderList(e,"  ",()=>(this.editor.storage.markdown.options.bulletListMarker||"-")+" ")},parse:{}}}}}),CodeBlock=Node$1.create({name:"codeBlock"}),CodeBlock$1=CodeBlock.extend({addStorage(){return{markdown:{serialize(t,e){t.write("```"+(e.attrs.language||"")+`
`),t.text(e.textContent,!1),t.ensureNewLine(),t.write("```"),t.closeBlock(e)},parse:{setup(t){var e;t.set({langPrefix:(e=this.options.languageClassPrefix)!==null&&e!==void 0?e:"language-"})},updateDOM(t){t.innerHTML=t.innerHTML.replace(/\n<\/code><\/pre>/g,"</code></pre>")}}}}}}),HardBreak=Node$1.create({name:"hardBreak"}),HardBreak$1=HardBreak.extend({addStorage(){return{markdown:{serialize(t,e,n,r){for(let s=r+1;s<n.childCount;s++)if(n.child(s).type!=e.type){t.write(t.inTable?HTMLNode.storage.markdown.serialize.call(this,t,e,n):`\\
`);return}},parse:{}}}}}),Heading=Node$1.create({name:"heading"}),Heading$1=Heading.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.heading,parse:{}}}}}),HorizontalRule=Node$1.create({name:"horizontalRule"}),HorizontalRule$1=HorizontalRule.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.horizontal_rule,parse:{}}}}}),Image=Node$1.create({name:"image"}),Image$1=Image.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.image,parse:{}}}}}),ListItem=Node$1.create({name:"listItem"}),ListItem$1=ListItem.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.list_item,parse:{}}}}}),OrderedList=Node$1.create({name:"orderedList"});function findIndexOfAdjacentNode(t,e,n){let r=0;for(;n-r>0&&e.child(n-r-1).type.name===t.type.name;r++);return r}const OrderedList$1=OrderedList.extend({addStorage(){return{markdown:{serialize(t,e,n,r){const s=e.attrs.start||1,o=String(s+e.childCount-1).length,a=t.repeat(" ",o+2),l=findIndexOfAdjacentNode(e,n,r)%2?") ":". ";t.renderList(e,a,c=>{const f=String(s+c);return t.repeat(" ",o-f.length)+f+l})},parse:{}}}}}),Paragraph=Node$1.create({name:"paragraph"}),Paragraph$1=Paragraph.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.paragraph,parse:{}}}}});function childNodes(t){var e,n;return(e=t==null||(n=t.content)===null||n===void 0?void 0:n.content)!==null&&e!==void 0?e:[]}const Table=Node$1.create({name:"table"}),Table$1=Table.extend({addStorage(){return{markdown:{serialize(t,e,n){if(!isMarkdownSerializable(e)){HTMLNode.storage.markdown.serialize.call(this,t,e,n);return}t.inTable=!0,e.forEach((r,s,o)=>{if(t.write("| "),r.forEach((a,u,l)=>{l&&t.write(" | ");const c=a.firstChild;c.textContent.trim()&&t.renderInline(c)}),t.write(" |"),t.ensureNewLine(),!o){const a=Array.from({length:r.childCount}).map(()=>"---").join(" | ");t.write(`| ${a} |`),t.ensureNewLine()}}),t.closeBlock(e),t.inTable=!1},parse:{}}}}});function hasSpan(t){return t.attrs.colspan>1||t.attrs.rowspan>1}function isMarkdownSerializable(t){const e=childNodes(t),n=e[0],r=e.slice(1);return!(childNodes(n).some(s=>s.type.name!=="tableHeader"||hasSpan(s)||s.childCount>1)||r.some(s=>childNodes(s).some(o=>o.type.name==="tableHeader"||hasSpan(o)||o.childCount>1)))}const TaskItem=Node$1.create({name:"taskItem"}),TaskItem$1=TaskItem.extend({addStorage(){return{markdown:{serialize(t,e){const n=e.attrs.checked?"[x]":"[ ]";t.write(`${n} `),t.renderContent(e)},parse:{updateDOM(t){[...t.querySelectorAll(".task-list-item")].forEach(e=>{const n=e.querySelector("input");e.setAttribute("data-type","taskItem"),n&&(e.setAttribute("data-checked",n.checked),n.remove())})}}}}}}),TaskList=Node$1.create({name:"taskList"}),TaskList$1=TaskList.extend({addStorage(){return{markdown:{serialize:BulletList$1.storage.markdown.serialize,parse:{setup(t){t.use(taskListPlugin)},updateDOM(t){[...t.querySelectorAll(".contains-task-list")].forEach(e=>{e.setAttribute("data-type","taskList")})}}}}}}),Text$1=Node$1.create({name:"text"}),Text$1$1=Text$1.extend({addStorage(){return{markdown:{serialize(t,e){t.text(escapeHTML(e.text))},parse:{}}}}}),Bold=Mark.create({name:"bold"}),Bold$1=Bold.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.marks.strong,parse:{}}}}}),Code=Mark.create({name:"code"}),Code$1=Code.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.marks.code,parse:{}}}}}),Italic=Mark.create({name:"italic"}),Italic$1=Italic.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.marks.em,parse:{}}}}}),Link=Mark.create({name:"link"}),Link$1=Link.extend({addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.marks.link,parse:{}}}}}),Strike=Mark.create({name:"strike"}),Strike$1=Strike.extend({addStorage(){return{markdown:{serialize:{open:"~~",close:"~~",expelEnclosingWhitespace:!0},parse:{}}}}}),markdownExtensions=[Blockquote$1,BulletList$1,CodeBlock$1,HardBreak$1,Heading$1,HorizontalRule$1,HTMLNode,Image$1,ListItem$1,OrderedList$1,Paragraph$1,Table$1,TaskItem$1,TaskList$1,Text$1$1,Bold$1,Code$1,HTMLMark,Italic$1,Link$1,Strike$1];function getMarkdownSpec(t){var e,n;const r=(e=t.storage)===null||e===void 0?void 0:e.markdown,s=(n=markdownExtensions.find(o=>o.name===t.name))===null||n===void 0?void 0:n.storage.markdown;return r||s?{...s,...r}:null}class MarkdownSerializer{constructor(e){__publicField(this,"editor",null),this.editor=e}serialize(e){const n=new MarkdownSerializerState(this.nodes,this.marks,{hardBreakNodeName:HardBreak$1.name});return n.renderContent(e),n.out}get nodes(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.nodes).map(n=>[n,this.serializeNode(HTMLNode)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(n=>n.type==="node"&&this.serializeNode(n)).map(n=>[n.name,this.serializeNode(n)]))!==null&&e!==void 0?e:[])}}get marks(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.marks).map(n=>[n,this.serializeMark(HTMLMark)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(n=>n.type==="mark"&&this.serializeMark(n)).map(n=>[n.name,this.serializeMark(n)]))!==null&&e!==void 0?e:[])}}serializeNode(e){var n;return(n=getMarkdownSpec(e))===null||n===void 0||(n=n.serialize)===null||n===void 0?void 0:n.bind({editor:this.editor,options:e.options})}serializeMark(e){var n;const r=(n=getMarkdownSpec(e))===null||n===void 0?void 0:n.serialize;return r?{...r,open:typeof r.open=="function"?r.open.bind({editor:this.editor,options:e.options}):r.open,close:typeof r.close=="function"?r.close.bind({editor:this.editor,options:e.options}):r.close}:null}}class MarkdownParser{constructor(e,n){__publicField(this,"editor",null),__publicField(this,"md",null);let{html:r,linkify:s,breaks:o}=n;this.editor=e,this.md=this.withPatchedRenderer(MarkdownIt({html:r,linkify:s,breaks:o}))}parse(e){let{inline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){this.editor.extensionManager.extensions.forEach(o=>{var a;return(a=getMarkdownSpec(o))===null||a===void 0||(a=a.parse)===null||a===void 0||(a=a.setup)===null||a===void 0?void 0:a.call({editor:this.editor,options:o.options},this.md)});const r=this.md.render(e),s=elementFromString(r);return this.editor.extensionManager.extensions.forEach(o=>{var a;return(a=getMarkdownSpec(o))===null||a===void 0||(a=a.parse)===null||a===void 0||(a=a.updateDOM)===null||a===void 0?void 0:a.call({editor:this.editor,options:o.options},s)}),this.normalizeDOM(s,{inline:n,content:e}),s.innerHTML}return e}normalizeDOM(e,n){let{inline:r,content:s}=n;return this.normalizeBlocks(e),e.querySelectorAll("*").forEach(o=>{var a;((a=o.nextSibling)===null||a===void 0?void 0:a.nodeType)===Node.TEXT_NODE&&!o.closest("pre")&&(o.nextSibling.textContent=o.nextSibling.textContent.replace(/^\n/,""))}),r&&this.normalizeInline(e,s),e}normalizeBlocks(e){const r=Object.values(this.editor.schema.nodes).filter(s=>s.isBlock).map(s=>{var o;return(o=s.spec.parseDOM)===null||o===void 0?void 0:o.map(a=>a.tag)}).flat().filter(Boolean).join(",");r&&[...e.querySelectorAll(r)].forEach(s=>{s.parentElement.matches("p")&&extractElement(s)})}normalizeInline(e,n){var r;if((r=e.firstElementChild)!==null&&r!==void 0&&r.matches("p")){var s,o,a,u;const l=e.firstElementChild,{nextElementSibling:c}=l,f=(s=(o=n.match(/^\s+/))===null||o===void 0?void 0:o[0])!==null&&s!==void 0?s:"",h=c?"":(a=(u=n.match(/\s+$/))===null||u===void 0?void 0:u[0])!==null&&a!==void 0?a:"";if(n.match(/^\n\n/)){l.innerHTML=`${l.innerHTML}${h}`;return}unwrapElement(l),e.innerHTML=`${f}${e.innerHTML}${h}`}}withPatchedRenderer(e){const n=r=>function(){const s=r(...arguments);return s===`
`?s:s[s.length-1]===`
`?s.slice(0,-1):s};return e.renderer.rules.hardbreak=n(e.renderer.rules.hardbreak),e.renderer.rules.softbreak=n(e.renderer.rules.softbreak),e.renderer.rules.fence=n(e.renderer.rules.fence),e.renderer.rules.code_block=n(e.renderer.rules.code_block),e.renderer.renderToken=n(e.renderer.renderToken.bind(e.renderer)),e}}const MarkdownClipboard=Extension.create({name:"markdownClipboard",addOptions(){return{transformPastedText:!1,transformCopiedText:!1}},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("markdownClipboard"),props:{clipboardTextParser:(t,e,n)=>{if(n||!this.options.transformPastedText)return null;const r=this.editor.storage.markdown.parser.parse(t,{inline:!0});return DOMParser.fromSchema(this.editor.schema).parseSlice(elementFromString(r),{preserveWhitespace:!0,context:e})},clipboardTextSerializer:t=>this.options.transformCopiedText?this.editor.storage.markdown.serializer.serialize(t.content):null}})]}}),Markdown=Extension.create({name:"markdown",priority:50,addOptions(){return{html:!0,tightLists:!0,tightListClass:"tight",bulletListMarker:"-",linkify:!1,breaks:!1,transformPastedText:!1,transformCopiedText:!1}},addCommands(){const t=index.Commands.config.addCommands();return{setContent:(e,n,r)=>s=>t.setContent(s.editor.storage.markdown.parser.parse(e),n,r)(s),insertContentAt:(e,n,r)=>s=>t.insertContentAt(e,s.editor.storage.markdown.parser.parse(n,{inline:!0}),r)(s)}},onBeforeCreate(){this.editor.storage.markdown={options:{...this.options},parser:new MarkdownParser(this.editor,this.options),serializer:new MarkdownSerializer(this.editor),getMarkdown:()=>this.editor.storage.markdown.serializer.serialize(this.editor.state.doc)},this.editor.options.initialContent=this.editor.options.content,this.editor.options.content=this.editor.storage.markdown.parser.parse(this.editor.options.content)},onCreate(){this.editor.options.content=this.editor.options.initialContent,delete this.editor.options.initialContent},addStorage(){return{}},addExtensions(){return[MarkdownTightLists.configure({tight:this.options.tightLists,tightClass:this.options.tightListClass}),MarkdownClipboard.configure({transformPastedText:this.options.transformPastedText,transformCopiedText:this.options.transformCopiedText})]}});var root_1$5=template('<div class="error-message svelte-qdd10c"> </div>'),root_2$3=template(`<input type="text" placeholder="Enter card status"> <div class="status-help svelte-qdd10c">This card's status doesn't match any column. You can edit it to match any of the column names.</div>`,1),root_3$4=template('<div class="status-display svelte-qdd10c"> </div>'),root_4$1=template('<div class="assignee-item svelte-qdd10c"><span> </span> <button type="button" class="remove-btn svelte-qdd10c">&times;</button></div>'),root_5$1=template('<div class="attachment-item svelte-qdd10c"><a target="_blank" rel="noopener noreferrer" class="svelte-qdd10c"> </a> <button type="button" class="remove-btn svelte-qdd10c">&times;</button></div>'),root$8=template('<div class="modal-backdrop svelte-qdd10c"><div class="modal svelte-qdd10c"><header class="svelte-qdd10c"><input type="text" class="title-input svelte-qdd10c" placeholder="Card Title"> <button class="close-btn svelte-qdd10c">&times;</button></header> <div class="content svelte-qdd10c"><!> <div class="section svelte-qdd10c"><label class="svelte-qdd10c">Status</label> <!></div> <div class="section svelte-qdd10c"><label for="description" class="svelte-qdd10c">Description (Markdown supported)</label> <div class="editor-wrapper svelte-qdd10c"><div class="editor svelte-qdd10c"></div></div> <div class="editor-help svelte-qdd10c">Supports Markdown: **bold**, *italic*, # heading, - list, etc.</div></div> <div class="section svelte-qdd10c"><label class="svelte-qdd10c">Assignees</label> <div class="assignees-list svelte-qdd10c"></div> <div class="add-assignee svelte-qdd10c"><input placeholder="Enter nostr pubkey" class="svelte-qdd10c"> <button type="button" class="svelte-qdd10c">Add Assignee</button></div></div> <div class="section svelte-qdd10c"><label class="svelte-qdd10c">Attachments</label> <div class="attachments-list svelte-qdd10c"></div> <div class="add-attachment svelte-qdd10c"><input placeholder="Enter link URL" type="url" class="svelte-qdd10c"> <button type="button" class="svelte-qdd10c">Add Link</button></div></div></div> <footer class="svelte-qdd10c"><button type="button" class="cancel svelte-qdd10c">Cancel</button> <button type="button" class="save svelte-qdd10c"> </button></footer></div></div>');function CardDetails(t,e){push$1(e,!1);let n=prop(e,"card",8),r=prop(e,"boardId",8),s=prop(e,"onClose",8),o=prop(e,"isUnmapped",8,!1),a=mutable_state(n().title),u=mutable_state(n().status),l=n().description,c=mutable_state(""),f=mutable_state([...n().attachments||[]]),h=mutable_state(""),p=mutable_state([...n().assignees||[]]),m,g=mutable_state(),b=mutable_state(!1),y=mutable_state(null);onMount(()=>{m=new Editor({element:get$1(g),extensions:[StarterKit,Markdown.configure({html:!1,transformPastedText:!0,transformCopiedText:!0})],content:l,onUpdate:({editor:V})=>{l=V.storage.markdown.getMarkdown()}})}),onDestroy(()=>{m&&m.destroy()});function _(){get$1(c).trim()&&(set(f,[...get$1(f),get$1(c).trim()]),set(c,""))}function x(V){set(f,get$1(f).filter((te,ce)=>ce!==V))}function E(){get$1(h).trim()&&!get$1(p).includes(get$1(h).trim())&&(set(p,[...get$1(p),get$1(h).trim()]),set(h,""))}function A(V){set(p,get$1(p).filter((te,ce)=>ce!==V))}async function v(){if(get$1(a).trim())try{set(b,!0),set(y,null),await kanbanStore.updateCard(r(),{...n(),title:get$1(a).trim(),status:get$1(u).trim(),description:l.trim(),attachments:get$1(f),assignees:get$1(p)}),s()()}catch(V){console.error("Failed to save card:",V),set(y,V.message||"Failed to save card")}finally{set(b,!1)}}function w(V){return V.slice(0,8)+"..."+V.slice(-8)}init();var k=root$8(),S=child(k),T=child(S),O=child(T),C=sibling(O,2),R=sibling(T,2),M=child(R);{var I=V=>{var te=root_1$5(),ce=child(te);template_effect(()=>set_text(ce,get$1(y))),append(V,te)};if_block(M,V=>{get$1(y)&&V(I)})}var D=sibling(M,2),N=sibling(child(D),2);{var F=V=>{var te=root_2$3(),ce=first_child(te);bind_value(ce,()=>get$1(u),le=>set(u,le)),append(V,te)},z=V=>{var te=root_3$4(),ce=child(te);template_effect(()=>set_text(ce,get$1(u))),append(V,te)};if_block(N,V=>{o()?V(F):V(z,!1)})}var U=sibling(D,2),L=sibling(child(U),2),B=child(L);bind_this(B,V=>set(g,V),()=>get$1(g));var H=sibling(U,2),j=sibling(child(H),2);each(j,5,()=>get$1(p),index$1,(V,te,ce)=>{var le=root_4$1(),de=child(le),pe=child(de);template_effect(()=>set_text(pe,w(get$1(te))));var me=sibling(de,2);event("click",me,()=>A(ce)),append(V,le)});var G=sibling(j,2),W=child(G),Q=sibling(W,2),se=sibling(H,2),X=sibling(child(se),2);each(X,5,()=>get$1(f),index$1,(V,te,ce)=>{var le=root_5$1(),de=child(le),pe=child(de),me=sibling(de,2);template_effect(()=>{set_attribute(de,"href",get$1(te)),set_text(pe,get$1(te))}),event("click",me,()=>x(ce)),append(V,le)});var ue=sibling(X,2),K=child(ue),ne=sibling(K,2),q=sibling(R,2),J=child(q),Y=sibling(J,2),re=child(Y);template_effect(()=>{Y.disabled=get$1(b),set_text(re,get$1(b)?"Saving...":"Save Changes")}),bind_value(O,()=>get$1(a),V=>set(a,V)),event("click",C,function(...V){var te;(te=s())==null||te.apply(this,V)}),bind_value(W,()=>get$1(h),V=>set(h,V)),event("keydown",W,V=>V.key==="Enter"&&(V.preventDefault(),E())),event("click",Q,E),bind_value(K,()=>get$1(c),V=>set(c,V)),event("keydown",K,V=>V.key==="Enter"&&(V.preventDefault(),_())),event("click",ne,_),event("click",J,function(...V){var te;(te=s())==null||te.apply(this,V)}),event("click",Y,v),event("click",S,stopPropagation(function(V){bubble_event.call(this,e,V)})),event("click",k,function(...V){var te;(te=s())==null||te.apply(this,V)}),append(t,k),pop()}var root_4=template('<span class="assignee svelte-194tdlk"> </span>'),root_3$3=template('<div class="assignees svelte-194tdlk"></div>'),root_5=template('<div class="attachments svelte-194tdlk"><span> </span></div>'),root$7=template('<div class="card svelte-194tdlk" draggable="true"><div class="card-header svelte-194tdlk"><h4 class="svelte-194tdlk"> </h4> <button class="permalink-button svelte-194tdlk" title="Copy permalink"><!></button></div> <div class="card-footer svelte-194tdlk"><!> <!></div></div> <!>',1);function Card(t,e){push$1(e,!1);let n=prop(e,"card",8),r=prop(e,"boardId",8),s=prop(e,"boardPubkey",8),o=prop(e,"isUnmapped",8,!1),a=prop(e,"showDetails",12,!1),u=mutable_state(!1),l;function c(){l&&clearTimeout(l);const I=`${window.location.origin}/#/board/${s()}/${r()}/${n().pubkey}/${n().id}`;navigator.clipboard.writeText(I).then(()=>{set(u,!0),l=setTimeout(()=>{set(u,!1)},2e3)})}function f(){a(!0)}function h(){a(!1)}function p(I){I.dataTransfer&&(I.dataTransfer.effectAllowed="move",I.dataTransfer.setData("application/json",JSON.stringify({cardId:n().id,sourceStatus:n().status,order:n().order})))}function m(I){return I.slice(0,4)+"..."+I.slice(-4)}init();var g=root$7(),b=first_child(g),y=child(b),_=child(y),x=child(_),E=sibling(_,2),A=child(E);{var v=I=>{var D=text$1("");append(I,D)},w=I=>{var D=text$1("");append(I,D)};if_block(A,I=>{get$1(u)?I(v):I(w,!1)})}var k=sibling(y,2),S=child(k);{var T=I=>{var D=root_3$3();each(D,5,()=>n().assignees,index$1,(N,F)=>{var z=root_4(),U=child(z);template_effect(()=>set_text(U,m(get$1(F)))),append(N,z)}),append(I,D)};if_block(S,I=>{n().assignees&&n().assignees.length>0&&I(T)})}var O=sibling(S,2);{var C=I=>{var D=root_5(),N=child(D),F=child(N);template_effect(()=>set_text(F,` ${n().attachments.length??""}`)),append(I,D)};if_block(O,I=>{n().attachments&&n().attachments.length>0&&I(C)})}var R=sibling(b,2);{var M=I=>{CardDetails(I,{get card(){return n()},get boardId(){return r()},get isUnmapped(){return o()},onClose:h})};if_block(R,I=>{a()&&I(M)})}template_effect(()=>set_text(x,n().title)),event("click",_,f),event("click",E,stopPropagation(c)),event("click",k,f),event("click",b,f),event("dragstart",b,p),append(t,g),pop()}var root_1$4=template('<div class="assignee-item svelte-4vvwnt"><span> </span> <button type="button" class="remove-btn svelte-4vvwnt">&times;</button></div>'),root_2$2=template('<div class="attachment-item svelte-4vvwnt"><a target="_blank" rel="noopener noreferrer" class="svelte-4vvwnt"> </a> <button type="button" class="remove-btn svelte-4vvwnt">&times;</button></div>'),root$6=template('<div class="modal-backdrop svelte-4vvwnt"><div class="modal svelte-4vvwnt"><header class="svelte-4vvwnt"><h2 class="svelte-4vvwnt">Create New Card</h2> <button class="close-btn svelte-4vvwnt">&times;</button></header> <form><div class="form-group svelte-4vvwnt"><label for="title" class="svelte-4vvwnt">Title</label> <input id="title" placeholder="Enter card title" required class="svelte-4vvwnt"></div> <div class="form-group svelte-4vvwnt"><label for="description" class="svelte-4vvwnt">Description (Markdown supported)</label> <div class="editor-wrapper svelte-4vvwnt"><div class="editor svelte-4vvwnt"></div></div> <div class="editor-help svelte-4vvwnt">Supports Markdown: **bold**, *italic*, # heading, - list, etc.</div></div> <div class="form-group svelte-4vvwnt"><label class="svelte-4vvwnt">Assignees</label> <div class="assignees-list svelte-4vvwnt"></div> <div class="add-assignee svelte-4vvwnt"><input placeholder="Enter nostr pubkey" class="svelte-4vvwnt"> <button type="button" class="svelte-4vvwnt">Add Assignee</button></div></div> <div class="form-group svelte-4vvwnt"><label class="svelte-4vvwnt">Attachments</label> <div class="attachments-list svelte-4vvwnt"></div> <div class="add-attachment svelte-4vvwnt"><input placeholder="Enter link URL" type="url" class="svelte-4vvwnt"> <button type="button" class="svelte-4vvwnt">Add Link</button></div></div> <div class="actions svelte-4vvwnt"><button type="button" class="cancel svelte-4vvwnt">Cancel</button> <button type="submit" class="create svelte-4vvwnt">Create Card</button></div></form></div></div> <!>',1);function CreateCard(t,e){push$1(e,!1);let n=prop(e,"onClose",8),r=prop(e,"columnName",8),s=prop(e,"boardId",8),o=prop(e,"cardsCount",8),a=mutable_state(""),u="",l=mutable_state(""),c=mutable_state([]),f=mutable_state(""),h=mutable_state([]),p,m=mutable_state(),g=mutable_state(null);onMount(()=>{p=new Editor({element:get$1(m),extensions:[StarterKit,Markdown.configure({html:!1,transformPastedText:!0,transformCopiedText:!0})],content:"",onUpdate:({editor:K})=>{u=K.storage.markdown.getMarkdown()}})}),onDestroy(()=>{p&&p.destroy()});function b(){get$1(l).trim()&&(set(c,[...get$1(c),get$1(l).trim()]),set(l,""))}function y(K){set(c,get$1(c).filter((ne,q)=>q!==K))}function _(){get$1(f).trim()&&!get$1(h).includes(get$1(f).trim())&&(set(h,[...get$1(h),get$1(f).trim()]),set(f,""))}function x(K){set(h,get$1(h).filter((ne,q)=>q!==K))}async function E(){if(get$1(a).trim())try{await kanbanStore.createCard(s(),{title:get$1(a),description:u.trim(),status:r(),order:o()*10,attachments:get$1(c),assignees:get$1(h)}),n()()}catch(K){set(g,K instanceof Error?K.message:"Failed to create card")}}function A(K){return K.slice(0,8)+"..."+K.slice(-8)}init();var v=root$6(),w=first_child(v),k=child(w),S=child(k),T=sibling(child(S),2),O=sibling(S,2),C=child(O),R=sibling(child(C),2),M=sibling(C,2),I=sibling(child(M),2),D=child(I);bind_this(D,K=>set(m,K),()=>get$1(m));var N=sibling(M,2),F=sibling(child(N),2);each(F,5,()=>get$1(h),index$1,(K,ne,q)=>{var J=root_1$4(),Y=child(J),re=child(Y);template_effect(()=>set_text(re,A(get$1(ne))));var V=sibling(Y,2);event("click",V,()=>x(q)),append(K,J)});var z=sibling(F,2),U=child(z),L=sibling(U,2),B=sibling(N,2),H=sibling(child(B),2);each(H,5,()=>get$1(c),index$1,(K,ne,q)=>{var J=root_2$2(),Y=child(J),re=child(Y),V=sibling(Y,2);template_effect(()=>{set_attribute(Y,"href",get$1(ne)),set_text(re,get$1(ne))}),event("click",V,()=>y(q)),append(K,J)});var j=sibling(H,2),G=child(j),W=sibling(G,2),Q=sibling(B,2),se=child(Q),X=sibling(w,2);{var ue=K=>{AlertModal(K,{get message(){return get$1(g)},onClose:()=>set(g,null)})};if_block(X,K=>{get$1(g)&&K(ue)})}event("click",T,function(...K){var ne;(ne=n())==null||ne.apply(this,K)}),bind_value(R,()=>get$1(a),K=>set(a,K)),bind_value(U,()=>get$1(f),K=>set(f,K)),event("keydown",U,K=>K.key==="Enter"&&(K.preventDefault(),_())),event("click",L,_),bind_value(G,()=>get$1(l),K=>set(l,K)),event("keydown",G,K=>K.key==="Enter"&&(K.preventDefault(),b())),event("click",W,b),event("click",se,function(...K){var ne;(ne=n())==null||ne.apply(this,K)}),event("submit",O,preventDefault(E)),event("click",k,stopPropagation(function(K){bubble_event.call(this,e,K)})),event("click",w,function(...K){var ne;(ne=n())==null||ne.apply(this,K)}),append(t,v),pop()}var root_1$3=template('<button class="delete-column-btn svelte-uvrhlf" title="Delete column"></button>'),root_2$1=template('<div class="card-wrapper svelte-uvrhlf"><!></div>'),root$5=template('<div class="column svelte-uvrhlf"><header class="column-header svelte-uvrhlf"><h3 class="svelte-uvrhlf"> </h3> <div class="column-actions svelte-uvrhlf"><!> <button class="add-card-btn svelte-uvrhlf">+ New Card</button></div></header> <div class="cards svelte-uvrhlf"><!> <div class="card-wrapper empty svelte-uvrhlf"></div></div> <!></div>');function Column(t,e){push$1(e,!1);let n=prop(e,"column",8),r=prop(e,"cards",8),s=prop(e,"boardId",8),o=prop(e,"boardPubkey",8),a=prop(e,"onCardDrop",8),u=prop(e,"isUnmapped",8,!1),l=prop(e,"cardToOpen",8,null),c=prop(e,"onDeleteColumn",8),f=mutable_state(!1),h=mutable_state(!1),p=null,m=mutable_state(!1);function g(){set(f,!0)}function b(){set(f,!1)}function y(F,z){if(u()){F.preventDefault();return}F.preventDefault(),F.dataTransfer.dropEffect="move",set(h,!0),p=z}function _(){set(h,!1),p=null}async function x(F){var B;if(u()){F.preventDefault();return}F.preventDefault(),set(h,!1);const z=(B=F.dataTransfer)==null?void 0:B.getData("application/json");if(!z)return;const{cardId:U}=JSON.parse(z),L=p;p=null,await a()(U,n().name,L)}function E(F){if(u()){F.preventDefault();return}F.preventDefault(),F.dataTransfer.dropEffect="move",set(h,!0),p=r().length}init();var A=root$5(),v=child(A),w=child(v),k=child(w),S=sibling(w,2),T=child(S);{var O=F=>{var z=root_1$3();event("click",z,stopPropagation(function(...U){var L;(L=c())==null||L.apply(this,U)})),append(F,z)};if_block(T,F=>{!u()&&get$1(m)&&F(O)})}var C=sibling(T,2),R=sibling(v,2),M=child(R);each(M,3,()=>r().sort((F,z)=>F.order-z.order),F=>F.id,(F,z,U)=>{var L=root_2$1(),B=child(L),H=derived_safe_equal(()=>{var j;return((j=l())==null?void 0:j.id)===get$1(z).id});Card(B,{get card(){return get$1(z)},get boardId(){return s()},get boardPubkey(){return o()},get isUnmapped(){return u()},get showDetails(){return get$1(H)}}),event("dragover",L,preventDefault(stopPropagation(j=>y(j,get$1(U))))),event("drop",L,preventDefault(stopPropagation(x))),append(F,L)});var I=sibling(M,2),D=sibling(R,2);{var N=F=>{CreateCard(F,{onClose:b,get columnName(){return n().name},get boardId(){return s()},get cardsCount(){return r().length}})};if_block(D,F=>{get$1(f)&&F(N)})}template_effect(()=>{toggle_class(A,"drag-over",get$1(h)),toggle_class(A,"unmapped",u()),set_text(k,n().name)}),event("click",C,g),event("dragover",I,preventDefault(stopPropagation(F=>y(F,r().length)))),event("drop",I,preventDefault(stopPropagation(x))),event("mouseenter",A,()=>set(m,!0)),event("mouseleave",A,()=>set(m,!1)),event("dragleave",A,_),event("drop",A,x),event("dragover",A,preventDefault(E)),append(t,A),pop()}var root$4=template('<div class="modal-backdrop svelte-16u0833"><div class="modal svelte-16u0833"><div class="modal-content svelte-16u0833"><p class="svelte-16u0833"> </p> <div class="modal-actions svelte-16u0833"><button class="cancel-button svelte-16u0833">Cancel</button> <button class="confirm-button svelte-16u0833">Confirm</button></div></div></div></div>');function ConfirmModal(t,e){let n=prop(e,"message",8),r=prop(e,"onConfirm",8),s=prop(e,"onCancel",8);var o=root$4(),a=child(o),u=child(a),l=child(u),c=child(l),f=sibling(l,2),h=child(f),p=sibling(h,2);template_effect(()=>set_text(c,n())),event("click",h,function(...m){var g;(g=s())==null||g.apply(this,m)}),event("click",p,function(...m){var g;(g=r())==null||g.apply(this,m)}),event("click",a,stopPropagation(function(m){bubble_event.call(this,e,m)})),event("click",o,function(...m){var g;(g=s())==null||g.apply(this,m)}),append(t,o)}var root_1$2=template('<div class="column-item svelte-vzraui"><span> </span> <div class="actions svelte-vzraui"><button class="move-btn svelte-vzraui" title="Move up"></button> <button class="move-btn svelte-vzraui" title="Move down"></button></div></div>'),root$3=template('<div class="modal-backdrop svelte-vzraui"><div class="modal svelte-vzraui"><div class="modal-content"><h3 class="svelte-vzraui">Reorder Columns</h3> <div class="columns-list svelte-vzraui"></div> <div class="modal-actions svelte-vzraui"><button class="cancel-button svelte-vzraui">Cancel</button> <button class="save-button svelte-vzraui">Save Order</button></div></div></div></div>');function ReorderColumnsModal(t,e){push$1(e,!1);let n=prop(e,"columns",8),r=prop(e,"onSave",8),s=prop(e,"onClose",8),o=mutable_state([...n()]);function a(b,y){const _=y==="up"?b-1:b+1;if(_<0||_>=get$1(o).length)return;const x=[...get$1(o)];[x[b],x[_]]=[x[_],x[b]],set(o,x)}function u(){const b=get$1(o).map((y,_)=>({...y,order:_}));r()(b)}init();var l=root$3(),c=child(l),f=child(c),h=sibling(child(f),2);each(h,7,()=>get$1(o),b=>b.id,(b,y,_)=>{var x=root_1$2(),E=child(x),A=child(E),v=sibling(E,2),w=child(v),k=sibling(w,2);template_effect(()=>{set_text(A,get$1(y).name),w.disabled=get$1(_)===0,k.disabled=get$1(_)===get$1(o).length-1}),event("click",w,()=>a(get$1(_),"up")),event("click",k,()=>a(get$1(_),"down")),append(b,x)});var p=sibling(h,2),m=child(p),g=sibling(m,2);event("click",m,function(...b){var y;(y=s())==null||y.apply(this,b)}),event("click",g,u),event("click",c,stopPropagation(function(b){bubble_event.call(this,e,b)})),event("click",l,function(...b){var y;(y=s())==null||y.apply(this,b)}),append(t,l),pop()}var root_1$1=template('<div class="loading svelte-1o5h7j9">Loading cards...</div>'),root_3$2=template('<div class="add-column-form svelte-1o5h7j9"><input type="text" placeholder="Enter column name" class="svelte-1o5h7j9"> <div class="add-column-actions svelte-1o5h7j9"><button class="save svelte-1o5h7j9">Save</button> <button class="cancel svelte-1o5h7j9">Cancel</button></div></div>'),root_2=template("<!> <!> <!>",1),root$2=template('<div class="board svelte-1o5h7j9"><header class="board-header svelte-1o5h7j9"><div class="header-content svelte-1o5h7j9"><h2 class="svelte-1o5h7j9"> </h2> <p> </p></div> <div class="header-actions svelte-1o5h7j9"><button class="board-btn svelte-1o5h7j9"> Reorder Columns</button> <button class="add-column-btn svelte-1o5h7j9">+ Add Column</button></div></header> <div class="columns svelte-1o5h7j9"><!></div></div> <!> <!> <!> <!>',1);function Board(t,e){push$1(e,!1);const n=mutable_state(),r=mutable_state();let s=prop(e,"board",12),o=prop(e,"initialCardToOpen",8,void 0),a=mutable_state([]),u=mutable_state(!0),l=mutable_state(null),c=mutable_state(!1),f=mutable_state(""),h=mutable_state(!1),p=mutable_state(!1),m=mutable_state(""),g=mutable_state(""),b=mutable_state(null),y=mutable_state(!1),_=mutable_state(null);onMount(()=>{const q=kanbanStore.subscribe(Y=>{const V=Y.boards.find(te=>te.id===s().id);V&&s(V)});return(async()=>{try{await kanbanStore.loadCardsForBoard(s().id);const Y=kanbanStore.subscribe(re=>{if(set(a,re.cards.get(s().id)||[]),o()&&!get$1(l)){const V=get$1(a).find(te=>te.pubkey===o().pubkey&&te.id===o().id);V&&set(l,V)}});return set(u,!1),Y}catch(Y){return console.error("Failed to load cards:",Y),set(u,!1),()=>{}}})(),()=>{q()}});async function x(q,J,Y){const re=get$1(a).find(V=>V.id===q);if(!re){set(_,"Card not found");return}if(!(re.status===J&&Y===void 0))try{await kanbanStore.updateCard(s().id,{...re,status:J},Y)}catch(V){set(_,V instanceof Error?V.message:"Failed to move card")}}function E(q,J){const Y=new Set(J.map(re=>re.name));return q.filter(re=>!Y.has(re.status))}async function A(){if(get$1(f).trim())try{const q={id:crypto.randomUUID(),name:get$1(f).trim(),order:s().columns.length};await kanbanStore.updateBoard({...s(),columns:[...s().columns,q]}),set(c,!1),set(f,"")}catch(q){console.error("Failed to add column:",q)}}async function v(q){if(get$1(a).filter(Y=>Y.status===q).length>0){set(m,"Cannot delete column with cards. Move or delete the cards first."),set(h,!0);return}set(b,q),set(g,`Are you sure you want to delete the column "${q}"?`),set(p,!0)}async function w(){if(get$1(b)){try{await kanbanStore.updateBoard({...s(),columns:s().columns.filter(q=>q.name!==get$1(b))})}catch(q){console.error("Failed to delete column:",q),set(m,"Failed to delete column. Please try again."),set(h,!0)}set(p,!1),set(b,null)}}function k(q){q.key==="Enter"?A():q.key==="Escape"&&(set(c,!1),set(f,""))}async function S(q){try{await kanbanStore.updateBoard({...s(),columns:q}),set(y,!1)}catch(J){console.error("Failed to reorder columns:",J),set(m,"Failed to reorder columns. Please try again."),set(h,!0)}}legacy_pre_effect(()=>(get$1(a),deep_read_state(s())),()=>{set(n,E(get$1(a),s().columns))}),legacy_pre_effect(()=>get$1(n),()=>{set(r,get$1(n).length>0)}),legacy_pre_effect(()=>(get$1(l),deep_read_state(s()),get$1(a),get$1(r)),()=>{get$1(l)&&(s().columns.find(q=>get$1(a).some(J=>{var Y;return J.id===((Y=get$1(l))==null?void 0:Y.id)&&J.status===q.name}))||get$1(r))}),legacy_pre_effect_reset(),init();var T=root$2(),O=first_child(T),C=child(O),R=child(C),M=child(R),I=child(M),D=sibling(M,2),N=child(D),F=sibling(R,2),z=child(F),U=sibling(z,2),L=sibling(C,2),B=child(L);{var H=q=>{var J=root_1$1();append(q,J)},j=q=>{var J=root_2(),Y=first_child(J);{var re=le=>{var de=root_3$2(),pe=child(de);autofocus(pe);var me=sibling(pe,2),ae=child(me),oe=sibling(ae,2);bind_value(pe,()=>get$1(f),he=>set(f,he)),event("keydown",pe,k),event("click",ae,A),event("click",oe,()=>{set(c,!1),set(f,"")}),append(le,de)};if_block(Y,le=>{get$1(c)&&le(re)})}var V=sibling(Y,2);each(V,1,()=>s().columns,le=>le.id,(le,de)=>{var pe=derived_safe_equal(()=>get$1(a).filter(me=>me.status===get$1(de).name));Column(le,{get column(){return get$1(de)},get cards(){return get$1(pe)},get boardId(){return s().id},get boardPubkey(){return s().pubkey},onCardDrop:x,get cardToOpen(){return get$1(l)},onDeleteColumn:()=>v(get$1(de).name)})});var te=sibling(V,2);{var ce=le=>{var de=derived_safe_equal(()=>({id:"unmapped",name:"UNMAPPED",order:s().columns.length}));Column(le,{get column(){return get$1(de)},get cards(){return get$1(n)},get boardId(){return s().id},get boardPubkey(){return s().pubkey},onCardDrop:x,isUnmapped:!0,get cardToOpen(){return get$1(l)}})};if_block(te,le=>{get$1(r)&&le(ce)})}append(q,J)};if_block(B,q=>{get$1(u)?q(H):q(j,!1)})}var G=sibling(O,2);{var W=q=>{AlertModal(q,{get message(){return get$1(m)},onClose:()=>set(h,!1)})};if_block(G,q=>{get$1(h)&&q(W)})}var Q=sibling(G,2);{var se=q=>{ConfirmModal(q,{get message(){return get$1(g)},onConfirm:w,onCancel:()=>{set(p,!1),set(b,null)}})};if_block(Q,q=>{get$1(p)&&q(se)})}var X=sibling(Q,2);{var ue=q=>{ReorderColumnsModal(q,{get columns(){return s().columns},onSave:S,onClose:()=>set(y,!1)})};if_block(X,q=>{get$1(y)&&q(ue)})}var K=sibling(X,2);{var ne=q=>{AlertModal(q,{get message(){return get$1(_)},onClose:()=>set(_,null)})};if_block(K,q=>{get$1(_)&&q(ne)})}template_effect(()=>{set_text(I,s().title),set_text(N,s().description)}),event("click",z,()=>set(y,!0)),event("click",U,()=>set(c,!0)),append(t,T),pop()}var root_1=template('<div class="loading svelte-b8f57g">Loading board...</div>'),root_3$1=template('<div class="error svelte-b8f57g"><p> </p> <button class="svelte-b8f57g">Return to Boards</button></div>'),root$1=template('<div class="board-view svelte-b8f57g"><header><h2 class="svelte-b8f57g">Kanbanstr</h2> <button class="back-button svelte-b8f57g">&larr; Back to Boards</button></header> <!></div>');function BoardView(t,e){push$1(e,!1);let n=prop(e,"params",8),r=mutable_state(null),s=mutable_state(!0),o=mutable_state(null),a=n().cardId?{pubkey:n().cardpubkey,id:n().cardId}:void 0;onMount(()=>((async()=>{try{return ndkInstance.store.subscribe(_=>{_.isReady&&(kanbanStore.hasNDK()||kanbanStore.init(ndkInstance.ndk),u())})}catch{return set(o,"Failed to load board"),set(s,!1),()=>{}}})(),()=>{}));async function u(){console.trace();try{set(r,await kanbanStore.loadBoardByPubkeyAndId(n().pubkey,n().id)),get$1(r)||set(o,"Board not found")}catch{set(o,"Failed to load board")}finally{set(s,!1)}}function l(){push("/")}init();var c=root$1(),f=child(c),h=sibling(child(f),2),p=sibling(f,2);{var m=b=>{var y=root_1();append(b,y)},g=b=>{var y=comment$1(),_=first_child(y);{var x=A=>{var v=root_3$1(),w=child(v),k=child(w),S=sibling(w,2);template_effect(()=>set_text(k,get$1(o))),event("click",S,l),append(A,v)},E=A=>{var v=comment$1(),w=first_child(v);{var k=S=>{Board(S,{get board(){return get$1(r)},initialCardToOpen:a})};if_block(w,S=>{get$1(r)&&S(k)},!0)}append(A,v)};if_block(_,A=>{get$1(o)?A(x):A(E,!1)},!0)}append(b,y)};if_block(p,b=>{get$1(s)?b(m):b(g,!1)})}event("click",h,l),append(t,c),pop()}var root_3=template("<p>Loading...</p>"),root=template('<main class="svelte-1w0uoyz"><!></main>');function App(t,e){push$1(e,!1);let n=mutable_state(null),r=mutable_state(!1);const s={"/":BoardsList,"/board/:pubkey/:id":BoardView,"/board/:pubkey/:id/:cardpubkey/:cardId":BoardView};onMount(()=>ndkInstance.store.subscribe(f=>{set(n,f.user),f.loginMethod,set(r,f.isReady)})),init();var o=root(),a=child(o);{var u=c=>{Login(c,{})},l=c=>{var f=comment$1(),h=first_child(f);{var p=g=>{var b=root_3();append(g,b)},m=g=>{Router(g,{routes:s})};if_block(h,g=>{get$1(r)?g(m,!1):g(p)})}append(c,f)};if_block(a,c=>{get$1(n)?c(l,!1):c(u)})}append(t,o),pop()}mount(App,{target:document.getElementById("app")});
